(window["webpackJsonp_N_E"] = window["webpackJsonp_N_E"] || []).push([[3],{

/***/ "./node_modules/cos-js-sdk-v5/dist/cos-js-sdk-v5.js":
/*!**********************************************************!*\
  !*** ./node_modules/cos-js-sdk-v5/dist/cos-js-sdk-v5.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

(function webpackUniversalModuleDefinition(root, factory) {
	if(true)
		module.exports = factory();
	else {}
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "/dist/";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./index.js":
/*!******************!*\
  !*** ./index.js ***!
  \******************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var COS = __webpack_require__(/*! ./src/cos */ "./src/cos.js");

module.exports = COS;

/***/ }),

/***/ "./lib/beacon.min.js":
/*!***************************!*\
  !*** ./lib/beacon.min.js ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(global) {var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

!function (t, e) {
  "object" == ( false ? undefined : _typeof(exports)) && "undefined" != typeof module ? module.exports = e() :  true ? !(__WEBPACK_AMD_DEFINE_FACTORY__ = (e),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :
				__WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : undefined;
}(this, function () {
  "use strict";

  var _t = function t(e, r) {
    return (_t = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (t, e) {
      t.__proto__ = e;
    } || function (t, e) {
      for (var r in e) {
        Object.prototype.hasOwnProperty.call(e, r) && (t[r] = e[r]);
      }
    })(e, r);
  };

  var _e = function e() {
    return (_e = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function r(t, e, r, n) {
    return new (r || (r = Promise))(function (o, i) {
      function a(t) {
        try {
          c(n.next(t));
        } catch (t) {
          i(t);
        }
      }

      function s(t) {
        try {
          c(n.throw(t));
        } catch (t) {
          i(t);
        }
      }

      function c(t) {
        var e;
        t.done ? o(t.value) : (e = t.value, e instanceof r ? e : new r(function (t) {
          t(e);
        })).then(a, s);
      }

      c((n = n.apply(t, e || [])).next());
    });
  }

  function n(t, e) {
    var r,
        n,
        o,
        i,
        a = {
      label: 0,
      sent: function sent() {
        if (1 & o[0]) throw o[1];
        return o[1];
      },
      trys: [],
      ops: []
    };
    return i = {
      next: s(0),
      throw: s(1),
      return: s(2)
    }, "function" == typeof Symbol && (i[Symbol.iterator] = function () {
      return this;
    }), i;

    function s(i) {
      return function (s) {
        return function (i) {
          if (r) throw new TypeError("Generator is already executing.");

          for (; a;) {
            try {
              if (r = 1, n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n), 0) : n.next) && !(o = o.call(n, i[1])).done) return o;

              switch (n = 0, o && (i = [2 & i[0], o.value]), i[0]) {
                case 0:
                case 1:
                  o = i;
                  break;

                case 4:
                  return a.label++, {
                    value: i[1],
                    done: !1
                  };

                case 5:
                  a.label++, n = i[1], i = [0];
                  continue;

                case 7:
                  i = a.ops.pop(), a.trys.pop();
                  continue;

                default:
                  if (!(o = a.trys, (o = o.length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) {
                    a = 0;
                    continue;
                  }

                  if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
                    a.label = i[1];
                    break;
                  }

                  if (6 === i[0] && a.label < o[1]) {
                    a.label = o[1], o = i;
                    break;
                  }

                  if (o && a.label < o[2]) {
                    a.label = o[2], a.ops.push(i);
                    break;
                  }

                  o[2] && a.ops.pop(), a.trys.pop();
                  continue;
              }

              i = e.call(t, a);
            } catch (t) {
              i = [6, t], n = 0;
            } finally {
              r = o = 0;
            }
          }

          if (5 & i[0]) throw i[1];
          return {
            value: i[0] ? i[1] : void 0,
            done: !0
          };
        }([i, s]);
      };
    }
  }

  var o = "__BEACON_",
      i = "__BEACON_deviceId",
      a = "last_report_time",
      s = "sending_event_ids",
      c = "beacon_config",
      u = "beacon_config_request_time",
      l = function () {
    function t() {
      var t = this;
      this.emit = function (e, r) {
        if (t) {
          var n,
              o = t.__EventsList[e];

          if (null == o ? void 0 : o.length) {
            o = o.slice();

            for (var i = 0; i < o.length; i++) {
              n = o[i];

              try {
                var a = n.callback.apply(t, [r]);
                if (1 === n.type && t.remove(e, n.callback), !1 === a) break;
              } catch (t) {
                throw t;
              }
            }
          }

          return t;
        }
      }, this.__EventsList = {};
    }

    return t.prototype.indexOf = function (t, e) {
      for (var r = 0; r < t.length; r++) {
        if (t[r].callback === e) return r;
      }

      return -1;
    }, t.prototype.on = function (t, e, r) {
      if (void 0 === r && (r = 0), this) {
        var n = this.__EventsList[t];

        if (n || (n = this.__EventsList[t] = []), -1 === this.indexOf(n, e)) {
          var o = {
            name: t,
            type: r || 0,
            callback: e
          };
          return n.push(o), this;
        }

        return this;
      }
    }, t.prototype.one = function (t, e) {
      this.on(t, e, 1);
    }, t.prototype.remove = function (t, e) {
      if (this) {
        var r = this.__EventsList[t];
        if (!r) return null;

        if (!e) {
          try {
            delete this.__EventsList[t];
          } catch (t) {}

          return null;
        }

        if (r.length) {
          var n = this.indexOf(r, e);
          r.splice(n, 1);
        }

        return this;
      }
    }, t;
  }();

  function h(t, e) {
    for (var r = {}, n = 0, o = Object.keys(t); n < o.length; n++) {
      var i = o[n],
          a = t[i];
      if ("string" == typeof a) r[f(i)] = f(a);else {
        if (e) throw new Error("value mast be string  !!!!");
        r[f(String(i))] = f(String(a));
      }
    }

    return r;
  }

  function f(t) {
    if ("string" != typeof t) return t;

    try {
      return t.replace(new RegExp("\\|", "g"), "%7C").replace(new RegExp("\\&", "g"), "%26").replace(new RegExp("\\=", "g"), "%3D").replace(new RegExp("\\+", "g"), "%2B");
    } catch (t) {
      return "";
    }
  }

  function p(t) {
    return String(t.A99) + String(t.A100);
  }

  var d = function d() {};

  var v = function () {
    function t(t) {
      var r = this;
      this.lifeCycle = new l(), this.uploadJobQueue = [], this.additionalParams = {}, this.delayTime = 0, this._normalLogPipeline = function (t) {
        if (!t || !t.reduce || !t.length) throw new TypeError("createPipeline 方法需要传入至少有一个 pipe 的数组");
        return 1 === t.length ? function (e, r) {
          t[0](e, r || d);
        } : t.reduce(function (t, e) {
          return function (r, n) {
            return void 0 === n && (n = d), t(r, function (t) {
              return null == e ? void 0 : e(t, n);
            });
          };
        });
      }([function (t) {
        r.send({
          url: r.strategy.getUploadUrl(),
          data: t,
          method: "post",
          contentType: "application/json;charset=UTF-8"
        }, function () {
          var e = r.config.onReportSuccess;
          "function" == typeof e && e(JSON.stringify(t.events));
        }, function () {
          var e = r.config.onReportFail;
          "function" == typeof e && e(JSON.stringify(t.events));
        });
      }]), function (t, e) {
        if (!t) throw e instanceof Error ? e : new Error(e);
      }(Boolean(t.appkey), "appkey must be initial"), this.config = _e({}, t);
    }

    return t.prototype.onUserAction = function (t, e) {
      this.preReport(t, e, !1);
    }, t.prototype.onDirectUserAction = function (t, e) {
      this.preReport(t, e, !0);
    }, t.prototype.preReport = function (t, e, r) {
      t ? this.strategy.isEventUpOnOff() && (this.strategy.isBlackEvent(t) || this.strategy.isSampleEvent(t) || this.onReport(t, e, r)) : this.errorReport.reportError("602", " no eventCode");
    }, t.prototype.addAdditionalParams = function (t) {
      for (var e = 0, r = Object.keys(t); e < r.length; e++) {
        var n = r[e];
        this.additionalParams[n] = t[n];
      }
    }, t.prototype.setChannelId = function (t) {
      this.commonInfo.channelID = String(t);
    }, t.prototype.setOpenId = function (t) {
      this.commonInfo.openid = String(t);
    }, t.prototype.setUnionid = function (t) {
      this.commonInfo.unid = String(t);
    }, t.prototype.getDeviceId = function () {
      return this.commonInfo.deviceId;
    }, t.prototype.getCommonInfo = function () {
      return this.commonInfo;
    }, t.prototype.removeSendingId = function (t) {
      try {
        var e = JSON.parse(this.storage.getItem(s)),
            r = e.indexOf(t);
        -1 != r && (e.splice(r, 1), this.storage.setItem(s, JSON.stringify(e)));
      } catch (t) {}
    }, t;
  }(),
      y = function () {
    function t(t, e, r, n) {
      this.requestParams = {}, this.network = n, this.requestParams.attaid = "00400014144", this.requestParams.token = "6478159937", this.requestParams.product_id = t.appkey, this.requestParams.platform = r, this.requestParams.uin = e.deviceId, this.requestParams.model = "", this.requestParams.os = r, this.requestParams.app_version = t.appVersion, this.requestParams.sdk_version = e.sdkVersion, this.requestParams.error_stack = "", this.uploadUrl = t.isOversea ? "https://htrace.wetvinfo.com/kv" : "https://h.trace.qq.com/kv";
    }

    return t.prototype.reportError = function (t, e) {
      this.requestParams._dc = Math.random(), this.requestParams.error_msg = e, this.requestParams.error_code = t, this.network.get(this.uploadUrl, {
        params: this.requestParams
      }).catch(function (t) {});
    }, t;
  }(),
      g = function () {
    function t(t, e, r, n) {
      this.strategy = {
        isEventUpOnOff: !0,
        httpsUploadUrl: "https://otheve.beacon.qq.com/analytics/v2_upload",
        requestInterval: 30,
        blacklist: [],
        samplelist: []
      }, this.realSample = {}, this.appkey = "", this.appkey = t.appkey, this.storage = r;

      try {
        var o = JSON.parse(this.storage.getItem(c));
        o && this.processData(o);
      } catch (t) {}

      t.isOversea && (this.strategy.httpsUploadUrl = "https://svibeacon.onezapp.com/analytics/v2_upload"), !t.isOversea && this.needRequestConfig() && this.requestConfig(t.appVersion, e, n);
    }

    return t.prototype.requestConfig = function (t, e, r) {
      var n = this;
      this.storage.setItem(u, Date.now().toString()), r.post("https://oth.str.beacon.qq.com/trpc.beacon.configserver.BeaconConfigService/QueryConfig", {
        platformId: "undefined" == typeof wx ? "3" : "4",
        mainAppKey: this.appkey,
        appVersion: t,
        sdkVersion: e.sdkVersion,
        osVersion: e.userAgent,
        model: "",
        packageName: "",
        params: {
          A3: e.deviceId
        }
      }).then(function (t) {
        if (0 == t.data.ret) try {
          var e = JSON.parse(t.data.beaconConfig);
          e && (n.processData(e), n.storage.setItem(c, t.data.beaconConfig));
        } catch (t) {} else n.processData(null), n.storage.setItem(c, "");
      }).catch(function (t) {});
    }, t.prototype.processData = function (t) {
      var e, r, n, o, i;
      this.strategy.isEventUpOnOff = null !== (e = null == t ? void 0 : t.isEventUpOnOff) && void 0 !== e ? e : this.strategy.isEventUpOnOff, this.strategy.httpsUploadUrl = null !== (r = null == t ? void 0 : t.httpsUploadUrl) && void 0 !== r ? r : this.strategy.httpsUploadUrl, this.strategy.requestInterval = null !== (n = null == t ? void 0 : t.requestInterval) && void 0 !== n ? n : this.strategy.requestInterval, this.strategy.blacklist = null !== (o = null == t ? void 0 : t.blacklist) && void 0 !== o ? o : this.strategy.blacklist, this.strategy.samplelist = null !== (i = null == t ? void 0 : t.samplelist) && void 0 !== i ? i : this.strategy.samplelist;

      for (var a = 0, s = this.strategy.samplelist; a < s.length; a++) {
        var c = s[a].split(",");
        2 == c.length && (this.realSample[c[0]] = c[1]);
      }
    }, t.prototype.needRequestConfig = function () {
      var t = Number(this.storage.getItem(u));
      return Date.now() - t > 60 * this.strategy.requestInterval * 1e3;
    }, t.prototype.getUploadUrl = function () {
      return this.strategy.httpsUploadUrl + "?appkey=" + this.appkey;
    }, t.prototype.isBlackEvent = function (t) {
      return -1 != this.strategy.blacklist.indexOf(t);
    }, t.prototype.isEventUpOnOff = function () {
      return this.strategy.isEventUpOnOff;
    }, t.prototype.isSampleEvent = function (t) {
      return !!Object.prototype.hasOwnProperty.call(this.realSample, t) && this.realSample[t] < Math.floor(Math.random() * Math.floor(1e4));
    }, t;
  }(),
      m = "session_storage_key",
      w = function () {
    function t(t, e, r) {
      this.beacon = r, this.storage = t, this.duration = e, this.appkey = r.config.appkey;
    }

    return t.prototype.getSession = function () {
      var t = this.storage.getItem(m);
      if (!t) return this.createSession();
      var e = "",
          r = 0;

      try {
        var n = JSON.parse(t) || {
          sessionId: void 0,
          sessionStart: void 0
        };
        if (!n.sessionId || !n.sessionStart) return this.createSession();
        var o = Number(this.storage.getItem(a));
        if (Date.now() - o > this.duration) return this.createSession();
        e = n.sessionId, r = n.sessionStart;
      } catch (t) {}

      return {
        sessionId: e,
        sessionStart: r
      };
    }, t.prototype.createSession = function () {
      var t = Date.now(),
          e = {
        sessionId: this.appkey + "_" + t.toString(),
        sessionStart: t
      };
      this.storage.setItem(m, JSON.stringify(e)), this.storage.setItem(a, t.toString());
      var r = "is_new_user",
          n = this.storage.getItem(r);
      return this.beacon.onDirectUserAction("rqd_applaunched", {
        A21: n ? "N" : "Y"
      }), this.storage.setItem(r, JSON.stringify(!1)), e;
    }, t;
  }();

  function b() {
    var t = navigator.userAgent,
        e = t.indexOf("compatible") > -1 && t.indexOf("MSIE") > -1,
        r = t.indexOf("Edge") > -1 && !e,
        n = t.indexOf("Trident") > -1 && t.indexOf("rv:11.0") > -1;

    if (e) {
      new RegExp("MSIE (\\d+\\.\\d+);").test(t);
      var o = parseFloat(RegExp.$1);
      return 7 == o ? 7 : 8 == o ? 8 : 9 == o ? 9 : 10 == o ? 10 : 6;
    }

    return r ? -2 : n ? 11 : -1;
  }

  var _S = function S() {
    return (_S = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  var E,
      I = function () {
    function t(t, e) {
      void 0 === e && (e = {}), this.reportOptions = {}, this.config = t, this.reportOptions = e;
    }

    return t.canUseDB = function () {
      return !!(null === window || void 0 === window ? void 0 : window.indexedDB);
    }, t.prototype.openDB = function () {
      var e = this;
      return new Promise(function (r, n) {
        if (!t.canUseDB()) return n({
          message: "当前不支持 indexeddb"
        });
        var o = e.config,
            i = o.name,
            a = o.version,
            s = o.stores,
            c = indexedDB.open(i, a);
        c.onsuccess = function () {
          e.db = c.result, r(), _S({
            result: 1,
            func: "open",
            params: JSON.stringify(e.config)
          }, e.reportOptions);
        }, c.onerror = function (t) {
          var r, o;
          n(t), _S({
            result: 0,
            func: "open",
            params: JSON.stringify(e.config),
            error_msg: null === (o = null === (r = t.target) || void 0 === r ? void 0 : r.error) || void 0 === o ? void 0 : o.message
          }, e.reportOptions);
        }, c.onupgradeneeded = function () {
          e.db = c.result;

          try {
            null == s || s.forEach(function (t) {
              e.createStore(t);
            });
          } catch (t) {
            _S({
              result: 0,
              func: "open",
              params: JSON.stringify(e.config),
              error_msg: t.message
            }, e.reportOptions), n(t);
          }
        };
      });
    }, t.prototype.useStore = function (t) {
      return this.storeName = t, this;
    }, t.prototype.deleteDB = function () {
      var t = this;
      return this.closeDB(), new Promise(function (e, r) {
        var n = indexedDB.deleteDatabase(t.config.name);
        n.onsuccess = function () {
          return e();
        }, n.onerror = r;
      });
    }, t.prototype.closeDB = function () {
      var t;
      null === (t = this.db) || void 0 === t || t.close(), this.db = null;
    }, t.prototype.getStoreCount = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readonly").count();
        n.onsuccess = function () {
          return e(n.result);
        }, n.onerror = r;
      });
    }, t.prototype.clearStore = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readwrite").clear();
        n.onsuccess = function () {
          return e();
        }, n.onerror = r;
      });
    }, t.prototype.add = function (t, e) {
      var r = this;
      return new Promise(function (n, o) {
        var i = r.getStore("readwrite").add(t, e);
        i.onsuccess = function () {
          n(i.result);
        }, i.onerror = o;
      });
    }, t.prototype.put = function (t, e) {
      var r = this;
      return new Promise(function (n, o) {
        var i = r.getStore("readwrite").put(t, e);
        i.onsuccess = function () {
          n(i.result);
        }, i.onerror = o;
      });
    }, t.prototype.getStoreAllData = function () {
      var t = this;
      return new Promise(function (e, r) {
        var n = t.getStore("readonly").openCursor(),
            o = [];
        n.onsuccess = function () {
          var t;

          if (null === (t = n.result) || void 0 === t ? void 0 : t.value) {
            var r = n.result.value;
            o.push(r), n.result.continue();
          } else e(o);
        }, n.onerror = r;
      });
    }, t.prototype.getDataRangeByIndex = function (t, e, r, n, o) {
      var i = this;
      return new Promise(function (a, s) {
        var c = i.getStore().index(t),
            u = IDBKeyRange.bound(e, r, n, o),
            l = [],
            h = c.openCursor(u);
        h.onsuccess = function () {
          var t;
          (null === (t = null == h ? void 0 : h.result) || void 0 === t ? void 0 : t.value) ? (l.push(null == h ? void 0 : h.result.value), null == h || h.result.continue()) : a(l);
        }, h.onerror = s;
      });
    }, t.prototype.removeDataByIndex = function (t, e, r, n, o) {
      var i = this;
      return new Promise(function (a, s) {
        var c = i.getStore("readwrite").index(t),
            u = IDBKeyRange.bound(e, r, n, o),
            l = c.openCursor(u),
            h = 0;
        l.onsuccess = function (t) {
          var e = t.target.result;
          e ? (h += 1, e.delete(), e.continue()) : a(h);
        }, l.onerror = s;
      });
    }, t.prototype.createStore = function (t) {
      var e = t.name,
          r = t.indexes,
          n = void 0 === r ? [] : r,
          o = t.options;

      if (this.db) {
        this.db.objectStoreNames.contains(e) && this.db.deleteObjectStore(e);
        var i = this.db.createObjectStore(e, o);
        n.forEach(function (t) {
          i.createIndex(t.indexName, t.keyPath, t.options);
        });
      }
    }, t.prototype.getStore = function (t) {
      var e;
      return void 0 === t && (t = "readonly"), null === (e = this.db) || void 0 === e ? void 0 : e.transaction(this.storeName, t).objectStore(this.storeName);
    }, t;
  }(),
      O = "event_table_v3",
      k = "eventId",
      x = function () {
    function t(t) {
      this.isReady = !1, this.taskQueue = Promise.resolve(), this.db = new I({
        name: "Beacon_" + t + "_V3",
        version: 1,
        stores: [{
          name: O,
          options: {
            keyPath: k
          },
          indexes: [{
            indexName: k,
            keyPath: k,
            options: {
              unique: !0
            }
          }]
        }]
      }), this.open();
    }

    return t.prototype.getCount = function () {
      var t = this;
      return this.readyExec(function () {
        return t.db.getStoreCount();
      });
    }, t.prototype.setItem = function (t, e) {
      var r = this;
      return this.readyExec(function () {
        return r.db.add({
          eventId: t,
          value: e
        });
      });
    }, t.prototype.getItem = function (t) {
      return r(this, void 0, void 0, function () {
        var e = this;
        return n(this, function (r) {
          return [2, this.readyExec(function () {
            return e.db.getDataRangeByIndex(k, t, t);
          })];
        });
      });
    }, t.prototype.removeItem = function (t) {
      var e = this;
      return this.readyExec(function () {
        return e.db.removeDataByIndex(k, t, t);
      });
    }, t.prototype.updateItem = function (t, e) {
      var r = this;
      return this.readyExec(function () {
        return r.db.put({
          eventId: t,
          value: e
        });
      });
    }, t.prototype.iterate = function (t) {
      var e = this;
      return this.readyExec(function () {
        return e.db.getStoreAllData().then(function (e) {
          e.forEach(function (e) {
            t(e.value);
          });
        });
      });
    }, t.prototype.open = function () {
      return r(this, void 0, void 0, function () {
        var t = this;
        return n(this, function (e) {
          switch (e.label) {
            case 0:
              return this.taskQueue = this.taskQueue.then(function () {
                return t.db.openDB();
              }), [4, this.taskQueue];

            case 1:
              return e.sent(), this.isReady = !0, this.db.useStore(O), [2];
          }
        });
      });
    }, t.prototype.readyExec = function (t) {
      return this.isReady ? t() : (this.taskQueue = this.taskQueue.then(function () {
        return t();
      }), this.taskQueue);
    }, t;
  }(),
      C = function () {
    function t(t) {
      this.keyObject = {}, this.storage = t;
    }

    return t.prototype.getCount = function () {
      return this.storage.getStoreCount();
    }, t.prototype.removeItem = function (t) {
      this.storage.removeItem(t), delete this.keyObject[t];
    }, t.prototype.setItem = function (t, e) {
      var r = JSON.stringify(e);
      this.storage.setItem(t, r), this.keyObject[t] = e;
    }, t.prototype.iterate = function (t) {
      for (var e = Object.keys(this.keyObject), r = 0; r < e.length; r++) {
        var n = this.storage.getItem(e[r]);
        t(JSON.parse(n));
      }
    }, t;
  }(),
      _ = function () {
    function t(t, e) {
      var r = this;
      this.dbEventCount = 0, b() > 0 || !window.indexedDB || /X5Lite/.test(navigator.userAgent) ? (this.store = new C(e), this.dbEventCount = this.store.getCount()) : (this.store = new x(t), this.getCount().then(function (t) {
        r.dbEventCount = t;
      }));
    }

    return t.prototype.getCount = function () {
      return r(this, void 0, void 0, function () {
        return n(this, function (t) {
          switch (t.label) {
            case 0:
              return t.trys.push([0, 2,, 3]), [4, this.store.getCount()];

            case 1:
              return [2, t.sent()];

            case 2:
              return t.sent(), [2, Promise.reject()];

            case 3:
              return [2];
          }
        });
      });
    }, t.prototype.insertEvent = function (t, e) {
      return r(this, void 0, void 0, function () {
        var r, o;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              if (this.dbEventCount >= 1e4) return [2, Promise.reject()];
              r = p(t.mapValue), n.label = 1;

            case 1:
              return n.trys.push([1, 3,, 4]), this.dbEventCount++, [4, this.store.setItem(r, t)];

            case 2:
              return [2, n.sent()];

            case 3:
              return o = n.sent(), e && e(o, t), this.dbEventCount--, [2, Promise.reject()];

            case 4:
              return [2];
          }
        });
      });
    }, t.prototype.getEvents = function () {
      return r(this, void 0, void 0, function () {
        var t;
        return n(this, function (e) {
          switch (e.label) {
            case 0:
              t = [], e.label = 1;

            case 1:
              return e.trys.push([1, 3,, 4]), [4, this.store.iterate(function (e) {
                t.push(e);
              })];

            case 2:
              return e.sent(), [2, Promise.all(t)];

            case 3:
              return e.sent(), [2, Promise.all(t)];

            case 4:
              return [2];
          }
        });
      });
    }, t.prototype.removeEvent = function (t) {
      return r(this, void 0, void 0, function () {
        var e;
        return n(this, function (r) {
          switch (r.label) {
            case 0:
              e = p(t.mapValue), r.label = 1;

            case 1:
              return r.trys.push([1, 3,, 4]), this.dbEventCount--, [4, this.store.removeItem(e)];

            case 2:
              return [2, r.sent()];

            case 3:
              return r.sent(), this.dbEventCount++, [2, Promise.reject()];

            case 4:
              return [2];
          }
        });
      });
    }, t;
  }(),
      _A = function A() {
    return (_A = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function P(t) {
    try {
      return decodeURIComponent(t.replace(/\+/g, " "));
    } catch (t) {
      return null;
    }
  }

  function j(t, e) {
    var r = [null, void 0, "", NaN].includes(t);
    if (e.isSkipEmpty && r) return null;
    var n = !e.isSkipEmpty && r ? "" : t;

    try {
      return e.encode ? encodeURIComponent(n) : n;
    } catch (t) {
      return null;
    }
  }

  function D(t) {
    var e = t.split("#"),
        r = e[0],
        n = e[1],
        o = void 0 === n ? "" : n,
        i = r.split("?"),
        a = i[0],
        s = i[1],
        c = void 0 === s ? "" : s,
        u = P(o),
        l = Object.create(null);
    return c.split("&").forEach(function (t) {
      var e = t.split("="),
          r = e[0],
          n = e[1],
          o = void 0 === n ? "" : n,
          i = P(r),
          a = P(o);
      null === i || null === a || "" === i && "" === a || l[i] || (l[i] = a);
    }), {
      url: a,
      query: l,
      hash: u
    };
  }

  function T(t, e) {
    void 0 === e && (e = {
      encode: !0,
      isSkipEmpty: !1
    });

    var r = t.url,
        n = t.query,
        o = void 0 === n ? {} : n,
        i = t.hash,
        a = r.split("#"),
        s = a[0],
        c = a[1],
        u = void 0 === c ? "" : c,
        l = s.split("?")[0],
        h = [],
        f = j(i || u, e),
        p = _A(_A({}, D(r).query), o);

    return Object.keys(p).forEach(function (t) {
      var r = j(t, e),
          n = j(p[t], e);
      null !== r && null !== n && h.push(r + "=" + n);
    }), l + (h.length ? "?" + h.join("&") : "") + (f ? "#" + f : "");
  }

  function N(t, e) {
    return new Promise(function (r, n) {
      if (e && document.querySelectorAll("script[data-tag=" + e + "]").length) return r();

      var o = document.createElement("script"),
          i = _A({
        type: "text/javascript",
        charset: "utf-8"
      }, t);

      Object.keys(i).forEach(function (t) {
        return function (t, e, r) {
          if (t) return void 0 === r ? t.getAttribute(e) : t.setAttribute(e, r);
        }(o, t, i[t]);
      }), e && (o.dataset.tag = e), o.onload = function () {
        return r();
      }, o.onreadystatechange = function () {
        var t = o.readyState;
        ["complete", "loaded"].includes(t) && (o.onreadystatechange = null, r());
      }, o.onerror = n, document.body.appendChild(o);
    });
  }

  !function (t) {
    t[t.equal = 0] = "equal", t[t.low = -1] = "low", t[t.high = 1] = "high";
  }(E || (E = {}));

  var _U = function U() {
    return (_U = Object.assign || function (t) {
      for (var e, r = 1, n = arguments.length; r < n; r++) {
        for (var o in e = arguments[r]) {
          Object.prototype.hasOwnProperty.call(e, o) && (t[o] = e[o]);
        }
      }

      return t;
    }).apply(this, arguments);
  };

  function q(t, e, r, n) {
    return new (r || (r = Promise))(function (o, i) {
      function a(t) {
        try {
          c(n.next(t));
        } catch (t) {
          i(t);
        }
      }

      function s(t) {
        try {
          c(n.throw(t));
        } catch (t) {
          i(t);
        }
      }

      function c(t) {
        var e;
        t.done ? o(t.value) : (e = t.value, e instanceof r ? e : new r(function (t) {
          t(e);
        })).then(a, s);
      }

      c((n = n.apply(t, e || [])).next());
    });
  }

  function R(t, e) {
    var r,
        n,
        o,
        i,
        a = {
      label: 0,
      sent: function sent() {
        if (1 & o[0]) throw o[1];
        return o[1];
      },
      trys: [],
      ops: []
    };
    return i = {
      next: s(0),
      throw: s(1),
      return: s(2)
    }, "function" == typeof Symbol && (i[Symbol.iterator] = function () {
      return this;
    }), i;

    function s(i) {
      return function (s) {
        return function (i) {
          if (r) throw new TypeError("Generator is already executing.");

          for (; a;) {
            try {
              if (r = 1, n && (o = 2 & i[0] ? n.return : i[0] ? n.throw || ((o = n.return) && o.call(n), 0) : n.next) && !(o = o.call(n, i[1])).done) return o;

              switch (n = 0, o && (i = [2 & i[0], o.value]), i[0]) {
                case 0:
                case 1:
                  o = i;
                  break;

                case 4:
                  return a.label++, {
                    value: i[1],
                    done: !1
                  };

                case 5:
                  a.label++, n = i[1], i = [0];
                  continue;

                case 7:
                  i = a.ops.pop(), a.trys.pop();
                  continue;

                default:
                  if (!((o = (o = a.trys).length > 0 && o[o.length - 1]) || 6 !== i[0] && 2 !== i[0])) {
                    a = 0;
                    continue;
                  }

                  if (3 === i[0] && (!o || i[1] > o[0] && i[1] < o[3])) {
                    a.label = i[1];
                    break;
                  }

                  if (6 === i[0] && a.label < o[1]) {
                    a.label = o[1], o = i;
                    break;
                  }

                  if (o && a.label < o[2]) {
                    a.label = o[2], a.ops.push(i);
                    break;
                  }

                  o[2] && a.ops.pop(), a.trys.pop();
                  continue;
              }

              i = e.call(t, a);
            } catch (t) {
              i = [6, t], n = 0;
            } finally {
              r = o = 0;
            }
          }

          if (5 & i[0]) throw i[1];
          return {
            value: i[0] ? i[1] : void 0,
            done: !0
          };
        }([i, s]);
      };
    }
  }

  var L = function () {
    function t() {
      this.interceptors = [];
    }

    return t.prototype.use = function (t, e) {
      return this.interceptors.push({
        resolved: t,
        rejected: e
      }), this.interceptors.length - 1;
    }, t.prototype.traverse = function (t, e) {
      void 0 === e && (e = !1);
      var r = Promise.resolve(t);
      return (e ? Array.prototype.reduceRight : Array.prototype.reduce).call(this.interceptors, function (t, e) {
        if (e) {
          var n = e.resolved,
              o = e.rejected;
          r = r.then(n, o);
        }

        return t;
      }, ""), r;
    }, t.prototype.eject = function (t) {
      this.interceptors[t] && (this.interceptors[t] = null);
    }, t;
  }(),
      B = {
    defaults: {
      timeout: 0,
      method: "GET",
      mode: "cors",
      redirect: "follow",
      credentials: "same-origin"
    },
    headers: {
      common: {
        Accept: "application/json, text/plain, */*"
      },
      POST: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      PUT: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      PATCH: {
        "Content-Type": "application/x-www-form-urlencoded"
      }
    },
    baseURL: "",
    polyfillUrl: "https://vm.gtimg.cn/comps/script/fetch.min.js",
    interceptors: {
      request: new L(),
      response: new L()
    }
  },
      J = /^([a-z][a-z\d+\-.]*:)?\/\//i,
      M = Object.prototype.toString;

  function V(t) {
    return q(this, void 0, void 0, function () {
      var e;
      return R(this, function (r) {
        switch (r.label) {
          case 0:
            if (window.fetch) return [2];
            r.label = 1;

          case 1:
            return r.trys.push([1, 3,, 4]), [4, N({
              src: t
            })];

          case 2:
            return r.sent(), [3, 4];

          case 3:
            throw e = r.sent(), function (t) {
              if ("undefined" != typeof Image) {
                var e = new Image(1, 1),
                    r = _U({
                  attaid: "0f400053130",
                  token: "6552374442",
                  comps: "@tencent/ovb-request",
                  version: "1.1.18",
                  ua: navigator.userAgent,
                  url: location.href,
                  _dc: Math.random()
                }, t),
                    n = Object.keys(r).map(function (t) {
                  return t + "=" + encodeURIComponent(r[t]);
                }).join("&");

                e.src = "https://h.trace.qq.com/kv?" + n;
              }
            }({
              func: "loadPolyfill",
              result: 0,
              params: t,
              error_msg: e.message
            }), new Error("加载 polyfill " + t + " 失败: " + e.message);

          case 4:
            return [2];
        }
      });
    });
  }

  function G(t) {
    return ["Accept", "Content-Type"].forEach(function (e) {
      return r = e, void ((n = t.headers) && Object.keys(n).forEach(function (t) {
        t !== r && t.toUpperCase() === r.toUpperCase() && (n[r] = n[t], delete n[t]);
      }));
      var r, n;
    }), function (t) {
      if ("[object Object]" !== M.call(t)) return !1;
      var e = Object.getPrototypeOf(t);
      return null === e || e === Object.prototype;
    }(t.body) && (t.body = JSON.stringify(t.body), t.headers && (t.headers["Content-Type"] = "application/json;charset=utf-8")), t;
  }

  function F(t) {
    return q(this, void 0, void 0, function () {
      var e, r, n, o, i, a, s, c, u, l, h, f, p, d, v, y, g;
      return R(this, function (m) {
        switch (m.label) {
          case 0:
            return e = B.baseURL, r = B.defaults, n = B.interceptors, [4, V(B.polyfillUrl)];

          case 1:
            return m.sent(), (o = _U(_U({}, r), t)).headers || (o.headers = function (t) {
              void 0 === t && (t = "GET");
              var e = B.headers[t] || {};
              return _U(_U({}, B.headers.common), e);
            }(o.method)), G(o), [4, n.request.traverse(o, !0)];

          case 2:
            if ((i = m.sent()) instanceof Error) throw i;
            return i.url = function (t, e) {
              return !t || J.test(e) ? e : t.replace(/\/+$/, "") + "/" + e.replace(/^\/+/, "");
            }(e, i.url), a = i.url, s = i.timeout, c = i.params, u = i.method, l = ["GET", "DELETE", "OPTIONS", "HEAD"].includes(void 0 === u ? "GET" : u) && !!c, h = l ? T({
              url: a,
              query: c
            }) : a, f = [], s && !i.signal && (v = new Promise(function (t) {
              p = setTimeout(function () {
                t(new Error("timeout"));
              }, s);
            }), f.push(v), d = new AbortController(), i.signal = d.signal), f.push(fetch(h, i).catch(function (t) {
              return t;
            })), [4, Promise.race(f)];

          case 3:
            return y = m.sent(), p && clearTimeout(p), [4, n.response.traverse(y)];

          case 4:
            if ((g = m.sent()) instanceof Error) throw null == d || d.abort(), g;
            return [2, g];
        }
      });
    });
  }

  var Q = function () {
    function t(t) {
      B.interceptors.request.use(function (r) {
        var n = r.url,
            o = r.method,
            i = r.body,
            a = i;

        if (t.onReportBeforeSend) {
          var s = t.onReportBeforeSend({
            url: n,
            method: o,
            data: i ? JSON.parse(i) : null
          });
          a = (null == s ? void 0 : s.data) ? JSON.stringify(s.data) : null;
        }

        if ("GET" !== o && !a) throw new Error("No data for sdk, cancel.");
        return _e(_e({}, r), {
          body: a
        });
      });
    }

    return t.prototype.get = function (t, o) {
      return r(this, void 0, void 0, function () {
        var r, i;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              return [4, F(_e({
                url: t
              }, o))];

            case 1:
              return [4, (r = n.sent()).json()];

            case 2:
              return i = n.sent(), [2, Promise.resolve({
                data: i,
                status: r.status,
                statusText: r.statusText,
                headers: r.headers
              })];
          }
        });
      });
    }, t.prototype.post = function (t, o, i) {
      return r(this, void 0, void 0, function () {
        var r, a;
        return n(this, function (n) {
          switch (n.label) {
            case 0:
              return [4, F(_e({
                url: t,
                body: o,
                method: "POST"
              }, i))];

            case 1:
              return [4, (r = n.sent()).json()];

            case 2:
              return a = n.sent(), [2, Promise.resolve({
                data: a,
                status: r.status,
                statusText: r.statusText,
                headers: r.headers
              })];
          }
        });
      });
    }, t;
  }(),
      K = function () {
    function t(t) {
      this.appkey = t;
    }

    return t.prototype.getItem = function (t) {
      try {
        return window.localStorage.getItem(this.getStoreKey(t));
      } catch (t) {
        return "";
      }
    }, t.prototype.removeItem = function (t) {
      try {
        window.localStorage.removeItem(this.getStoreKey(t));
      } catch (t) {}
    }, t.prototype.setItem = function (t, e) {
      try {
        window.localStorage.setItem(this.getStoreKey(t), e);
      } catch (t) {}
    }, t.prototype.setSessionItem = function (t, e) {
      try {
        window.sessionStorage.setItem(this.getStoreKey(t), e);
      } catch (t) {}
    }, t.prototype.getSessionItem = function (t) {
      try {
        return window.sessionStorage.getItem(this.getStoreKey(t));
      } catch (t) {
        return "";
      }
    }, t.prototype.getStoreKey = function (t) {
      return o + this.appkey + "_" + t;
    }, t.prototype.createDeviceId = function () {
      try {
        var t = window.localStorage.getItem(i);
        return t || (t = function (t) {
          for (var e = "ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz0123456789", r = "", n = 0; n < t; n++) {
            r += e.charAt(Math.floor(Math.random() * e.length));
          }

          return r;
        }(32), window.localStorage.setItem(i, t)), t;
      } catch (t) {
        return "";
      }
    }, t.prototype.clear = function () {
      try {
        for (var t = window.localStorage.length, e = 0; e < t; e++) {
          var r = window.localStorage.key(e);
          (null == r ? void 0 : r.substr(0, 9)) == o && window.localStorage.removeItem(r);
        }
      } catch (t) {}
    }, t.prototype.getStoreCount = function () {
      var t = 0;

      try {
        t = window.localStorage.length;
      } catch (t) {}

      return t;
    }, t;
  }();

  "undefined" != typeof globalThis ? globalThis : "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self && self;

  var W = function (t) {
    var e = {
      exports: {}
    };
    return t(e, e.exports), e.exports;
  }(function (t, e) {
    t.exports = function () {
      function t(t, e, r, n, o, i, a) {
        try {
          var s = t[i](a),
              c = s.value;
        } catch (t) {
          return void r(t);
        }

        s.done ? e(c) : Promise.resolve(c).then(n, o);
      }

      function e(t, e) {
        for (var r = 0; r < e.length; r++) {
          var n = e[r];
          n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
        }
      }

      var r,
          n = (function (t) {
        t = function (t) {
          var e,
              r = Object.prototype,
              n = r.hasOwnProperty,
              o = "function" == typeof Symbol ? Symbol : {},
              i = o.iterator || "@@iterator",
              a = o.asyncIterator || "@@asyncIterator",
              s = o.toStringTag || "@@toStringTag";

          function c(t, e, r) {
            return Object.defineProperty(t, e, {
              value: r,
              enumerable: !0,
              configurable: !0,
              writable: !0
            }), t[e];
          }

          try {
            c({}, "");
          } catch (r) {
            c = function c(t, e, r) {
              return t[e] = r;
            };
          }

          function u(t, r, n, o) {
            var i, a, s, c;
            return r = r && r.prototype instanceof y ? r : y, r = Object.create(r.prototype), o = new k(o || []), r._invoke = (i = t, a = n, s = o, c = h, function (t, r) {
              if (c === p) throw new Error("Generator is already running");

              if (c === d) {
                if ("throw" === t) throw r;
                return C();
              }

              for (s.method = t, s.arg = r;;) {
                var n = s.delegate;

                if (n) {
                  var o = function t(r, n) {
                    var o;

                    if ((o = r.iterator[n.method]) === e) {
                      if (n.delegate = null, "throw" === n.method) {
                        if (r.iterator.return && (n.method = "return", n.arg = e, t(r, n), "throw" === n.method)) return v;
                        n.method = "throw", n.arg = new TypeError("The iterator does not provide a 'throw' method");
                      }

                      return v;
                    }

                    return "throw" === (o = l(o, r.iterator, n.arg)).type ? (n.method = "throw", n.arg = o.arg, n.delegate = null, v) : (o = o.arg) ? o.done ? (n[r.resultName] = o.value, n.next = r.nextLoc, "return" !== n.method && (n.method = "next", n.arg = e), n.delegate = null, v) : o : (n.method = "throw", n.arg = new TypeError("iterator result is not an object"), n.delegate = null, v);
                  }(n, s);

                  if (o) {
                    if (o === v) continue;
                    return o;
                  }
                }

                if ("next" === s.method) s.sent = s._sent = s.arg;else if ("throw" === s.method) {
                  if (c === h) throw c = d, s.arg;
                  s.dispatchException(s.arg);
                } else "return" === s.method && s.abrupt("return", s.arg);

                if (c = p, "normal" === (o = l(i, a, s)).type) {
                  if (c = s.done ? d : f, o.arg !== v) return {
                    value: o.arg,
                    done: s.done
                  };
                } else "throw" === o.type && (c = d, s.method = "throw", s.arg = o.arg);
              }
            }), r;
          }

          function l(t, e, r) {
            try {
              return {
                type: "normal",
                arg: t.call(e, r)
              };
            } catch (t) {
              return {
                type: "throw",
                arg: t
              };
            }
          }

          t.wrap = u;
          var h = "suspendedStart",
              f = "suspendedYield",
              p = "executing",
              d = "completed",
              v = {};

          function y() {}

          function g() {}

          function m() {}

          var w = {};
          w[i] = function () {
            return this;
          }, (o = (o = Object.getPrototypeOf) && o(o(x([])))) && o !== r && n.call(o, i) && (w = o);
          var b = m.prototype = y.prototype = Object.create(w);

          function S(t) {
            ["next", "throw", "return"].forEach(function (e) {
              c(t, e, function (t) {
                return this._invoke(e, t);
              });
            });
          }

          function E(t, e) {
            var r;

            this._invoke = function (o, i) {
              function a() {
                return new e(function (r, a) {
                  !function r(o, i, a, s) {
                    if ("throw" !== (o = l(t[o], t, i)).type) {
                      var c = o.arg;
                      return (i = c.value) && "object" == _typeof(i) && n.call(i, "__await") ? e.resolve(i.__await).then(function (t) {
                        r("next", t, a, s);
                      }, function (t) {
                        r("throw", t, a, s);
                      }) : e.resolve(i).then(function (t) {
                        c.value = t, a(c);
                      }, function (t) {
                        return r("throw", t, a, s);
                      });
                    }

                    s(o.arg);
                  }(o, i, r, a);
                });
              }

              return r = r ? r.then(a, a) : a();
            };
          }

          function I(t) {
            var e = {
              tryLoc: t[0]
            };
            1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e);
          }

          function O(t) {
            var e = t.completion || {};
            e.type = "normal", delete e.arg, t.completion = e;
          }

          function k(t) {
            this.tryEntries = [{
              tryLoc: "root"
            }], t.forEach(I, this), this.reset(!0);
          }

          function x(t) {
            if (t) {
              if (r = t[i]) return r.call(t);
              if ("function" == typeof t.next) return t;

              if (!isNaN(t.length)) {
                var r,
                    o = -1;
                return (r = function r() {
                  for (; ++o < t.length;) {
                    if (n.call(t, o)) return r.value = t[o], r.done = !1, r;
                  }

                  return r.value = e, r.done = !0, r;
                }).next = r;
              }
            }

            return {
              next: C
            };
          }

          function C() {
            return {
              value: e,
              done: !0
            };
          }

          return ((g.prototype = b.constructor = m).constructor = g).displayName = c(m, s, "GeneratorFunction"), t.isGeneratorFunction = function (t) {
            return !!(t = "function" == typeof t && t.constructor) && (t === g || "GeneratorFunction" === (t.displayName || t.name));
          }, t.mark = function (t) {
            return Object.setPrototypeOf ? Object.setPrototypeOf(t, m) : (t.__proto__ = m, c(t, s, "GeneratorFunction")), t.prototype = Object.create(b), t;
          }, t.awrap = function (t) {
            return {
              __await: t
            };
          }, S(E.prototype), E.prototype[a] = function () {
            return this;
          }, t.AsyncIterator = E, t.async = function (e, r, n, o, i) {
            void 0 === i && (i = Promise);
            var a = new E(u(e, r, n, o), i);
            return t.isGeneratorFunction(r) ? a : a.next().then(function (t) {
              return t.done ? t.value : a.next();
            });
          }, S(b), c(b, s, "Generator"), b[i] = function () {
            return this;
          }, b.toString = function () {
            return "[object Generator]";
          }, t.keys = function (t) {
            var e,
                r = [];

            for (e in t) {
              r.push(e);
            }

            return r.reverse(), function e() {
              for (; r.length;) {
                var n = r.pop();
                if (n in t) return e.value = n, e.done = !1, e;
              }

              return e.done = !0, e;
            };
          }, t.values = x, k.prototype = {
            constructor: k,
            reset: function reset(t) {
              if (this.prev = 0, this.next = 0, this.sent = this._sent = e, this.done = !1, this.delegate = null, this.method = "next", this.arg = e, this.tryEntries.forEach(O), !t) for (var r in this) {
                "t" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = e);
              }
            },
            stop: function stop() {
              this.done = !0;
              var t = this.tryEntries[0].completion;
              if ("throw" === t.type) throw t.arg;
              return this.rval;
            },
            dispatchException: function dispatchException(t) {
              if (this.done) throw t;
              var r = this;

              function o(n, o) {
                return s.type = "throw", s.arg = t, r.next = n, o && (r.method = "next", r.arg = e), !!o;
              }

              for (var i = this.tryEntries.length - 1; 0 <= i; --i) {
                var a = this.tryEntries[i],
                    s = a.completion;
                if ("root" === a.tryLoc) return o("end");

                if (a.tryLoc <= this.prev) {
                  var c = n.call(a, "catchLoc"),
                      u = n.call(a, "finallyLoc");

                  if (c && u) {
                    if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
                    if (this.prev < a.finallyLoc) return o(a.finallyLoc);
                  } else if (c) {
                    if (this.prev < a.catchLoc) return o(a.catchLoc, !0);
                  } else {
                    if (!u) throw new Error("try statement without catch or finally");
                    if (this.prev < a.finallyLoc) return o(a.finallyLoc);
                  }
                }
              }
            },
            abrupt: function abrupt(t, e) {
              for (var r = this.tryEntries.length - 1; 0 <= r; --r) {
                var o = this.tryEntries[r];

                if (o.tryLoc <= this.prev && n.call(o, "finallyLoc") && this.prev < o.finallyLoc) {
                  var i = o;
                  break;
                }
              }

              var a = (i = i && ("break" === t || "continue" === t) && i.tryLoc <= e && e <= i.finallyLoc ? null : i) ? i.completion : {};
              return a.type = t, a.arg = e, i ? (this.method = "next", this.next = i.finallyLoc, v) : this.complete(a);
            },
            complete: function complete(t, e) {
              if ("throw" === t.type) throw t.arg;
              return "break" === t.type || "continue" === t.type ? this.next = t.arg : "return" === t.type ? (this.rval = this.arg = t.arg, this.method = "return", this.next = "end") : "normal" === t.type && e && (this.next = e), v;
            },
            finish: function finish(t) {
              for (var e = this.tryEntries.length - 1; 0 <= e; --e) {
                var r = this.tryEntries[e];
                if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), O(r), v;
              }
            },
            catch: function _catch(t) {
              for (var e = this.tryEntries.length - 1; 0 <= e; --e) {
                var r = this.tryEntries[e];

                if (r.tryLoc === t) {
                  var n,
                      o = r.completion;
                  return "throw" === o.type && (n = o.arg, O(r)), n;
                }
              }

              throw new Error("illegal catch attempt");
            },
            delegateYield: function delegateYield(t, r, n) {
              return this.delegate = {
                iterator: x(t),
                resultName: r,
                nextLoc: n
              }, "next" === this.method && (this.arg = e), v;
            }
          }, t;
        }(t.exports);

        try {
          regeneratorRuntime = t;
        } catch (e) {
          Function("r", "regeneratorRuntime = r")(t);
        }
      }(r = {
        exports: {}
      }), r.exports);
      return function () {
        function r(t) {
          !function (t, e) {
            if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
          }(this, r), this.version = "1.0.0";
          var e = Array.prototype.map,
              n = Array.prototype.forEach;
          t && (this.hasher = t), this.each = function (t, e, r) {
            if (null != t) if (n && t.forEach === n) t.forEach(e, r);else if (t.length === +t.length) {
              for (var o = 0, i = t.length; o < i; o++) {
                if (e.call(r, t[o], o, t) === {}) return;
              }
            } else for (var a in t) {
              if (t.hasOwnProperty(a) && e.call(r, t[a], a, t) === {}) return;
            }
          }, this.map = function (t, r, n) {
            var o = [];
            return null == t ? o : e && t.map === e ? t.map(r, n) : (this.each(t, function (t, e, i) {
              o[o.length] = r.call(n, t, e, i);
            }), o);
          };
        }

        var o, i, a, s;
        return o = r, (i = [{
          key: "getQimei36",
          value: function value(t, e) {
            var r = this;
            this.getHid().then(function (n) {
              var o = "3BJr" + t.substring(0, 2) + (n && n.substring(3, 7)),
                  i = new XMLHttpRequest();
              i.open("POST", "https://snowflake.qq.com/ola/h5", !0), i.setRequestHeader("Content-Type", "application/json"), i.onreadystatechange = function () {
                if (i.readyState == XMLHttpRequest.DONE && 200 == i.status) try {
                  e && e(JSON.parse(i.responseText));
                } catch (t) {
                  e(null);
                }
              }, i.send(JSON.stringify({
                appKey: t,
                hid: n,
                sign: o,
                version: r.version
              }));
            });
          }
        }, {
          key: "getHid",
          value: (a = n.mark(function t() {
            var e, r;
            return n.wrap(function (t) {
              for (;;) {
                switch (t.prev = t.next) {
                  case 0:
                    return (e = []).push((n = void 0, (n = [Math.floor(window.screen.width * window.devicePixelRatio), Math.floor(window.screen.height * window.devicePixelRatio)]).sort().reverse(), n.join("x"))), e.push((n = void 0, (n = [Math.floor(window.screen.availWidth * window.devicePixelRatio), Math.floor(window.screen.availHeight * window.devicePixelRatio)]).sort().reverse(), n.join("x"))), e.push(navigator.deviceMemory), e.push(!!window.sessionStorage), e.push(!!window.indexedDB), e.push(navigator.productSub), e.push(navigator.hardwareConcurrency), e.push(this.getWebglVendorAndRenderer()), e.push(new Date().getTimezoneOffset()), t.next = 12, this.getFactor();

                  case 12:
                    if (r = t.sent, e.push(r), this.hasher) return t.abrupt("return", this.hasher(e.join("###"), 31));
                    t.next = 18;
                    break;

                  case 18:
                    return t.abrupt("return", this.x64hash128(e.join("###"), 31));

                  case 19:
                  case "end":
                    return t.stop();
                }
              }

              var n;
            }, t, this);
          }), s = function s() {
            var e = this,
                r = arguments;
            return new Promise(function (n, o) {
              var i = a.apply(e, r);

              function s(e) {
                t(i, n, o, s, c, "next", e);
              }

              function c(e) {
                t(i, n, o, s, c, "throw", e);
              }

              s(void 0);
            });
          }, function () {
            return s.apply(this, arguments);
          })
        }, {
          key: "getUserAgent",
          value: function value() {
            return navigator.userAgent;
          }
        }, {
          key: "getNative",
          value: function value() {
            var t = this;
            this.getHid().then(function (e) {
              JSInterface.callback(t.version, e, t.getUserAgent());
            });
          }
        }, {
          key: "getWebglVendorAndRenderer",
          value: function value() {
            try {
              var t = function () {
                var t = document.createElement("canvas"),
                    e = null;

                try {
                  e = t.getContext("webgl") || t.getContext("experimental-webgl");
                } catch (t) {}

                return e || null;
              }(),
                  e = t.getExtension("WEBGL_debug_renderer_info"),
                  r = [t.getParameter(e.UNMASKED_VENDOR_WEBGL), t.getParameter(e.UNMASKED_RENDERER_WEBGL)].join("~"),
                  n = t.getExtension("WEBGL_lose_context");

              return null != n && n.loseContext(), r;
            } catch (t) {
              return null;
            }
          }
        }, {
          key: "getFactor",
          value: function value() {
            return new Promise(function (t, e) {
              var r = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
              r ? function () {
                var e = new r({
                  iceServers: []
                });
                e.createDataChannel("", {
                  reliable: !1
                }), e.onicecandidate = function (t) {
                  t.candidate && i("a=".concat(t.candidate.candidate));
                }, e.createOffer(function (t) {
                  i(t.sdp), e.setLocalDescription(t);
                }, function (t) {});
                var n = Object.create(null);

                function o(e) {
                  if (!(e in n)) {
                    n[e] = !0;

                    for (var r = Object.keys(n).filter(function (t) {
                      return n[t];
                    }), o = 0; o < r.length; o++) {
                      16 < r[o].length && (r.splice(o, 1), o--);
                    }

                    t(r[0]);
                  }
                }

                function i(t) {
                  (0 < arguments.length && void 0 !== t ? t : "").split("\r\n").forEach(function (t, e, r) {
                    var n, i;
                    ~t.indexOf("a=candidate") ? (i = (n = t.split(" "))[4], "host" === n[7] && o(i)) : ~t.indexOf("c=") && o(t.split(" ")[2]);
                  });
                }

                n["0.0.0.0"] = !1;
              }() : t(null);
            });
          }
        }, {
          key: "x64hash128",
          value: function value(t, e) {
            for (var r = function r(t, e) {
              t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]], e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]];
              var r = [0, 0, 0, 0];
              return r[3] += t[3] + e[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += t[2] + e[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += t[1] + e[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += t[0] + e[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]];
            }, n = function n(t, e) {
              t = [t[0] >>> 16, 65535 & t[0], t[1] >>> 16, 65535 & t[1]], e = [e[0] >>> 16, 65535 & e[0], e[1] >>> 16, 65535 & e[1]];
              var r = [0, 0, 0, 0];
              return r[3] += t[3] * e[3], r[2] += r[3] >>> 16, r[3] &= 65535, r[2] += t[2] * e[3], r[1] += r[2] >>> 16, r[2] &= 65535, r[2] += t[3] * e[2], r[1] += r[2] >>> 16, r[2] &= 65535, r[1] += t[1] * e[3], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += t[2] * e[2], r[0] += r[1] >>> 16, r[1] &= 65535, r[1] += t[3] * e[1], r[0] += r[1] >>> 16, r[1] &= 65535, r[0] += t[0] * e[3] + t[1] * e[2] + t[2] * e[1] + t[3] * e[0], r[0] &= 65535, [r[0] << 16 | r[1], r[2] << 16 | r[3]];
            }, o = function o(t, e) {
              return 32 == (e %= 64) ? [t[1], t[0]] : e < 32 ? [t[0] << e | t[1] >>> 32 - e, t[1] << e | t[0] >>> 32 - e] : [t[1] << (e -= 32) | t[0] >>> 32 - e, t[0] << e | t[1] >>> 32 - e];
            }, i = function i(t, e) {
              return 0 == (e %= 64) ? t : e < 32 ? [t[0] << e | t[1] >>> 32 - e, t[1] << e] : [t[1] << e - 32, 0];
            }, a = function a(t, e) {
              return [t[0] ^ e[0], t[1] ^ e[1]];
            }, s = function s(t) {
              return t = a(t, [0, t[0] >>> 1]), t = n(t, [4283543511, 3981806797]), t = a(t, [0, t[0] >>> 1]), t = n(t, [3301882366, 444984403]), a(t, [0, t[0] >>> 1]);
            }, c = (t = t || "").length % 16, u = t.length - c, l = [0, e = e || 0], h = [0, e], f = [0, 0], p = [0, 0], d = [2277735313, 289559509], v = [1291169091, 658871167], y = 0; y < u; y += 16) {
              f = [255 & t.charCodeAt(y + 4) | (255 & t.charCodeAt(y + 5)) << 8 | (255 & t.charCodeAt(y + 6)) << 16 | (255 & t.charCodeAt(y + 7)) << 24, 255 & t.charCodeAt(y) | (255 & t.charCodeAt(y + 1)) << 8 | (255 & t.charCodeAt(y + 2)) << 16 | (255 & t.charCodeAt(y + 3)) << 24], p = [255 & t.charCodeAt(y + 12) | (255 & t.charCodeAt(y + 13)) << 8 | (255 & t.charCodeAt(y + 14)) << 16 | (255 & t.charCodeAt(y + 15)) << 24, 255 & t.charCodeAt(y + 8) | (255 & t.charCodeAt(y + 9)) << 8 | (255 & t.charCodeAt(y + 10)) << 16 | (255 & t.charCodeAt(y + 11)) << 24], f = o(f = n(f, d), 31), f = n(f, v), l = r(l = o(l = a(l, f), 27), h), l = r(n(l, [0, 5]), [0, 1390208809]), p = o(p = n(p, v), 33), p = n(p, d), h = r(h = o(h = a(h, p), 31), l), h = r(n(h, [0, 5]), [0, 944331445]);
            }

            switch (f = [0, 0], p = [0, 0], c) {
              case 15:
                p = a(p, i([0, t.charCodeAt(y + 14)], 48));

              case 14:
                p = a(p, i([0, t.charCodeAt(y + 13)], 40));

              case 13:
                p = a(p, i([0, t.charCodeAt(y + 12)], 32));

              case 12:
                p = a(p, i([0, t.charCodeAt(y + 11)], 24));

              case 11:
                p = a(p, i([0, t.charCodeAt(y + 10)], 16));

              case 10:
                p = a(p, i([0, t.charCodeAt(y + 9)], 8));

              case 9:
                p = a(p, [0, t.charCodeAt(y + 8)]), p = o(p = n(p, v), 33), p = n(p, d), h = a(h, p);

              case 8:
                f = a(f, i([0, t.charCodeAt(y + 7)], 56));

              case 7:
                f = a(f, i([0, t.charCodeAt(y + 6)], 48));

              case 6:
                f = a(f, i([0, t.charCodeAt(y + 5)], 40));

              case 5:
                f = a(f, i([0, t.charCodeAt(y + 4)], 32));

              case 4:
                f = a(f, i([0, t.charCodeAt(y + 3)], 24));

              case 3:
                f = a(f, i([0, t.charCodeAt(y + 2)], 16));

              case 2:
                f = a(f, i([0, t.charCodeAt(y + 1)], 8));

              case 1:
                f = a(f, [t.charCodeAt(y)]), f = o(f = n(f, d), 31), f = n(f, v), l = a(l, f);
            }

            return l = a(l, [0, t.length]), h = r(h = a(h, [0, t.length]), l = r(l, h)), l = s(l), h = r(h = s(h), l = r(l, h)), ("00000000" + (l[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (l[1] >>> 0).toString(16)).slice(-8) + ("00000000" + (h[0] >>> 0).toString(16)).slice(-8) + ("00000000" + (h[1] >>> 0).toString(16)).slice(-8);
          }
        }]) && e(o.prototype, i), r;
      }();
    }();
  }),
      H = "logid_start",
      z = "4.5.6-web";

  return function (r) {
    function n(t) {
      var e = r.call(this, t) || this;
      e.qimei36 = "", e.uselessCycleTaskNum = 0, e.underWeakNet = !1, e.send = function (t, r, n) {
        e.storage.setItem(a, Date.now().toString()), e.network.post(e.uploadUrl || e.strategy.getUploadUrl(), t.data).then(function (n) {
          var o;
          100 == (null === (o = null == n ? void 0 : n.data) || void 0 === o ? void 0 : o.result) ? e.delayTime = 1e3 * n.data.delayTime : e.delayTime = 0, r && r(t.data), t.data.events.forEach(function (t) {
            e.store.removeEvent(t).then(function () {
              e.removeSendingId(p(t.mapValue));
            });
          }), e.doCustomCycleTask();
        }).catch(function (r) {
          var o = t.data.events;
          e.errorReport.reportError(r.code ? r.code.toString() : "600", r.message), n && n(t.data);
          var i = JSON.parse(e.storage.getItem(s));
          o.forEach(function (t) {
            i && -1 != i.indexOf(p(t)) && e.store.insertEvent(t, function (t, r) {
              t && e.errorReport.reportError("604", "insertEvent fail!");
            }), e.removeSendingId(p(t));
          }), e.monitorUploadFailed();
        });
      };
      var n,
          o,
          i = b();
      return e.isUnderIE8 = i > 0 && i < 8, e.isUnderIE8 || (e.isUnderIE = i > 0, t.needInitQimei && e.initQimei(t.appkey), e.network = new Q(t), e.storage = new K(t.appkey), e.initCommonInfo(t), e.store = new _(t.appkey, e.storage), e.errorReport = new y(e.config, e.commonInfo, "web", e.network), e.strategy = new g(e.config, e.commonInfo, e.storage, e.network), e.logidStartTime = e.storage.getItem(H), e.logidStartTime || (e.logidStartTime = Date.now().toString(), e.storage.setItem(H, e.logidStartTime)), n = e.logidStartTime, o = Date.now() - Number.parseFloat(n), Math.floor(o / 864e5) >= 365 && e.storage.clear(), e.initSession(t), e.onDirectUserAction("rqd_js_init", {}), setTimeout(function () {
        return e.lifeCycle.emit("init");
      }, 0), e.initDelayTime = t.delay ? t.delay : 1e3, e.cycleTask(e.initDelayTime)), e;
    }

    return function (e, r) {
      if ("function" != typeof r && null !== r) throw new TypeError("Class extends value " + String(r) + " is not a constructor or null");

      function n() {
        this.constructor = e;
      }

      _t(e, r), e.prototype = null === r ? Object.create(r) : (n.prototype = r.prototype, new n());
    }(n, r), n.prototype.initQimei = function (t) {
      var e = this;
      new W().getQimei36(t, function (t) {
        e.qimei36 = t.q36;
      });
    }, n.prototype.initSession = function (t) {
      var e = 18e5;
      t.sessionDuration && t.sessionDuration > 3e4 && (e = t.sessionDuration), this.beaconSession = new w(this.storage, e, this);
    }, n.prototype.initCommonInfo = function (t) {
      var e = Number(this.storage.getItem(a));

      try {
        var r = JSON.parse(this.storage.getItem(s));
        (Date.now() - e > 3e4 || !r) && this.storage.setItem(s, JSON.stringify([]));
      } catch (t) {}

      t.uploadUrl && (this.uploadUrl = t.uploadUrl + "?appkey=" + t.appkey);
      var n = [window.screen.width, window.screen.height];
      window.devicePixelRatio && n.push(window.devicePixelRatio), this.commonInfo = {
        deviceId: this.storage.createDeviceId(),
        language: navigator && navigator.language || "zh_CN",
        query: window.location.search,
        userAgent: navigator.userAgent,
        pixel: n.join("*"),
        channelID: t.channelID ? String(t.channelID) : "",
        openid: t.openid ? String(t.openid) : "",
        unid: t.unionid ? String(t.unionid) : "",
        sdkVersion: z
      }, this.config.appVersion = t.versionCode ? String(t.versionCode) : "", this.config.strictMode = t.strictMode;
    }, n.prototype.cycleTask = function (t) {
      var e = this;
      this.intervalID = window.setInterval(function () {
        e.store.getEvents().then(function (t) {
          var r = [],
              n = JSON.parse(e.storage.getItem(s));
          n || (n = []), t && t.forEach(function (t) {
            var e = p(t.mapValue);
            -1 == n.indexOf(e) && (r.push(t), n.push(e));
          }), 0 != r.length && (e.storage.setItem(s, JSON.stringify(n)), e._normalLogPipeline(e.assembleData(r)));
        }).catch(function (t) {});
      }, t);
    }, n.prototype.onReport = function (t, e, r) {
      var n = this;
      if (this.isUnderIE8) this.errorReport.reportError("601", "UnderIE8");else {
        var o = this.generateData(t, e, r);
        if (r && 0 == this.delayTime && !this.underWeakNet) this._normalLogPipeline(this.assembleData(o));else {
          var i = o.shift();
          i && this.store.insertEvent(i, function (t) {
            t && n.errorReport.reportError("604", "insertEvent fail!");
          }).catch(function (t) {
            n._normalLogPipeline(n.assembleData(o));
          });
        }
      }
    }, n.prototype.onSendBeacon = function (t, e) {
      if (this.isUnderIE) this.errorReport.reportError("605", "UnderIE");else {
        var r = this.assembleData(this.generateData(t, e, !0));
        "function" == typeof navigator.sendBeacon && navigator.sendBeacon(this.uploadUrl || this.strategy.getUploadUrl(), JSON.stringify(r));
      }
    }, n.prototype.generateData = function (t, r, n) {
      var o = [],
          i = "4.5.6-web_" + (n ? "direct_log_id" : "normal_log_id"),
          a = Number(this.storage.getItem(i));
      return a = a || 1, r = _e(_e({}, r), {
        A99: n ? "Y" : "N",
        A100: a.toString(),
        A72: z,
        A88: this.logidStartTime
      }), a++, this.storage.setItem(i, a.toString()), o.push({
        eventCode: t,
        eventTime: Date.now().toString(),
        mapValue: h(r, this.config.strictMode)
      }), o;
    }, n.prototype.assembleData = function (t) {
      var r = this.beaconSession.getSession();
      return {
        appVersion: this.config.appVersion ? f(this.config.appVersion) : "",
        sdkId: "js",
        sdkVersion: z,
        mainAppKey: this.config.appkey,
        platformId: 3,
        common: h(_e(_e({}, this.additionalParams), {
          A2: this.commonInfo.deviceId,
          A8: this.commonInfo.openid,
          A12: this.commonInfo.language,
          A17: this.commonInfo.pixel,
          A23: this.commonInfo.channelID,
          A50: this.commonInfo.unid,
          A76: r.sessionId,
          A101: this.commonInfo.userAgent,
          A102: window.location.href,
          A104: document.referrer,
          A119: this.commonInfo.query,
          A153: this.qimei36
        }), !1),
        events: t
      };
    }, n.prototype.monitorUploadFailed = function () {
      this.uselessCycleTaskNum++, this.uselessCycleTaskNum >= 5 && (window.clearInterval(this.intervalID), this.cycleTask(6e4), this.underWeakNet = !0);
    }, n.prototype.doCustomCycleTask = function () {
      this.uselessCycleTaskNum >= 5 && (window.clearInterval(this.intervalID), this.cycleTask(this.initDelayTime)), this.uselessCycleTaskNum = 0, this.underWeakNet = !1;
    }, n;
  }(v);
});
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js")))

/***/ }),

/***/ "./lib/crypto.js":
/*!***********************!*\
  !*** ./lib/crypto.js ***!
  \***********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(module) {var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

/*
 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 */
var CryptoJS = CryptoJS || function (g, l) {
  var e = {},
      d = e.lib = {},
      m = function m() {},
      k = d.Base = {
    extend: function extend(a) {
      m.prototype = this;
      var c = new m();
      a && c.mixIn(a);
      c.hasOwnProperty("init") || (c.init = function () {
        c.$super.init.apply(this, arguments);
      });
      c.init.prototype = c;
      c.$super = this;
      return c;
    },
    create: function create() {
      var a = this.extend();
      a.init.apply(a, arguments);
      return a;
    },
    init: function init() {},
    mixIn: function mixIn(a) {
      for (var c in a) {
        a.hasOwnProperty(c) && (this[c] = a[c]);
      }

      a.hasOwnProperty("toString") && (this.toString = a.toString);
    },
    clone: function clone() {
      return this.init.prototype.extend(this);
    }
  },
      p = d.WordArray = k.extend({
    init: function init(a, c) {
      a = this.words = a || [];
      this.sigBytes = c != l ? c : 4 * a.length;
    },
    toString: function toString(a) {
      return (a || n).stringify(this);
    },
    concat: function concat(a) {
      var c = this.words,
          q = a.words,
          f = this.sigBytes;
      a = a.sigBytes;
      this.clamp();
      if (f % 4) for (var b = 0; b < a; b++) {
        c[f + b >>> 2] |= (q[b >>> 2] >>> 24 - 8 * (b % 4) & 255) << 24 - 8 * ((f + b) % 4);
      } else if (65535 < q.length) for (b = 0; b < a; b += 4) {
        c[f + b >>> 2] = q[b >>> 2];
      } else c.push.apply(c, q);
      this.sigBytes += a;
      return this;
    },
    clamp: function clamp() {
      var a = this.words,
          c = this.sigBytes;
      a[c >>> 2] &= 4294967295 << 32 - 8 * (c % 4);
      a.length = g.ceil(c / 4);
    },
    clone: function clone() {
      var a = k.clone.call(this);
      a.words = this.words.slice(0);
      return a;
    },
    random: function random(a) {
      for (var c = [], b = 0; b < a; b += 4) {
        c.push(4294967296 * g.random() | 0);
      }

      return new p.init(c, a);
    }
  }),
      b = e.enc = {},
      n = b.Hex = {
    stringify: function stringify(a) {
      var c = a.words;
      a = a.sigBytes;

      for (var b = [], f = 0; f < a; f++) {
        var d = c[f >>> 2] >>> 24 - 8 * (f % 4) & 255;
        b.push((d >>> 4).toString(16));
        b.push((d & 15).toString(16));
      }

      return b.join("");
    },
    parse: function parse(a) {
      for (var c = a.length, b = [], f = 0; f < c; f += 2) {
        b[f >>> 3] |= parseInt(a.substr(f, 2), 16) << 24 - 4 * (f % 8);
      }

      return new p.init(b, c / 2);
    }
  },
      j = b.Latin1 = {
    stringify: function stringify(a) {
      var c = a.words;
      a = a.sigBytes;

      for (var b = [], f = 0; f < a; f++) {
        b.push(String.fromCharCode(c[f >>> 2] >>> 24 - 8 * (f % 4) & 255));
      }

      return b.join("");
    },
    parse: function parse(a) {
      for (var c = a.length, b = [], f = 0; f < c; f++) {
        b[f >>> 2] |= (a.charCodeAt(f) & 255) << 24 - 8 * (f % 4);
      }

      return new p.init(b, c);
    }
  },
      h = b.Utf8 = {
    stringify: function stringify(a) {
      try {
        return decodeURIComponent(escape(j.stringify(a)));
      } catch (c) {
        throw Error("Malformed UTF-8 data");
      }
    },
    parse: function parse(a) {
      return j.parse(unescape(encodeURIComponent(a)));
    }
  },
      r = d.BufferedBlockAlgorithm = k.extend({
    reset: function reset() {
      this._data = new p.init();
      this._nDataBytes = 0;
    },
    _append: function _append(a) {
      "string" == typeof a && (a = h.parse(a));

      this._data.concat(a);

      this._nDataBytes += a.sigBytes;
    },
    _process: function _process(a) {
      var c = this._data,
          b = c.words,
          f = c.sigBytes,
          d = this.blockSize,
          e = f / (4 * d),
          e = a ? g.ceil(e) : g.max((e | 0) - this._minBufferSize, 0);
      a = e * d;
      f = g.min(4 * a, f);

      if (a) {
        for (var k = 0; k < a; k += d) {
          this._doProcessBlock(b, k);
        }

        k = b.splice(0, a);
        c.sigBytes -= f;
      }

      return new p.init(k, f);
    },
    clone: function clone() {
      var a = k.clone.call(this);
      a._data = this._data.clone();
      return a;
    },
    _minBufferSize: 0
  });

  d.Hasher = r.extend({
    cfg: k.extend(),
    init: function init(a) {
      this.cfg = this.cfg.extend(a);
      this.reset();
    },
    reset: function reset() {
      r.reset.call(this);

      this._doReset();
    },
    update: function update(a) {
      this._append(a);

      this._process();

      return this;
    },
    finalize: function finalize(a) {
      a && this._append(a);
      return this._doFinalize();
    },
    blockSize: 16,
    _createHelper: function _createHelper(a) {
      return function (b, d) {
        return new a.init(d).finalize(b);
      };
    },
    _createHmacHelper: function _createHmacHelper(a) {
      return function (b, d) {
        return new s.HMAC.init(a, d).finalize(b);
      };
    }
  });
  var s = e.algo = {};
  return e;
}(Math);

(function () {
  var g = CryptoJS,
      l = g.lib,
      e = l.WordArray,
      d = l.Hasher,
      m = [],
      l = g.algo.SHA1 = d.extend({
    _doReset: function _doReset() {
      this._hash = new e.init([1732584193, 4023233417, 2562383102, 271733878, 3285377520]);
    },
    _doProcessBlock: function _doProcessBlock(d, e) {
      for (var b = this._hash.words, n = b[0], j = b[1], h = b[2], g = b[3], l = b[4], a = 0; 80 > a; a++) {
        if (16 > a) m[a] = d[e + a] | 0;else {
          var c = m[a - 3] ^ m[a - 8] ^ m[a - 14] ^ m[a - 16];
          m[a] = c << 1 | c >>> 31;
        }
        c = (n << 5 | n >>> 27) + l + m[a];
        c = 20 > a ? c + ((j & h | ~j & g) + 1518500249) : 40 > a ? c + ((j ^ h ^ g) + 1859775393) : 60 > a ? c + ((j & h | j & g | h & g) - 1894007588) : c + ((j ^ h ^ g) - 899497514);
        l = g;
        g = h;
        h = j << 30 | j >>> 2;
        j = n;
        n = c;
      }

      b[0] = b[0] + n | 0;
      b[1] = b[1] + j | 0;
      b[2] = b[2] + h | 0;
      b[3] = b[3] + g | 0;
      b[4] = b[4] + l | 0;
    },
    _doFinalize: function _doFinalize() {
      var d = this._data,
          e = d.words,
          b = 8 * this._nDataBytes,
          g = 8 * d.sigBytes;
      e[g >>> 5] |= 128 << 24 - g % 32;
      e[(g + 64 >>> 9 << 4) + 14] = Math.floor(b / 4294967296);
      e[(g + 64 >>> 9 << 4) + 15] = b;
      d.sigBytes = 4 * e.length;

      this._process();

      return this._hash;
    },
    clone: function clone() {
      var e = d.clone.call(this);
      e._hash = this._hash.clone();
      return e;
    }
  });
  g.SHA1 = d._createHelper(l);
  g.HmacSHA1 = d._createHmacHelper(l);
})();

(function () {
  var g = CryptoJS,
      l = g.enc.Utf8;
  g.algo.HMAC = g.lib.Base.extend({
    init: function init(e, d) {
      e = this._hasher = new e.init();
      "string" == typeof d && (d = l.parse(d));
      var g = e.blockSize,
          k = 4 * g;
      d.sigBytes > k && (d = e.finalize(d));
      d.clamp();

      for (var p = this._oKey = d.clone(), b = this._iKey = d.clone(), n = p.words, j = b.words, h = 0; h < g; h++) {
        n[h] ^= 1549556828, j[h] ^= 909522486;
      }

      p.sigBytes = b.sigBytes = k;
      this.reset();
    },
    reset: function reset() {
      var e = this._hasher;
      e.reset();
      e.update(this._iKey);
    },
    update: function update(e) {
      this._hasher.update(e);

      return this;
    },
    finalize: function finalize(e) {
      var d = this._hasher;
      e = d.finalize(e);
      d.reset();
      return d.finalize(this._oKey.clone().concat(e));
    }
  });
})();

(function () {
  // Shortcuts
  var C = CryptoJS;
  var C_lib = C.lib;
  var WordArray = C_lib.WordArray;
  var C_enc = C.enc;
  /**
   * Base64 encoding strategy.
   */

  var Base64 = C_enc.Base64 = {
    /**
     * Converts a word array to a Base64 string.
     *
     * @param {WordArray} wordArray The word array.
     *
     * @return {string} The Base64 string.
     *
     * @static
     *
     * @example
     *
     *     var base64String = CryptoJS.enc.Base64.stringify(wordArray);
     */
    stringify: function stringify(wordArray) {
      // Shortcuts
      var words = wordArray.words;
      var sigBytes = wordArray.sigBytes;
      var map = this._map; // Clamp excess bits

      wordArray.clamp(); // Convert

      var base64Chars = [];

      for (var i = 0; i < sigBytes; i += 3) {
        var byte1 = words[i >>> 2] >>> 24 - i % 4 * 8 & 0xff;
        var byte2 = words[i + 1 >>> 2] >>> 24 - (i + 1) % 4 * 8 & 0xff;
        var byte3 = words[i + 2 >>> 2] >>> 24 - (i + 2) % 4 * 8 & 0xff;
        var triplet = byte1 << 16 | byte2 << 8 | byte3;

        for (var j = 0; j < 4 && i + j * 0.75 < sigBytes; j++) {
          base64Chars.push(map.charAt(triplet >>> 6 * (3 - j) & 0x3f));
        }
      } // Add padding


      var paddingChar = map.charAt(64);

      if (paddingChar) {
        while (base64Chars.length % 4) {
          base64Chars.push(paddingChar);
        }
      }

      return base64Chars.join('');
    },

    /**
     * Converts a Base64 string to a word array.
     *
     * @param {string} base64Str The Base64 string.
     *
     * @return {WordArray} The word array.
     *
     * @static
     *
     * @example
     *
     *     var wordArray = CryptoJS.enc.Base64.parse(base64String);
     */
    parse: function parse(base64Str) {
      // Shortcuts
      var base64StrLength = base64Str.length;
      var map = this._map; // Ignore padding

      var paddingChar = map.charAt(64);

      if (paddingChar) {
        var paddingIndex = base64Str.indexOf(paddingChar);

        if (paddingIndex != -1) {
          base64StrLength = paddingIndex;
        }
      } // Convert


      var words = [];
      var nBytes = 0;

      for (var i = 0; i < base64StrLength; i++) {
        if (i % 4) {
          var bits1 = map.indexOf(base64Str.charAt(i - 1)) << i % 4 * 2;
          var bits2 = map.indexOf(base64Str.charAt(i)) >>> 6 - i % 4 * 2;
          words[nBytes >>> 2] |= (bits1 | bits2) << 24 - nBytes % 4 * 8;
          nBytes++;
        }
      }

      return WordArray.create(words, nBytes);
    },
    _map: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='
  };
})();

if (( false ? undefined : _typeof(module)) === 'object') {
  module.exports = CryptoJS;
} else {
  window.CryptoJS = CryptoJS;
}
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./lib/json2xml.js":
/*!*************************!*\
  !*** ./lib/json2xml.js ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

//copyright Ryan Day 2010 <http://ryanday.org>, Joscha Feth 2013 <http://www.feth.com> [MIT Licensed]
var element_start_char = "a-zA-Z_\xC0-\xD6\xD8-\xF6\xF8-\xFF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FFF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD";
var element_non_start_char = "-.0-9\xB7\u0300-\u036F\u203F\u2040";
var element_replace = new RegExp("^([^" + element_start_char + "])|^((x|X)(m|M)(l|L))|([^" + element_start_char + element_non_start_char + "])", "g");
var not_safe_in_xml = /[^\x09\x0A\x0D\x20-\xFF\x85\xA0-\uD7FF\uE000-\uFDCF\uFDE0-\uFFFD]/gm;

var objKeys = function objKeys(obj) {
  var l = [];

  if (obj instanceof Object) {
    for (var k in obj) {
      if (obj.hasOwnProperty(k)) {
        l.push(k);
      }
    }
  }

  return l;
};

var process_to_xml = function process_to_xml(node_data, options) {
  var makeNode = function makeNode(name, content, attributes, level, hasSubNodes) {
    var indent_value = options.indent !== undefined ? options.indent : "\t";
    var indent = options.prettyPrint ? '\n' + new Array(level).join(indent_value) : '';

    if (options.removeIllegalNameCharacters) {
      name = name.replace(element_replace, '_');
    }

    var node = [indent, '<', name, attributes || ''];

    if (content && content.length > 0) {
      node.push('>');
      node.push(content);
      hasSubNodes && node.push(indent);
      node.push('</');
      node.push(name);
      node.push('>');
    } else {
      node.push('/>');
    }

    return node.join('');
  };

  return function fn(node_data, node_descriptor, level) {
    var type = _typeof(node_data);

    if (Array.isArray ? Array.isArray(node_data) : node_data instanceof Array) {
      type = 'array';
    } else if (node_data instanceof Date) {
      type = 'date';
    }

    switch (type) {
      //if value is an array create child nodes from values
      case 'array':
        var ret = [];
        node_data.map(function (v) {
          ret.push(fn(v, 1, level + 1)); //entries that are values of an array are the only ones that can be special node descriptors
        });
        options.prettyPrint && ret.push('\n');
        return ret.join('');
        break;

      case 'date':
        // cast dates to ISO 8601 date (soap likes it)
        return node_data.toJSON ? node_data.toJSON() : node_data + '';
        break;

      case 'object':
        var nodes = [];

        for (var name in node_data) {
          if (node_data.hasOwnProperty(name)) {
            if (node_data[name] instanceof Array) {
              for (var j = 0; j < node_data[name].length; j++) {
                if (node_data[name].hasOwnProperty(j)) {
                  nodes.push(makeNode(name, fn(node_data[name][j], 0, level + 1), null, level + 1, objKeys(node_data[name][j]).length));
                }
              }
            } else {
              nodes.push(makeNode(name, fn(node_data[name], 0, level + 1), null, level + 1));
            }
          }
        }

        options.prettyPrint && nodes.length > 0 && nodes.push('\n');
        return nodes.join('');
        break;

      case 'function':
        return node_data();
        break;

      default:
        return options.escape ? esc(node_data) : '' + node_data;
    }
  }(node_data, 0, 0);
};

var xml_header = function xml_header(standalone) {
  var ret = ['<?xml version="1.0" encoding="UTF-8"'];

  if (standalone) {
    ret.push(' standalone="yes"');
  }

  ret.push('?>');
  return ret.join('');
};

function esc(str) {
  return ('' + str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&apos;').replace(/"/g, '&quot;').replace(not_safe_in_xml, '');
}

module.exports = function (obj, options) {
  if (!options) {
    options = {
      xmlHeader: {
        standalone: true
      },
      prettyPrint: true,
      indent: "  ",
      escape: true
    };
  }

  if (typeof obj == 'string') {
    try {
      obj = JSON.parse(obj.toString());
    } catch (e) {
      return false;
    }
  }

  var xmlheader = '';
  var docType = '';

  if (options) {
    if (_typeof(options) == 'object') {
      // our config is an object
      if (options.xmlHeader) {
        // the user wants an xml header
        xmlheader = xml_header(!!options.xmlHeader.standalone);
      }

      if (typeof options.docType != 'undefined') {
        docType = '<!DOCTYPE ' + options.docType + '>';
      }
    } else {
      // our config is a boolean value, so just add xml header
      xmlheader = xml_header();
    }
  }

  options = options || {};
  var ret = [xmlheader, options.prettyPrint && docType ? '\n' : '', docType, process_to_xml(obj, options)];
  return ret.join('').replace(/\n{2,}/g, '\n').replace(/\s+$/g, '');
};

/***/ }),

/***/ "./lib/md5.js":
/*!********************!*\
  !*** ./lib/md5.js ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(process, global, module) {var __WEBPACK_AMD_DEFINE_RESULT__;var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

/* https://github.com/emn178/js-md5 */
(function () {
  'use strict';

  var ERROR = 'input is invalid type';
  var WINDOW = (typeof window === "undefined" ? "undefined" : _typeof(window)) === 'object';
  var root = WINDOW ? window : {};

  if (root.JS_MD5_NO_WINDOW) {
    WINDOW = false;
  }

  var WEB_WORKER = !WINDOW && (typeof self === "undefined" ? "undefined" : _typeof(self)) === 'object';
  var NODE_JS = !root.JS_MD5_NO_NODE_JS && (typeof process === "undefined" ? "undefined" : _typeof(process)) === 'object' && process.versions && process.versions.node;

  if (NODE_JS) {
    root = global;
  } else if (WEB_WORKER) {
    root = self;
  }

  var COMMON_JS = !root.JS_MD5_NO_COMMON_JS && ( false ? undefined : _typeof(module)) === 'object' && module.exports;
  var AMD =   true && __webpack_require__(/*! !webpack amd options */ "./node_modules/webpack/buildin/amd-options.js");
  var ARRAY_BUFFER = !root.JS_MD5_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';
  var HEX_CHARS = '0123456789abcdef'.split('');
  var EXTRA = [128, 32768, 8388608, -2147483648];
  var SHIFT = [0, 8, 16, 24];
  var OUTPUT_TYPES = ['hex', 'array', 'digest', 'buffer', 'arrayBuffer', 'base64'];
  var BASE64_ENCODE_CHAR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');
  var blocks = [],
      buffer8;

  if (ARRAY_BUFFER) {
    var buffer = new ArrayBuffer(68);
    buffer8 = new Uint8Array(buffer);
    blocks = new Uint32Array(buffer);
  }

  if (root.JS_MD5_NO_NODE_JS || !Array.isArray) {
    Array.isArray = function (obj) {
      return Object.prototype.toString.call(obj) === '[object Array]';
    };
  }

  if (ARRAY_BUFFER && (root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {
    ArrayBuffer.isView = function (obj) {
      return _typeof(obj) === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;
    };
  }
  /**
   * @method hex
   * @memberof md5
   * @description Output hash as hex string
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {String} Hex string
   * @example
   * md5.hex('The quick brown fox jumps over the lazy dog');
   * // equal to
   * md5('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method digest
   * @memberof md5
   * @description Output hash as bytes array
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Array} Bytes array
   * @example
   * md5.digest('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method array
   * @memberof md5
   * @description Output hash as bytes array
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Array} Bytes array
   * @example
   * md5.array('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method arrayBuffer
   * @memberof md5
   * @description Output hash as ArrayBuffer
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {ArrayBuffer} ArrayBuffer
   * @example
   * md5.arrayBuffer('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method buffer
   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.
   * @memberof md5
   * @description Output hash as ArrayBuffer
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {ArrayBuffer} ArrayBuffer
   * @example
   * md5.buffer('The quick brown fox jumps over the lazy dog');
   */

  /**
   * @method base64
   * @memberof md5
   * @description Output hash as base64 string
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {String} base64 string
   * @example
   * md5.base64('The quick brown fox jumps over the lazy dog');
   */


  var createOutputMethod = function createOutputMethod(outputType) {
    return function (message, isBinStr) {
      return new Md5(true).update(message, isBinStr)[outputType]();
    };
  };
  /**
   * @method create
   * @memberof md5
   * @description Create Md5 object
   * @returns {Md5} Md5 object.
   * @example
   * var hash = md5.create();
   */

  /**
   * @method update
   * @memberof md5
   * @description Create and update Md5 object
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Md5} Md5 object.
   * @example
   * var hash = md5.update('The quick brown fox jumps over the lazy dog');
   * // equal to
   * var hash = md5.create();
   * hash.update('The quick brown fox jumps over the lazy dog');
   */


  var createMethod = function createMethod() {
    var method = createOutputMethod('hex');

    if (NODE_JS) {
      method = nodeWrap(method);
    }

    method.getCtx = method.create = function () {
      return new Md5();
    };

    method.update = function (message) {
      return method.create().update(message);
    };

    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {
      var type = OUTPUT_TYPES[i];
      method[type] = createOutputMethod(type);
    }

    return method;
  };

  var nodeWrap = function nodeWrap(method) {
    var crypto = eval("require('crypto')");
    var Buffer = eval("require('buffer').Buffer");

    var nodeMethod = function nodeMethod(message) {
      if (typeof message === 'string') {
        return crypto.createHash('md5').update(message, 'utf8').digest('hex');
      } else {
        if (message === null || message === undefined) {
          throw ERROR;
        } else if (message.constructor === ArrayBuffer) {
          message = new Uint8Array(message);
        }
      }

      if (Array.isArray(message) || ArrayBuffer.isView(message) || message.constructor === Buffer) {
        return crypto.createHash('md5').update(new Buffer(message)).digest('hex');
      } else {
        return method(message);
      }
    };

    return nodeMethod;
  };
  /**
   * Md5 class
   * @class Md5
   * @description This is internal class.
   * @see {@link md5.create}
   */


  function Md5(sharedMemory) {
    if (sharedMemory) {
      blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
      this.blocks = blocks;
      this.buffer8 = buffer8;
    } else {
      if (ARRAY_BUFFER) {
        var buffer = new ArrayBuffer(68);
        this.buffer8 = new Uint8Array(buffer);
        this.blocks = new Uint32Array(buffer);
      } else {
        this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
      }
    }

    this.h0 = this.h1 = this.h2 = this.h3 = this.start = this.bytes = this.hBytes = 0;
    this.finalized = this.hashed = false;
    this.first = true;
  }
  /**
   * @method update
   * @memberof Md5
   * @instance
   * @description Update hash
   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
   * @returns {Md5} Md5 object.
   * @see {@link md5.update}
   */


  Md5.prototype.update = function (message, isBinStr) {
    if (this.finalized) {
      return;
    }

    var code,
        index = 0,
        i,
        length = message.length,
        blocks = this.blocks;
    var buffer8 = this.buffer8;

    while (index < length) {
      if (this.hashed) {
        this.hashed = false;
        blocks[0] = blocks[16];
        blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
      }

      if (ARRAY_BUFFER) {
        for (i = this.start; index < length && i < 64; ++index) {
          code = message.charCodeAt(index);

          if (isBinStr || code < 0x80) {
            buffer8[i++] = code;
          } else if (code < 0x800) {
            buffer8[i++] = 0xc0 | code >> 6;
            buffer8[i++] = 0x80 | code & 0x3f;
          } else if (code < 0xd800 || code >= 0xe000) {
            buffer8[i++] = 0xe0 | code >> 12;
            buffer8[i++] = 0x80 | code >> 6 & 0x3f;
            buffer8[i++] = 0x80 | code & 0x3f;
          } else {
            code = 0x10000 + ((code & 0x3ff) << 10 | message.charCodeAt(++index) & 0x3ff);
            buffer8[i++] = 0xf0 | code >> 18;
            buffer8[i++] = 0x80 | code >> 12 & 0x3f;
            buffer8[i++] = 0x80 | code >> 6 & 0x3f;
            buffer8[i++] = 0x80 | code & 0x3f;
          }
        }
      } else {
        for (i = this.start; index < length && i < 64; ++index) {
          code = message.charCodeAt(index);

          if (isBinStr || code < 0x80) {
            blocks[i >> 2] |= code << SHIFT[i++ & 3];
          } else if (code < 0x800) {
            blocks[i >> 2] |= (0xc0 | code >> 6) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          } else if (code < 0xd800 || code >= 0xe000) {
            blocks[i >> 2] |= (0xe0 | code >> 12) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          } else {
            code = 0x10000 + ((code & 0x3ff) << 10 | message.charCodeAt(++index) & 0x3ff);
            blocks[i >> 2] |= (0xf0 | code >> 18) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 12 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code >> 6 & 0x3f) << SHIFT[i++ & 3];
            blocks[i >> 2] |= (0x80 | code & 0x3f) << SHIFT[i++ & 3];
          }
        }
      }

      this.lastByteIndex = i;
      this.bytes += i - this.start;

      if (i >= 64) {
        this.start = i - 64;
        this.hash();
        this.hashed = true;
      } else {
        this.start = i;
      }
    }

    if (this.bytes > 4294967295) {
      this.hBytes += this.bytes / 4294967296 << 0;
      this.bytes = this.bytes % 4294967296;
    }

    return this;
  };

  Md5.prototype.finalize = function () {
    if (this.finalized) {
      return;
    }

    this.finalized = true;
    var blocks = this.blocks,
        i = this.lastByteIndex;
    blocks[i >> 2] |= EXTRA[i & 3];

    if (i >= 56) {
      if (!this.hashed) {
        this.hash();
      }

      blocks[0] = blocks[16];
      blocks[16] = blocks[1] = blocks[2] = blocks[3] = blocks[4] = blocks[5] = blocks[6] = blocks[7] = blocks[8] = blocks[9] = blocks[10] = blocks[11] = blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;
    }

    blocks[14] = this.bytes << 3;
    blocks[15] = this.hBytes << 3 | this.bytes >>> 29;
    this.hash();
  };

  Md5.prototype.hash = function () {
    var a,
        b,
        c,
        d,
        bc,
        da,
        blocks = this.blocks;

    if (this.first) {
      a = blocks[0] - 680876937;
      a = (a << 7 | a >>> 25) - 271733879 << 0;
      d = (-1732584194 ^ a & 2004318071) + blocks[1] - 117830708;
      d = (d << 12 | d >>> 20) + a << 0;
      c = (-271733879 ^ d & (a ^ -271733879)) + blocks[2] - 1126478375;
      c = (c << 17 | c >>> 15) + d << 0;
      b = (a ^ c & (d ^ a)) + blocks[3] - 1316259209;
      b = (b << 22 | b >>> 10) + c << 0;
    } else {
      a = this.h0;
      b = this.h1;
      c = this.h2;
      d = this.h3;
      a += (d ^ b & (c ^ d)) + blocks[0] - 680876936;
      a = (a << 7 | a >>> 25) + b << 0;
      d += (c ^ a & (b ^ c)) + blocks[1] - 389564586;
      d = (d << 12 | d >>> 20) + a << 0;
      c += (b ^ d & (a ^ b)) + blocks[2] + 606105819;
      c = (c << 17 | c >>> 15) + d << 0;
      b += (a ^ c & (d ^ a)) + blocks[3] - 1044525330;
      b = (b << 22 | b >>> 10) + c << 0;
    }

    a += (d ^ b & (c ^ d)) + blocks[4] - 176418897;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[5] + 1200080426;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[6] - 1473231341;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[7] - 45705983;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (d ^ b & (c ^ d)) + blocks[8] + 1770035416;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[9] - 1958414417;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[10] - 42063;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[11] - 1990404162;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (d ^ b & (c ^ d)) + blocks[12] + 1804603682;
    a = (a << 7 | a >>> 25) + b << 0;
    d += (c ^ a & (b ^ c)) + blocks[13] - 40341101;
    d = (d << 12 | d >>> 20) + a << 0;
    c += (b ^ d & (a ^ b)) + blocks[14] - 1502002290;
    c = (c << 17 | c >>> 15) + d << 0;
    b += (a ^ c & (d ^ a)) + blocks[15] + 1236535329;
    b = (b << 22 | b >>> 10) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[1] - 165796510;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[6] - 1069501632;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[11] + 643717713;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[0] - 373897302;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[5] - 701558691;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[10] + 38016083;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[15] - 660478335;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[4] - 405537848;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[9] + 568446438;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[14] - 1019803690;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[3] - 187363961;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[8] + 1163531501;
    b = (b << 20 | b >>> 12) + c << 0;
    a += (c ^ d & (b ^ c)) + blocks[13] - 1444681467;
    a = (a << 5 | a >>> 27) + b << 0;
    d += (b ^ c & (a ^ b)) + blocks[2] - 51403784;
    d = (d << 9 | d >>> 23) + a << 0;
    c += (a ^ b & (d ^ a)) + blocks[7] + 1735328473;
    c = (c << 14 | c >>> 18) + d << 0;
    b += (d ^ a & (c ^ d)) + blocks[12] - 1926607734;
    b = (b << 20 | b >>> 12) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[5] - 378558;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[8] - 2022574463;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[11] + 1839030562;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[14] - 35309556;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[1] - 1530992060;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[4] + 1272893353;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[7] - 155497632;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[10] - 1094730640;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[13] + 681279174;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[0] - 358537222;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[3] - 722521979;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[6] + 76029189;
    b = (b << 23 | b >>> 9) + c << 0;
    bc = b ^ c;
    a += (bc ^ d) + blocks[9] - 640364487;
    a = (a << 4 | a >>> 28) + b << 0;
    d += (bc ^ a) + blocks[12] - 421815835;
    d = (d << 11 | d >>> 21) + a << 0;
    da = d ^ a;
    c += (da ^ b) + blocks[15] + 530742520;
    c = (c << 16 | c >>> 16) + d << 0;
    b += (da ^ c) + blocks[2] - 995338651;
    b = (b << 23 | b >>> 9) + c << 0;
    a += (c ^ (b | ~d)) + blocks[0] - 198630844;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[7] + 1126891415;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[14] - 1416354905;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[5] - 57434055;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[12] + 1700485571;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[3] - 1894986606;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[10] - 1051523;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[1] - 2054922799;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[8] + 1873313359;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[15] - 30611744;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[6] - 1560198380;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[13] + 1309151649;
    b = (b << 21 | b >>> 11) + c << 0;
    a += (c ^ (b | ~d)) + blocks[4] - 145523070;
    a = (a << 6 | a >>> 26) + b << 0;
    d += (b ^ (a | ~c)) + blocks[11] - 1120210379;
    d = (d << 10 | d >>> 22) + a << 0;
    c += (a ^ (d | ~b)) + blocks[2] + 718787259;
    c = (c << 15 | c >>> 17) + d << 0;
    b += (d ^ (c | ~a)) + blocks[9] - 343485551;
    b = (b << 21 | b >>> 11) + c << 0;

    if (this.first) {
      this.h0 = a + 1732584193 << 0;
      this.h1 = b - 271733879 << 0;
      this.h2 = c - 1732584194 << 0;
      this.h3 = d + 271733878 << 0;
      this.first = false;
    } else {
      this.h0 = this.h0 + a << 0;
      this.h1 = this.h1 + b << 0;
      this.h2 = this.h2 + c << 0;
      this.h3 = this.h3 + d << 0;
    }
  };
  /**
   * @method hex
   * @memberof Md5
   * @instance
   * @description Output hash as hex string
   * @returns {String} Hex string
   * @see {@link md5.hex}
   * @example
   * hash.hex();
   */


  Md5.prototype.hex = function () {
    this.finalize();
    var h0 = this.h0,
        h1 = this.h1,
        h2 = this.h2,
        h3 = this.h3;
    return HEX_CHARS[h0 >> 4 & 0x0F] + HEX_CHARS[h0 & 0x0F] + HEX_CHARS[h0 >> 12 & 0x0F] + HEX_CHARS[h0 >> 8 & 0x0F] + HEX_CHARS[h0 >> 20 & 0x0F] + HEX_CHARS[h0 >> 16 & 0x0F] + HEX_CHARS[h0 >> 28 & 0x0F] + HEX_CHARS[h0 >> 24 & 0x0F] + HEX_CHARS[h1 >> 4 & 0x0F] + HEX_CHARS[h1 & 0x0F] + HEX_CHARS[h1 >> 12 & 0x0F] + HEX_CHARS[h1 >> 8 & 0x0F] + HEX_CHARS[h1 >> 20 & 0x0F] + HEX_CHARS[h1 >> 16 & 0x0F] + HEX_CHARS[h1 >> 28 & 0x0F] + HEX_CHARS[h1 >> 24 & 0x0F] + HEX_CHARS[h2 >> 4 & 0x0F] + HEX_CHARS[h2 & 0x0F] + HEX_CHARS[h2 >> 12 & 0x0F] + HEX_CHARS[h2 >> 8 & 0x0F] + HEX_CHARS[h2 >> 20 & 0x0F] + HEX_CHARS[h2 >> 16 & 0x0F] + HEX_CHARS[h2 >> 28 & 0x0F] + HEX_CHARS[h2 >> 24 & 0x0F] + HEX_CHARS[h3 >> 4 & 0x0F] + HEX_CHARS[h3 & 0x0F] + HEX_CHARS[h3 >> 12 & 0x0F] + HEX_CHARS[h3 >> 8 & 0x0F] + HEX_CHARS[h3 >> 20 & 0x0F] + HEX_CHARS[h3 >> 16 & 0x0F] + HEX_CHARS[h3 >> 28 & 0x0F] + HEX_CHARS[h3 >> 24 & 0x0F];
  };
  /**
   * @method toString
   * @memberof Md5
   * @instance
   * @description Output hash as hex string
   * @returns {String} Hex string
   * @see {@link md5.hex}
   * @example
   * hash.toString();
   */


  Md5.prototype.toString = Md5.prototype.hex;
  /**
   * @method digest
   * @memberof Md5
   * @instance
   * @description Output hash as bytes array
   * @returns {Array} Bytes array
   * @see {@link md5.digest}
   * @example
   * hash.digest();
   */

  Md5.prototype.digest = function (format) {
    if (format === 'hex') return this.hex();
    this.finalize();
    var h0 = this.h0,
        h1 = this.h1,
        h2 = this.h2,
        h3 = this.h3;
    var res = [h0 & 0xFF, h0 >> 8 & 0xFF, h0 >> 16 & 0xFF, h0 >> 24 & 0xFF, h1 & 0xFF, h1 >> 8 & 0xFF, h1 >> 16 & 0xFF, h1 >> 24 & 0xFF, h2 & 0xFF, h2 >> 8 & 0xFF, h2 >> 16 & 0xFF, h2 >> 24 & 0xFF, h3 & 0xFF, h3 >> 8 & 0xFF, h3 >> 16 & 0xFF, h3 >> 24 & 0xFF];
    return res;
  };
  /**
   * @method array
   * @memberof Md5
   * @instance
   * @description Output hash as bytes array
   * @returns {Array} Bytes array
   * @see {@link md5.array}
   * @example
   * hash.array();
   */


  Md5.prototype.array = Md5.prototype.digest;
  /**
   * @method arrayBuffer
   * @memberof Md5
   * @instance
   * @description Output hash as ArrayBuffer
   * @returns {ArrayBuffer} ArrayBuffer
   * @see {@link md5.arrayBuffer}
   * @example
   * hash.arrayBuffer();
   */

  Md5.prototype.arrayBuffer = function () {
    this.finalize();
    var buffer = new ArrayBuffer(16);
    var blocks = new Uint32Array(buffer);
    blocks[0] = this.h0;
    blocks[1] = this.h1;
    blocks[2] = this.h2;
    blocks[3] = this.h3;
    return buffer;
  };
  /**
   * @method buffer
   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.
   * @memberof Md5
   * @instance
   * @description Output hash as ArrayBuffer
   * @returns {ArrayBuffer} ArrayBuffer
   * @see {@link md5.buffer}
   * @example
   * hash.buffer();
   */


  Md5.prototype.buffer = Md5.prototype.arrayBuffer;
  /**
   * @method base64
   * @memberof Md5
   * @instance
   * @description Output hash as base64 string
   * @returns {String} base64 string
   * @see {@link md5.base64}
   * @example
   * hash.base64();
   */

  Md5.prototype.base64 = function () {
    var v1,
        v2,
        v3,
        base64Str = '',
        bytes = this.array();

    for (var i = 0; i < 15;) {
      v1 = bytes[i++];
      v2 = bytes[i++];
      v3 = bytes[i++];
      base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] + BASE64_ENCODE_CHAR[(v1 << 4 | v2 >>> 4) & 63] + BASE64_ENCODE_CHAR[(v2 << 2 | v3 >>> 6) & 63] + BASE64_ENCODE_CHAR[v3 & 63];
    }

    v1 = bytes[i];
    base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] + BASE64_ENCODE_CHAR[v1 << 4 & 63] + '==';
    return base64Str;
  };

  var exports = createMethod();

  if (COMMON_JS) {
    module.exports = exports;
  } else {
    /**
     * @method md5
     * @description Md5 hash function, export to global in browsers.
     * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash
     * @returns {String} md5 hashes
     * @example
     * md5(''); // d41d8cd98f00b204e9800998ecf8427e
     * md5('The quick brown fox jumps over the lazy dog'); // 9e107d9d372bb6826bd81d3542a419d6
     * md5('The quick brown fox jumps over the lazy dog.'); // e4d909c290d0fb1ca068ffaddf22cbd0
     *
     * // It also supports UTF-8 encoding
     * md5('中文'); // a7bac2239fcdcb3a067903d8077c4a07
     *
     * // It also supports byte `Array`, `Uint8Array`, `ArrayBuffer`
     * md5([]); // d41d8cd98f00b204e9800998ecf8427e
     * md5(new Uint8Array([])); // d41d8cd98f00b204e9800998ecf8427e
     */
    root.md5 = exports;

    if (AMD) {
      !(__WEBPACK_AMD_DEFINE_RESULT__ = (function () {
        return exports;
      }).call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
    }
  }
})();
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/process/browser.js */ "./node_modules/process/browser.js"), __webpack_require__(/*! ./../node_modules/webpack/buildin/global.js */ "./node_modules/webpack/buildin/global.js"), __webpack_require__(/*! ./../node_modules/webpack/buildin/module.js */ "./node_modules/webpack/buildin/module.js")(module)))

/***/ }),

/***/ "./lib/request.js":
/*!************************!*\
  !*** ./lib/request.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var stringifyPrimitive = function stringifyPrimitive(v) {
  switch (_typeof(v)) {
    case 'string':
      return v;

    case 'boolean':
      return v ? 'true' : 'false';

    case 'number':
      return isFinite(v) ? v : '';

    default:
      return '';
  }
};

var queryStringify = function queryStringify(obj, sep, eq, name) {
  sep = sep || '&';
  eq = eq || '=';

  if (obj === null) {
    obj = undefined;
  }

  if (_typeof(obj) === 'object') {
    return Object.keys(obj).map(function (k) {
      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;

      if (Array.isArray(obj[k])) {
        return obj[k].map(function (v) {
          return ks + encodeURIComponent(stringifyPrimitive(v));
        }).join(sep);
      } else {
        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));
      }
    }).filter(Boolean).join(sep);
  }

  if (!name) return '';
  return encodeURIComponent(stringifyPrimitive(name)) + eq + encodeURIComponent(stringifyPrimitive(obj));
};

var xhrRes = function xhrRes(err, xhr, body) {
  var headers = {};
  xhr.getAllResponseHeaders().trim().split('\n').forEach(function (item) {
    if (item) {
      var index = item.indexOf(':');
      var key = item.substr(0, index).trim().toLowerCase();
      var val = item.substr(index + 1).trim();
      headers[key] = val;
    }
  });
  return {
    error: err,
    statusCode: xhr.status,
    statusMessage: xhr.statusText,
    headers: headers,
    body: body
  };
};

var xhrBody = function xhrBody(xhr, dataType) {
  return !dataType && dataType === 'text' ? xhr.responseText : xhr.response;
};

var request = function request(opt, callback) {
  // method
  var method = (opt.method || 'GET').toUpperCase(); // url、qs

  var url = opt.url;

  if (opt.qs) {
    var qsStr = queryStringify(opt.qs);

    if (qsStr) {
      url += (url.indexOf('?') === -1 ? '?' : '&') + qsStr;
    }
  } // 创建 ajax 实例


  var xhr = new XMLHttpRequest();
  xhr.open(method, url, true);
  xhr.responseType = opt.dataType || 'text'; // 处理 xhrFields 属性

  if (opt.xhrFields) {
    for (var xhrField in opt.xhrFields) {
      xhr[xhrField] = opt.xhrFields[xhrField];
    }
  } // 处理 headers


  var headers = opt.headers;

  if (headers) {
    for (var key in headers) {
      if (headers.hasOwnProperty(key) && key.toLowerCase() !== 'content-length' && key.toLowerCase() !== 'user-agent' && key.toLowerCase() !== 'origin' && key.toLowerCase() !== 'host') {
        xhr.setRequestHeader(key, headers[key]);
      }
    }
  } // onprogress


  if (opt.onProgress && xhr.upload) xhr.upload.onprogress = opt.onProgress;
  if (opt.onDownloadProgress) xhr.onprogress = opt.onDownloadProgress; // timeout

  if (opt.timeout) xhr.timeout = opt.timeout;

  xhr.ontimeout = function (event) {
    var error = new Error('timeout');
    callback(xhrRes(error, xhr));
  }; // success 2xx/3xx/4xx


  xhr.onload = function () {
    callback(xhrRes(null, xhr, xhrBody(xhr, opt.dataType)));
  }; // error 5xx/0 (网络错误、跨域报错、Https connect-src 限制的报错时 statusCode 为 0)


  xhr.onerror = function (err) {
    var body = xhrBody(xhr, opt.dataType);

    if (body) {
      // 5xx
      callback(xhrRes(null, xhr, body));
    } else {
      // 0
      var error = xhr.statusText;
      if (!error && xhr.status === 0) error = new Error('CORS blocked or network error');
      callback(xhrRes(error, xhr, body));
    }
  }; // send


  xhr.send(opt.body || ''); // 返回 ajax 实例，用于外部调用 xhr.abort

  return xhr;
};

module.exports = request;

/***/ }),

/***/ "./lib/xml2json.js":
/*!*************************!*\
  !*** ./lib/xml2json.js ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

/* Copyright 2015 William Summers, MetaTribal LLC
 * adapted from https://developer.mozilla.org/en-US/docs/JXON
 *
 * Licensed under the MIT License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://opensource.org/licenses/MIT
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @author William Summers
 * https://github.com/metatribal/xmlToJSON
 */
var DOMParser = __webpack_require__(/*! @xmldom/xmldom */ "./node_modules/@xmldom/xmldom/lib/index.js").DOMParser;

var xmlToJSON = function () {
  this.version = "1.3.5";
  var options = {
    // set up the default options
    mergeCDATA: true,
    // extract cdata and merge with text
    normalize: true,
    // collapse multiple spaces to single space
    stripElemPrefix: true // for elements of same name in diff namespaces, you can enable namespaces and access the nskey property

  };
  var prefixMatch = new RegExp(/(?!xmlns)^.*:/);
  var trimMatch = new RegExp(/^\s+|\s+$/g);

  this.grokType = function (sValue) {
    if (/^\s*$/.test(sValue)) {
      return null;
    }

    if (/^(?:true|false)$/i.test(sValue)) {
      return sValue.toLowerCase() === "true";
    }

    if (isFinite(sValue)) {
      return parseFloat(sValue);
    }

    return sValue;
  };

  this.parseString = function (xmlString, opt) {
    if (xmlString) {
      var xml = this.stringToXML(xmlString);

      if (xml.getElementsByTagName('parsererror').length) {
        return null;
      } else {
        return this.parseXML(xml, opt);
      }
    } else {
      return null;
    }
  };

  this.parseXML = function (oXMLParent, opt) {
    // initialize options
    for (var key in opt) {
      options[key] = opt[key];
    }

    var vResult = {},
        nLength = 0,
        sCollectedTxt = ""; // iterate over the children

    var childNum = oXMLParent.childNodes.length;

    if (childNum) {
      for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {
        oNode = oXMLParent.childNodes.item(nItem);

        if (oNode.nodeType === 4) {
          if (options.mergeCDATA) {
            sCollectedTxt += oNode.nodeValue;
          }
        }
        /* nodeType is "CDATASection" (4) */
        else if (oNode.nodeType === 3) {
          sCollectedTxt += oNode.nodeValue;
        }
        /* nodeType is "Text" (3) */
        else if (oNode.nodeType === 1) {
          /* nodeType is "Element" (1) */
          if (nLength === 0) {
            vResult = {};
          } // using nodeName to support browser (IE) implementation with no 'localName' property


          if (options.stripElemPrefix) {
            sProp = oNode.nodeName.replace(prefixMatch, '');
          } else {
            sProp = oNode.nodeName;
          }

          vContent = xmlToJSON.parseXML(oNode);

          if (vResult.hasOwnProperty(sProp)) {
            if (vResult[sProp].constructor !== Array) {
              vResult[sProp] = [vResult[sProp]];
            }

            vResult[sProp].push(vContent);
          } else {
            vResult[sProp] = vContent;
            nLength++;
          }
        }
      }
    }

    if (!Object.keys(vResult).length) {
      // vResult = sCollectedTxt.replace(trimMatch, '') || ''; // by carsonxu 修复 getBucket返回的 Key 是 " /" 这种场景
      vResult = sCollectedTxt || '';
    }

    return vResult;
  }; // Convert xmlDocument to a string
  // Returns null on failure


  this.xmlToString = function (xmlDoc) {
    try {
      var xmlString = xmlDoc.xml ? xmlDoc.xml : new XMLSerializer().serializeToString(xmlDoc);
      return xmlString;
    } catch (err) {
      return null;
    }
  }; // Convert a string to XML Node Structure
  // Returns null on failure


  this.stringToXML = function (xmlString) {
    try {
      var xmlDoc = null;

      if (window.DOMParser) {
        var parser = new DOMParser();
        xmlDoc = parser.parseFromString(xmlString, "text/xml");
        return xmlDoc;
      } else {
        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = false;
        xmlDoc.loadXML(xmlString);
        return xmlDoc;
      }
    } catch (e) {
      return null;
    }
  };

  return this;
}.call({});

var xml2json = function xml2json(xmlString) {
  return xmlToJSON.parseString(xmlString);
};

module.exports = xml2json;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/classCallCheck.js":
/*!***************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/classCallCheck.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

module.exports = _classCallCheck, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/createClass.js":
/*!************************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/createClass.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}

module.exports = _createClass, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@babel/runtime/helpers/typeof.js":
/*!*******************************************************!*\
  !*** ./node_modules/@babel/runtime/helpers/typeof.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

function _typeof(obj) {
  "@babel/helpers - typeof";

  return (module.exports = _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) {
    return typeof obj;
  } : function (obj) {
    return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
  }, module.exports.__esModule = true, module.exports["default"] = module.exports), _typeof(obj);
}

module.exports = _typeof, module.exports.__esModule = true, module.exports["default"] = module.exports;

/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/conventions.js":
/*!********************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/conventions.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


/**
 * "Shallow freezes" an object to render it immutable.
 * Uses `Object.freeze` if available,
 * otherwise the immutability is only in the type.
 *
 * Is used to create "enum like" objects.
 *
 * @template T
 * @param {T} object the object to freeze
 * @param {Pick<ObjectConstructor, 'freeze'> = Object} oc `Object` by default,
 * 				allows to inject custom object constructor for tests
 * @returns {Readonly<T>}
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze
 */
function freeze(object, oc) {
	if (oc === undefined) {
		oc = Object
	}
	return oc && typeof oc.freeze === 'function' ? oc.freeze(object) : object
}

/**
 * Since we can not rely on `Object.assign` we provide a simplified version
 * that is sufficient for our needs.
 *
 * @param {Object} target
 * @param {Object | null | undefined} source
 *
 * @returns {Object} target
 * @throws TypeError if target is not an object
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign
 * @see https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-object.assign
 */
function assign(target, source) {
	if (target === null || typeof target !== 'object') {
		throw new TypeError('target is not an object')
	}
	for (var key in source) {
		if (Object.prototype.hasOwnProperty.call(source, key)) {
			target[key] = source[key]
		}
	}
	return target
}

/**
 * All mime types that are allowed as input to `DOMParser.parseFromString`
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString#Argument02 MDN
 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#domparsersupportedtype WHATWG HTML Spec
 * @see DOMParser.prototype.parseFromString
 */
var MIME_TYPE = freeze({
	/**
	 * `text/html`, the only mime type that triggers treating an XML document as HTML.
	 *
	 * @see DOMParser.SupportedType.isHTML
	 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
	 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring WHATWG HTML Spec
	 */
	HTML: 'text/html',

	/**
	 * Helper method to check a mime type if it indicates an HTML document
	 *
	 * @param {string} [value]
	 * @returns {boolean}
	 *
	 * @see https://www.iana.org/assignments/media-types/text/html IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/HTML Wikipedia
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser/parseFromString MDN
	 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-domparser-parsefromstring 	 */
	isHTML: function (value) {
		return value === MIME_TYPE.HTML
	},

	/**
	 * `application/xml`, the standard mime type for XML documents.
	 *
	 * @see https://www.iana.org/assignments/media-types/application/xml IANA MimeType registration
	 * @see https://tools.ietf.org/html/rfc7303#section-9.1 RFC 7303
	 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
	 */
	XML_APPLICATION: 'application/xml',

	/**
	 * `text/html`, an alias for `application/xml`.
	 *
	 * @see https://tools.ietf.org/html/rfc7303#section-9.2 RFC 7303
	 * @see https://www.iana.org/assignments/media-types/text/xml IANA MimeType registration
	 * @see https://en.wikipedia.org/wiki/XML_and_MIME Wikipedia
	 */
	XML_TEXT: 'text/xml',

	/**
	 * `application/xhtml+xml`, indicates an XML document that has the default HTML namespace,
	 * but is parsed as an XML document.
	 *
	 * @see https://www.iana.org/assignments/media-types/application/xhtml+xml IANA MimeType registration
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument WHATWG DOM Spec
	 * @see https://en.wikipedia.org/wiki/XHTML Wikipedia
	 */
	XML_XHTML_APPLICATION: 'application/xhtml+xml',

	/**
	 * `image/svg+xml`,
	 *
	 * @see https://www.iana.org/assignments/media-types/image/svg+xml IANA MimeType registration
	 * @see https://www.w3.org/TR/SVG11/ W3C SVG 1.1
	 * @see https://en.wikipedia.org/wiki/Scalable_Vector_Graphics Wikipedia
	 */
	XML_SVG_IMAGE: 'image/svg+xml',
})

/**
 * Namespaces that are used in this code base.
 *
 * @see http://www.w3.org/TR/REC-xml-names
 */
var NAMESPACE = freeze({
	/**
	 * The XHTML namespace.
	 *
	 * @see http://www.w3.org/1999/xhtml
	 */
	HTML: 'http://www.w3.org/1999/xhtml',

	/**
	 * Checks if `uri` equals `NAMESPACE.HTML`.
	 *
	 * @param {string} [uri]
	 *
	 * @see NAMESPACE.HTML
	 */
	isHTML: function (uri) {
		return uri === NAMESPACE.HTML
	},

	/**
	 * The SVG namespace.
	 *
	 * @see http://www.w3.org/2000/svg
	 */
	SVG: 'http://www.w3.org/2000/svg',

	/**
	 * The `xml:` namespace.
	 *
	 * @see http://www.w3.org/XML/1998/namespace
	 */
	XML: 'http://www.w3.org/XML/1998/namespace',

	/**
	 * The `xmlns:` namespace
	 *
	 * @see https://www.w3.org/2000/xmlns/
	 */
	XMLNS: 'http://www.w3.org/2000/xmlns/',
})

exports.assign = assign;
exports.freeze = freeze;
exports.MIME_TYPE = MIME_TYPE;
exports.NAMESPACE = NAMESPACE;


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/dom-parser.js":
/*!*******************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/dom-parser.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var conventions = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js");
var dom = __webpack_require__(/*! ./dom */ "./node_modules/@xmldom/xmldom/lib/dom.js")
var entities = __webpack_require__(/*! ./entities */ "./node_modules/@xmldom/xmldom/lib/entities.js");
var sax = __webpack_require__(/*! ./sax */ "./node_modules/@xmldom/xmldom/lib/sax.js");

var DOMImplementation = dom.DOMImplementation;

var NAMESPACE = conventions.NAMESPACE;

var ParseError = sax.ParseError;
var XMLReader = sax.XMLReader;

/**
 * Normalizes line ending according to https://www.w3.org/TR/xml11/#sec-line-ends:
 *
 * > XML parsed entities are often stored in computer files which,
 * > for editing convenience, are organized into lines.
 * > These lines are typically separated by some combination
 * > of the characters CARRIAGE RETURN (#xD) and LINE FEED (#xA).
 * >
 * > To simplify the tasks of applications, the XML processor must behave
 * > as if it normalized all line breaks in external parsed entities (including the document entity)
 * > on input, before parsing, by translating all of the following to a single #xA character:
 * >
 * > 1. the two-character sequence #xD #xA
 * > 2. the two-character sequence #xD #x85
 * > 3. the single character #x85
 * > 4. the single character #x2028
 * > 5. any #xD character that is not immediately followed by #xA or #x85.
 *
 * @param {string} input
 * @returns {string}
 */
function normalizeLineEndings(input) {
	return input
		.replace(/\r[\n\u0085]/g, '\n')
		.replace(/[\r\u0085\u2028]/g, '\n')
}

/**
 * @typedef Locator
 * @property {number} [columnNumber]
 * @property {number} [lineNumber]
 */

/**
 * @typedef DOMParserOptions
 * @property {DOMHandler} [domBuilder]
 * @property {Function} [errorHandler]
 * @property {(string) => string} [normalizeLineEndings] used to replace line endings before parsing
 * 						defaults to `normalizeLineEndings`
 * @property {Locator} [locator]
 * @property {Record<string, string>} [xmlns]
 *
 * @see normalizeLineEndings
 */

/**
 * The DOMParser interface provides the ability to parse XML or HTML source code
 * from a string into a DOM `Document`.
 *
 * _xmldom is different from the spec in that it allows an `options` parameter,
 * to override the default behavior._
 *
 * @param {DOMParserOptions} [options]
 * @constructor
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMParser
 * @see https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsing-and-serialization
 */
function DOMParser(options){
	this.options = options ||{locator:{}};
}

DOMParser.prototype.parseFromString = function(source,mimeType){
	var options = this.options;
	var sax =  new XMLReader();
	var domBuilder = options.domBuilder || new DOMHandler();//contentHandler and LexicalHandler
	var errorHandler = options.errorHandler;
	var locator = options.locator;
	var defaultNSMap = options.xmlns||{};
	var isHTML = /\/x?html?$/.test(mimeType);//mimeType.toLowerCase().indexOf('html') > -1;
  	var entityMap = isHTML ? entities.HTML_ENTITIES : entities.XML_ENTITIES;
	if(locator){
		domBuilder.setDocumentLocator(locator)
	}

	sax.errorHandler = buildErrorHandler(errorHandler,domBuilder,locator);
	sax.domBuilder = options.domBuilder || domBuilder;
	if(isHTML){
		defaultNSMap[''] = NAMESPACE.HTML;
	}
	defaultNSMap.xml = defaultNSMap.xml || NAMESPACE.XML;
	var normalize = options.normalizeLineEndings || normalizeLineEndings;
	if (source && typeof source === 'string') {
		sax.parse(
			normalize(source),
			defaultNSMap,
			entityMap
		)
	} else {
		sax.errorHandler.error('invalid doc source')
	}
	return domBuilder.doc;
}
function buildErrorHandler(errorImpl,domBuilder,locator){
	if(!errorImpl){
		if(domBuilder instanceof DOMHandler){
			return domBuilder;
		}
		errorImpl = domBuilder ;
	}
	var errorHandler = {}
	var isCallback = errorImpl instanceof Function;
	locator = locator||{}
	function build(key){
		var fn = errorImpl[key];
		if(!fn && isCallback){
			fn = errorImpl.length == 2?function(msg){errorImpl(key,msg)}:errorImpl;
		}
		errorHandler[key] = fn && function(msg){
			fn('[xmldom '+key+']\t'+msg+_locator(locator));
		}||function(){};
	}
	build('warning');
	build('error');
	build('fatalError');
	return errorHandler;
}

//console.log('#\n\n\n\n\n\n\n####')
/**
 * +ContentHandler+ErrorHandler
 * +LexicalHandler+EntityResolver2
 * -DeclHandler-DTDHandler
 *
 * DefaultHandler:EntityResolver, DTDHandler, ContentHandler, ErrorHandler
 * DefaultHandler2:DefaultHandler,LexicalHandler, DeclHandler, EntityResolver2
 * @link http://www.saxproject.org/apidoc/org/xml/sax/helpers/DefaultHandler.html
 */
function DOMHandler() {
    this.cdata = false;
}
function position(locator,node){
	node.lineNumber = locator.lineNumber;
	node.columnNumber = locator.columnNumber;
}
/**
 * @see org.xml.sax.ContentHandler#startDocument
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ContentHandler.html
 */
DOMHandler.prototype = {
	startDocument : function() {
    	this.doc = new DOMImplementation().createDocument(null, null, null);
    	if (this.locator) {
        	this.doc.documentURI = this.locator.systemId;
    	}
	},
	startElement:function(namespaceURI, localName, qName, attrs) {
		var doc = this.doc;
	    var el = doc.createElementNS(namespaceURI, qName||localName);
	    var len = attrs.length;
	    appendElement(this, el);
	    this.currentElement = el;

		this.locator && position(this.locator,el)
	    for (var i = 0 ; i < len; i++) {
	        var namespaceURI = attrs.getURI(i);
	        var value = attrs.getValue(i);
	        var qName = attrs.getQName(i);
			var attr = doc.createAttributeNS(namespaceURI, qName);
			this.locator &&position(attrs.getLocator(i),attr);
			attr.value = attr.nodeValue = value;
			el.setAttributeNode(attr)
	    }
	},
	endElement:function(namespaceURI, localName, qName) {
		var current = this.currentElement
		var tagName = current.tagName;
		this.currentElement = current.parentNode;
	},
	startPrefixMapping:function(prefix, uri) {
	},
	endPrefixMapping:function(prefix) {
	},
	processingInstruction:function(target, data) {
	    var ins = this.doc.createProcessingInstruction(target, data);
	    this.locator && position(this.locator,ins)
	    appendElement(this, ins);
	},
	ignorableWhitespace:function(ch, start, length) {
	},
	characters:function(chars, start, length) {
		chars = _toString.apply(this,arguments)
		//console.log(chars)
		if(chars){
			if (this.cdata) {
				var charNode = this.doc.createCDATASection(chars);
			} else {
				var charNode = this.doc.createTextNode(chars);
			}
			if(this.currentElement){
				this.currentElement.appendChild(charNode);
			}else if(/^\s*$/.test(chars)){
				this.doc.appendChild(charNode);
				//process xml
			}
			this.locator && position(this.locator,charNode)
		}
	},
	skippedEntity:function(name) {
	},
	endDocument:function() {
		this.doc.normalize();
	},
	setDocumentLocator:function (locator) {
	    if(this.locator = locator){// && !('lineNumber' in locator)){
	    	locator.lineNumber = 0;
	    }
	},
	//LexicalHandler
	comment:function(chars, start, length) {
		chars = _toString.apply(this,arguments)
	    var comm = this.doc.createComment(chars);
	    this.locator && position(this.locator,comm)
	    appendElement(this, comm);
	},

	startCDATA:function() {
	    //used in characters() methods
	    this.cdata = true;
	},
	endCDATA:function() {
	    this.cdata = false;
	},

	startDTD:function(name, publicId, systemId) {
		var impl = this.doc.implementation;
	    if (impl && impl.createDocumentType) {
	        var dt = impl.createDocumentType(name, publicId, systemId);
	        this.locator && position(this.locator,dt)
	        appendElement(this, dt);
					this.doc.doctype = dt;
	    }
	},
	/**
	 * @see org.xml.sax.ErrorHandler
	 * @link http://www.saxproject.org/apidoc/org/xml/sax/ErrorHandler.html
	 */
	warning:function(error) {
		console.warn('[xmldom warning]\t'+error,_locator(this.locator));
	},
	error:function(error) {
		console.error('[xmldom error]\t'+error,_locator(this.locator));
	},
	fatalError:function(error) {
		throw new ParseError(error, this.locator);
	}
}
function _locator(l){
	if(l){
		return '\n@'+(l.systemId ||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'
	}
}
function _toString(chars,start,length){
	if(typeof chars == 'string'){
		return chars.substr(start,length)
	}else{//java sax connect width xmldom on rhino(what about: "? && !(chars instanceof String)")
		if(chars.length >= start+length || start){
			return new java.lang.String(chars,start,length)+'';
		}
		return chars;
	}
}

/*
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/LexicalHandler.html
 * used method of org.xml.sax.ext.LexicalHandler:
 *  #comment(chars, start, length)
 *  #startCDATA()
 *  #endCDATA()
 *  #startDTD(name, publicId, systemId)
 *
 *
 * IGNORED method of org.xml.sax.ext.LexicalHandler:
 *  #endDTD()
 *  #startEntity(name)
 *  #endEntity(name)
 *
 *
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/DeclHandler.html
 * IGNORED method of org.xml.sax.ext.DeclHandler
 * 	#attributeDecl(eName, aName, type, mode, value)
 *  #elementDecl(name, model)
 *  #externalEntityDecl(name, publicId, systemId)
 *  #internalEntityDecl(name, value)
 * @link http://www.saxproject.org/apidoc/org/xml/sax/ext/EntityResolver2.html
 * IGNORED method of org.xml.sax.EntityResolver2
 *  #resolveEntity(String name,String publicId,String baseURI,String systemId)
 *  #resolveEntity(publicId, systemId)
 *  #getExternalSubset(name, baseURI)
 * @link http://www.saxproject.org/apidoc/org/xml/sax/DTDHandler.html
 * IGNORED method of org.xml.sax.DTDHandler
 *  #notationDecl(name, publicId, systemId) {};
 *  #unparsedEntityDecl(name, publicId, systemId, notationName) {};
 */
"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){
	DOMHandler.prototype[key] = function(){return null}
})

/* Private static helpers treated below as private instance methods, so don't need to add these to the public API; we might use a Relator to also get rid of non-standard public properties */
function appendElement (hander,node) {
    if (!hander.currentElement) {
        hander.doc.appendChild(node);
    } else {
        hander.currentElement.appendChild(node);
    }
}//appendChild and setAttributeNS are preformance key

exports.__DOMHandler = DOMHandler;
exports.normalizeLineEndings = normalizeLineEndings;
exports.DOMParser = DOMParser;


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/dom.js":
/*!************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/dom.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var conventions = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js");

var NAMESPACE = conventions.NAMESPACE;

/**
 * A prerequisite for `[].filter`, to drop elements that are empty
 * @param {string} input
 * @returns {boolean}
 */
function notEmptyString (input) {
	return input !== ''
}
/**
 * @see https://infra.spec.whatwg.org/#split-on-ascii-whitespace
 * @see https://infra.spec.whatwg.org/#ascii-whitespace
 *
 * @param {string} input
 * @returns {string[]} (can be empty)
 */
function splitOnASCIIWhitespace(input) {
	// U+0009 TAB, U+000A LF, U+000C FF, U+000D CR, U+0020 SPACE
	return input ? input.split(/[\t\n\f\r ]+/).filter(notEmptyString) : []
}

/**
 * Adds element as a key to current if it is not already present.
 *
 * @param {Record<string, boolean | undefined>} current
 * @param {string} element
 * @returns {Record<string, boolean | undefined>}
 */
function orderedSetReducer (current, element) {
	if (!current.hasOwnProperty(element)) {
		current[element] = true;
	}
	return current;
}

/**
 * @see https://infra.spec.whatwg.org/#ordered-set
 * @param {string} input
 * @returns {string[]}
 */
function toOrderedSet(input) {
	if (!input) return [];
	var list = splitOnASCIIWhitespace(input);
	return Object.keys(list.reduce(orderedSetReducer, {}))
}

/**
 * Uses `list.indexOf` to implement something like `Array.prototype.includes`,
 * which we can not rely on being available.
 *
 * @param {any[]} list
 * @returns {function(any): boolean}
 */
function arrayIncludes (list) {
	return function(element) {
		return list && list.indexOf(element) !== -1;
	}
}

function copy(src,dest){
	for(var p in src){
		dest[p] = src[p];
	}
}

/**
^\w+\.prototype\.([_\w]+)\s*=\s*((?:.*\{\s*?[\r\n][\s\S]*?^})|\S.*?(?=[;\r\n]));?
^\w+\.prototype\.([_\w]+)\s*=\s*(\S.*?(?=[;\r\n]));?
 */
function _extends(Class,Super){
	var pt = Class.prototype;
	if(!(pt instanceof Super)){
		function t(){};
		t.prototype = Super.prototype;
		t = new t();
		copy(pt,t);
		Class.prototype = pt = t;
	}
	if(pt.constructor != Class){
		if(typeof Class != 'function'){
			console.error("unknown Class:"+Class)
		}
		pt.constructor = Class
	}
}

// Node Types
var NodeType = {}
var ELEMENT_NODE                = NodeType.ELEMENT_NODE                = 1;
var ATTRIBUTE_NODE              = NodeType.ATTRIBUTE_NODE              = 2;
var TEXT_NODE                   = NodeType.TEXT_NODE                   = 3;
var CDATA_SECTION_NODE          = NodeType.CDATA_SECTION_NODE          = 4;
var ENTITY_REFERENCE_NODE       = NodeType.ENTITY_REFERENCE_NODE       = 5;
var ENTITY_NODE                 = NodeType.ENTITY_NODE                 = 6;
var PROCESSING_INSTRUCTION_NODE = NodeType.PROCESSING_INSTRUCTION_NODE = 7;
var COMMENT_NODE                = NodeType.COMMENT_NODE                = 8;
var DOCUMENT_NODE               = NodeType.DOCUMENT_NODE               = 9;
var DOCUMENT_TYPE_NODE          = NodeType.DOCUMENT_TYPE_NODE          = 10;
var DOCUMENT_FRAGMENT_NODE      = NodeType.DOCUMENT_FRAGMENT_NODE      = 11;
var NOTATION_NODE               = NodeType.NOTATION_NODE               = 12;

// ExceptionCode
var ExceptionCode = {}
var ExceptionMessage = {};
var INDEX_SIZE_ERR              = ExceptionCode.INDEX_SIZE_ERR              = ((ExceptionMessage[1]="Index size error"),1);
var DOMSTRING_SIZE_ERR          = ExceptionCode.DOMSTRING_SIZE_ERR          = ((ExceptionMessage[2]="DOMString size error"),2);
var HIERARCHY_REQUEST_ERR       = ExceptionCode.HIERARCHY_REQUEST_ERR       = ((ExceptionMessage[3]="Hierarchy request error"),3);
var WRONG_DOCUMENT_ERR          = ExceptionCode.WRONG_DOCUMENT_ERR          = ((ExceptionMessage[4]="Wrong document"),4);
var INVALID_CHARACTER_ERR       = ExceptionCode.INVALID_CHARACTER_ERR       = ((ExceptionMessage[5]="Invalid character"),5);
var NO_DATA_ALLOWED_ERR         = ExceptionCode.NO_DATA_ALLOWED_ERR         = ((ExceptionMessage[6]="No data allowed"),6);
var NO_MODIFICATION_ALLOWED_ERR = ExceptionCode.NO_MODIFICATION_ALLOWED_ERR = ((ExceptionMessage[7]="No modification allowed"),7);
var NOT_FOUND_ERR               = ExceptionCode.NOT_FOUND_ERR               = ((ExceptionMessage[8]="Not found"),8);
var NOT_SUPPORTED_ERR           = ExceptionCode.NOT_SUPPORTED_ERR           = ((ExceptionMessage[9]="Not supported"),9);
var INUSE_ATTRIBUTE_ERR         = ExceptionCode.INUSE_ATTRIBUTE_ERR         = ((ExceptionMessage[10]="Attribute in use"),10);
//level2
var INVALID_STATE_ERR        	= ExceptionCode.INVALID_STATE_ERR        	= ((ExceptionMessage[11]="Invalid state"),11);
var SYNTAX_ERR               	= ExceptionCode.SYNTAX_ERR               	= ((ExceptionMessage[12]="Syntax error"),12);
var INVALID_MODIFICATION_ERR 	= ExceptionCode.INVALID_MODIFICATION_ERR 	= ((ExceptionMessage[13]="Invalid modification"),13);
var NAMESPACE_ERR            	= ExceptionCode.NAMESPACE_ERR           	= ((ExceptionMessage[14]="Invalid namespace"),14);
var INVALID_ACCESS_ERR       	= ExceptionCode.INVALID_ACCESS_ERR      	= ((ExceptionMessage[15]="Invalid access"),15);

/**
 * DOM Level 2
 * Object DOMException
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/ecma-script-binding.html
 * @see http://www.w3.org/TR/REC-DOM-Level-1/ecma-script-language-binding.html
 */
function DOMException(code, message) {
	if(message instanceof Error){
		var error = message;
	}else{
		error = this;
		Error.call(this, ExceptionMessage[code]);
		this.message = ExceptionMessage[code];
		if(Error.captureStackTrace) Error.captureStackTrace(this, DOMException);
	}
	error.code = code;
	if(message) this.message = this.message + ": " + message;
	return error;
};
DOMException.prototype = Error.prototype;
copy(ExceptionCode,DOMException)

/**
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-536297177
 * The NodeList interface provides the abstraction of an ordered collection of nodes, without defining or constraining how this collection is implemented. NodeList objects in the DOM are live.
 * The items in the NodeList are accessible via an integral index, starting from 0.
 */
function NodeList() {
};
NodeList.prototype = {
	/**
	 * The number of nodes in the list. The range of valid child node indices is 0 to length-1 inclusive.
	 * @standard level1
	 */
	length:0, 
	/**
	 * Returns the indexth item in the collection. If index is greater than or equal to the number of nodes in the list, this returns null.
	 * @standard level1
	 * @param index  unsigned long 
	 *   Index into the collection.
	 * @return Node
	 * 	The node at the indexth position in the NodeList, or null if that is not a valid index. 
	 */
	item: function(index) {
		return this[index] || null;
	},
	toString:function(isHTML,nodeFilter){
		for(var buf = [], i = 0;i<this.length;i++){
			serializeToString(this[i],buf,isHTML,nodeFilter);
		}
		return buf.join('');
	}
};

function LiveNodeList(node,refresh){
	this._node = node;
	this._refresh = refresh
	_updateLiveList(this);
}
function _updateLiveList(list){
	var inc = list._node._inc || list._node.ownerDocument._inc;
	if(list._inc != inc){
		var ls = list._refresh(list._node);
		//console.log(ls.length)
		__set__(list,'length',ls.length);
		copy(ls,list);
		list._inc = inc;
	}
}
LiveNodeList.prototype.item = function(i){
	_updateLiveList(this);
	return this[i];
}

_extends(LiveNodeList,NodeList);

/**
 * Objects implementing the NamedNodeMap interface are used
 * to represent collections of nodes that can be accessed by name.
 * Note that NamedNodeMap does not inherit from NodeList;
 * NamedNodeMaps are not maintained in any particular order.
 * Objects contained in an object implementing NamedNodeMap may also be accessed by an ordinal index,
 * but this is simply to allow convenient enumeration of the contents of a NamedNodeMap,
 * and does not imply that the DOM specifies an order to these Nodes.
 * NamedNodeMap objects in the DOM are live.
 * used for attributes or DocumentType entities 
 */
function NamedNodeMap() {
};

function _findNodeIndex(list,node){
	var i = list.length;
	while(i--){
		if(list[i] === node){return i}
	}
}

function _addNamedNode(el,list,newAttr,oldAttr){
	if(oldAttr){
		list[_findNodeIndex(list,oldAttr)] = newAttr;
	}else{
		list[list.length++] = newAttr;
	}
	if(el){
		newAttr.ownerElement = el;
		var doc = el.ownerDocument;
		if(doc){
			oldAttr && _onRemoveAttribute(doc,el,oldAttr);
			_onAddAttribute(doc,el,newAttr);
		}
	}
}
function _removeNamedNode(el,list,attr){
	//console.log('remove attr:'+attr)
	var i = _findNodeIndex(list,attr);
	if(i>=0){
		var lastIndex = list.length-1
		while(i<lastIndex){
			list[i] = list[++i]
		}
		list.length = lastIndex;
		if(el){
			var doc = el.ownerDocument;
			if(doc){
				_onRemoveAttribute(doc,el,attr);
				attr.ownerElement = null;
			}
		}
	}else{
		throw DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr))
	}
}
NamedNodeMap.prototype = {
	length:0,
	item:NodeList.prototype.item,
	getNamedItem: function(key) {
//		if(key.indexOf(':')>0 || key == 'xmlns'){
//			return null;
//		}
		//console.log()
		var i = this.length;
		while(i--){
			var attr = this[i];
			//console.log(attr.nodeName,key)
			if(attr.nodeName == key){
				return attr;
			}
		}
	},
	setNamedItem: function(attr) {
		var el = attr.ownerElement;
		if(el && el!=this._ownerElement){
			throw new DOMException(INUSE_ATTRIBUTE_ERR);
		}
		var oldAttr = this.getNamedItem(attr.nodeName);
		_addNamedNode(this._ownerElement,this,attr,oldAttr);
		return oldAttr;
	},
	/* returns Node */
	setNamedItemNS: function(attr) {// raises: WRONG_DOCUMENT_ERR,NO_MODIFICATION_ALLOWED_ERR,INUSE_ATTRIBUTE_ERR
		var el = attr.ownerElement, oldAttr;
		if(el && el!=this._ownerElement){
			throw new DOMException(INUSE_ATTRIBUTE_ERR);
		}
		oldAttr = this.getNamedItemNS(attr.namespaceURI,attr.localName);
		_addNamedNode(this._ownerElement,this,attr,oldAttr);
		return oldAttr;
	},

	/* returns Node */
	removeNamedItem: function(key) {
		var attr = this.getNamedItem(key);
		_removeNamedNode(this._ownerElement,this,attr);
		return attr;
		
		
	},// raises: NOT_FOUND_ERR,NO_MODIFICATION_ALLOWED_ERR
	
	//for level2
	removeNamedItemNS:function(namespaceURI,localName){
		var attr = this.getNamedItemNS(namespaceURI,localName);
		_removeNamedNode(this._ownerElement,this,attr);
		return attr;
	},
	getNamedItemNS: function(namespaceURI, localName) {
		var i = this.length;
		while(i--){
			var node = this[i];
			if(node.localName == localName && node.namespaceURI == namespaceURI){
				return node;
			}
		}
		return null;
	}
};

/**
 * The DOMImplementation interface represents an object providing methods
 * which are not dependent on any particular document.
 * Such an object is returned by the `Document.implementation` property.
 *
 * __The individual methods describe the differences compared to the specs.__
 *
 * @constructor
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation MDN
 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-102161490 DOM Level 1 Core (Initial)
 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-102161490 DOM Level 2 Core
 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#ID-102161490 DOM Level 3 Core
 * @see https://dom.spec.whatwg.org/#domimplementation DOM Living Standard
 */
function DOMImplementation() {
}

DOMImplementation.prototype = {
	/**
	 * The DOMImplementation.hasFeature() method returns a Boolean flag indicating if a given feature is supported.
	 * The different implementations fairly diverged in what kind of features were reported.
	 * The latest version of the spec settled to force this method to always return true, where the functionality was accurate and in use.
	 *
	 * @deprecated It is deprecated and modern browsers return true in all cases.
	 *
	 * @param {string} feature
	 * @param {string} [version]
	 * @returns {boolean} always true
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/hasFeature MDN
	 * @see https://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html#ID-5CED94D7 DOM Level 1 Core
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-hasfeature DOM Living Standard
	 */
	hasFeature: function(feature, version) {
			return true;
	},
	/**
	 * Creates an XML Document object of the specified type with its document element.
	 *
	 * __It behaves slightly different from the description in the living standard__:
	 * - There is no interface/class `XMLDocument`, it returns a `Document` instance.
	 * - `contentType`, `encoding`, `mode`, `origin`, `url` fields are currently not declared.
	 * - this implementation is not validating names or qualified names
	 *   (when parsing XML strings, the SAX parser takes care of that)
	 *
	 * @param {string|null} namespaceURI
	 * @param {string} qualifiedName
	 * @param {DocumentType=null} doctype
	 * @returns {Document}
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocument MDN
	 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocument DOM Level 2 Core (initial)
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocument  DOM Level 2 Core
	 *
	 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
	 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
	 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
	 */
	createDocument: function(namespaceURI,  qualifiedName, doctype){
		var doc = new Document();
		doc.implementation = this;
		doc.childNodes = new NodeList();
		doc.doctype = doctype || null;
		if (doctype){
			doc.appendChild(doctype);
		}
		if (qualifiedName){
			var root = doc.createElementNS(namespaceURI, qualifiedName);
			doc.appendChild(root);
		}
		return doc;
	},
	/**
	 * Returns a doctype, with the given `qualifiedName`, `publicId`, and `systemId`.
	 *
	 * __This behavior is slightly different from the in the specs__:
	 * - this implementation is not validating names or qualified names
	 *   (when parsing XML strings, the SAX parser takes care of that)
	 *
	 * @param {string} qualifiedName
	 * @param {string} [publicId]
	 * @param {string} [systemId]
	 * @returns {DocumentType} which can either be used with `DOMImplementation.createDocument` upon document creation
	 * 				  or can be put into the document via methods like `Node.insertBefore()` or `Node.replaceChild()`
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMImplementation/createDocumentType MDN
	 * @see https://www.w3.org/TR/DOM-Level-2-Core/core.html#Level-2-Core-DOM-createDocType DOM Level 2 Core
	 * @see https://dom.spec.whatwg.org/#dom-domimplementation-createdocumenttype DOM Living Standard
	 *
	 * @see https://dom.spec.whatwg.org/#validate-and-extract DOM: Validate and extract
	 * @see https://www.w3.org/TR/xml/#NT-NameStartChar XML Spec: Names
	 * @see https://www.w3.org/TR/xml-names/#ns-qualnames XML Namespaces: Qualified names
	 */
	createDocumentType: function(qualifiedName, publicId, systemId){
		var node = new DocumentType();
		node.name = qualifiedName;
		node.nodeName = qualifiedName;
		node.publicId = publicId || '';
		node.systemId = systemId || '';

		return node;
	}
};


/**
 * @see http://www.w3.org/TR/2000/REC-DOM-Level-2-Core-20001113/core.html#ID-1950641247
 */

function Node() {
};

Node.prototype = {
	firstChild : null,
	lastChild : null,
	previousSibling : null,
	nextSibling : null,
	attributes : null,
	parentNode : null,
	childNodes : null,
	ownerDocument : null,
	nodeValue : null,
	namespaceURI : null,
	prefix : null,
	localName : null,
	// Modified in DOM Level 2:
	insertBefore:function(newChild, refChild){//raises 
		return _insertBefore(this,newChild,refChild);
	},
	replaceChild:function(newChild, oldChild){//raises 
		this.insertBefore(newChild,oldChild);
		if(oldChild){
			this.removeChild(oldChild);
		}
	},
	removeChild:function(oldChild){
		return _removeChild(this,oldChild);
	},
	appendChild:function(newChild){
		return this.insertBefore(newChild,null);
	},
	hasChildNodes:function(){
		return this.firstChild != null;
	},
	cloneNode:function(deep){
		return cloneNode(this.ownerDocument||this,this,deep);
	},
	// Modified in DOM Level 2:
	normalize:function(){
		var child = this.firstChild;
		while(child){
			var next = child.nextSibling;
			if(next && next.nodeType == TEXT_NODE && child.nodeType == TEXT_NODE){
				this.removeChild(next);
				child.appendData(next.data);
			}else{
				child.normalize();
				child = next;
			}
		}
	},
  	// Introduced in DOM Level 2:
	isSupported:function(feature, version){
		return this.ownerDocument.implementation.hasFeature(feature,version);
	},
    // Introduced in DOM Level 2:
    hasAttributes:function(){
    	return this.attributes.length>0;
    },
	/**
	 * Look up the prefix associated to the given namespace URI, starting from this node.
	 * **The default namespace declarations are ignored by this method.**
	 * See Namespace Prefix Lookup for details on the algorithm used by this method.
	 *
	 * _Note: The implementation seems to be incomplete when compared to the algorithm described in the specs._
	 *
	 * @param {string | null} namespaceURI
	 * @returns {string | null}
	 * @see https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-lookupNamespacePrefix
	 * @see https://www.w3.org/TR/DOM-Level-3-Core/namespaces-algorithms.html#lookupNamespacePrefixAlgo
	 * @see https://dom.spec.whatwg.org/#dom-node-lookupprefix
	 * @see https://github.com/xmldom/xmldom/issues/322
	 */
    lookupPrefix:function(namespaceURI){
    	var el = this;
    	while(el){
    		var map = el._nsMap;
    		//console.dir(map)
    		if(map){
    			for(var n in map){
    				if(map[n] == namespaceURI){
    					return n;
    				}
    			}
    		}
    		el = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;
    	}
    	return null;
    },
    // Introduced in DOM Level 3:
    lookupNamespaceURI:function(prefix){
    	var el = this;
    	while(el){
    		var map = el._nsMap;
    		//console.dir(map)
    		if(map){
    			if(prefix in map){
    				return map[prefix] ;
    			}
    		}
    		el = el.nodeType == ATTRIBUTE_NODE?el.ownerDocument : el.parentNode;
    	}
    	return null;
    },
    // Introduced in DOM Level 3:
    isDefaultNamespace:function(namespaceURI){
    	var prefix = this.lookupPrefix(namespaceURI);
    	return prefix == null;
    }
};


function _xmlEncoder(c){
	return c == '<' && '&lt;' ||
         c == '>' && '&gt;' ||
         c == '&' && '&amp;' ||
         c == '"' && '&quot;' ||
         '&#'+c.charCodeAt()+';'
}


copy(NodeType,Node);
copy(NodeType,Node.prototype);

/**
 * @param callback return true for continue,false for break
 * @return boolean true: break visit;
 */
function _visitNode(node,callback){
	if(callback(node)){
		return true;
	}
	if(node = node.firstChild){
		do{
			if(_visitNode(node,callback)){return true}
        }while(node=node.nextSibling)
    }
}



function Document(){
}

function _onAddAttribute(doc,el,newAttr){
	doc && doc._inc++;
	var ns = newAttr.namespaceURI ;
	if(ns === NAMESPACE.XMLNS){
		//update namespace
		el._nsMap[newAttr.prefix?newAttr.localName:''] = newAttr.value
	}
}

function _onRemoveAttribute(doc,el,newAttr,remove){
	doc && doc._inc++;
	var ns = newAttr.namespaceURI ;
	if(ns === NAMESPACE.XMLNS){
		//update namespace
		delete el._nsMap[newAttr.prefix?newAttr.localName:'']
	}
}

/**
 * Updates `el.childNodes`, updating the indexed items and it's `length`.
 * Passing `newChild` means it will be appended.
 * Otherwise it's assumed that an item has been removed,
 * and `el.firstNode` and it's `.nextSibling` are used
 * to walk the current list of child nodes.
 *
 * @param {Document} doc
 * @param {Node} el
 * @param {Node} [newChild]
 * @private
 */
function _onUpdateChild (doc, el, newChild) {
	if(doc && doc._inc){
		doc._inc++;
		//update childNodes
		var cs = el.childNodes;
		if (newChild) {
			cs[cs.length++] = newChild;
		} else {
			var child = el.firstChild;
			var i = 0;
			while (child) {
				cs[i++] = child;
				child = child.nextSibling;
			}
			cs.length = i;
			delete cs[cs.length];
		}
	}
}

/**
 * Removes the connections between `parentNode` and `child`
 * and any existing `child.previousSibling` or `child.nextSibling`.
 *
 * @see https://github.com/xmldom/xmldom/issues/135
 * @see https://github.com/xmldom/xmldom/issues/145
 *
 * @param {Node} parentNode
 * @param {Node} child
 * @returns {Node} the child that was removed.
 * @private
 */
function _removeChild (parentNode, child) {
	var previous = child.previousSibling;
	var next = child.nextSibling;
	if (previous) {
		previous.nextSibling = next;
	} else {
		parentNode.firstChild = next;
	}
	if (next) {
		next.previousSibling = previous;
	} else {
		parentNode.lastChild = previous;
	}
	child.parentNode = null;
	child.previousSibling = null;
	child.nextSibling = null;
	_onUpdateChild(parentNode.ownerDocument, parentNode);
	return child;
}
/**
 * preformance key(refChild == null)
 */
function _insertBefore(parentNode,newChild,nextChild){
	var cp = newChild.parentNode;
	if(cp){
		cp.removeChild(newChild);//remove and update
	}
	if(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){
		var newFirst = newChild.firstChild;
		if (newFirst == null) {
			return newChild;
		}
		var newLast = newChild.lastChild;
	}else{
		newFirst = newLast = newChild;
	}
	var pre = nextChild ? nextChild.previousSibling : parentNode.lastChild;

	newFirst.previousSibling = pre;
	newLast.nextSibling = nextChild;
	
	
	if(pre){
		pre.nextSibling = newFirst;
	}else{
		parentNode.firstChild = newFirst;
	}
	if(nextChild == null){
		parentNode.lastChild = newLast;
	}else{
		nextChild.previousSibling = newLast;
	}
	do{
		newFirst.parentNode = parentNode;
	}while(newFirst !== newLast && (newFirst= newFirst.nextSibling))
	_onUpdateChild(parentNode.ownerDocument||parentNode,parentNode);
	//console.log(parentNode.lastChild.nextSibling == null)
	if (newChild.nodeType == DOCUMENT_FRAGMENT_NODE) {
		newChild.firstChild = newChild.lastChild = null;
	}
	return newChild;
}

/**
 * Appends `newChild` to `parentNode`.
 * If `newChild` is already connected to a `parentNode` it is first removed from it.
 *
 * @see https://github.com/xmldom/xmldom/issues/135
 * @see https://github.com/xmldom/xmldom/issues/145
 * @param {Node} parentNode
 * @param {Node} newChild
 * @returns {Node}
 * @private
 */
function _appendSingleChild (parentNode, newChild) {
	if (newChild.parentNode) {
		newChild.parentNode.removeChild(newChild);
	}
	newChild.parentNode = parentNode;
	newChild.previousSibling = parentNode.lastChild;
	newChild.nextSibling = null;
	if (newChild.previousSibling) {
		newChild.previousSibling.nextSibling = newChild;
	} else {
		parentNode.firstChild = newChild;
	}
	parentNode.lastChild = newChild;
	_onUpdateChild(parentNode.ownerDocument, parentNode, newChild);
	return newChild;
}

Document.prototype = {
	//implementation : null,
	nodeName :  '#document',
	nodeType :  DOCUMENT_NODE,
	/**
	 * The DocumentType node of the document.
	 *
	 * @readonly
	 * @type DocumentType
	 */
	doctype :  null,
	documentElement :  null,
	_inc : 1,

	insertBefore :  function(newChild, refChild){//raises
		if(newChild.nodeType == DOCUMENT_FRAGMENT_NODE){
			var child = newChild.firstChild;
			while(child){
				var next = child.nextSibling;
				this.insertBefore(child,refChild);
				child = next;
			}
			return newChild;
		}
		if(this.documentElement == null && newChild.nodeType == ELEMENT_NODE){
			this.documentElement = newChild;
		}

		return _insertBefore(this,newChild,refChild),(newChild.ownerDocument = this),newChild;
	},
	removeChild :  function(oldChild){
		if(this.documentElement == oldChild){
			this.documentElement = null;
		}
		return _removeChild(this,oldChild);
	},
	// Introduced in DOM Level 2:
	importNode : function(importedNode,deep){
		return importNode(this,importedNode,deep);
	},
	// Introduced in DOM Level 2:
	getElementById :	function(id){
		var rtv = null;
		_visitNode(this.documentElement,function(node){
			if(node.nodeType == ELEMENT_NODE){
				if(node.getAttribute('id') == id){
					rtv = node;
					return true;
				}
			}
		})
		return rtv;
	},

	/**
	 * The `getElementsByClassName` method of `Document` interface returns an array-like object
	 * of all child elements which have **all** of the given class name(s).
	 *
	 * Returns an empty list if `classeNames` is an empty string or only contains HTML white space characters.
	 *
	 *
	 * Warning: This is a live LiveNodeList.
	 * Changes in the DOM will reflect in the array as the changes occur.
	 * If an element selected by this array no longer qualifies for the selector,
	 * it will automatically be removed. Be aware of this for iteration purposes.
	 *
	 * @param {string} classNames is a string representing the class name(s) to match; multiple class names are separated by (ASCII-)whitespace
	 *
	 * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName
	 * @see https://dom.spec.whatwg.org/#concept-getelementsbyclassname
	 */
	getElementsByClassName: function(classNames) {
		var classNamesSet = toOrderedSet(classNames)
		return new LiveNodeList(this, function(base) {
			var ls = [];
			if (classNamesSet.length > 0) {
				_visitNode(base.documentElement, function(node) {
					if(node !== base && node.nodeType === ELEMENT_NODE) {
						var nodeClassNames = node.getAttribute('class')
						// can be null if the attribute does not exist
						if (nodeClassNames) {
							// before splitting and iterating just compare them for the most common case
							var matches = classNames === nodeClassNames;
							if (!matches) {
								var nodeClassNamesSet = toOrderedSet(nodeClassNames)
								matches = classNamesSet.every(arrayIncludes(nodeClassNamesSet))
							}
							if(matches) {
								ls.push(node);
							}
						}
					}
				});
			}
			return ls;
		});
	},

	//document factory method:
	createElement :	function(tagName){
		var node = new Element();
		node.ownerDocument = this;
		node.nodeName = tagName;
		node.tagName = tagName;
		node.localName = tagName;
		node.childNodes = new NodeList();
		var attrs	= node.attributes = new NamedNodeMap();
		attrs._ownerElement = node;
		return node;
	},
	createDocumentFragment :	function(){
		var node = new DocumentFragment();
		node.ownerDocument = this;
		node.childNodes = new NodeList();
		return node;
	},
	createTextNode :	function(data){
		var node = new Text();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createComment :	function(data){
		var node = new Comment();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createCDATASection :	function(data){
		var node = new CDATASection();
		node.ownerDocument = this;
		node.appendData(data)
		return node;
	},
	createProcessingInstruction :	function(target,data){
		var node = new ProcessingInstruction();
		node.ownerDocument = this;
		node.tagName = node.target = target;
		node.nodeValue= node.data = data;
		return node;
	},
	createAttribute :	function(name){
		var node = new Attr();
		node.ownerDocument	= this;
		node.name = name;
		node.nodeName	= name;
		node.localName = name;
		node.specified = true;
		return node;
	},
	createEntityReference :	function(name){
		var node = new EntityReference();
		node.ownerDocument	= this;
		node.nodeName	= name;
		return node;
	},
	// Introduced in DOM Level 2:
	createElementNS :	function(namespaceURI,qualifiedName){
		var node = new Element();
		var pl = qualifiedName.split(':');
		var attrs	= node.attributes = new NamedNodeMap();
		node.childNodes = new NodeList();
		node.ownerDocument = this;
		node.nodeName = qualifiedName;
		node.tagName = qualifiedName;
		node.namespaceURI = namespaceURI;
		if(pl.length == 2){
			node.prefix = pl[0];
			node.localName = pl[1];
		}else{
			//el.prefix = null;
			node.localName = qualifiedName;
		}
		attrs._ownerElement = node;
		return node;
	},
	// Introduced in DOM Level 2:
	createAttributeNS :	function(namespaceURI,qualifiedName){
		var node = new Attr();
		var pl = qualifiedName.split(':');
		node.ownerDocument = this;
		node.nodeName = qualifiedName;
		node.name = qualifiedName;
		node.namespaceURI = namespaceURI;
		node.specified = true;
		if(pl.length == 2){
			node.prefix = pl[0];
			node.localName = pl[1];
		}else{
			//el.prefix = null;
			node.localName = qualifiedName;
		}
		return node;
	}
};
_extends(Document,Node);


function Element() {
	this._nsMap = {};
};
Element.prototype = {
	nodeType : ELEMENT_NODE,
	hasAttribute : function(name){
		return this.getAttributeNode(name)!=null;
	},
	getAttribute : function(name){
		var attr = this.getAttributeNode(name);
		return attr && attr.value || '';
	},
	getAttributeNode : function(name){
		return this.attributes.getNamedItem(name);
	},
	setAttribute : function(name, value){
		var attr = this.ownerDocument.createAttribute(name);
		attr.value = attr.nodeValue = "" + value;
		this.setAttributeNode(attr)
	},
	removeAttribute : function(name){
		var attr = this.getAttributeNode(name)
		attr && this.removeAttributeNode(attr);
	},
	
	//four real opeartion method
	appendChild:function(newChild){
		if(newChild.nodeType === DOCUMENT_FRAGMENT_NODE){
			return this.insertBefore(newChild,null);
		}else{
			return _appendSingleChild(this,newChild);
		}
	},
	setAttributeNode : function(newAttr){
		return this.attributes.setNamedItem(newAttr);
	},
	setAttributeNodeNS : function(newAttr){
		return this.attributes.setNamedItemNS(newAttr);
	},
	removeAttributeNode : function(oldAttr){
		//console.log(this == oldAttr.ownerElement)
		return this.attributes.removeNamedItem(oldAttr.nodeName);
	},
	//get real attribute name,and remove it by removeAttributeNode
	removeAttributeNS : function(namespaceURI, localName){
		var old = this.getAttributeNodeNS(namespaceURI, localName);
		old && this.removeAttributeNode(old);
	},
	
	hasAttributeNS : function(namespaceURI, localName){
		return this.getAttributeNodeNS(namespaceURI, localName)!=null;
	},
	getAttributeNS : function(namespaceURI, localName){
		var attr = this.getAttributeNodeNS(namespaceURI, localName);
		return attr && attr.value || '';
	},
	setAttributeNS : function(namespaceURI, qualifiedName, value){
		var attr = this.ownerDocument.createAttributeNS(namespaceURI, qualifiedName);
		attr.value = attr.nodeValue = "" + value;
		this.setAttributeNode(attr)
	},
	getAttributeNodeNS : function(namespaceURI, localName){
		return this.attributes.getNamedItemNS(namespaceURI, localName);
	},
	
	getElementsByTagName : function(tagName){
		return new LiveNodeList(this,function(base){
			var ls = [];
			_visitNode(base,function(node){
				if(node !== base && node.nodeType == ELEMENT_NODE && (tagName === '*' || node.tagName == tagName)){
					ls.push(node);
				}
			});
			return ls;
		});
	},
	getElementsByTagNameNS : function(namespaceURI, localName){
		return new LiveNodeList(this,function(base){
			var ls = [];
			_visitNode(base,function(node){
				if(node !== base && node.nodeType === ELEMENT_NODE && (namespaceURI === '*' || node.namespaceURI === namespaceURI) && (localName === '*' || node.localName == localName)){
					ls.push(node);
				}
			});
			return ls;
			
		});
	}
};
Document.prototype.getElementsByTagName = Element.prototype.getElementsByTagName;
Document.prototype.getElementsByTagNameNS = Element.prototype.getElementsByTagNameNS;


_extends(Element,Node);
function Attr() {
};
Attr.prototype.nodeType = ATTRIBUTE_NODE;
_extends(Attr,Node);


function CharacterData() {
};
CharacterData.prototype = {
	data : '',
	substringData : function(offset, count) {
		return this.data.substring(offset, offset+count);
	},
	appendData: function(text) {
		text = this.data+text;
		this.nodeValue = this.data = text;
		this.length = text.length;
	},
	insertData: function(offset,text) {
		this.replaceData(offset,0,text);
	
	},
	appendChild:function(newChild){
		throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])
	},
	deleteData: function(offset, count) {
		this.replaceData(offset,count,"");
	},
	replaceData: function(offset, count, text) {
		var start = this.data.substring(0,offset);
		var end = this.data.substring(offset+count);
		text = start + text + end;
		this.nodeValue = this.data = text;
		this.length = text.length;
	}
}
_extends(CharacterData,Node);
function Text() {
};
Text.prototype = {
	nodeName : "#text",
	nodeType : TEXT_NODE,
	splitText : function(offset) {
		var text = this.data;
		var newText = text.substring(offset);
		text = text.substring(0, offset);
		this.data = this.nodeValue = text;
		this.length = text.length;
		var newNode = this.ownerDocument.createTextNode(newText);
		if(this.parentNode){
			this.parentNode.insertBefore(newNode, this.nextSibling);
		}
		return newNode;
	}
}
_extends(Text,CharacterData);
function Comment() {
};
Comment.prototype = {
	nodeName : "#comment",
	nodeType : COMMENT_NODE
}
_extends(Comment,CharacterData);

function CDATASection() {
};
CDATASection.prototype = {
	nodeName : "#cdata-section",
	nodeType : CDATA_SECTION_NODE
}
_extends(CDATASection,CharacterData);


function DocumentType() {
};
DocumentType.prototype.nodeType = DOCUMENT_TYPE_NODE;
_extends(DocumentType,Node);

function Notation() {
};
Notation.prototype.nodeType = NOTATION_NODE;
_extends(Notation,Node);

function Entity() {
};
Entity.prototype.nodeType = ENTITY_NODE;
_extends(Entity,Node);

function EntityReference() {
};
EntityReference.prototype.nodeType = ENTITY_REFERENCE_NODE;
_extends(EntityReference,Node);

function DocumentFragment() {
};
DocumentFragment.prototype.nodeName =	"#document-fragment";
DocumentFragment.prototype.nodeType =	DOCUMENT_FRAGMENT_NODE;
_extends(DocumentFragment,Node);


function ProcessingInstruction() {
}
ProcessingInstruction.prototype.nodeType = PROCESSING_INSTRUCTION_NODE;
_extends(ProcessingInstruction,Node);
function XMLSerializer(){}
XMLSerializer.prototype.serializeToString = function(node,isHtml,nodeFilter){
	return nodeSerializeToString.call(node,isHtml,nodeFilter);
}
Node.prototype.toString = nodeSerializeToString;
function nodeSerializeToString(isHtml,nodeFilter){
	var buf = [];
	var refNode = this.nodeType == 9 && this.documentElement || this;
	var prefix = refNode.prefix;
	var uri = refNode.namespaceURI;
	
	if(uri && prefix == null){
		//console.log(prefix)
		var prefix = refNode.lookupPrefix(uri);
		if(prefix == null){
			//isHTML = true;
			var visibleNamespaces=[
			{namespace:uri,prefix:null}
			//{namespace:uri,prefix:''}
			]
		}
	}
	serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces);
	//console.log('###',this.nodeType,uri,prefix,buf.join(''))
	return buf.join('');
}

function needNamespaceDefine(node, isHTML, visibleNamespaces) {
	var prefix = node.prefix || '';
	var uri = node.namespaceURI;
	// According to [Namespaces in XML 1.0](https://www.w3.org/TR/REC-xml-names/#ns-using) ,
	// and more specifically https://www.w3.org/TR/REC-xml-names/#nsc-NoPrefixUndecl :
	// > In a namespace declaration for a prefix [...], the attribute value MUST NOT be empty.
	// in a similar manner [Namespaces in XML 1.1](https://www.w3.org/TR/xml-names11/#ns-using)
	// and more specifically https://www.w3.org/TR/xml-names11/#nsc-NSDeclared :
	// > [...] Furthermore, the attribute value [...] must not be an empty string.
	// so serializing empty namespace value like xmlns:ds="" would produce an invalid XML document.
	if (!uri) {
		return false;
	}
	if (prefix === "xml" && uri === NAMESPACE.XML || uri === NAMESPACE.XMLNS) {
		return false;
	}
	
	var i = visibleNamespaces.length 
	while (i--) {
		var ns = visibleNamespaces[i];
		// get namespace prefix
		if (ns.prefix === prefix) {
			return ns.namespace !== uri;
		}
	}
	return true;
}
/**
 * Well-formed constraint: No < in Attribute Values
 * > The replacement text of any entity referred to directly or indirectly
 * > in an attribute value must not contain a <.
 * @see https://www.w3.org/TR/xml11/#CleanAttrVals
 * @see https://www.w3.org/TR/xml11/#NT-AttValue
 *
 * Literal whitespace other than space that appear in attribute values
 * are serialized as their entity references, so they will be preserved.
 * (In contrast to whitespace literals in the input which are normalized to spaces)
 * @see https://www.w3.org/TR/xml11/#AVNormalize
 * @see https://w3c.github.io/DOM-Parsing/#serializing-an-element-s-attributes
 */
function addSerializedAttribute(buf, qualifiedName, value) {
	buf.push(' ', qualifiedName, '="', value.replace(/[<>&"\t\n\r]/g, _xmlEncoder), '"')
}

function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){
	if (!visibleNamespaces) {
		visibleNamespaces = [];
	}

	if(nodeFilter){
		node = nodeFilter(node);
		if(node){
			if(typeof node == 'string'){
				buf.push(node);
				return;
			}
		}else{
			return;
		}
		//buf.sort.apply(attrs, attributeSorter);
	}

	switch(node.nodeType){
	case ELEMENT_NODE:
		var attrs = node.attributes;
		var len = attrs.length;
		var child = node.firstChild;
		var nodeName = node.tagName;
		
		isHTML = NAMESPACE.isHTML(node.namespaceURI) || isHTML

		var prefixedNodeName = nodeName
		if (!isHTML && !node.prefix && node.namespaceURI) {
			var defaultNS
			// lookup current default ns from `xmlns` attribute
			for (var ai = 0; ai < attrs.length; ai++) {
				if (attrs.item(ai).name === 'xmlns') {
					defaultNS = attrs.item(ai).value
					break
				}
			}
			if (!defaultNS) {
				// lookup current default ns in visibleNamespaces
				for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {
					var namespace = visibleNamespaces[nsi]
					if (namespace.prefix === '' && namespace.namespace === node.namespaceURI) {
						defaultNS = namespace.namespace
						break
					}
				}
			}
			if (defaultNS !== node.namespaceURI) {
				for (var nsi = visibleNamespaces.length - 1; nsi >= 0; nsi--) {
					var namespace = visibleNamespaces[nsi]
					if (namespace.namespace === node.namespaceURI) {
						if (namespace.prefix) {
							prefixedNodeName = namespace.prefix + ':' + nodeName
						}
						break
					}
				}
			}
		}

		buf.push('<', prefixedNodeName);

		for(var i=0;i<len;i++){
			// add namespaces for attributes
			var attr = attrs.item(i);
			if (attr.prefix == 'xmlns') {
				visibleNamespaces.push({ prefix: attr.localName, namespace: attr.value });
			}else if(attr.nodeName == 'xmlns'){
				visibleNamespaces.push({ prefix: '', namespace: attr.value });
			}
		}

		for(var i=0;i<len;i++){
			var attr = attrs.item(i);
			if (needNamespaceDefine(attr,isHTML, visibleNamespaces)) {
				var prefix = attr.prefix||'';
				var uri = attr.namespaceURI;
				addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : "xmlns", uri);
				visibleNamespaces.push({ prefix: prefix, namespace:uri });
			}
			serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces);
		}

		// add namespace for current node		
		if (nodeName === prefixedNodeName && needNamespaceDefine(node, isHTML, visibleNamespaces)) {
			var prefix = node.prefix||'';
			var uri = node.namespaceURI;
			addSerializedAttribute(buf, prefix ? 'xmlns:' + prefix : "xmlns", uri);
			visibleNamespaces.push({ prefix: prefix, namespace:uri });
		}
		
		if(child || isHTML && !/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){
			buf.push('>');
			//if is cdata child node
			if(isHTML && /^script$/i.test(nodeName)){
				while(child){
					if(child.data){
						buf.push(child.data);
					}else{
						serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
					}
					child = child.nextSibling;
				}
			}else
			{
				while(child){
					serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
					child = child.nextSibling;
				}
			}
			buf.push('</',prefixedNodeName,'>');
		}else{
			buf.push('/>');
		}
		// remove added visible namespaces
		//visibleNamespaces.length = startVisibleNamespaces;
		return;
	case DOCUMENT_NODE:
	case DOCUMENT_FRAGMENT_NODE:
		var child = node.firstChild;
		while(child){
			serializeToString(child, buf, isHTML, nodeFilter, visibleNamespaces.slice());
			child = child.nextSibling;
		}
		return;
	case ATTRIBUTE_NODE:
		return addSerializedAttribute(buf, node.name, node.value);
	case TEXT_NODE:
		/**
		 * The ampersand character (&) and the left angle bracket (<) must not appear in their literal form,
		 * except when used as markup delimiters, or within a comment, a processing instruction, or a CDATA section.
		 * If they are needed elsewhere, they must be escaped using either numeric character references or the strings
		 * `&amp;` and `&lt;` respectively.
		 * The right angle bracket (>) may be represented using the string " &gt; ", and must, for compatibility,
		 * be escaped using either `&gt;` or a character reference when it appears in the string `]]>` in content,
		 * when that string is not marking the end of a CDATA section.
		 *
		 * In the content of elements, character data is any string of characters
		 * which does not contain the start-delimiter of any markup
		 * and does not include the CDATA-section-close delimiter, `]]>`.
		 *
		 * @see https://www.w3.org/TR/xml/#NT-CharData
		 * @see https://w3c.github.io/DOM-Parsing/#xml-serializing-a-text-node
		 */
		return buf.push(node.data
			.replace(/[<&>]/g,_xmlEncoder)
		);
	case CDATA_SECTION_NODE:
		return buf.push( '<![CDATA[',node.data,']]>');
	case COMMENT_NODE:
		return buf.push( "<!--",node.data,"-->");
	case DOCUMENT_TYPE_NODE:
		var pubid = node.publicId;
		var sysid = node.systemId;
		buf.push('<!DOCTYPE ',node.name);
		if(pubid){
			buf.push(' PUBLIC ', pubid);
			if (sysid && sysid!='.') {
				buf.push(' ', sysid);
			}
			buf.push('>');
		}else if(sysid && sysid!='.'){
			buf.push(' SYSTEM ', sysid, '>');
		}else{
			var sub = node.internalSubset;
			if(sub){
				buf.push(" [",sub,"]");
			}
			buf.push(">");
		}
		return;
	case PROCESSING_INSTRUCTION_NODE:
		return buf.push( "<?",node.target," ",node.data,"?>");
	case ENTITY_REFERENCE_NODE:
		return buf.push( '&',node.nodeName,';');
	//case ENTITY_NODE:
	//case NOTATION_NODE:
	default:
		buf.push('??',node.nodeName);
	}
}
function importNode(doc,node,deep){
	var node2;
	switch (node.nodeType) {
	case ELEMENT_NODE:
		node2 = node.cloneNode(false);
		node2.ownerDocument = doc;
		//var attrs = node2.attributes;
		//var len = attrs.length;
		//for(var i=0;i<len;i++){
			//node2.setAttributeNodeNS(importNode(doc,attrs.item(i),deep));
		//}
	case DOCUMENT_FRAGMENT_NODE:
		break;
	case ATTRIBUTE_NODE:
		deep = true;
		break;
	//case ENTITY_REFERENCE_NODE:
	//case PROCESSING_INSTRUCTION_NODE:
	////case TEXT_NODE:
	//case CDATA_SECTION_NODE:
	//case COMMENT_NODE:
	//	deep = false;
	//	break;
	//case DOCUMENT_NODE:
	//case DOCUMENT_TYPE_NODE:
	//cannot be imported.
	//case ENTITY_NODE:
	//case NOTATION_NODE：
	//can not hit in level3
	//default:throw e;
	}
	if(!node2){
		node2 = node.cloneNode(false);//false
	}
	node2.ownerDocument = doc;
	node2.parentNode = null;
	if(deep){
		var child = node.firstChild;
		while(child){
			node2.appendChild(importNode(doc,child,deep));
			child = child.nextSibling;
		}
	}
	return node2;
}
//
//var _relationMap = {firstChild:1,lastChild:1,previousSibling:1,nextSibling:1,
//					attributes:1,childNodes:1,parentNode:1,documentElement:1,doctype,};
function cloneNode(doc,node,deep){
	var node2 = new node.constructor();
	for(var n in node){
		var v = node[n];
		if(typeof v != 'object' ){
			if(v != node2[n]){
				node2[n] = v;
			}
		}
	}
	if(node.childNodes){
		node2.childNodes = new NodeList();
	}
	node2.ownerDocument = doc;
	switch (node2.nodeType) {
	case ELEMENT_NODE:
		var attrs	= node.attributes;
		var attrs2	= node2.attributes = new NamedNodeMap();
		var len = attrs.length
		attrs2._ownerElement = node2;
		for(var i=0;i<len;i++){
			node2.setAttributeNode(cloneNode(doc,attrs.item(i),true));
		}
		break;;
	case ATTRIBUTE_NODE:
		deep = true;
	}
	if(deep){
		var child = node.firstChild;
		while(child){
			node2.appendChild(cloneNode(doc,child,deep));
			child = child.nextSibling;
		}
	}
	return node2;
}

function __set__(object,key,value){
	object[key] = value
}
//do dynamic
try{
	if(Object.defineProperty){
		Object.defineProperty(LiveNodeList.prototype,'length',{
			get:function(){
				_updateLiveList(this);
				return this.$$length;
			}
		});

		Object.defineProperty(Node.prototype,'textContent',{
			get:function(){
				return getTextContent(this);
			},

			set:function(data){
				switch(this.nodeType){
				case ELEMENT_NODE:
				case DOCUMENT_FRAGMENT_NODE:
					while(this.firstChild){
						this.removeChild(this.firstChild);
					}
					if(data || String(data)){
						this.appendChild(this.ownerDocument.createTextNode(data));
					}
					break;

				default:
					this.data = data;
					this.value = data;
					this.nodeValue = data;
				}
			}
		})
		
		function getTextContent(node){
			switch(node.nodeType){
			case ELEMENT_NODE:
			case DOCUMENT_FRAGMENT_NODE:
				var buf = [];
				node = node.firstChild;
				while(node){
					if(node.nodeType!==7 && node.nodeType !==8){
						buf.push(getTextContent(node));
					}
					node = node.nextSibling;
				}
				return buf.join('');
			default:
				return node.nodeValue;
			}
		}

		__set__ = function(object,key,value){
			//console.log(value)
			object['$$'+key] = value
		}
	}
}catch(e){//ie8
}

//if(typeof require == 'function'){
	exports.DocumentType = DocumentType;
	exports.DOMException = DOMException;
	exports.DOMImplementation = DOMImplementation;
	exports.Element = Element;
	exports.Node = Node;
	exports.NodeList = NodeList;
	exports.XMLSerializer = XMLSerializer;
//}


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/entities.js":
/*!*****************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/entities.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var freeze = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js").freeze;

/**
 * The entities that are predefined in every XML document.
 *
 * @see https://www.w3.org/TR/2006/REC-xml11-20060816/#sec-predefined-ent W3C XML 1.1
 * @see https://www.w3.org/TR/2008/REC-xml-20081126/#sec-predefined-ent W3C XML 1.0
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Predefined_entities_in_XML Wikipedia
 */
exports.XML_ENTITIES = freeze({amp:'&', apos:"'", gt:'>', lt:'<', quot:'"'})

/**
 * A map of currently 241 entities that are detected in an HTML document.
 * They contain all entries from `XML_ENTITIES`.
 *
 * @see XML_ENTITIES
 * @see DOMParser.parseFromString
 * @see DOMImplementation.prototype.createHTMLDocument
 * @see https://html.spec.whatwg.org/#named-character-references WHATWG HTML(5) Spec
 * @see https://www.w3.org/TR/xml-entity-names/ W3C XML Entity Names
 * @see https://www.w3.org/TR/html4/sgml/entities.html W3C HTML4/SGML
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Character_entity_references_in_HTML Wikipedia (HTML)
 * @see https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references#Entities_representing_special_characters_in_XHTML Wikpedia (XHTML)
 */
exports.HTML_ENTITIES = freeze({
       lt: '<',
       gt: '>',
       amp: '&',
       quot: '"',
       apos: "'",
       Agrave: "À",
       Aacute: "Á",
       Acirc: "Â",
       Atilde: "Ã",
       Auml: "Ä",
       Aring: "Å",
       AElig: "Æ",
       Ccedil: "Ç",
       Egrave: "È",
       Eacute: "É",
       Ecirc: "Ê",
       Euml: "Ë",
       Igrave: "Ì",
       Iacute: "Í",
       Icirc: "Î",
       Iuml: "Ï",
       ETH: "Ð",
       Ntilde: "Ñ",
       Ograve: "Ò",
       Oacute: "Ó",
       Ocirc: "Ô",
       Otilde: "Õ",
       Ouml: "Ö",
       Oslash: "Ø",
       Ugrave: "Ù",
       Uacute: "Ú",
       Ucirc: "Û",
       Uuml: "Ü",
       Yacute: "Ý",
       THORN: "Þ",
       szlig: "ß",
       agrave: "à",
       aacute: "á",
       acirc: "â",
       atilde: "ã",
       auml: "ä",
       aring: "å",
       aelig: "æ",
       ccedil: "ç",
       egrave: "è",
       eacute: "é",
       ecirc: "ê",
       euml: "ë",
       igrave: "ì",
       iacute: "í",
       icirc: "î",
       iuml: "ï",
       eth: "ð",
       ntilde: "ñ",
       ograve: "ò",
       oacute: "ó",
       ocirc: "ô",
       otilde: "õ",
       ouml: "ö",
       oslash: "ø",
       ugrave: "ù",
       uacute: "ú",
       ucirc: "û",
       uuml: "ü",
       yacute: "ý",
       thorn: "þ",
       yuml: "ÿ",
       nbsp: "\u00a0",
       iexcl: "¡",
       cent: "¢",
       pound: "£",
       curren: "¤",
       yen: "¥",
       brvbar: "¦",
       sect: "§",
       uml: "¨",
       copy: "©",
       ordf: "ª",
       laquo: "«",
       not: "¬",
       shy: "­­",
       reg: "®",
       macr: "¯",
       deg: "°",
       plusmn: "±",
       sup2: "²",
       sup3: "³",
       acute: "´",
       micro: "µ",
       para: "¶",
       middot: "·",
       cedil: "¸",
       sup1: "¹",
       ordm: "º",
       raquo: "»",
       frac14: "¼",
       frac12: "½",
       frac34: "¾",
       iquest: "¿",
       times: "×",
       divide: "÷",
       forall: "∀",
       part: "∂",
       exist: "∃",
       empty: "∅",
       nabla: "∇",
       isin: "∈",
       notin: "∉",
       ni: "∋",
       prod: "∏",
       sum: "∑",
       minus: "−",
       lowast: "∗",
       radic: "√",
       prop: "∝",
       infin: "∞",
       ang: "∠",
       and: "∧",
       or: "∨",
       cap: "∩",
       cup: "∪",
       'int': "∫",
       there4: "∴",
       sim: "∼",
       cong: "≅",
       asymp: "≈",
       ne: "≠",
       equiv: "≡",
       le: "≤",
       ge: "≥",
       sub: "⊂",
       sup: "⊃",
       nsub: "⊄",
       sube: "⊆",
       supe: "⊇",
       oplus: "⊕",
       otimes: "⊗",
       perp: "⊥",
       sdot: "⋅",
       Alpha: "Α",
       Beta: "Β",
       Gamma: "Γ",
       Delta: "Δ",
       Epsilon: "Ε",
       Zeta: "Ζ",
       Eta: "Η",
       Theta: "Θ",
       Iota: "Ι",
       Kappa: "Κ",
       Lambda: "Λ",
       Mu: "Μ",
       Nu: "Ν",
       Xi: "Ξ",
       Omicron: "Ο",
       Pi: "Π",
       Rho: "Ρ",
       Sigma: "Σ",
       Tau: "Τ",
       Upsilon: "Υ",
       Phi: "Φ",
       Chi: "Χ",
       Psi: "Ψ",
       Omega: "Ω",
       alpha: "α",
       beta: "β",
       gamma: "γ",
       delta: "δ",
       epsilon: "ε",
       zeta: "ζ",
       eta: "η",
       theta: "θ",
       iota: "ι",
       kappa: "κ",
       lambda: "λ",
       mu: "μ",
       nu: "ν",
       xi: "ξ",
       omicron: "ο",
       pi: "π",
       rho: "ρ",
       sigmaf: "ς",
       sigma: "σ",
       tau: "τ",
       upsilon: "υ",
       phi: "φ",
       chi: "χ",
       psi: "ψ",
       omega: "ω",
       thetasym: "ϑ",
       upsih: "ϒ",
       piv: "ϖ",
       OElig: "Œ",
       oelig: "œ",
       Scaron: "Š",
       scaron: "š",
       Yuml: "Ÿ",
       fnof: "ƒ",
       circ: "ˆ",
       tilde: "˜",
       ensp: " ",
       emsp: " ",
       thinsp: " ",
       zwnj: "‌",
       zwj: "‍",
       lrm: "‎",
       rlm: "‏",
       ndash: "–",
       mdash: "—",
       lsquo: "‘",
       rsquo: "’",
       sbquo: "‚",
       ldquo: "“",
       rdquo: "”",
       bdquo: "„",
       dagger: "†",
       Dagger: "‡",
       bull: "•",
       hellip: "…",
       permil: "‰",
       prime: "′",
       Prime: "″",
       lsaquo: "‹",
       rsaquo: "›",
       oline: "‾",
       euro: "€",
       trade: "™",
       larr: "←",
       uarr: "↑",
       rarr: "→",
       darr: "↓",
       harr: "↔",
       crarr: "↵",
       lceil: "⌈",
       rceil: "⌉",
       lfloor: "⌊",
       rfloor: "⌋",
       loz: "◊",
       spades: "♠",
       clubs: "♣",
       hearts: "♥",
       diams: "♦"
});

/**
 * @deprecated use `HTML_ENTITIES` instead
 * @see HTML_ENTITIES
 */
exports.entityMap = exports.HTML_ENTITIES


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/index.js":
/*!**************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/index.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var dom = __webpack_require__(/*! ./dom */ "./node_modules/@xmldom/xmldom/lib/dom.js")
exports.DOMImplementation = dom.DOMImplementation
exports.XMLSerializer = dom.XMLSerializer
exports.DOMParser = __webpack_require__(/*! ./dom-parser */ "./node_modules/@xmldom/xmldom/lib/dom-parser.js").DOMParser


/***/ }),

/***/ "./node_modules/@xmldom/xmldom/lib/sax.js":
/*!************************************************!*\
  !*** ./node_modules/@xmldom/xmldom/lib/sax.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var NAMESPACE = __webpack_require__(/*! ./conventions */ "./node_modules/@xmldom/xmldom/lib/conventions.js").NAMESPACE;

//[4]   	NameStartChar	   ::=   	":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
//[4a]   	NameChar	   ::=   	NameStartChar | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]
//[5]   	Name	   ::=   	NameStartChar (NameChar)*
var nameStartChar = /[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]///\u10000-\uEFFFF
var nameChar = new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]");
var tagNamePattern = new RegExp('^'+nameStartChar.source+nameChar.source+'*(?:\:'+nameStartChar.source+nameChar.source+'*)?$');
//var tagNamePattern = /^[a-zA-Z_][\w\-\.]*(?:\:[a-zA-Z_][\w\-\.]*)?$/
//var handlers = 'resolveEntity,getExternalSubset,characters,endDocument,endElement,endPrefixMapping,ignorableWhitespace,processingInstruction,setDocumentLocator,skippedEntity,startDocument,startElement,startPrefixMapping,notationDecl,unparsedEntityDecl,error,fatalError,warning,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,comment,endCDATA,endDTD,endEntity,startCDATA,startDTD,startEntity'.split(',')

//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
var S_TAG = 0;//tag name offerring
var S_ATTR = 1;//attr name offerring
var S_ATTR_SPACE=2;//attr name end and space offer
var S_EQ = 3;//=space?
var S_ATTR_NOQUOT_VALUE = 4;//attr value(no quot value only)
var S_ATTR_END = 5;//attr value end and no space(quot end)
var S_TAG_SPACE = 6;//(attr value end || tag end ) && (space offer)
var S_TAG_CLOSE = 7;//closed el<el />

/**
 * Creates an error that will not be caught by XMLReader aka the SAX parser.
 *
 * @param {string} message
 * @param {any?} locator Optional, can provide details about the location in the source
 * @constructor
 */
function ParseError(message, locator) {
	this.message = message
	this.locator = locator
	if(Error.captureStackTrace) Error.captureStackTrace(this, ParseError);
}
ParseError.prototype = new Error();
ParseError.prototype.name = ParseError.name

function XMLReader(){

}

XMLReader.prototype = {
	parse:function(source,defaultNSMap,entityMap){
		var domBuilder = this.domBuilder;
		domBuilder.startDocument();
		_copy(defaultNSMap ,defaultNSMap = {})
		parse(source,defaultNSMap,entityMap,
				domBuilder,this.errorHandler);
		domBuilder.endDocument();
	}
}
function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){
	function fixedFromCharCode(code) {
		// String.prototype.fromCharCode does not supports
		// > 2 bytes unicode chars directly
		if (code > 0xffff) {
			code -= 0x10000;
			var surrogate1 = 0xd800 + (code >> 10)
				, surrogate2 = 0xdc00 + (code & 0x3ff);

			return String.fromCharCode(surrogate1, surrogate2);
		} else {
			return String.fromCharCode(code);
		}
	}
	function entityReplacer(a){
		var k = a.slice(1,-1);
		if (Object.hasOwnProperty.call(entityMap, k)) {
			return entityMap[k];
		}else if(k.charAt(0) === '#'){
			return fixedFromCharCode(parseInt(k.substr(1).replace('x','0x')))
		}else{
			errorHandler.error('entity not found:'+a);
			return a;
		}
	}
	function appendText(end){//has some bugs
		if(end>start){
			var xt = source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);
			locator&&position(start);
			domBuilder.characters(xt,0,end-start);
			start = end
		}
	}
	function position(p,m){
		while(p>=lineEnd && (m = linePattern.exec(source))){
			lineStart = m.index;
			lineEnd = lineStart + m[0].length;
			locator.lineNumber++;
			//console.log('line++:',locator,startPos,endPos)
		}
		locator.columnNumber = p-lineStart+1;
	}
	var lineStart = 0;
	var lineEnd = 0;
	var linePattern = /.*(?:\r\n?|\n)|.*$/g
	var locator = domBuilder.locator;

	var parseStack = [{currentNSMap:defaultNSMapCopy}]
	var closeMap = {};
	var start = 0;
	while(true){
		try{
			var tagStart = source.indexOf('<',start);
			if(tagStart<0){
				if(!source.substr(start).match(/^\s*$/)){
					var doc = domBuilder.doc;
	    			var text = doc.createTextNode(source.substr(start));
	    			doc.appendChild(text);
	    			domBuilder.currentElement = text;
				}
				return;
			}
			if(tagStart>start){
				appendText(tagStart);
			}
			switch(source.charAt(tagStart+1)){
			case '/':
				var end = source.indexOf('>',tagStart+3);
				var tagName = source.substring(tagStart + 2, end).replace(/[ \t\n\r]+$/g, '');
				var config = parseStack.pop();
				if(end<0){

	        		tagName = source.substring(tagStart+2).replace(/[\s<].*/,'');
	        		errorHandler.error("end tag name: "+tagName+' is not complete:'+config.tagName);
	        		end = tagStart+1+tagName.length;
	        	}else if(tagName.match(/\s</)){
	        		tagName = tagName.replace(/[\s<].*/,'');
	        		errorHandler.error("end tag name: "+tagName+' maybe not complete');
	        		end = tagStart+1+tagName.length;
				}
				var localNSMap = config.localNSMap;
				var endMatch = config.tagName == tagName;
				var endIgnoreCaseMach = endMatch || config.tagName&&config.tagName.toLowerCase() == tagName.toLowerCase()
		        if(endIgnoreCaseMach){
		        	domBuilder.endElement(config.uri,config.localName,tagName);
					if(localNSMap){
						for(var prefix in localNSMap){
							domBuilder.endPrefixMapping(prefix) ;
						}
					}
					if(!endMatch){
		            	errorHandler.fatalError("end tag name: "+tagName+' is not match the current start tagName:'+config.tagName ); // No known test case
					}
		        }else{
		        	parseStack.push(config)
		        }

				end++;
				break;
				// end elment
			case '?':// <?...?>
				locator&&position(tagStart);
				end = parseInstruction(source,tagStart,domBuilder);
				break;
			case '!':// <!doctype,<![CDATA,<!--
				locator&&position(tagStart);
				end = parseDCC(source,tagStart,domBuilder,errorHandler);
				break;
			default:
				locator&&position(tagStart);
				var el = new ElementAttributes();
				var currentNSMap = parseStack[parseStack.length-1].currentNSMap;
				//elStartEnd
				var end = parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler);
				var len = el.length;


				if(!el.closed && fixSelfClosed(source,end,el.tagName,closeMap)){
					el.closed = true;
					if(!entityMap.nbsp){
						errorHandler.warning('unclosed xml attribute');
					}
				}
				if(locator && len){
					var locator2 = copyLocator(locator,{});
					//try{//attribute position fixed
					for(var i = 0;i<len;i++){
						var a = el[i];
						position(a.offset);
						a.locator = copyLocator(locator,{});
					}
					domBuilder.locator = locator2
					if(appendElement(el,domBuilder,currentNSMap)){
						parseStack.push(el)
					}
					domBuilder.locator = locator;
				}else{
					if(appendElement(el,domBuilder,currentNSMap)){
						parseStack.push(el)
					}
				}

				if (NAMESPACE.isHTML(el.uri) && !el.closed) {
					end = parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)
				} else {
					end++;
				}
			}
		}catch(e){
			if (e instanceof ParseError) {
				throw e;
			}
			errorHandler.error('element parse error: '+e)
			end = -1;
		}
		if(end>start){
			start = end;
		}else{
			//TODO: 这里有可能sax回退，有位置错误风险
			appendText(Math.max(tagStart,start)+1);
		}
	}
}
function copyLocator(f,t){
	t.lineNumber = f.lineNumber;
	t.columnNumber = f.columnNumber;
	return t;
}

/**
 * @see #appendElement(source,elStartEnd,el,selfClosed,entityReplacer,domBuilder,parseStack);
 * @return end of the elementStartPart(end of elementEndPart for selfClosed el)
 */
function parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){

	/**
	 * @param {string} qname
	 * @param {string} value
	 * @param {number} startIndex
	 */
	function addAttribute(qname, value, startIndex) {
		if (el.attributeNames.hasOwnProperty(qname)) {
			errorHandler.fatalError('Attribute ' + qname + ' redefined')
		}
		el.addValue(
			qname,
			// @see https://www.w3.org/TR/xml/#AVNormalize
			// since the xmldom sax parser does not "interpret" DTD the following is not implemented:
			// - recursive replacement of (DTD) entity references
			// - trimming and collapsing multiple spaces into a single one for attributes that are not of type CDATA
			value.replace(/[\t\n\r]/g, ' ').replace(/&#?\w+;/g, entityReplacer),
			startIndex
		)
	}
	var attrName;
	var value;
	var p = ++start;
	var s = S_TAG;//status
	while(true){
		var c = source.charAt(p);
		switch(c){
		case '=':
			if(s === S_ATTR){//attrName
				attrName = source.slice(start,p);
				s = S_EQ;
			}else if(s === S_ATTR_SPACE){
				s = S_EQ;
			}else{
				//fatalError: equal must after attrName or space after attrName
				throw new Error('attribute equal must after attrName'); // No known test case
			}
			break;
		case '\'':
		case '"':
			if(s === S_EQ || s === S_ATTR //|| s == S_ATTR_SPACE
				){//equal
				if(s === S_ATTR){
					errorHandler.warning('attribute value must after "="')
					attrName = source.slice(start,p)
				}
				start = p+1;
				p = source.indexOf(c,start)
				if(p>0){
					value = source.slice(start, p);
					addAttribute(attrName, value, start-1);
					s = S_ATTR_END;
				}else{
					//fatalError: no end quot match
					throw new Error('attribute value no end \''+c+'\' match');
				}
			}else if(s == S_ATTR_NOQUOT_VALUE){
				value = source.slice(start, p);
				addAttribute(attrName, value, start);
				errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+')!!');
				start = p+1;
				s = S_ATTR_END
			}else{
				//fatalError: no equal before
				throw new Error('attribute value must after "="'); // No known test case
			}
			break;
		case '/':
			switch(s){
			case S_TAG:
				el.setTagName(source.slice(start,p));
			case S_ATTR_END:
			case S_TAG_SPACE:
			case S_TAG_CLOSE:
				s =S_TAG_CLOSE;
				el.closed = true;
			case S_ATTR_NOQUOT_VALUE:
			case S_ATTR:
			case S_ATTR_SPACE:
				break;
			//case S_EQ:
			default:
				throw new Error("attribute invalid close char('/')") // No known test case
			}
			break;
		case ''://end document
			errorHandler.error('unexpected end of input');
			if(s == S_TAG){
				el.setTagName(source.slice(start,p));
			}
			return p;
		case '>':
			switch(s){
			case S_TAG:
				el.setTagName(source.slice(start,p));
			case S_ATTR_END:
			case S_TAG_SPACE:
			case S_TAG_CLOSE:
				break;//normal
			case S_ATTR_NOQUOT_VALUE://Compatible state
			case S_ATTR:
				value = source.slice(start,p);
				if(value.slice(-1) === '/'){
					el.closed  = true;
					value = value.slice(0,-1)
				}
			case S_ATTR_SPACE:
				if(s === S_ATTR_SPACE){
					value = attrName;
				}
				if(s == S_ATTR_NOQUOT_VALUE){
					errorHandler.warning('attribute "'+value+'" missed quot(")!');
					addAttribute(attrName, value, start)
				}else{
					if(!NAMESPACE.isHTML(currentNSMap['']) || !value.match(/^(?:disabled|checked|selected)$/i)){
						errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!')
					}
					addAttribute(value, value, start)
				}
				break;
			case S_EQ:
				throw new Error('attribute value missed!!');
			}
//			console.log(tagName,tagNamePattern,tagNamePattern.test(tagName))
			return p;
		/*xml space '\x20' | #x9 | #xD | #xA; */
		case '\u0080':
			c = ' ';
		default:
			if(c<= ' '){//space
				switch(s){
				case S_TAG:
					el.setTagName(source.slice(start,p));//tagName
					s = S_TAG_SPACE;
					break;
				case S_ATTR:
					attrName = source.slice(start,p)
					s = S_ATTR_SPACE;
					break;
				case S_ATTR_NOQUOT_VALUE:
					var value = source.slice(start, p);
					errorHandler.warning('attribute "'+value+'" missed quot(")!!');
					addAttribute(attrName, value, start)
				case S_ATTR_END:
					s = S_TAG_SPACE;
					break;
				//case S_TAG_SPACE:
				//case S_EQ:
				//case S_ATTR_SPACE:
				//	void();break;
				//case S_TAG_CLOSE:
					//ignore warning
				}
			}else{//not space
//S_TAG,	S_ATTR,	S_EQ,	S_ATTR_NOQUOT_VALUE
//S_ATTR_SPACE,	S_ATTR_END,	S_TAG_SPACE, S_TAG_CLOSE
				switch(s){
				//case S_TAG:void();break;
				//case S_ATTR:void();break;
				//case S_ATTR_NOQUOT_VALUE:void();break;
				case S_ATTR_SPACE:
					var tagName =  el.tagName;
					if (!NAMESPACE.isHTML(currentNSMap['']) || !attrName.match(/^(?:disabled|checked|selected)$/i)) {
						errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead2!!')
					}
					addAttribute(attrName, attrName, start);
					start = p;
					s = S_ATTR;
					break;
				case S_ATTR_END:
					errorHandler.warning('attribute space is required"'+attrName+'"!!')
				case S_TAG_SPACE:
					s = S_ATTR;
					start = p;
					break;
				case S_EQ:
					s = S_ATTR_NOQUOT_VALUE;
					start = p;
					break;
				case S_TAG_CLOSE:
					throw new Error("elements closed character '/' and '>' must be connected to");
				}
			}
		}//end outer switch
		//console.log('p++',p)
		p++;
	}
}
/**
 * @return true if has new namespace define
 */
function appendElement(el,domBuilder,currentNSMap){
	var tagName = el.tagName;
	var localNSMap = null;
	//var currentNSMap = parseStack[parseStack.length-1].currentNSMap;
	var i = el.length;
	while(i--){
		var a = el[i];
		var qName = a.qName;
		var value = a.value;
		var nsp = qName.indexOf(':');
		if(nsp>0){
			var prefix = a.prefix = qName.slice(0,nsp);
			var localName = qName.slice(nsp+1);
			var nsPrefix = prefix === 'xmlns' && localName
		}else{
			localName = qName;
			prefix = null
			nsPrefix = qName === 'xmlns' && ''
		}
		//can not set prefix,because prefix !== ''
		a.localName = localName ;
		//prefix == null for no ns prefix attribute
		if(nsPrefix !== false){//hack!!
			if(localNSMap == null){
				localNSMap = {}
				//console.log(currentNSMap,0)
				_copy(currentNSMap,currentNSMap={})
				//console.log(currentNSMap,1)
			}
			currentNSMap[nsPrefix] = localNSMap[nsPrefix] = value;
			a.uri = NAMESPACE.XMLNS
			domBuilder.startPrefixMapping(nsPrefix, value)
		}
	}
	var i = el.length;
	while(i--){
		a = el[i];
		var prefix = a.prefix;
		if(prefix){//no prefix attribute has no namespace
			if(prefix === 'xml'){
				a.uri = NAMESPACE.XML;
			}if(prefix !== 'xmlns'){
				a.uri = currentNSMap[prefix || '']

				//{console.log('###'+a.qName,domBuilder.locator.systemId+'',currentNSMap,a.uri)}
			}
		}
	}
	var nsp = tagName.indexOf(':');
	if(nsp>0){
		prefix = el.prefix = tagName.slice(0,nsp);
		localName = el.localName = tagName.slice(nsp+1);
	}else{
		prefix = null;//important!!
		localName = el.localName = tagName;
	}
	//no prefix element has default namespace
	var ns = el.uri = currentNSMap[prefix || ''];
	domBuilder.startElement(ns,localName,tagName,el);
	//endPrefixMapping and startPrefixMapping have not any help for dom builder
	//localNSMap = null
	if(el.closed){
		domBuilder.endElement(ns,localName,tagName);
		if(localNSMap){
			for(prefix in localNSMap){
				domBuilder.endPrefixMapping(prefix)
			}
		}
	}else{
		el.currentNSMap = currentNSMap;
		el.localNSMap = localNSMap;
		//parseStack.push(el);
		return true;
	}
}
function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){
	if(/^(?:script|textarea)$/i.test(tagName)){
		var elEndStart =  source.indexOf('</'+tagName+'>',elStartEnd);
		var text = source.substring(elStartEnd+1,elEndStart);
		if(/[&<]/.test(text)){
			if(/^script$/i.test(tagName)){
				//if(!/\]\]>/.test(text)){
					//lexHandler.startCDATA();
					domBuilder.characters(text,0,text.length);
					//lexHandler.endCDATA();
					return elEndStart;
				//}
			}//}else{//text area
				text = text.replace(/&#?\w+;/g,entityReplacer);
				domBuilder.characters(text,0,text.length);
				return elEndStart;
			//}

		}
	}
	return elStartEnd+1;
}
function fixSelfClosed(source,elStartEnd,tagName,closeMap){
	//if(tagName in closeMap){
	var pos = closeMap[tagName];
	if(pos == null){
		//console.log(tagName)
		pos =  source.lastIndexOf('</'+tagName+'>')
		if(pos<elStartEnd){//忘记闭合
			pos = source.lastIndexOf('</'+tagName)
		}
		closeMap[tagName] =pos
	}
	return pos<elStartEnd;
	//}
}
function _copy(source,target){
	for(var n in source){target[n] = source[n]}
}
function parseDCC(source,start,domBuilder,errorHandler){//sure start with '<!'
	var next= source.charAt(start+2)
	switch(next){
	case '-':
		if(source.charAt(start + 3) === '-'){
			var end = source.indexOf('-->',start+4);
			//append comment source.substring(4,end)//<!--
			if(end>start){
				domBuilder.comment(source,start+4,end-start-4);
				return end+3;
			}else{
				errorHandler.error("Unclosed comment");
				return -1;
			}
		}else{
			//error
			return -1;
		}
	default:
		if(source.substr(start+3,6) == 'CDATA['){
			var end = source.indexOf(']]>',start+9);
			domBuilder.startCDATA();
			domBuilder.characters(source,start+9,end-start-9);
			domBuilder.endCDATA()
			return end+3;
		}
		//<!DOCTYPE
		//startDTD(java.lang.String name, java.lang.String publicId, java.lang.String systemId)
		var matchs = split(source,start);
		var len = matchs.length;
		if(len>1 && /!doctype/i.test(matchs[0][0])){
			var name = matchs[1][0];
			var pubid = false;
			var sysid = false;
			if(len>3){
				if(/^public$/i.test(matchs[2][0])){
					pubid = matchs[3][0];
					sysid = len>4 && matchs[4][0];
				}else if(/^system$/i.test(matchs[2][0])){
					sysid = matchs[3][0];
				}
			}
			var lastMatch = matchs[len-1]
			domBuilder.startDTD(name, pubid, sysid);
			domBuilder.endDTD();

			return lastMatch.index+lastMatch[0].length
		}
	}
	return -1;
}



function parseInstruction(source,start,domBuilder){
	var end = source.indexOf('?>',start);
	if(end){
		var match = source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);
		if(match){
			var len = match[0].length;
			domBuilder.processingInstruction(match[1], match[2]) ;
			return end+2;
		}else{//error
			return -1;
		}
	}
	return -1;
}

function ElementAttributes(){
	this.attributeNames = {}
}
ElementAttributes.prototype = {
	setTagName:function(tagName){
		if(!tagNamePattern.test(tagName)){
			throw new Error('invalid tagName:'+tagName)
		}
		this.tagName = tagName
	},
	addValue:function(qName, value, offset) {
		if(!tagNamePattern.test(qName)){
			throw new Error('invalid attribute:'+qName)
		}
		this.attributeNames[qName] = this.length;
		this[this.length++] = {qName:qName,value:value,offset:offset}
	},
	length:0,
	getLocalName:function(i){return this[i].localName},
	getLocator:function(i){return this[i].locator},
	getQName:function(i){return this[i].qName},
	getURI:function(i){return this[i].uri},
	getValue:function(i){return this[i].value}
//	,getIndex:function(uri, localName)){
//		if(localName){
//
//		}else{
//			var qName = uri
//		}
//	},
//	getValue:function(){return this.getValue(this.getIndex.apply(this,arguments))},
//	getType:function(uri,localName){}
//	getType:function(i){},
}



function split(source,start){
	var match;
	var buf = [];
	var reg = /'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;
	reg.lastIndex = start;
	reg.exec(source);//skip <
	while(match = reg.exec(source)){
		buf.push(match);
		if(match[1])return buf;
	}
}

exports.XMLReader = XMLReader;
exports.ParseError = ParseError;


/***/ }),

/***/ "./node_modules/process/browser.js":
/*!*****************************************!*\
  !*** ./node_modules/process/browser.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),

/***/ "./node_modules/webpack/buildin/amd-options.js":
/*!****************************************!*\
  !*** (webpack)/buildin/amd-options.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(this, {}))

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || new Function("return this")();
} catch (e) {
	// This works if the window reference is available
	if (typeof window === "object") g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ }),

/***/ "./node_modules/webpack/buildin/module.js":
/*!***********************************!*\
  !*** (webpack)/buildin/module.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = function(module) {
	if (!module.webpackPolyfill) {
		module.deprecate = function() {};
		module.paths = [];
		// module.parent = undefined by default
		if (!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),

/***/ "./package.json":
/*!**********************!*\
  !*** ./package.json ***!
  \**********************/
/*! exports provided: name, version, description, main, types, scripts, repository, keywords, author, license, bugs, homepage, dependencies, devDependencies, default */
/***/ (function(module) {

module.exports = JSON.parse("{\"name\":\"cos-js-sdk-v5\",\"version\":\"1.4.10\",\"description\":\"JavaScript SDK for [腾讯云对象存储](https://cloud.tencent.com/product/cos)\",\"main\":\"dist/cos-js-sdk-v5.js\",\"types\":\"index.d.ts\",\"scripts\":{\"server\":\"node server/sts.js\",\"dev\":\"cross-env NODE_ENV=development webpack -w --mode=development\",\"build\":\"cross-env NODE_ENV=production webpack --mode=production\",\"cos-auth.min.js\":\"uglifyjs ./demo/common/cos-auth.js -o ./demo/common/cos-auth.min.js -c -m\"},\"repository\":{\"type\":\"git\",\"url\":\"git+https://github.com/tencentyun/cos-js-sdk-v5.git\"},\"keywords\":[],\"author\":\"carsonxu\",\"license\":\"ISC\",\"bugs\":{\"url\":\"https://github.com/tencentyun/cos-js-sdk-v5/issues\"},\"homepage\":\"https://github.com/tencentyun/cos-js-sdk-v5#readme\",\"dependencies\":{\"@xmldom/xmldom\":\"^0.8.2\"},\"devDependencies\":{\"@babel/core\":\"7.17.9\",\"@babel/plugin-transform-runtime\":\"7.18.10\",\"@babel/preset-env\":\"7.16.11\",\"babel-loader\":\"8.2.5\",\"body-parser\":\"^1.18.3\",\"cross-env\":\"^5.2.0\",\"express\":\"^4.16.4\",\"qcloud-cos-sts\":\"^3.0.2\",\"request\":\"^2.87.0\",\"terser-webpack-plugin\":\"4.2.3\",\"webpack\":\"4.46.0\",\"webpack-cli\":\"4.10.0\"}}");

/***/ }),

/***/ "./src/advance.js":
/*!************************!*\
  !*** ./src/advance.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var session = __webpack_require__(/*! ./session */ "./src/session.js");

var Async = __webpack_require__(/*! ./async */ "./src/async.js");

var EventProxy = __webpack_require__(/*! ./event */ "./src/event.js").EventProxy;

var util = __webpack_require__(/*! ./util */ "./src/util.js");

var Tracker = __webpack_require__(/*! ./tracker */ "./src/tracker.js"); // 文件分块上传全过程，暴露的分块上传接口


function sliceUploadFile(params, callback) {
  var self = this;
  var ep = new EventProxy();
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var Body = params.Body;
  var ChunkSize = params.ChunkSize || params.SliceSize || self.options.ChunkSize;
  var AsyncLimit = params.AsyncLimit;
  var StorageClass = params.StorageClass;
  var ServerSideEncryption = params.ServerSideEncryption;
  var FileSize;
  var onProgress;
  var onHashProgress = params.onHashProgress;
  var tracker = params.tracker;
  tracker && tracker.setParams({
    chunkSize: ChunkSize
  }); // 上传过程中出现错误，返回错误

  ep.on('error', function (err) {
    if (!self._isRunningTask(TaskId)) return;
    err.UploadId = params.UploadData.UploadId || '';
    return callback(err);
  }); // 上传分块完成，开始 uploadSliceComplete 操作

  ep.on('upload_complete', function (UploadCompleteData) {
    var _UploadCompleteData = util.extend({
      UploadId: params.UploadData.UploadId || ''
    }, UploadCompleteData);

    callback(null, _UploadCompleteData);
  }); // 上传分块完成，开始 uploadSliceComplete 操作

  ep.on('upload_slice_complete', function (UploadData) {
    var metaHeaders = {};
    util.each(params.Headers, function (val, k) {
      var shortKey = k.toLowerCase();
      if (shortKey.indexOf('x-cos-meta-') === 0 || shortKey === 'pic-operations') metaHeaders[k] = val;
    });
    uploadSliceComplete.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      UploadId: UploadData.UploadId,
      SliceList: UploadData.SliceList,
      Headers: metaHeaders,
      tracker: tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      session.removeUsing(UploadData.UploadId);

      if (err) {
        onProgress(null, true);
        return ep.emit('error', err);
      }

      session.removeUploadId.call(self, UploadData.UploadId);
      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      ep.emit('upload_complete', data);
    });
  }); // 获取 UploadId 完成，开始上传每个分片

  ep.on('get_upload_data_finish', function (UploadData) {
    // 处理 UploadId 缓存
    var uuid = session.getFileId(Body, params.ChunkSize, Bucket, Key);
    uuid && session.saveUploadId.call(self, uuid, UploadData.UploadId, self.options.UploadIdCacheLimit); // 缓存 UploadId

    session.setUsing(UploadData.UploadId); // 标记 UploadId 为正在使用
    // 获取 UploadId

    onProgress(null, true); // 任务状态开始 uploading

    uploadSliceList.call(self, {
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Body: Body,
      FileSize: FileSize,
      SliceSize: ChunkSize,
      AsyncLimit: AsyncLimit,
      ServerSideEncryption: ServerSideEncryption,
      UploadData: UploadData,
      Headers: params.Headers,
      onProgress: onProgress,
      tracker: tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;

      if (err) {
        onProgress(null, true);
        return ep.emit('error', err);
      }

      ep.emit('upload_slice_complete', data);
    });
  }); // 开始获取文件 UploadId，里面会视情况计算 ETag，并比对，保证文件一致性，也优化上传

  ep.on('get_file_size_finish', function () {
    onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress);

    if (params.UploadData.UploadId) {
      ep.emit('get_upload_data_finish', params.UploadData);
    } else {
      var _params = util.extend({
        TaskId: TaskId,
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        Headers: params.Headers,
        StorageClass: StorageClass,
        Body: Body,
        FileSize: FileSize,
        SliceSize: ChunkSize,
        onHashProgress: onHashProgress,
        tracker: tracker
      }, params);

      getUploadIdAndPartList.call(self, _params, function (err, UploadData) {
        if (!self._isRunningTask(TaskId)) return;
        if (err) return ep.emit('error', err);
        params.UploadData.UploadId = UploadData.UploadId;
        params.UploadData.PartList = UploadData.PartList;
        ep.emit('get_upload_data_finish', params.UploadData);
      });
    }
  }); // 获取上传文件大小

  FileSize = params.ContentLength;
  delete params.ContentLength;
  !params.Headers && (params.Headers = {});
  util.each(params.Headers, function (item, key) {
    if (key.toLowerCase() === 'content-length') {
      delete params.Headers[key];
    }
  }); // 控制分片大小

  (function () {
    var SIZE = [1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 1024 * 2, 1024 * 4, 1024 * 5];
    var AutoChunkSize = 1024 * 1024;

    for (var i = 0; i < SIZE.length; i++) {
      AutoChunkSize = SIZE[i] * 1024 * 1024;
      if (FileSize / AutoChunkSize <= self.options.MaxPartNumber) break;
    }

    params.ChunkSize = params.SliceSize = ChunkSize = Math.max(ChunkSize, AutoChunkSize);
  })(); // 开始上传


  if (FileSize === 0) {
    params.Body = '';
    params.ContentLength = 0;
    params.SkipTask = true;
    self.putObject(params, callback);
  } else {
    ep.emit('get_file_size_finish');
  }
} // 获取上传任务的 UploadId


function getUploadIdAndPartList(params, callback) {
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var StorageClass = params.StorageClass;
  var self = this; // 计算 ETag

  var ETagMap = {};
  var FileSize = params.FileSize;
  var SliceSize = params.SliceSize;
  var SliceCount = Math.ceil(FileSize / SliceSize);
  var FinishSliceCount = 0;
  var FinishSize = 0;
  var onHashProgress = util.throttleOnProgress.call(self, FileSize, params.onHashProgress);

  var getChunkETag = function getChunkETag(PartNumber, callback) {
    var start = SliceSize * (PartNumber - 1);
    var end = Math.min(start + SliceSize, FileSize);
    var ChunkSize = end - start;

    if (ETagMap[PartNumber]) {
      callback(null, {
        PartNumber: PartNumber,
        ETag: ETagMap[PartNumber],
        Size: ChunkSize
      });
    } else {
      util.fileSlice(params.Body, start, end, false, function (chunkItem) {
        util.getFileMd5(chunkItem, function (err, md5) {
          if (err) return callback(util.error(err));
          var ETag = '"' + md5 + '"';
          ETagMap[PartNumber] = ETag;
          FinishSliceCount += 1;
          FinishSize += ChunkSize;
          onHashProgress({
            loaded: FinishSize,
            total: FileSize
          });
          callback(null, {
            PartNumber: PartNumber,
            ETag: ETag,
            Size: ChunkSize
          });
        });
      });
    }
  }; // 通过和文件的 md5 对比，判断 UploadId 是否可用


  var isAvailableUploadList = function isAvailableUploadList(PartList, callback) {
    var PartCount = PartList.length; // 如果没有分片，通过

    if (PartCount === 0) {
      return callback(null, true);
    } // 检查分片数量


    if (PartCount > SliceCount) {
      return callback(null, false);
    } // 检查分片大小


    if (PartCount > 1) {
      var PartSliceSize = Math.max(PartList[0].Size, PartList[1].Size);

      if (PartSliceSize !== SliceSize) {
        return callback(null, false);
      }
    } // 逐个分片计算并检查 ETag 是否一致


    var next = function next(index) {
      if (index < PartCount) {
        var Part = PartList[index];
        getChunkETag(Part.PartNumber, function (err, chunk) {
          if (chunk && chunk.ETag === Part.ETag && chunk.Size === Part.Size) {
            next(index + 1);
          } else {
            callback(null, false);
          }
        });
      } else {
        callback(null, true);
      }
    };

    next(0);
  };

  var ep = new EventProxy();
  ep.on('error', function (errData) {
    if (!self._isRunningTask(TaskId)) return;
    return callback(errData);
  }); // 存在 UploadId

  ep.on('upload_id_available', function (UploadData) {
    // 转换成 map
    var map = {};
    var list = [];
    util.each(UploadData.PartList, function (item) {
      map[item.PartNumber] = item;
    });

    for (var PartNumber = 1; PartNumber <= SliceCount; PartNumber++) {
      var item = map[PartNumber];

      if (item) {
        item.PartNumber = PartNumber;
        item.Uploaded = true;
      } else {
        item = {
          PartNumber: PartNumber,
          ETag: null,
          Uploaded: false
        };
      }

      list.push(item);
    }

    UploadData.PartList = list;
    callback(null, UploadData);
  }); // 不存在 UploadId, 初始化生成 UploadId

  ep.on('no_available_upload_id', function () {
    if (!self._isRunningTask(TaskId)) return;

    var _params = util.extend({
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Query: util.clone(params.Query),
      StorageClass: StorageClass,
      Body: params.Body,
      calledBySdk: 'sliceUploadFile',
      tracker: params.tracker
    }, params);

    var headers = util.clone(params.Headers);
    delete headers['x-cos-mime-limit'];
    _params.Headers = headers;
    self.multipartInit(_params, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (err) return ep.emit('error', err);
      var UploadId = data.UploadId;

      if (!UploadId) {
        return callback(util.error(new Error('no such upload id')));
      }

      ep.emit('upload_id_available', {
        UploadId: UploadId,
        PartList: []
      });
    });
  }); // 如果已存在 UploadId，找一个可以用的 UploadId

  ep.on('has_and_check_upload_id', function (UploadIdList) {
    // 串行地，找一个内容一致的 UploadId
    UploadIdList = UploadIdList.reverse();
    Async.eachLimit(UploadIdList, 1, function (UploadId, asyncCallback) {
      if (!self._isRunningTask(TaskId)) return; // 如果正在上传，跳过

      if (session.using[UploadId]) {
        asyncCallback(); // 检查下一个 UploadId

        return;
      } // 判断 UploadId 是否可用


      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId,
        tracker: params.tracker
      }, function (err, PartListData) {
        if (!self._isRunningTask(TaskId)) return;

        if (err) {
          session.removeUsing(UploadId);
          return ep.emit('error', err);
        }

        var PartList = PartListData.PartList;
        PartList.forEach(function (item) {
          item.PartNumber *= 1;
          item.Size *= 1;
          item.ETag = item.ETag || '';
        });
        isAvailableUploadList(PartList, function (err, isAvailable) {
          if (!self._isRunningTask(TaskId)) return;
          if (err) return ep.emit('error', err);

          if (isAvailable) {
            asyncCallback({
              UploadId: UploadId,
              PartList: PartList
            }); // 马上结束
          } else {
            asyncCallback(); // 检查下一个 UploadId
          }
        });
      });
    }, function (AvailableUploadData) {
      if (!self._isRunningTask(TaskId)) return;
      onHashProgress(null, true);

      if (AvailableUploadData && AvailableUploadData.UploadId) {
        ep.emit('upload_id_available', AvailableUploadData);
      } else {
        ep.emit('no_available_upload_id');
      }
    });
  }); // 在本地缓存找可用的 UploadId

  ep.on('seek_local_avail_upload_id', function (RemoteUploadIdList) {
    // 在本地找可用的 UploadId
    var uuid = session.getFileId(params.Body, params.ChunkSize, Bucket, Key);
    var LocalUploadIdList = session.getUploadIdList.call(self, uuid);

    if (!uuid || !LocalUploadIdList) {
      ep.emit('has_and_check_upload_id', RemoteUploadIdList);
      return;
    }

    var next = function next(index) {
      // 如果本地找不到可用 UploadId，再一个个遍历校验远端
      if (index >= LocalUploadIdList.length) {
        ep.emit('has_and_check_upload_id', RemoteUploadIdList);
        return;
      }

      var UploadId = LocalUploadIdList[index]; // 如果不在远端 UploadId 列表里，跳过并删除

      if (!util.isInArray(RemoteUploadIdList, UploadId)) {
        session.removeUploadId.call(self, UploadId);
        next(index + 1);
        return;
      } // 如果正在上传，跳过


      if (session.using[UploadId]) {
        next(index + 1);
        return;
      } // 判断 UploadId 是否存在线上


      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId,
        tracker: params.tracker
      }, function (err, PartListData) {
        if (!self._isRunningTask(TaskId)) return;

        if (err) {
          // 如果 UploadId 获取会出错，跳过并删除
          session.removeUploadId.call(self, UploadId);
          next(index + 1);
        } else {
          // 找到可用 UploadId
          ep.emit('upload_id_available', {
            UploadId: UploadId,
            PartList: PartListData.PartList
          });
        }
      });
    };

    next(0);
  }); // 获取线上 UploadId 列表

  ep.on('get_remote_upload_id_list', function () {
    // 获取符合条件的 UploadId 列表，因为同一个文件可以有多个上传任务。
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      tracker: params.tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (err) return ep.emit('error', err); // 整理远端 UploadId 列表

      var RemoteUploadIdList = util.filter(data.UploadList, function (item) {
        return item.Key === Key && (!StorageClass || item.StorageClass.toUpperCase() === StorageClass.toUpperCase());
      }).reverse().map(function (item) {
        return item.UploadId || item.UploadID;
      });

      if (RemoteUploadIdList.length) {
        ep.emit('seek_local_avail_upload_id', RemoteUploadIdList);
      } else {
        // 远端没有 UploadId，清理缓存的 UploadId
        var uuid = session.getFileId(params.Body, params.ChunkSize, Bucket, Key),
            LocalUploadIdList;

        if (uuid && (LocalUploadIdList = session.getUploadIdList.call(self, uuid))) {
          util.each(LocalUploadIdList, function (UploadId) {
            session.removeUploadId.call(self, UploadId);
          });
        }

        ep.emit('no_available_upload_id');
      }
    });
  }); // 开始找可用 UploadId

  ep.emit('get_remote_upload_id_list');
} // 获取符合条件的全部上传任务 (条件包括 Bucket, Region, Prefix)


function wholeMultipartList(params, callback) {
  var self = this;
  var UploadList = [];
  var sendParams = {
    Bucket: params.Bucket,
    Region: params.Region,
    Prefix: params.Key,
    calledBySdk: params.calledBySdk || 'sliceUploadFile',
    tracker: params.tracker
  };

  var next = function next() {
    self.multipartList(sendParams, function (err, data) {
      if (err) return callback(err);
      UploadList.push.apply(UploadList, data.Upload || []);

      if (data.IsTruncated === 'true') {
        // 列表不完整
        sendParams.KeyMarker = data.NextKeyMarker;
        sendParams.UploadIdMarker = data.NextUploadIdMarker;
        next();
      } else {
        callback(null, {
          UploadList: UploadList
        });
      }
    });
  };

  next();
} // 获取指定上传任务的分块列表


function wholeMultipartListPart(params, callback) {
  var self = this;
  var PartList = [];
  var sendParams = {
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    UploadId: params.UploadId,
    calledBySdk: 'sliceUploadFile',
    tracker: params.tracker
  };

  var next = function next() {
    self.multipartListPart(sendParams, function (err, data) {
      if (err) return callback(err);
      PartList.push.apply(PartList, data.Part || []);

      if (data.IsTruncated === 'true') {
        // 列表不完整
        sendParams.PartNumberMarker = data.NextPartNumberMarker;
        next();
      } else {
        callback(null, {
          PartList: PartList
        });
      }
    });
  };

  next();
} // 上传文件分块，包括

/*
 UploadId (上传任务编号)
 AsyncLimit (并发量)，
 SliceList (上传的分块数组)，
 FilePath (本地文件的位置)，
 SliceSize (文件分块大小)
 FileSize (文件大小)
 onProgress (上传成功之后的回调函数)
 */


function uploadSliceList(params, cb) {
  var self = this;
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadData = params.UploadData;
  var FileSize = params.FileSize;
  var SliceSize = params.SliceSize;
  var ChunkParallel = Math.min(params.AsyncLimit || self.options.ChunkParallelLimit || 1, 256);
  var Body = params.Body;
  var SliceCount = Math.ceil(FileSize / SliceSize);
  var FinishSize = 0;
  var ServerSideEncryption = params.ServerSideEncryption;
  var Headers = params.Headers;
  var needUploadSlices = util.filter(UploadData.PartList, function (SliceItem) {
    if (SliceItem['Uploaded']) {
      FinishSize += SliceItem['PartNumber'] >= SliceCount ? FileSize % SliceSize || SliceSize : SliceSize;
    }

    return !SliceItem['Uploaded'];
  });
  var _onProgress2 = params.onProgress;
  Async.eachLimit(needUploadSlices, ChunkParallel, function (SliceItem, asyncCallback) {
    if (!self._isRunningTask(TaskId)) return;
    var PartNumber = SliceItem['PartNumber'];
    var currentSize = Math.min(FileSize, SliceItem['PartNumber'] * SliceSize) - (SliceItem['PartNumber'] - 1) * SliceSize;
    var preAddSize = 0;
    uploadSliceItem.call(self, {
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      SliceSize: SliceSize,
      FileSize: FileSize,
      PartNumber: PartNumber,
      ServerSideEncryption: ServerSideEncryption,
      Body: Body,
      UploadData: UploadData,
      Headers: Headers,
      onProgress: function onProgress(data) {
        FinishSize += data.loaded - preAddSize;
        preAddSize = data.loaded;

        _onProgress2({
          loaded: FinishSize,
          total: FileSize
        });
      },
      tracker: params.tracker
    }, function (err, data) {
      if (!self._isRunningTask(TaskId)) return;
      if (!err && !data.ETag) err = 'get ETag error, please add "ETag" to CORS ExposeHeader setting.( 获取ETag失败，请在CORS ExposeHeader设置中添加ETag，请参考文档：https://cloud.tencent.com/document/product/436/13318 )';

      if (err) {
        FinishSize -= preAddSize;
      } else {
        FinishSize += currentSize - preAddSize;
        SliceItem.ETag = data.ETag;
      }

      _onProgress2({
        loaded: FinishSize,
        total: FileSize
      });

      asyncCallback(err || null, data);
    });
  }, function (err) {
    if (!self._isRunningTask(TaskId)) return;
    if (err) return cb(err);
    cb(null, {
      UploadId: UploadData.UploadId,
      SliceList: UploadData.PartList
    });
  });
} // 上传指定分片


function uploadSliceItem(params, callback) {
  var self = this;
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var FileSize = params.FileSize;
  var FileBody = params.Body;
  var PartNumber = params.PartNumber * 1;
  var SliceSize = params.SliceSize;
  var ServerSideEncryption = params.ServerSideEncryption;
  var UploadData = params.UploadData;
  var Headers = params.Headers || {};
  var ChunkRetryTimes = self.options.ChunkRetryTimes + 1;
  var start = SliceSize * (PartNumber - 1);
  var ContentLength = SliceSize;
  var end = start + SliceSize;

  if (end > FileSize) {
    end = FileSize;
    ContentLength = end - start;
  }

  var headersWhiteList = ['x-cos-traffic-limit', 'x-cos-mime-limit'];
  var headers = {};
  util.each(Headers, function (v, k) {
    if (headersWhiteList.indexOf(k) > -1) {
      headers[k] = v;
    }
  });
  var PartItem = UploadData.PartList[PartNumber - 1];
  Async.retry(ChunkRetryTimes, function (tryCallback) {
    if (!self._isRunningTask(TaskId)) return;
    util.fileSlice(FileBody, start, end, true, function (Body) {
      self.multipartUpload({
        TaskId: TaskId,
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        ContentLength: ContentLength,
        PartNumber: PartNumber,
        UploadId: UploadData.UploadId,
        ServerSideEncryption: ServerSideEncryption,
        Body: Body,
        Headers: headers,
        onProgress: params.onProgress,
        calledBySdk: 'sliceUploadFile',
        tracker: params.tracker
      }, function (err, data) {
        if (!self._isRunningTask(TaskId)) return;
        if (err) return tryCallback(err);
        PartItem.Uploaded = true;
        return tryCallback(null, data);
      });
    });
  }, function (err, data) {
    if (!self._isRunningTask(TaskId)) return;
    return callback(err, data);
  });
} // 完成分块上传


function uploadSliceComplete(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadId = params.UploadId;
  var SliceList = params.SliceList;
  var self = this;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var Headers = params.Headers;
  var Parts = SliceList.map(function (item) {
    return {
      PartNumber: item.PartNumber,
      ETag: item.ETag
    };
  }); // 完成上传的请求也做重试

  Async.retry(ChunkRetryTimes, function (tryCallback) {
    self.multipartComplete({
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      UploadId: UploadId,
      Parts: Parts,
      Headers: Headers,
      calledBySdk: 'sliceUploadFile',
      tracker: params.tracker
    }, tryCallback);
  }, function (err, data) {
    callback(err, data);
  });
} // 抛弃分块上传任务

/*
 AsyncLimit (抛弃上传任务的并发量)，
 UploadId (上传任务的编号，当 Level 为 task 时候需要)
 Level (抛弃分块上传任务的级别，task : 抛弃指定的上传任务，file ： 抛弃指定的文件对应的上传任务，其他值 ：抛弃指定Bucket 的全部上传任务)
 */


function abortUploadTask(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var UploadId = params.UploadId;
  var Level = params.Level || 'task';
  var AsyncLimit = params.AsyncLimit;
  var self = this;
  var ep = new EventProxy();
  ep.on('error', function (errData) {
    return callback(errData);
  }); // 已经获取到需要抛弃的任务列表

  ep.on('get_abort_array', function (AbortArray) {
    abortUploadTaskArray.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      Headers: params.Headers,
      AsyncLimit: AsyncLimit,
      AbortArray: AbortArray
    }, callback);
  });

  if (Level === 'bucket') {
    // Bucket 级别的任务抛弃，抛弃该 Bucket 下的全部上传任务
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      calledBySdk: 'abortUploadTask'
    }, function (err, data) {
      if (err) return callback(err);
      ep.emit('get_abort_array', data.UploadList || []);
    });
  } else if (Level === 'file') {
    // 文件级别的任务抛弃，抛弃该文件的全部上传任务
    if (!Key) return callback(util.error(new Error('abort_upload_task_no_key')));
    wholeMultipartList.call(self, {
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      calledBySdk: 'abortUploadTask'
    }, function (err, data) {
      if (err) return callback(err);
      ep.emit('get_abort_array', data.UploadList || []);
    });
  } else if (Level === 'task') {
    // 单个任务级别的任务抛弃，抛弃指定 UploadId 的上传任务
    if (!UploadId) return callback(util.error(new Error('abort_upload_task_no_id')));
    if (!Key) return callback(util.error(new Error('abort_upload_task_no_key')));
    ep.emit('get_abort_array', [{
      Key: Key,
      UploadId: UploadId
    }]);
  } else {
    return callback(util.error(new Error('abort_unknown_level')));
  }
} // 批量抛弃分块上传任务


function abortUploadTaskArray(params, callback) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var AbortArray = params.AbortArray;
  var AsyncLimit = params.AsyncLimit || 1;
  var self = this;
  var index = 0;
  var resultList = new Array(AbortArray.length);
  Async.eachLimit(AbortArray, AsyncLimit, function (AbortItem, nextItem) {
    var eachIndex = index;

    if (Key && Key !== AbortItem.Key) {
      resultList[eachIndex] = {
        error: {
          KeyNotMatch: true
        }
      };
      nextItem(null);
      return;
    }

    var UploadId = AbortItem.UploadId || AbortItem.UploadID;
    self.multipartAbort({
      Bucket: Bucket,
      Region: Region,
      Key: AbortItem.Key,
      Headers: params.Headers,
      UploadId: UploadId
    }, function (err) {
      var task = {
        Bucket: Bucket,
        Region: Region,
        Key: AbortItem.Key,
        UploadId: UploadId
      };
      resultList[eachIndex] = {
        error: err,
        task: task
      };
      nextItem(null);
    });
    index++;
  }, function (err) {
    if (err) return callback(err);
    var successList = [];
    var errorList = [];

    for (var i = 0, len = resultList.length; i < len; i++) {
      var item = resultList[i];

      if (item['task']) {
        if (item['error']) {
          errorList.push(item['task']);
        } else {
          successList.push(item['task']);
        }
      }
    }

    return callback(null, {
      successList: successList,
      errorList: errorList
    });
  });
} // 高级上传


function uploadFile(params, callback) {
  var self = this; // 判断多大的文件使用分片上传

  var SliceSize = params.SliceSize === undefined ? self.options.SliceSize : params.SliceSize;
  var taskList = [];
  var Body = params.Body;
  var FileSize = Body.size || Body.length || 0;
  var fileInfo = {
    TaskId: ''
  }; // 上传链路

  if (self.options.EnableTracker) {
    var accelerate = self.options.UseAccelerate || typeof self.options.Domain === 'string' && self.options.Domain.includes('accelerate.');
    params.tracker = new Tracker({
      bucket: params.Bucket,
      region: params.Region,
      apiName: 'uploadFile',
      fileKey: params.Key,
      fileSize: FileSize,
      accelerate: accelerate,
      deepTracker: self.options.DeepTracker,
      customId: self.options.CustomId,
      delay: self.options.TrackerDelay
    });
  } // 整理 option，用于返回给回调


  util.each(params, function (v, k) {
    if (_typeof(v) !== 'object' && typeof v !== 'function') {
      fileInfo[k] = v;
    }
  }); // 处理文件 TaskReady

  var _onTaskReady = params.onTaskReady;

  var onTaskReady = function onTaskReady(tid) {
    fileInfo.TaskId = tid;
    _onTaskReady && _onTaskReady(tid);
  };

  params.onTaskReady = onTaskReady; // 添加上传任务,超过阈值使用分块上传，小于等于则简单上传

  var api = FileSize > SliceSize ? 'sliceUploadFile' : 'putObject'; // 处理文件完成

  var _onFileFinish = params.onFileFinish;

  var onFileFinish = function onFileFinish(err, data) {
    // 格式化上报参数并上报
    params.tracker && params.tracker.formatResult(err, data);
    _onFileFinish && _onFileFinish(err, data, fileInfo);
    callback && callback(err, data);
  };

  taskList.push({
    api: api,
    params: params,
    callback: onFileFinish
  });

  self._addTasks(taskList);
} // 批量上传文件


function uploadFiles(params, callback) {
  var self = this; // 判断多大的文件使用分片上传

  var SliceSize = params.SliceSize === undefined ? self.options.SliceSize : params.SliceSize; // 汇总返回进度

  var TotalSize = 0;
  var TotalFinish = 0;
  var onTotalProgress = util.throttleOnProgress.call(self, TotalFinish, params.onProgress); // 汇总返回回调

  var unFinishCount = params.files.length;
  var _onTotalFileFinish = params.onFileFinish;
  var resultList = Array(unFinishCount);

  var onTotalFileFinish = function onTotalFileFinish(err, data, options) {
    onTotalProgress(null, true);
    _onTotalFileFinish && _onTotalFileFinish(err, data, options);
    resultList[options.Index] = {
      options: options,
      error: err,
      data: data
    };

    if (--unFinishCount <= 0 && callback) {
      callback(null, {
        files: resultList
      });
    }
  }; // 开始处理每个文件


  var taskList = [];
  util.each(params.files, function (fileParams, index) {
    (function () {
      // 对齐 nodejs 缩进
      var Body = fileParams.Body;
      var FileSize = Body.size || Body.length || 0;
      var fileInfo = {
        Index: index,
        TaskId: ''
      }; // 更新文件总大小

      TotalSize += FileSize; // 单个文件上传链路

      if (self.options.EnableTracker) {
        var accelerate = self.options.UseAccelerate || typeof self.options.Domain === 'string' && self.options.Domain.includes('accelerate.');
        fileParams.tracker = new Tracker({
          bucket: fileParams.Bucket,
          region: fileParams.Region,
          apiName: 'uploadFiles',
          fileKey: fileParams.Key,
          fileSize: FileSize,
          accelerate: accelerate,
          deepTracker: self.options.DeepTracker,
          customId: self.options.CustomId,
          delay: self.options.TrackerDelay
        });
      } // 整理 option，用于返回给回调


      util.each(fileParams, function (v, k) {
        if (_typeof(v) !== 'object' && typeof v !== 'function') {
          fileInfo[k] = v;
        }
      }); // 处理单个文件 TaskReady

      var _onTaskReady = fileParams.onTaskReady;

      var onTaskReady = function onTaskReady(tid) {
        fileInfo.TaskId = tid;
        _onTaskReady && _onTaskReady(tid);
      };

      fileParams.onTaskReady = onTaskReady; // 处理单个文件进度

      var PreAddSize = 0;
      var _onProgress = fileParams.onProgress;

      var onProgress = function onProgress(info) {
        TotalFinish = TotalFinish - PreAddSize + info.loaded;
        PreAddSize = info.loaded;
        _onProgress && _onProgress(info);
        onTotalProgress({
          loaded: TotalFinish,
          total: TotalSize
        });
      };

      fileParams.onProgress = onProgress; // 添加上传任务

      var api = FileSize > SliceSize ? 'sliceUploadFile' : 'putObject'; // 处理单个文件完成

      var _onFileFinish = fileParams.onFileFinish;

      var onFileFinish = function onFileFinish(err, data) {
        // 格式化上报参数并上报
        fileParams.tracker && fileParams.tracker.formatResult(err, data);
        _onFileFinish && _onFileFinish(err, data);
        onTotalFileFinish && onTotalFileFinish(err, data, fileInfo);
      };

      taskList.push({
        api: api,
        params: fileParams,
        callback: onFileFinish
      });
    })();
  });

  self._addTasks(taskList);
} // 分片复制文件


function sliceCopyFile(params, callback) {
  var ep = new EventProxy();
  var self = this;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var CopySource = params.CopySource;
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m.Bucket;
  var SourceRegion = m.Region;
  var SourceKey = decodeURIComponent(m.Key);
  var CopySliceSize = params.CopySliceSize === undefined ? self.options.CopySliceSize : params.CopySliceSize;
  CopySliceSize = Math.max(0, CopySliceSize);
  var ChunkSize = params.CopyChunkSize || this.options.CopyChunkSize;
  var ChunkParallel = this.options.CopyChunkParallelLimit;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var ChunkCount = 0;
  var FinishSize = 0;
  var FileSize;
  var onProgress;
  var SourceResHeaders = {};
  var SourceHeaders = {};
  var TargetHeader = {}; // 分片复制完成，开始 multipartComplete 操作

  ep.on('copy_slice_complete', function (UploadData) {
    var metaHeaders = {};
    util.each(params.Headers, function (val, k) {
      if (k.toLowerCase().indexOf('x-cos-meta-') === 0) metaHeaders[k] = val;
    });
    var Parts = util.map(UploadData.PartList, function (item) {
      return {
        PartNumber: item.PartNumber,
        ETag: item.ETag
      };
    }); // 完成上传的请求也做重试

    Async.retry(ChunkRetryTimes, function (tryCallback) {
      self.multipartComplete({
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadData.UploadId,
        Parts: Parts,
        calledBySdk: 'sliceCopyFile'
      }, tryCallback);
    }, function (err, data) {
      session.removeUsing(UploadData.UploadId); // 标记 UploadId 没被使用了，因为复制没提供重试，所以只要出错，就是 UploadId 停用了。

      if (err) {
        onProgress(null, true);
        return callback(err);
      }

      session.removeUploadId(UploadData.UploadId);
      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      callback(null, data);
    });
  });
  ep.on('get_copy_data_finish', function (UploadData) {
    // 处理 UploadId 缓存
    var uuid = session.getCopyFileId(CopySource, SourceResHeaders, ChunkSize, Bucket, Key);
    uuid && session.saveUploadId(uuid, UploadData.UploadId, self.options.UploadIdCacheLimit); // 缓存 UploadId

    session.setUsing(UploadData.UploadId); // 标记 UploadId 为正在使用

    var needCopySlices = util.filter(UploadData.PartList, function (SliceItem) {
      if (SliceItem['Uploaded']) {
        FinishSize += SliceItem['PartNumber'] >= ChunkCount ? FileSize % ChunkSize || ChunkSize : ChunkSize;
      }

      return !SliceItem['Uploaded'];
    });
    Async.eachLimit(needCopySlices, ChunkParallel, function (SliceItem, asyncCallback) {
      var PartNumber = SliceItem.PartNumber;
      var CopySourceRange = SliceItem.CopySourceRange;
      var currentSize = SliceItem.end - SliceItem.start;
      Async.retry(ChunkRetryTimes, function (tryCallback) {
        copySliceItem.call(self, {
          Bucket: Bucket,
          Region: Region,
          Key: Key,
          CopySource: CopySource,
          UploadId: UploadData.UploadId,
          PartNumber: PartNumber,
          CopySourceRange: CopySourceRange
        }, tryCallback);
      }, function (err, data) {
        if (err) return asyncCallback(err);
        FinishSize += currentSize;
        onProgress({
          loaded: FinishSize,
          total: FileSize
        });
        SliceItem.ETag = data.ETag;
        asyncCallback(err || null, data);
      });
    }, function (err) {
      if (err) {
        session.removeUsing(UploadData.UploadId); // 标记 UploadId 没被使用了，因为复制没提供重试，所以只要出错，就是 UploadId 停用了。

        onProgress(null, true);
        return callback(err);
      }

      ep.emit('copy_slice_complete', UploadData);
    });
  });
  ep.on('get_chunk_size_finish', function () {
    var createNewUploadId = function createNewUploadId() {
      self.multipartInit({
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        Headers: TargetHeader
      }, function (err, data) {
        if (err) return callback(err);
        params.UploadId = data.UploadId;
        ep.emit('get_copy_data_finish', {
          UploadId: params.UploadId,
          PartList: params.PartList
        });
      });
    }; // 在本地找可用的 UploadId


    var uuid = session.getCopyFileId(CopySource, SourceResHeaders, ChunkSize, Bucket, Key);
    var LocalUploadIdList = session.getUploadIdList(uuid);
    if (!uuid || !LocalUploadIdList) return createNewUploadId();

    var next = function next(index) {
      // 如果本地找不到可用 UploadId，再一个个遍历校验远端
      if (index >= LocalUploadIdList.length) return createNewUploadId();
      var UploadId = LocalUploadIdList[index]; // 如果正在被使用，跳过

      if (session.using[UploadId]) return next(index + 1); // 判断 UploadId 是否存在线上

      wholeMultipartListPart.call(self, {
        Bucket: Bucket,
        Region: Region,
        Key: Key,
        UploadId: UploadId
      }, function (err, PartListData) {
        if (err) {
          // 如果 UploadId 获取会出错，跳过并删除
          session.removeUploadId(UploadId);
          next(index + 1);
        } else {
          // 如果异步回来 UploadId 已经被用了，也跳过
          if (session.using[UploadId]) return next(index + 1); // 找到可用 UploadId

          var finishETagMap = {};
          var offset = 0;
          util.each(PartListData.PartList, function (PartItem) {
            var size = parseInt(PartItem.Size);
            var end = offset + size - 1;
            finishETagMap[PartItem.PartNumber + '|' + offset + '|' + end] = PartItem.ETag;
            offset += size;
          });
          util.each(params.PartList, function (PartItem) {
            var ETag = finishETagMap[PartItem.PartNumber + '|' + PartItem.start + '|' + PartItem.end];

            if (ETag) {
              PartItem.ETag = ETag;
              PartItem.Uploaded = true;
            }
          });
          ep.emit('get_copy_data_finish', {
            UploadId: UploadId,
            PartList: params.PartList
          });
        }
      });
    };

    next(0);
  });
  ep.on('get_file_size_finish', function () {
    // 控制分片大小
    (function () {
      var SIZE = [1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 1024 * 2, 1024 * 4, 1024 * 5];
      var AutoChunkSize = 1024 * 1024;

      for (var i = 0; i < SIZE.length; i++) {
        AutoChunkSize = SIZE[i] * 1024 * 1024;
        if (FileSize / AutoChunkSize <= self.options.MaxPartNumber) break;
      }

      params.ChunkSize = ChunkSize = Math.max(ChunkSize, AutoChunkSize);
      ChunkCount = Math.ceil(FileSize / ChunkSize);
      var list = [];

      for (var partNumber = 1; partNumber <= ChunkCount; partNumber++) {
        var start = (partNumber - 1) * ChunkSize;
        var end = partNumber * ChunkSize < FileSize ? partNumber * ChunkSize - 1 : FileSize - 1;
        var item = {
          PartNumber: partNumber,
          start: start,
          end: end,
          CopySourceRange: "bytes=" + start + "-" + end
        };
        list.push(item);
      }

      params.PartList = list;
    })();

    if (params.Headers['x-cos-metadata-directive'] === 'Replaced') {
      TargetHeader = params.Headers;
    } else {
      TargetHeader = SourceHeaders;
    }

    TargetHeader['x-cos-storage-class'] = params.Headers['x-cos-storage-class'] || SourceHeaders['x-cos-storage-class'];
    TargetHeader = util.clearKey(TargetHeader);
    /**
     * 对于归档存储的对象，如果未恢复副本，则不允许 Copy
     */

    if (SourceHeaders['x-cos-storage-class'] === 'ARCHIVE' || SourceHeaders['x-cos-storage-class'] === 'DEEP_ARCHIVE') {
      var restoreHeader = SourceHeaders['x-cos-restore'];

      if (!restoreHeader || restoreHeader === 'ongoing-request="true"') {
        callback(util.error(new Error('Unrestored archive object is not allowed to be copied')));
        return;
      }
    }
    /**
     * 去除一些无用的头部，规避 multipartInit 出错
     * 这些头部通常是在 putObjectCopy 时才使用
     */


    delete TargetHeader['x-cos-copy-source'];
    delete TargetHeader['x-cos-metadata-directive'];
    delete TargetHeader['x-cos-copy-source-If-Modified-Since'];
    delete TargetHeader['x-cos-copy-source-If-Unmodified-Since'];
    delete TargetHeader['x-cos-copy-source-If-Match'];
    delete TargetHeader['x-cos-copy-source-If-None-Match'];
    ep.emit('get_chunk_size_finish');
  }); // 获取远端复制源文件的大小

  self.headObject({
    Bucket: SourceBucket,
    Region: SourceRegion,
    Key: SourceKey
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 404) {
        callback(util.error(err, {
          ErrorStatus: SourceKey + ' Not Exist'
        }));
      } else {
        callback(err);
      }

      return;
    }

    FileSize = params.FileSize = data.headers['content-length'];

    if (FileSize === undefined || !FileSize) {
      callback(util.error(new Error('get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.（ 获取Content-Length失败，请在CORS ExposeHeader设置中添加Content-Length，请参考文档：https://cloud.tencent.com/document/product/436/13318 ）')));
      return;
    }

    onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress); // 开始上传

    if (FileSize <= CopySliceSize) {
      if (!params.Headers['x-cos-metadata-directive']) {
        params.Headers['x-cos-metadata-directive'] = 'Copy';
      }

      self.putObjectCopy(params, function (err, data) {
        if (err) {
          onProgress(null, true);
          return callback(err);
        }

        onProgress({
          loaded: FileSize,
          total: FileSize
        }, true);
        callback(err, data);
      });
    } else {
      var resHeaders = data.headers;
      SourceResHeaders = resHeaders;
      SourceHeaders = {
        'Cache-Control': resHeaders['cache-control'],
        'Content-Disposition': resHeaders['content-disposition'],
        'Content-Encoding': resHeaders['content-encoding'],
        'Content-Type': resHeaders['content-type'],
        'Expires': resHeaders['expires'],
        'x-cos-storage-class': resHeaders['x-cos-storage-class']
      };
      util.each(resHeaders, function (v, k) {
        var metaPrefix = 'x-cos-meta-';

        if (k.indexOf(metaPrefix) === 0 && k.length > metaPrefix.length) {
          SourceHeaders[k] = v;
        }
      });
      ep.emit('get_file_size_finish');
    }
  });
} // 复制指定分片


function copySliceItem(params, callback) {
  var TaskId = params.TaskId;
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var CopySource = params.CopySource;
  var UploadId = params.UploadId;
  var PartNumber = params.PartNumber * 1;
  var CopySourceRange = params.CopySourceRange;
  var ChunkRetryTimes = this.options.ChunkRetryTimes + 1;
  var self = this;
  Async.retry(ChunkRetryTimes, function (tryCallback) {
    self.uploadPartCopy({
      TaskId: TaskId,
      Bucket: Bucket,
      Region: Region,
      Key: Key,
      CopySource: CopySource,
      UploadId: UploadId,
      PartNumber: PartNumber,
      CopySourceRange: CopySourceRange
    }, function (err, data) {
      tryCallback(err || null, data);
    });
  }, function (err, data) {
    return callback(err, data);
  });
}

var API_MAP = {
  sliceUploadFile: sliceUploadFile,
  abortUploadTask: abortUploadTask,
  uploadFile: uploadFile,
  uploadFiles: uploadFiles,
  sliceCopyFile: sliceCopyFile
};

module.exports.init = function (COS, task) {
  task.transferToTaskMethod(API_MAP, 'sliceUploadFile');
  util.each(API_MAP, function (fn, apiName) {
    COS.prototype[apiName] = util.apiWrapper(apiName, fn);
  });
};

/***/ }),

/***/ "./src/async.js":
/*!**********************!*\
  !*** ./src/async.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

var eachLimit = function eachLimit(arr, limit, iterator, callback) {
  callback = callback || function () {};

  if (!arr.length || limit <= 0) {
    return callback();
  }

  var completed = 0;
  var started = 0;
  var running = 0;

  (function replenish() {
    if (completed >= arr.length) {
      return callback();
    }

    while (running < limit && started < arr.length) {
      started += 1;
      running += 1;
      iterator(arr[started - 1], function (err) {
        if (err) {
          callback(err);

          callback = function callback() {};
        } else {
          completed += 1;
          running -= 1;

          if (completed >= arr.length) {
            callback();
          } else {
            replenish();
          }
        }
      });
    }
  })();
};

var retry = function retry(times, iterator, callback) {
  var next = function next(index) {
    iterator(function (err, data) {
      if (err && index < times) {
        next(index + 1);
      } else {
        callback(err, data);
      }
    });
  };

  if (times < 1) {
    callback();
  } else {
    next(1);
  }
};

var async = {
  eachLimit: eachLimit,
  retry: retry
};
module.exports = async;

/***/ }),

/***/ "./src/base.js":
/*!*********************!*\
  !*** ./src/base.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var REQUEST = __webpack_require__(/*! ../lib/request */ "./lib/request.js");

var util = __webpack_require__(/*! ./util */ "./src/util.js"); // Bucket 相关

/**
 * 获取用户的 bucket 列表
 * @param  {Object}  params         回调函数，必须，下面为参数列表
 * 无特殊参数
 * @param  {Function}  callback     回调函数，必须
 */


function getService(params, callback) {
  if (typeof params === 'function') {
    callback = params;
    params = {};
  }

  var protocol = this.options.Protocol || (util.isBrowser && location.protocol === 'http:' ? 'http:' : 'https:');
  var domain = this.options.ServiceDomain;
  var appId = params.AppId || this.options.appId;
  var region = params.Region;

  if (domain) {
    domain = domain.replace(/\{\{AppId\}\}/ig, appId || '').replace(/\{\{Region\}\}/ig, region || '').replace(/\{\{.*?\}\}/ig, '');

    if (!/^[a-zA-Z]+:\/\//.test(domain)) {
      domain = protocol + '//' + domain;
    }

    if (domain.slice(-1) === '/') {
      domain = domain.slice(0, -1);
    }
  } else if (region) {
    domain = protocol + '//cos.' + region + '.myqcloud.com';
  } else {
    domain = protocol + '//service.cos.myqcloud.com';
  }

  var SignHost = '';
  var standardHost = region ? 'cos.' + region + '.myqcloud.com' : 'service.cos.myqcloud.com';
  var urlHost = domain.replace(/^https?:\/\/([^/]+)(\/.*)?$/, '$1');
  if (standardHost === urlHost) SignHost = standardHost;
  submitRequest.call(this, {
    Action: 'name/cos:GetService',
    url: domain,
    method: 'GET',
    headers: params.Headers,
    SignHost: SignHost
  }, function (err, data) {
    if (err) return callback(err);
    var buckets = data && data.ListAllMyBucketsResult && data.ListAllMyBucketsResult.Buckets && data.ListAllMyBucketsResult.Buckets.Bucket || [];
    buckets = util.isArray(buckets) ? buckets : [buckets];
    var owner = data && data.ListAllMyBucketsResult && data.ListAllMyBucketsResult.Owner || {};
    callback(null, {
      Buckets: buckets,
      Owner: owner,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 创建 Bucket，并初始化访问权限
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.ACL                 用户自定义文件权限，可以设置：private，public-read；默认值：private，非必须
 *     @param  {String}  params.GrantRead           赋予被授权者读的权限，格式x-cos-grant-read: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantWrite          赋予被授权者写的权限，格式x-cos-grant-write: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantFullControl    赋予被授权者读写权限，格式x-cos-grant-full-control: uin=" ",uin=" "，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {String}  data.Location             操作地址
 */


function putBucket(params, callback) {
  var self = this;
  var xml = '';

  if (params['BucketAZConfig']) {
    var CreateBucketConfiguration = {
      BucketAZConfig: params.BucketAZConfig
    };
    xml = util.json2xml({
      CreateBucketConfiguration: CreateBucketConfiguration
    });
  }

  submitRequest.call(this, {
    Action: 'name/cos:PutBucket',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    var url = getUrl({
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      isLocation: true
    });
    callback(null, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 查看是否存在该Bucket，是否有权限访问
 * @param  {Object}  params                     参数对象，必须
 *     @param  {String}  params.Bucket          Bucket名称，必须
 *     @param  {String}  params.Region          地域名称，必须
 * @param  {Function}  callback                 回调函数，必须
 * @return  {Object}  err                       请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                      返回的数据
 *     @return  {Boolean}  data.BucketExist     Bucket是否存在
 *     @return  {Boolean}  data.BucketAuth      是否有 Bucket 的访问权限
 */


function headBucket(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:HeadBucket',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    method: 'HEAD'
  }, callback);
}
/**
 * 获取 Bucket 下的 object 列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Prefix              前缀匹配，用来规定返回的文件前缀地址，非必须
 *     @param  {String}  params.Delimiter           定界符为一个符号，如果有Prefix，则将Prefix到delimiter之间的相同路径归为一类，非必须
 *     @param  {String}  params.Marker              默认以UTF-8二进制顺序列出条目，所有列出条目从marker开始，非必须
 *     @param  {String}  params.MaxKeys             单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.EncodingType        规定返回值的编码方式，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.ListBucketResult     返回的 object 列表信息
 */


function getBucket(params, callback) {
  var reqParams = {};
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['marker'] = params['Marker'];
  reqParams['max-keys'] = params['MaxKeys'];
  reqParams['encoding-type'] = params['EncodingType'];
  submitRequest.call(this, {
    Action: 'name/cos:GetBucket',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) return callback(err);
    var ListBucketResult = data.ListBucketResult || {};
    var Contents = ListBucketResult.Contents || [];
    var CommonPrefixes = ListBucketResult.CommonPrefixes || [];
    Contents = util.isArray(Contents) ? Contents : [Contents];
    CommonPrefixes = util.isArray(CommonPrefixes) ? CommonPrefixes : [CommonPrefixes];
    var result = util.clone(ListBucketResult);
    util.extend(result, {
      Contents: Contents,
      CommonPrefixes: CommonPrefixes,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 删除 Bucket
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 *     @return  {String}  data.Location     操作地址
 */


function deleteBucket(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucket',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    method: 'DELETE'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.ACL                 用户自定义文件权限，可以设置：private，public-read；默认值：private，非必须
 *     @param  {String}  params.GrantRead           赋予被授权者读的权限，格式x-cos-grant-read: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantWrite          赋予被授权者写的权限，格式x-cos-grant-write: uin=" ",uin=" "，非必须
 *     @param  {String}  params.GrantFullControl    赋予被授权者读写权限，格式x-cos-grant-full-control: uin=" ",uin=" "，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 */


function putBucketAcl(params, callback) {
  var headers = params.Headers;
  var xml = '';

  if (params['AccessControlPolicy']) {
    var AccessControlPolicy = util.clone(params['AccessControlPolicy'] || {});
    var Grants = AccessControlPolicy.Grants || AccessControlPolicy.Grant;
    Grants = util.isArray(Grants) ? Grants : [Grants];
    delete AccessControlPolicy.Grant;
    delete AccessControlPolicy.Grants;
    AccessControlPolicy.AccessControlList = {
      Grant: Grants
    };
    xml = util.json2xml({
      AccessControlPolicy: AccessControlPolicy
    });
    headers['Content-Type'] = 'application/xml';
    headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  } // Grant Header 去重


  util.each(headers, function (val, key) {
    if (key.indexOf('x-cos-grant-') === 0) {
      headers[key] = uniqGrant(headers[key]);
    }
  });
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketACL',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: headers,
    action: 'acl',
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.AccessControlPolicy  访问权限信息
 */


function getBucketAcl(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketACL',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'acl'
  }, function (err, data) {
    if (err) return callback(err);
    var AccessControlPolicy = data.AccessControlPolicy || {};
    var Owner = AccessControlPolicy.Owner || {};
    var Grant = AccessControlPolicy.AccessControlList.Grant || [];
    Grant = util.isArray(Grant) ? Grant : [Grant];
    var result = decodeAcl(AccessControlPolicy);

    if (data.headers && data.headers['x-cos-acl']) {
      result.ACL = data.headers['x-cos-acl'];
    }

    result = util.extend(result, {
      Owner: Owner,
      Grants: Grant,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 设置 Bucket 的 跨域设置
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {Object}  params.CORSConfiguration       相关的跨域设置，必须
 * @param  {Array}  params.CORSConfiguration.CORSRules  对应的跨域规则
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回的数据
 */


function putBucketCors(params, callback) {
  var CORSConfiguration = params['CORSConfiguration'] || {};
  var CORSRules = CORSConfiguration['CORSRules'] || params['CORSRules'] || [];
  CORSRules = util.clone(util.isArray(CORSRules) ? CORSRules : [CORSRules]);
  util.each(CORSRules, function (rule) {
    util.each(['AllowedOrigin', 'AllowedHeader', 'AllowedMethod', 'ExposeHeader'], function (key) {
      var sKey = key + 's';
      var val = rule[sKey] || rule[key] || [];
      delete rule[sKey];
      rule[key] = util.isArray(val) ? val : [val];
    });
  });
  var Conf = {
    CORSRule: CORSRules
  };
  if (params.ResponseVary) Conf.ResponseVary = params.ResponseVary;
  var xml = util.json2xml({
    CORSConfiguration: Conf
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketCORS',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'cors',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 跨域设置
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.CORSRules            Bucket的跨域设置
 */


function getBucketCors(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketCORS',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'cors'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && err.error.Code === 'NoSuchCORSConfiguration') {
        var result = {
          CORSRules: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var CORSConfiguration = data.CORSConfiguration || {};
    var CORSRules = CORSConfiguration.CORSRules || CORSConfiguration.CORSRule || [];
    CORSRules = util.clone(util.isArray(CORSRules) ? CORSRules : [CORSRules]);
    var ResponseVary = CORSConfiguration.ResponseVary;
    util.each(CORSRules, function (rule) {
      util.each(['AllowedOrigin', 'AllowedHeader', 'AllowedMethod', 'ExposeHeader'], function (key) {
        var sKey = key + 's';
        var val = rule[sKey] || rule[key] || [];
        delete rule[key];
        rule[sKey] = util.isArray(val) ? val : [val];
      });
    });
    callback(null, {
      CORSRules: CORSRules,
      ResponseVary: ResponseVary,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 跨域设置
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 */


function deleteBucketCors(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketCORS',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'cors'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode || err.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的 地域信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据，包含地域信息 LocationConstraint
 */


function getBucketLocation(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLocation',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'location'
  }, callback);
}

function putBucketPolicy(params, callback) {
  var Policy = params['Policy'];

  try {
    if (typeof Policy === 'string') Policy = JSON.parse(Policy);
  } catch (e) {}

  if (!Policy || typeof Policy === 'string') return callback(util.error(new Error('Policy format error')));
  var PolicyStr = JSON.stringify(Policy);
  if (!Policy.version) Policy.version = '2.0';
  var headers = params.Headers;
  headers['Content-Type'] = 'application/json';
  headers['Content-MD5'] = util.binaryBase64(util.md5(PolicyStr));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketPolicy',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'policy',
    body: PolicyStr,
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的读取权限策略
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketPolicy(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketPolicy',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'policy',
    rawBody: true
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 403) {
        return callback(util.error(err, {
          ErrorStatus: 'Access Denied'
        }));
      }

      if (err.statusCode && err.statusCode === 405) {
        return callback(util.error(err, {
          ErrorStatus: 'Method Not Allowed'
        }));
      }

      if (err.statusCode && err.statusCode === 404) {
        return callback(util.error(err, {
          ErrorStatus: 'Policy Not Found'
        }));
      }

      return callback(err);
    }

    var Policy = {};

    try {
      Policy = JSON.parse(data.body);
    } catch (e) {}

    callback(null, {
      Policy: Policy,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 跨域设置
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 * @param  {Function}  callback             回调函数，必须
 * @return  {Object}  err                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                  返回的数据
 */


function deleteBucketPolicy(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketPolicy',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'policy'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode || err.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的标签
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {Array}   params.TagSet  标签设置，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function putBucketTagging(params, callback) {
  var Tagging = params['Tagging'] || {};
  var Tags = Tagging.TagSet || Tagging.Tags || params['Tags'] || [];
  Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
  var xml = util.json2xml({
    Tagging: {
      TagSet: {
        Tag: Tags
      }
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketTagging',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'tagging',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketTagging',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === "Not Found" || err.error.Code === 'NoSuchTagSet')) {
        var result = {
          Tags: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Tags = [];

    try {
      Tags = data.Tagging.TagSet.Tag || [];
    } catch (e) {}

    Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
    callback(null, {
      Tags: Tags,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的 标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function deleteBucketTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketTagging',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function putBucketLifecycle(params, callback) {
  var LifecycleConfiguration = params['LifecycleConfiguration'] || {};
  var Rules = LifecycleConfiguration.Rules || params.Rules || [];
  Rules = util.clone(Rules);
  var xml = util.json2xml({
    LifecycleConfiguration: {
      Rule: Rules
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketLifecycle',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'lifecycle',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketLifecycle(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLifecycle',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'lifecycle'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && err.error.Code === 'NoSuchLifecycleConfiguration') {
        var result = {
          Rules: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Rules = [];

    try {
      Rules = data.LifecycleConfiguration.Rule || [];
    } catch (e) {}

    Rules = util.clone(util.isArray(Rules) ? Rules : [Rules]);
    callback(null, {
      Rules: Rules,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function deleteBucketLifecycle(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketLifecycle',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'lifecycle'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function putBucketVersioning(params, callback) {
  if (!params['VersioningConfiguration']) {
    callback(util.error(new Error('missing param VersioningConfiguration')));
    return;
  }

  var VersioningConfiguration = params['VersioningConfiguration'] || {};
  var xml = util.json2xml({
    VersioningConfiguration: VersioningConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketVersioning',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'versioning',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketVersioning(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketVersioning',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'versioning'
  }, function (err, data) {
    if (!err) {
      !data.VersioningConfiguration && (data.VersioningConfiguration = {});
    }

    callback(err, data);
  });
}

function putBucketReplication(params, callback) {
  var ReplicationConfiguration = util.clone(params.ReplicationConfiguration);
  var xml = util.json2xml({
    ReplicationConfiguration: ReplicationConfiguration
  });
  xml = xml.replace(/<(\/?)Rules>/ig, '<$1Rule>');
  xml = xml.replace(/<(\/?)Tags>/ig, '<$1Tag>');
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketReplication',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'replication',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketReplication(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketReplication',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'replication'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === 'Not Found' || err.error.Code === 'ReplicationConfigurationnotFoundError')) {
        var result = {
          ReplicationConfiguration: {
            Rules: []
          },
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    !data.ReplicationConfiguration && (data.ReplicationConfiguration = {});

    if (data.ReplicationConfiguration.Rule) {
      data.ReplicationConfiguration.Rules = util.makeArray(data.ReplicationConfiguration.Rule);
      delete data.ReplicationConfiguration.Rule;
    }

    callback(err, data);
  });
}

function deleteBucketReplication(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketReplication',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'replication'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 静态网站配置信息
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {Object}  params.WebsiteConfiguration                        地域名称，必须
 *         @param  {Object}   WebsiteConfiguration.IndexDocument            索引文档，必须
 *         @param  {Object}   WebsiteConfiguration.ErrorDocument            错误文档，非必须
 *         @param  {Object}   WebsiteConfiguration.RedirectAllRequestsTo    重定向所有请求，非必须
 *         @param  {Array}   params.RoutingRules                            重定向规则，非必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketWebsite(params, callback) {
  if (!params['WebsiteConfiguration']) {
    callback(util.error(new Error('missing param WebsiteConfiguration')));
    return;
  }

  var WebsiteConfiguration = util.clone(params['WebsiteConfiguration'] || {});
  var RoutingRules = WebsiteConfiguration['RoutingRules'] || WebsiteConfiguration['RoutingRule'] || [];
  RoutingRules = util.isArray(RoutingRules) ? RoutingRules : [RoutingRules];
  delete WebsiteConfiguration.RoutingRule;
  delete WebsiteConfiguration.RoutingRules;
  if (RoutingRules.length) WebsiteConfiguration.RoutingRules = {
    RoutingRule: RoutingRules
  };
  var xml = util.json2xml({
    WebsiteConfiguration: WebsiteConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketWebsite',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'website',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的静态网站配置信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketWebsite(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketWebsite',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'website'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error.Code === 'NoSuchWebsiteConfiguration') {
        var result = {
          WebsiteConfiguration: {},
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var WebsiteConfiguration = data.WebsiteConfiguration || {};

    if (WebsiteConfiguration['RoutingRules']) {
      var RoutingRules = util.clone(WebsiteConfiguration['RoutingRules'].RoutingRule || []);
      RoutingRules = util.makeArray(RoutingRules);
      WebsiteConfiguration.RoutingRules = RoutingRules;
    }

    callback(null, {
      WebsiteConfiguration: WebsiteConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的静态网站配置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketWebsite(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketWebsite',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'website'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的防盗链白名单或者黑名单
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {Object}  params.RefererConfiguration                        地域名称，必须
 *         @param  {String}   RefererConfiguration.Status                   是否开启防盗链，枚举值：Enabled、Disabled
 *         @param  {String}   RefererConfiguration.RefererType              防盗链类型，枚举值：Black-List、White-List，必须
 *         @param  {Array}   RefererConfiguration.DomianList.Domain         生效域名，必须
 *         @param  {String}   RefererConfiguration.EmptyReferConfiguration  ，非必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketReferer(params, callback) {
  if (!params['RefererConfiguration']) {
    callback(util.error(new Error('missing param RefererConfiguration')));
    return;
  }

  var RefererConfiguration = util.clone(params['RefererConfiguration'] || {});
  var DomainList = RefererConfiguration['DomainList'] || {};
  var Domains = DomainList['Domains'] || DomainList['Domain'] || [];
  Domains = util.isArray(Domains) ? Domains : [Domains];
  if (Domains.length) RefererConfiguration.DomainList = {
    Domain: Domains
  };
  var xml = util.json2xml({
    RefererConfiguration: RefererConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketReferer',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'referer',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的防盗链白名单或者黑名单
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketReferer(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketReferer',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'referer'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error.Code === 'NoSuchRefererConfiguration') {
        var result = {
          WebsiteConfiguration: {},
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var RefererConfiguration = data.RefererConfiguration || {};

    if (RefererConfiguration['DomainList']) {
      var Domains = util.makeArray(RefererConfiguration['DomainList'].Domain || []);
      RefererConfiguration.DomainList = {
        Domains: Domains
      };
    }

    callback(null, {
      RefererConfiguration: RefererConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 自定义域名
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketDomain(params, callback) {
  var DomainConfiguration = params['DomainConfiguration'] || {};
  var DomainRule = DomainConfiguration.DomainRule || params.DomainRule || [];
  DomainRule = util.clone(DomainRule);
  var xml = util.json2xml({
    DomainConfiguration: {
      DomainRule: DomainRule
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketDomain',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'domain',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的自定义域名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketDomain(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketDomain',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'domain'
  }, function (err, data) {
    if (err) return callback(err);
    var DomainRule = [];

    try {
      DomainRule = data.DomainConfiguration.DomainRule || [];
    } catch (e) {}

    DomainRule = util.clone(util.isArray(DomainRule) ? DomainRule : [DomainRule]);
    callback(null, {
      DomainRule: DomainRule,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 自定义域名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketDomain(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketDomain',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'domain'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的回源
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketOrigin(params, callback) {
  var OriginConfiguration = params['OriginConfiguration'] || {};
  var OriginRule = OriginConfiguration.OriginRule || params.OriginRule || [];
  OriginRule = util.clone(OriginRule);
  var xml = util.json2xml({
    OriginConfiguration: {
      OriginRule: OriginRule
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketOrigin',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'origin',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的回源
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketOrigin(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketOrigin',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'origin'
  }, function (err, data) {
    if (err) return callback(err);
    var OriginRule = [];

    try {
      OriginRule = data.OriginConfiguration.OriginRule || [];
    } catch (e) {}

    OriginRule = util.clone(util.isArray(OriginRule) ? OriginRule : [OriginRule]);
    callback(null, {
      OriginRule: OriginRule,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Bucket 的回源
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketOrigin(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketOrigin',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'origin'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 设置 Bucket 的日志记录
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {(Object|String)}  params.BucketLoggingStatus                         说明日志记录配置的状态，如果无子节点信息则意为关闭日志记录，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketLogging(params, callback) {
  var xml = util.json2xml({
    BucketLoggingStatus: params['BucketLoggingStatus'] || ''
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketLogging',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'logging',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的日志记录
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketLogging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketLogging',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'logging'
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      BucketLoggingStatus: data.BucketLoggingStatus,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 创建/编辑 Bucket 的清单任务
 * @param  {Object}  params                                                 参数对象，必须
 *     @param  {String}  params.Bucket                                      Bucket名称，必须
 *     @param  {String}  params.Region                                      地域名称，必须
 *     @param  {String}  params.Id                                          清单任务的名称，必须
 *     @param  {Object}  params.InventoryConfiguration                      包含清单的配置参数，必须
 * @param  {Function}  callback                                             回调函数，必须
 * @return  {Object}  err                                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                                  返回数据
 */


function putBucketInventory(params, callback) {
  var InventoryConfiguration = util.clone(params['InventoryConfiguration']);

  if (InventoryConfiguration.OptionalFields) {
    var Field = InventoryConfiguration.OptionalFields || [];
    InventoryConfiguration.OptionalFields = {
      Field: Field
    };
  }

  if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
    var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

    if (Object.keys(Encryption).indexOf('SSECOS') > -1) {
      Encryption['SSE-COS'] = Encryption['SSECOS'];
      delete Encryption['SSECOS'];
    }
  }

  var xml = util.json2xml({
    InventoryConfiguration: InventoryConfiguration
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketInventory',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'inventory',
    qs: {
      id: params['Id']
    },
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的清单任务信息
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Id      清单任务的名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function getBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketInventory',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      id: params['Id']
    }
  }, function (err, data) {
    if (err) return callback(err);
    var InventoryConfiguration = data['InventoryConfiguration'];

    if (InventoryConfiguration && InventoryConfiguration.OptionalFields && InventoryConfiguration.OptionalFields.Field) {
      var Field = InventoryConfiguration.OptionalFields.Field;

      if (!util.isArray(Field)) {
        Field = [Field];
      }

      InventoryConfiguration.OptionalFields = Field;
    }

    if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
      var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

      if (Object.keys(Encryption).indexOf('SSE-COS') > -1) {
        Encryption['SSECOS'] = Encryption['SSE-COS'];
        delete Encryption['SSE-COS'];
      }
    }

    callback(null, {
      InventoryConfiguration: InventoryConfiguration,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Bucket 的清单任务信息
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {String}  params.ContinuationToken       当 COS 响应体中 IsTruncated 为 true，且 NextContinuationToken 节点中存在参数值时，您可以将这个参数作为 continuation-token 参数值，以获取下一页的清单任务信息，非必须
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回数据
 */


function listBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:ListBucketInventory',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      'continuation-token': params['ContinuationToken']
    }
  }, function (err, data) {
    if (err) return callback(err);
    var ListInventoryConfigurationResult = data['ListInventoryConfigurationResult'];
    var InventoryConfigurations = ListInventoryConfigurationResult.InventoryConfiguration || [];
    InventoryConfigurations = util.isArray(InventoryConfigurations) ? InventoryConfigurations : [InventoryConfigurations];
    delete ListInventoryConfigurationResult['InventoryConfiguration'];
    util.each(InventoryConfigurations, function (InventoryConfiguration) {
      if (InventoryConfiguration && InventoryConfiguration.OptionalFields && InventoryConfiguration.OptionalFields.Field) {
        var Field = InventoryConfiguration.OptionalFields.Field;

        if (!util.isArray(Field)) {
          Field = [Field];
        }

        InventoryConfiguration.OptionalFields = Field;
      }

      if (InventoryConfiguration.Destination && InventoryConfiguration.Destination.COSBucketDestination && InventoryConfiguration.Destination.COSBucketDestination.Encryption) {
        var Encryption = InventoryConfiguration.Destination.COSBucketDestination.Encryption;

        if (Object.keys(Encryption).indexOf('SSE-COS') > -1) {
          Encryption['SSECOS'] = Encryption['SSE-COS'];
          delete Encryption['SSE-COS'];
        }
      }
    });
    ListInventoryConfigurationResult.InventoryConfigurations = InventoryConfigurations;
    util.extend(ListInventoryConfigurationResult, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, ListInventoryConfigurationResult);
  });
}
/**
 * 删除 Bucket 的清单任务
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Id      清单任务的名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回数据
 */


function deleteBucketInventory(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketInventory',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'inventory',
    qs: {
      id: params['Id']
    }
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/* 全球加速 */


function putBucketAccelerate(params, callback) {
  if (!params['AccelerateConfiguration']) {
    callback(util.error(new Error('missing param AccelerateConfiguration')));
    return;
  }

  var configuration = {
    AccelerateConfiguration: params.AccelerateConfiguration || {}
  };
  var xml = util.json2xml(configuration);
  var headers = {};
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketAccelerate',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'accelerate',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketAccelerate(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketAccelerate',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'accelerate'
  }, function (err, data) {
    if (!err) {
      !data.AccelerateConfiguration && (data.AccelerateConfiguration = {});
    }

    callback(err, data);
  });
}

function putBucketEncryption(params, callback) {
  var conf = params.ServerSideEncryptionConfiguration || {};
  var Rules = conf.Rule || conf.Rules || [];
  var xml = util.json2xml({
    ServerSideEncryptionConfiguration: {
      Rule: Rules
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutBucketEncryption',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'encryption',
    headers: headers
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}

function getBucketEncryption(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketEncryption',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'encryption'
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.code === 'NoSuchEncryptionConfiguration') {
        var result = {
          EncryptionConfiguration: {
            Rules: []
          },
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Rules = util.makeArray(data.EncryptionConfiguration && data.EncryptionConfiguration.Rule || []);
    data.EncryptionConfiguration = {
      Rules: Rules
    };
    callback(err, data);
  });
}

function deleteBucketEncryption(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteBucketReplication',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'encryption'
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
} // Object 相关

/**
 * 取回对应Object的元数据，Head的权限与Get的权限一致
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Key                 文件名称，必须
 *     @param  {String}  params.IfModifiedSince     当Object在指定时间后被修改，则返回对应Object元信息，否则返回304，非必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          为指定 object 的元数据，如果设置了 IfModifiedSince ，且文件未修改，则返回一个对象，NotModified 属性为 true
 *     @return  {Boolean}  data.NotModified         是否在 IfModifiedSince 时间点之后未修改该 object，则为 true
 */


function headObject(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:HeadObject',
    method: 'HEAD',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    headers: params.Headers
  }, function (err, data) {
    if (err) {
      var statusCode = err.statusCode;

      if (params.Headers['If-Modified-Since'] && statusCode && statusCode === 304) {
        return callback(null, {
          NotModified: true,
          statusCode: statusCode
        });
      }

      return callback(err);
    }

    data.ETag = util.attr(data.headers, 'etag', '');
    callback(null, data);
  });
}

function listObjectVersions(params, callback) {
  var reqParams = {};
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['key-marker'] = params['KeyMarker'];
  reqParams['version-id-marker'] = params['VersionIdMarker'];
  reqParams['max-keys'] = params['MaxKeys'];
  reqParams['encoding-type'] = params['EncodingType'];
  submitRequest.call(this, {
    Action: 'name/cos:GetBucketObjectVersions',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams,
    action: 'versions'
  }, function (err, data) {
    if (err) return callback(err);
    var ListVersionsResult = data.ListVersionsResult || {};
    var DeleteMarkers = ListVersionsResult.DeleteMarker || [];
    DeleteMarkers = util.isArray(DeleteMarkers) ? DeleteMarkers : [DeleteMarkers];
    var Versions = ListVersionsResult.Version || [];
    Versions = util.isArray(Versions) ? Versions : [Versions];
    var result = util.clone(ListVersionsResult);
    delete result.DeleteMarker;
    delete result.Version;
    util.extend(result, {
      DeleteMarkers: DeleteMarkers,
      Versions: Versions,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 下载 object
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         文件名称，必须
 *     @param  {WriteStream}  params.Output                 文件写入流，非必须
 *     @param  {String}  params.IfModifiedSince             当Object在指定时间后被修改，则返回对应Object元信息，否则返回304，非必须
 *     @param  {String}  params.IfUnmodifiedSince           如果文件修改时间早于或等于指定时间，才返回文件内容。否则返回 412 (precondition failed)，非必须
 *     @param  {String}  params.IfMatch                     当 ETag 与指定的内容一致，才返回文件。否则返回 412 (precondition failed)，非必须
 *     @param  {String}  params.IfNoneMatch                 当 ETag 与指定的内容不一致，才返回文件。否则返回304 (not modified)，非必须
 *     @param  {String}  params.ResponseContentType         设置返回头部中的 Content-Type 参数，非必须
 *     @param  {String}  params.ResponseContentLanguage     设置返回头部中的 Content-Language 参数，非必须
 *     @param  {String}  params.ResponseExpires             设置返回头部中的 Content-Expires 参数，非必须
 *     @param  {String}  params.ResponseCacheControl        设置返回头部中的 Cache-Control 参数，非必须
 *     @param  {String}  params.ResponseContentDisposition  设置返回头部中的 Content-Disposition 参数，非必须
 *     @param  {String}  params.ResponseContentEncoding     设置返回头部中的 Content-Encoding 参数，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @param  {Object}  err                                    请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @param  {Object}  data                                   为对应的 object 数据，包括 body 和 headers
 */


function getObject(params, callback) {
  var reqParams = params.Query || {};
  var reqParamsStr = params.QueryString || '';
  var onProgress = util.throttleOnProgress.call(this, 0, params.onProgress);
  var tracker = params.tracker;
  tracker && tracker.setParams({
    signStartTime: new Date().getTime()
  });
  reqParams['response-content-type'] = params['ResponseContentType'];
  reqParams['response-content-language'] = params['ResponseContentLanguage'];
  reqParams['response-expires'] = params['ResponseExpires'];
  reqParams['response-cache-control'] = params['ResponseCacheControl'];
  reqParams['response-content-disposition'] = params['ResponseContentDisposition'];
  reqParams['response-content-encoding'] = params['ResponseContentEncoding']; // 如果用户自己传入了 output

  submitRequest.call(this, {
    Action: 'name/cos:GetObject',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    DataType: params.DataType,
    headers: params.Headers,
    qs: reqParams,
    qsStr: reqParamsStr,
    rawBody: true,
    onDownloadProgress: onProgress,
    tracker: tracker
  }, function (err, data) {
    onProgress(null, true);

    if (err) {
      var statusCode = err.statusCode;

      if (params.Headers['If-Modified-Since'] && statusCode && statusCode === 304) {
        return callback(null, {
          NotModified: true
        });
      }

      return callback(err);
    }

    callback(null, {
      Body: data.body,
      ETag: util.attr(data.headers, 'etag', ''),
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 上传 object
 * @param  {Object} params                                          参数对象，必须
 *     @param  {String}  params.Bucket                              Bucket名称，必须
 *     @param  {String}  params.Region                              地域名称，必须
 *     @param  {String}  params.Key                                 文件名称，必须
 *     @param  {File || Blob || String}  params.Body                上传文件对象或字符串，必须
 *     @param  {String}  params.CacheControl                        RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition                  RFC 2616 中定义的文件名称，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentEncoding                     RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentLength                       RFC 2616 中定义的 HTTP 请求内容长度（字节），必须
 *     @param  {String}  params.ContentType                         RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expect                              当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String}  params.Expires                             RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                                 允许用户自定义文件权限，有效值：private | public-read，非必须
 *     @param  {String}  params.GrantRead                           赋予被授权者读取对象的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantReadAcp                        赋予被授权者读取对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantWriteAcp                       赋予被授权者写入对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantFullControl                    赋予被授权者操作对象的所有权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.StorageClass                        设置对象的存储级别，枚举值：STANDARD、STANDARD_IA、ARCHIVE，默认值：STANDARD，非必须
 *     @param  {String}  params.x-cos-meta-*                        允许用户自定义的头部信息，将作为对象的元数据保存。大小限制2KB，非必须
 *     @param  {String}  params.ContentSha1                         RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验，非必须
 *     @param  {String}  params.ServerSideEncryption                支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {Function}  params.onProgress                        上传进度回调函数
 * @param  {Function}  callback                                     回调函数，必须
 * @return  {Object}  err                                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                          为对应的 object 数据
 *     @return  {String}  data.ETag                                 为对应上传文件的 ETag 值
 */


function putObject(params, callback) {
  var self = this;
  var FileSize = params.ContentLength;
  var onProgress = util.throttleOnProgress.call(self, FileSize, params.onProgress); // 特殊处理 Cache-Control、Content-Type，避免代理更改这两个字段导致写入到 Object 属性里

  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  var needCalcMd5 = params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5 || self.options.UploadCheckContentMd5;
  var tracker = params.tracker;
  needCalcMd5 && tracker && tracker.setParams({
    md5StartTime: new Date().getTime()
  });
  util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
    if (md5) {
      tracker && tracker.setParams({
        md5EndTime: new Date().getTime()
      });
      if (self.options.UploadCheckContentMd5) headers['Content-MD5'] = util.binaryBase64(md5);
      if (params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5) headers['x-cos-meta-md5'] = md5;
    }

    if (params.ContentLength !== undefined) headers['Content-Length'] = params.ContentLength;
    onProgress(null, true); // 任务状态开始 uploading

    submitRequest.call(self, {
      Action: 'name/cos:PutObject',
      TaskId: params.TaskId,
      method: 'PUT',
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      headers: params.Headers,
      qs: params.Query,
      body: params.Body,
      onProgress: onProgress,
      tracker: tracker
    }, function (err, data) {
      if (err) {
        onProgress(null, true);
        return callback(err);
      }

      onProgress({
        loaded: FileSize,
        total: FileSize
      }, true);
      var url = getUrl({
        ForcePathStyle: self.options.ForcePathStyle,
        protocol: self.options.Protocol,
        domain: self.options.Domain,
        bucket: params.Bucket,
        region: !self.options.UseAccelerate ? params.Region : 'accelerate',
        object: params.Key
      });
      url = url.substr(url.indexOf('://') + 3);
      data.Location = url;
      data.ETag = util.attr(data.headers, 'etag', '');
      callback(null, data);
    });
  }, params.onHashProgress);
}
/**
 * 删除 object
 * @param  {Object}  params                     参数对象，必须
 *     @param  {String}  params.Bucket          Bucket名称，必须
 *     @param  {String}  params.Region          地域名称，必须
 *     @param  {String}  params.Key             object名称，必须
 * @param  {Function}  callback                 回调函数，必须
 * @param  {Object}  err                        请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @param  {Object}  data                       删除操作成功之后返回的数据
 */


function deleteObject(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteObject',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    VersionId: params.VersionId,
    action: params.Recursive ? 'recursive' : ''
  }, function (err, data) {
    if (err) {
      var statusCode = err.statusCode;

      if (statusCode && statusCode === 404) {
        return callback(null, {
          BucketNotFound: true,
          statusCode: statusCode
        });
      } else {
        return callback(err);
      }
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 object 的 权限列表
 * @param  {Object}  params                         参数对象，必须
 *     @param  {String}  params.Bucket              Bucket名称，必须
 *     @param  {String}  params.Region              地域名称，必须
 *     @param  {String}  params.Key                 object名称，必须
 * @param  {Function}  callback                     回调函数，必须
 * @return  {Object}  err                           请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                          返回的数据
 *     @return  {Object}  data.AccessControlPolicy  权限列表
 */


function getObjectAcl(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetObjectACL',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'acl'
  }, function (err, data) {
    if (err) return callback(err);
    var AccessControlPolicy = data.AccessControlPolicy || {};
    var Owner = AccessControlPolicy.Owner || {};
    var Grant = AccessControlPolicy.AccessControlList && AccessControlPolicy.AccessControlList.Grant || [];
    Grant = util.isArray(Grant) ? Grant : [Grant];
    var result = decodeAcl(AccessControlPolicy);
    delete result.GrantWrite;

    if (data.headers && data.headers['x-cos-acl']) {
      result.ACL = data.headers['x-cos-acl'];
    }

    result = util.extend(result, {
      Owner: Owner,
      Grants: Grant,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 设置 object 的 权限列表
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Key     object名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function putObjectAcl(params, callback) {
  var headers = params.Headers;
  var xml = '';

  if (params['AccessControlPolicy']) {
    var AccessControlPolicy = util.clone(params['AccessControlPolicy'] || {});
    var Grants = AccessControlPolicy.Grants || AccessControlPolicy.Grant;
    Grants = util.isArray(Grants) ? Grants : [Grants];
    delete AccessControlPolicy.Grant;
    delete AccessControlPolicy.Grants;
    AccessControlPolicy.AccessControlList = {
      Grant: Grants
    };
    xml = util.json2xml({
      AccessControlPolicy: AccessControlPolicy
    });
    headers['Content-Type'] = 'application/xml';
    headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  } // Grant Header 去重


  util.each(headers, function (val, key) {
    if (key.indexOf('x-cos-grant-') === 0) {
      headers[key] = uniqGrant(headers[key]);
    }
  });
  submitRequest.call(this, {
    Action: 'name/cos:PutObjectACL',
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    action: 'acl',
    headers: headers,
    body: xml
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * Options Object请求实现跨域访问的预请求。即发出一个 OPTIONS 请求给服务器以确认是否可以进行跨域操作。
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {String}  params.Key     object名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data              返回的数据
 */


function optionsObject(params, callback) {
  var headers = params.Headers;
  headers['Origin'] = params['Origin'];
  headers['Access-Control-Request-Method'] = params['AccessControlRequestMethod'];
  headers['Access-Control-Request-Headers'] = params['AccessControlRequestHeaders'];
  submitRequest.call(this, {
    Action: 'name/cos:OptionsObject',
    method: 'OPTIONS',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: headers
  }, function (err, data) {
    if (err) {
      if (err.statusCode && err.statusCode === 403) {
        return callback(null, {
          OptionsForbidden: true,
          statusCode: err.statusCode
        });
      }

      return callback(err);
    }

    var headers = data.headers || {};
    callback(null, {
      AccessControlAllowOrigin: headers['access-control-allow-origin'],
      AccessControlAllowMethods: headers['access-control-allow-methods'],
      AccessControlAllowHeaders: headers['access-control-allow-headers'],
      AccessControlExposeHeaders: headers['access-control-expose-headers'],
      AccessControlMaxAge: headers['access-control-max-age'],
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * @param  {Object}                                     参数列表
 *     @param  {String}  Bucket                         Bucket 名称
 *     @param  {String}  Region                         地域名称
 *     @param  {String}  Key                            文件名称
 *     @param  {String}  CopySource                     源文件URL绝对路径，可以通过versionid子资源指定历史版本
 *     @param  {String}  ACL                            允许用户自定义文件权限。有效值：private，public-read默认值：private。
 *     @param  {String}  GrantRead                      赋予被授权者读的权限，格式 x-cos-grant-read: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  GrantWrite                     赋予被授权者写的权限，格式 x-cos-grant-write: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  GrantFullControl               赋予被授权者读写权限，格式 x-cos-grant-full-control: uin=" ",uin=" "，当需要给子账户授权时，uin="RootAcountID/SubAccountID"，当需要给根账户授权时，uin="RootAcountID"。
 *     @param  {String}  MetadataDirective              是否拷贝元数据，枚举值：Copy, Replaced，默认值Copy。假如标记为Copy，忽略Header中的用户元数据信息直接复制；假如标记为Replaced，按Header信息修改元数据。当目标路径和原路径一致，即用户试图修改元数据时，必须为Replaced
 *     @param  {String}  CopySourceIfModifiedSince      当Object在指定时间后被修改，则执行操作，否则返回412。可与x-cos-copy-source-If-None-Match一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfUnmodifiedSince    当Object在指定时间后未被修改，则执行操作，否则返回412。可与x-cos-copy-source-If-Match一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfMatch              当Object的ETag和给定一致时，则执行操作，否则返回412。可与x-cos-copy-source-If-Unmodified-Since一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  CopySourceIfNoneMatch          当Object的ETag和给定不一致时，则执行操作，否则返回412。可与x-cos-copy-source-If-Modified-Since一起使用，与其他条件联合使用返回冲突。
 *     @param  {String}  StorageClass                   存储级别，枚举值：存储级别，枚举值：Standard, Standard_IA，Archive；默认值：Standard
 *     @param  {String}  CacheControl                   指定所有缓存机制在整个请求/响应链中必须服从的指令。
 *     @param  {String}  ContentDisposition             MIME 协议的扩展，MIME 协议指示 MIME 用户代理如何显示附加的文件
 *     @param  {String}  ContentEncoding                HTTP 中用来对「采用何种编码格式传输正文」进行协定的一对头部字段
 *     @param  {String}  ContentLength                  设置响应消息的实体内容的大小，单位为字节
 *     @param  {String}  ContentType                    RFC 2616 中定义的 HTTP 请求内容类型（MIME），例如text/plain
 *     @param  {String}  Expect                         请求的特定的服务器行为
 *     @param  {String}  Expires                        响应过期的日期和时间
 *     @param  {String}  params.ServerSideEncryption   支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {String}  ContentLanguage                指定内容语言
 *     @param  {String}  x-cos-meta-*                   允许用户自定义的头部信息，将作为 Object 元数据返回。大小限制2K。
 */


function putObjectCopy(params, callback) {
  // 特殊处理 Cache-Control
  var self = this;
  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  var CopySource = params.CopySource || '';
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m.Bucket;
  var SourceRegion = m.Region;
  var SourceKey = decodeURIComponent(m.Key);
  submitRequest.call(this, {
    Scope: [{
      action: 'name/cos:GetObject',
      bucket: SourceBucket,
      region: SourceRegion,
      prefix: SourceKey
    }, {
      action: 'name/cos:PutObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: params.Key
    }],
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    var result = util.clone(data.CopyObjectResult || {});
    var url = getUrl({
      ForcePathStyle: self.options.ForcePathStyle,
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      object: params.Key,
      isLocation: true
    });
    util.extend(result, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function uploadPartCopy(params, callback) {
  var CopySource = params.CopySource || '';
  var m = util.getSourceParams.call(this, CopySource);

  if (!m) {
    callback(util.error(new Error('CopySource format error')));
    return;
  }

  var SourceBucket = m.Bucket;
  var SourceRegion = m.Region;
  var SourceKey = decodeURIComponent(m.Key);
  submitRequest.call(this, {
    Scope: [{
      action: 'name/cos:GetObject',
      bucket: SourceBucket,
      region: SourceRegion,
      prefix: SourceKey
    }, {
      action: 'name/cos:PutObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: params.Key
    }],
    method: 'PUT',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    qs: {
      partNumber: params['PartNumber'],
      uploadId: params['UploadId']
    },
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    var result = util.clone(data.CopyPartResult || {});
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function deleteMultipleObject(params, callback) {
  var Objects = params.Objects || [];
  var Quiet = params.Quiet;
  Objects = util.isArray(Objects) ? Objects : [Objects];
  var xml = util.json2xml({
    Delete: {
      Object: Objects,
      Quiet: Quiet || false
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  var Scope = util.map(Objects, function (v) {
    return {
      action: 'name/cos:DeleteObject',
      bucket: params.Bucket,
      region: params.Region,
      prefix: v.Key
    };
  });
  submitRequest.call(this, {
    Scope: Scope,
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    body: xml,
    action: 'delete',
    headers: headers
  }, function (err, data) {
    if (err) return callback(err);
    var DeleteResult = data.DeleteResult || {};
    var Deleted = DeleteResult.Deleted || [];
    var Errors = DeleteResult.Error || [];
    Deleted = util.isArray(Deleted) ? Deleted : [Deleted];
    Errors = util.isArray(Errors) ? Errors : [Errors];
    var result = util.clone(DeleteResult);
    util.extend(result, {
      Error: Errors,
      Deleted: Deleted,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}

function restoreObject(params, callback) {
  var headers = params.Headers;

  if (!params['RestoreRequest']) {
    callback(util.error(new Error('missing param RestoreRequest')));
    return;
  }

  var RestoreRequest = params.RestoreRequest || {};
  var xml = util.json2xml({
    RestoreRequest: RestoreRequest
  });
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:RestoreObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    VersionId: params.VersionId,
    body: xml,
    action: 'restore',
    headers: headers
  }, callback);
}
/**
 * 设置 Object 的标签
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Object名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 *     @param  {Array}   params.TagSet  标签设置，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回数据
 */


function putObjectTagging(params, callback) {
  var Tagging = params['Tagging'] || {};
  var Tags = Tagging.TagSet || Tagging.Tags || params['Tags'] || [];
  Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
  var xml = util.json2xml({
    Tagging: {
      TagSet: {
        Tag: Tags
      }
    }
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:PutObjectTagging',
    method: 'PUT',
    Bucket: params.Bucket,
    Key: params.Key,
    Region: params.Region,
    body: xml,
    action: 'tagging',
    headers: headers,
    VersionId: params.VersionId
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 获取 Object 的标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Bucket名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回数据
 */


function getObjectTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:GetObjectTagging',
    method: 'GET',
    Key: params.Key,
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    action: 'tagging',
    VersionId: params.VersionId
  }, function (err, data) {
    if (err) {
      if (err.statusCode === 404 && err.error && (err.error === "Not Found" || err.error.Code === 'NoSuchTagSet')) {
        var result = {
          Tags: [],
          statusCode: err.statusCode
        };
        err.headers && (result.headers = err.headers);
        callback(null, result);
      } else {
        callback(err);
      }

      return;
    }

    var Tags = [];

    try {
      Tags = data.Tagging.TagSet.Tag || [];
    } catch (e) {}

    Tags = util.clone(util.isArray(Tags) ? Tags : [Tags]);
    callback(null, {
      Tags: Tags,
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 删除 Object 的 标签设置
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Bucket  Object名称，必须
 *     @param  {String}  params.Region  地域名称，必须
 * @param  {Function}  callback         回调函数，必须
 * @return  {Object}  err               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data              返回的数据
 */


function deleteObjectTagging(params, callback) {
  submitRequest.call(this, {
    Action: 'name/cos:DeleteObjectTagging',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'tagging',
    VersionId: params.VersionId
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 使用 SQL 语句从指定对象（CSV 格式或者 JSON 格式）中检索内容
 * @param  {Object}  params                   参数对象，必须
 *     @param  {String}  params.Bucket        Object名称，必须
 *     @param  {String}  params.Region        地域名称，必须
 *     @param  {Object}  params.SelectRequest 地域名称，必须
 * @param  {Function}  callback               回调函数，必须
 * @return  {Object}  err                     请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/42998
 * @return  {Object}  data                    返回的数据
 */


function selectObjectContent(params, callback) {
  var SelectType = params['SelectType'];
  if (!SelectType) return callback(util.error(new Error('missing param SelectType')));
  var SelectRequest = params['SelectRequest'] || {};
  var xml = util.json2xml({
    SelectRequest: SelectRequest
  });
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:GetObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    action: 'select',
    qs: {
      'select-type': params['SelectType']
    },
    VersionId: params.VersionId,
    body: xml,
    DataType: 'arraybuffer',
    rawBody: true
  }, function (err, data) {
    if (err && err.statusCode === 204) {
      return callback(null, {
        statusCode: err.statusCode
      });
    } else if (err) {
      return callback(err);
    }

    var result = util.parseSelectPayload(data.body);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers,
      Body: result.body,
      Payload: result.payload
    });
  });
} // 分块上传

/**
 * 初始化分块上传
 * @param  {Object}  params                                     参数对象，必须
 *     @param  {String}  params.Bucket                          Bucket名称，必须
 *     @param  {String}  params.Region                          地域名称，必须
 *     @param  {String}  params.Key                             object名称，必须
 *     @param  {String}  params.UploadId                        object名称，必须
 *     @param  {String}  params.CacheControl                    RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition              RFC 2616 中定义的文件名称，将作为 Object 元数据保存    ，非必须
 *     @param  {String}  params.ContentEncoding                 RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentType                     RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expires                         RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                             允许用户自定义文件权限，非必须
 *     @param  {String}  params.GrantRead                       赋予被授权者读的权限 ，非必须
 *     @param  {String}  params.GrantWrite                      赋予被授权者写的权限 ，非必须
 *     @param  {String}  params.GrantFullControl                赋予被授权者读写权限 ，非必须
 *     @param  {String}  params.StorageClass                    设置Object的存储级别，枚举值：Standard，Standard_IA，Archive，非必须
 *     @param  {String}  params.ServerSideEncryption           支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 * @param  {Function}  callback                                 回调函数，必须
 * @return  {Object}  err                                       请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                      返回的数据
 */


function multipartInit(params, callback) {
  var self = this; // 特殊处理 Cache-Control

  var headers = params.Headers;
  var tracker = params.tracker; // 特殊处理 Cache-Control、Content-Type

  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  var needCalcMd5 = params.Body && (params.UploadAddMetaMd5 || self.options.UploadAddMetaMd5);
  needCalcMd5 && tracker && tracker.setParams({
    md5StartTime: new Date().getTime()
  });
  util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
    if (md5) params.Headers['x-cos-meta-md5'] = md5;
    needCalcMd5 && tracker && tracker.setParams({
      md5EndTime: new Date().getTime()
    });
    submitRequest.call(self, {
      Action: 'name/cos:InitiateMultipartUpload',
      method: 'POST',
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      action: 'uploads',
      headers: params.Headers,
      qs: params.Query,
      tracker: tracker
    }, function (err, data) {
      if (err) {
        tracker && tracker.parent && tracker.parent.setParams({
          errorNode: 'multipartInit'
        });
        return callback(err);
      }

      data = util.clone(data || {});

      if (data && data.InitiateMultipartUploadResult) {
        return callback(null, util.extend(data.InitiateMultipartUploadResult, {
          statusCode: data.statusCode,
          headers: data.headers
        }));
      }

      callback(null, data);
    });
  }, params.onHashProgress);
}
/**
 * 分块上传
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         object名称，必须
 *     @param  {File || Blob || String}  params.Body        上传文件对象或字符串
 *     @param  {String} params.ContentLength                RFC 2616 中定义的 HTTP 请求内容长度（字节），非必须
 *     @param  {String} params.Expect                       当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String} params.ServerSideEncryption         支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 *     @param  {String} params.ContentSha1                  RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验值，非必须
 * @param  {Function}  callback                             回调函数，必须
 *     @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}  data                              返回的数据
 *     @return  {Object}  data.ETag                         返回的文件分块 sha1 值
 */


function multipartUpload(params, callback) {
  var self = this;
  util.getFileSize('multipartUpload', params, function () {
    var tracker = params.tracker;
    var needCalcMd5 = self.options.UploadCheckContentMd5;
    needCalcMd5 && tracker && tracker.setParams({
      md5StartTime: new Date().getTime()
    });
    util.getBodyMd5(needCalcMd5, params.Body, function (md5) {
      if (md5) params.Headers['Content-MD5'] = util.binaryBase64(md5);
      needCalcMd5 && tracker && tracker.setParams({
        md5EndTime: new Date().getTime()
      });
      tracker && tracker.setParams({
        partNumber: params.PartNumber
      });
      submitRequest.call(self, {
        Action: 'name/cos:UploadPart',
        TaskId: params.TaskId,
        method: 'PUT',
        Bucket: params.Bucket,
        Region: params.Region,
        Key: params.Key,
        qs: {
          partNumber: params['PartNumber'],
          uploadId: params['UploadId']
        },
        headers: params.Headers,
        onProgress: params.onProgress,
        body: params.Body || null,
        tracker: tracker
      }, function (err, data) {
        if (err) {
          tracker && tracker.parent && tracker.parent.setParams({
            errorNode: 'multipartUpload'
          });
          return callback(err);
        }

        callback(null, {
          ETag: util.attr(data.headers, 'etag', ''),
          statusCode: data.statusCode,
          headers: data.headers
        });
      });
    });
  });
}
/**
 * 完成分块上传
 * @param  {Object}  params                             参数对象，必须
 *     @param  {String}  params.Bucket                  Bucket名称，必须
 *     @param  {String}  params.Region                  地域名称，必须
 *     @param  {String}  params.Key                     object名称，必须
 *     @param  {Array}   params.Parts                   分块信息列表，必须
 *     @param  {String}  params.Parts[i].PartNumber     块编号，必须
 *     @param  {String}  params.Parts[i].ETag           分块的 sha1 校验值
 * @param  {Function}  callback                         回调函数，必须
 * @return  {Object}  err                               请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                              返回的数据
 *     @return  {Object}  data.CompleteMultipartUpload  完成分块上传后的文件信息，包括Location, Bucket, Key 和 ETag
 */


function multipartComplete(params, callback) {
  var self = this;
  var UploadId = params.UploadId;
  var Parts = params['Parts'];
  var tracker = params.tracker;

  for (var i = 0, len = Parts.length; i < len; i++) {
    if (Parts[i]['ETag'] && Parts[i]['ETag'].indexOf('"') === 0) {
      continue;
    }

    Parts[i]['ETag'] = '"' + Parts[i]['ETag'] + '"';
  }

  var xml = util.json2xml({
    CompleteMultipartUpload: {
      Part: Parts
    }
  }); // CSP/ceph CompleteMultipartUpload 接口 body 写死了限制 1MB，这里醉倒 10000 片时，xml 字符串去掉空格853KB

  xml = xml.replace(/\n\s*/g, '');
  var headers = params.Headers;
  headers['Content-Type'] = 'application/xml';
  headers['Content-MD5'] = util.binaryBase64(util.md5(xml));
  submitRequest.call(this, {
    Action: 'name/cos:CompleteMultipartUpload',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    qs: {
      uploadId: UploadId
    },
    body: xml,
    headers: headers,
    tracker: tracker
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartComplete'
      });
      return callback(err);
    }

    var url = getUrl({
      ForcePathStyle: self.options.ForcePathStyle,
      protocol: self.options.Protocol,
      domain: self.options.Domain,
      bucket: params.Bucket,
      region: params.Region,
      object: params.Key,
      isLocation: true
    });
    var res = data.CompleteMultipartUploadResult || {};

    if (res.ProcessResults) {
      if (res && res.ProcessResults) {
        res.UploadResult = {
          OriginalInfo: {
            Key: res.Key,
            Location: url,
            ETag: res.ETag,
            ImageInfo: res.ImageInfo
          },
          ProcessResults: res.ProcessResults
        };
        delete res.ImageInfo;
        delete res.ProcessResults;
      }
    }

    var result = util.extend(res, {
      Location: url,
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 分块上传任务列表查询
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Delimiter                   定界符为一个符号，如果有Prefix，则将Prefix到delimiter之间的相同路径归为一类，定义为Common Prefix，然后列出所有Common Prefix。如果没有Prefix，则从路径起点开始，非必须
 *     @param  {String}  params.EncodingType                规定返回值的编码方式，非必须
 *     @param  {String}  params.Prefix                      前缀匹配，用来规定返回的文件前缀地址，非必须
 *     @param  {String}  params.MaxUploads                  单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.KeyMarker                   与upload-id-marker一起使用 </Br>当upload-id-marker未被指定时，ObjectName字母顺序大于key-marker的条目将被列出 </Br>当upload-id-marker被指定时，ObjectName字母顺序大于key-marker的条目被列出，ObjectName字母顺序等于key-marker同时UploadId大于upload-id-marker的条目将被列出，非必须
 *     @param  {String}  params.UploadIdMarker              与key-marker一起使用 </Br>当key-marker未被指定时，upload-id-marker将被忽略 </Br>当key-marker被指定时，ObjectName字母顺序大于key-marker的条目被列出，ObjectName字母顺序等于key-marker同时UploadId大于upload-id-marker的条目将被列出，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @return  {Object}  err                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                  返回的数据
 *     @return  {Object}  data.ListMultipartUploadsResult   分块上传任务信息
 */


function multipartList(params, callback) {
  var reqParams = {};
  reqParams['delimiter'] = params['Delimiter'];
  reqParams['encoding-type'] = params['EncodingType'];
  reqParams['prefix'] = params['Prefix'] || '';
  reqParams['max-uploads'] = params['MaxUploads'];
  reqParams['key-marker'] = params['KeyMarker'];
  reqParams['upload-id-marker'] = params['UploadIdMarker'];
  reqParams = util.clearKey(reqParams);
  var tracker = params.tracker;
  tracker && tracker.setParams({
    signStartTime: new Date().getTime()
  });
  submitRequest.call(this, {
    Action: 'name/cos:ListMultipartUploads',
    ResourceKey: reqParams['prefix'],
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    headers: params.Headers,
    qs: reqParams,
    action: 'uploads',
    tracker: tracker
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartList'
      });
      return callback(err);
    }

    if (data && data.ListMultipartUploadsResult) {
      var Upload = data.ListMultipartUploadsResult.Upload || [];
      Upload = util.isArray(Upload) ? Upload : [Upload];
      data.ListMultipartUploadsResult.Upload = Upload;
    }

    var result = util.clone(data.ListMultipartUploadsResult || {});
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 上传的分块列表查询
 * @param  {Object}  params                                 参数对象，必须
 *     @param  {String}  params.Bucket                      Bucket名称，必须
 *     @param  {String}  params.Region                      地域名称，必须
 *     @param  {String}  params.Key                         object名称，必须
 *     @param  {String}  params.UploadId                    标示本次分块上传的ID，必须
 *     @param  {String}  params.EncodingType                规定返回值的编码方式，非必须
 *     @param  {String}  params.MaxParts                    单次返回最大的条目数量，默认1000，非必须
 *     @param  {String}  params.PartNumberMarker            默认以UTF-8二进制顺序列出条目，所有列出条目从marker开始，非必须
 * @param  {Function}  callback                             回调函数，必须
 * @return  {Object}  err                                   请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 * @return  {Object}  data                                  返回的数据
 *     @return  {Object}  data.ListMultipartUploadsResult   分块信息
 */


function multipartListPart(params, callback) {
  var reqParams = {};
  var tracker = params.tracker;
  reqParams['uploadId'] = params['UploadId'];
  reqParams['encoding-type'] = params['EncodingType'];
  reqParams['max-parts'] = params['MaxParts'];
  reqParams['part-number-marker'] = params['PartNumberMarker'];
  submitRequest.call(this, {
    Action: 'name/cos:ListParts',
    method: 'GET',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) {
      tracker && tracker.parent && tracker.parent.setParams({
        errorNode: 'multipartListPart'
      });
      return callback(err);
    }

    var ListPartsResult = data.ListPartsResult || {};
    var Part = ListPartsResult.Part || [];
    Part = util.isArray(Part) ? Part : [Part];
    ListPartsResult.Part = Part;
    var result = util.clone(ListPartsResult);
    util.extend(result, {
      statusCode: data.statusCode,
      headers: data.headers
    });
    callback(null, result);
  });
}
/**
 * 抛弃分块上传
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.UploadId    标示本次分块上传的ID，必须
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function multipartAbort(params, callback) {
  var reqParams = {};
  reqParams['uploadId'] = params['UploadId'];
  submitRequest.call(this, {
    Action: 'name/cos:AbortMultipartUpload',
    method: 'DELETE',
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    headers: params.Headers,
    qs: reqParams
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, {
      statusCode: data.statusCode,
      headers: data.headers
    });
  });
}
/**
 * 抛弃分块上传
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.UploadId    标示本次分块上传的ID，必须
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function request(params, callback) {
  submitRequest.call(this, {
    method: params.Method,
    Bucket: params.Bucket,
    Region: params.Region,
    Key: params.Key,
    action: params.Action,
    headers: params.Headers,
    qs: params.Query,
    body: params.Body,
    Url: params.Url,
    rawBody: params.RawBody,
    DataType: params.DataType
  }, function (err, data) {
    if (err) return callback(err);

    if (data && data.body) {
      data.Body = data.body;
      delete data.body;
    }

    callback(err, data);
  });
}
/**
 * 追加上传
 * @param  {Object}  params                                         参数对象，必须
 *     @param  {String}  params.Bucket                              Bucket名称，必须
 *     @param  {String}  params.Region                              地域名称，必须
 *     @param  {String}  params.Key                                 object名称，必须
 *     @param  {File || Blob || String}  params.Body                上传文件对象或字符串
 *     @param  {Number}  params.Position                            追加操作的起始点，单位为字节，必须
 *     @param  {String}  params.CacheControl                        RFC 2616 中定义的缓存策略，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentDisposition                  RFC 2616 中定义的文件名称，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentEncoding                     RFC 2616 中定义的编码格式，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ContentLength                       RFC 2616 中定义的 HTTP 请求内容长度（字节），必须
 *     @param  {String}  params.ContentType                         RFC 2616 中定义的内容类型（MIME），将作为 Object 元数据保存，非必须
 *     @param  {String}  params.Expect                              当使用 Expect: 100-continue 时，在收到服务端确认后，才会发送请求内容，非必须
 *     @param  {String}  params.Expires                             RFC 2616 中定义的过期时间，将作为 Object 元数据保存，非必须
 *     @param  {String}  params.ACL                                 允许用户自定义文件权限，有效值：private | public-read，非必须
 *     @param  {String}  params.GrantRead                           赋予被授权者读取对象的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantReadAcp                        赋予被授权者读取对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantWriteAcp                       赋予被授权者写入对象的访问控制列表（ACL）的权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.GrantFullControl                    赋予被授权者操作对象的所有权限，格式：id="[OwnerUin]"，可使用半角逗号（,）分隔多组被授权者，非必须
 *     @param  {String}  params.StorageClass                        设置对象的存储级别，枚举值：STANDARD、STANDARD_IA、ARCHIVE，默认值：STANDARD，非必须
 *     @param  {String}  params.x-cos-meta-*                        允许用户自定义的头部信息，将作为对象的元数据保存。大小限制2KB，非必须
 *     @param  {String}  params.ContentSha1                         RFC 3174 中定义的 160-bit 内容 SHA-1 算法校验，非必须
 *     @param  {String}  params.ServerSideEncryption                支持按照指定的加密算法进行服务端数据加密，格式 x-cos-server-side-encryption: "AES256"，非必须
 * @param  {Function}  callback                                     回调函数，必须
 *     @return  {Object}    err                                     请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data                                    返回的数据
 */


function appendObject(params, callback) {
  // 特殊处理 Cache-Control、Content-Type，避免代理更改这两个字段导致写入到 Object 属性里
  var headers = params.Headers;
  if (!headers['Cache-Control'] && !headers['cache-control']) headers['Cache-Control'] = '';
  if (!headers['Content-Type'] && !headers['content-type']) headers['Content-Type'] = params.Body && params.Body.type || '';
  submitRequest.call(this, {
    Action: 'name/cos:AppendObject',
    method: 'POST',
    Bucket: params.Bucket,
    Region: params.Region,
    action: 'append',
    Key: params.Key,
    body: params.Body,
    qs: {
      position: params.Position
    },
    headers: params.Headers
  }, function (err, data) {
    if (err) return callback(err);
    callback(null, data);
  });
}
/**
 * 获取签名
 * @param  {Object}  params             参数对象，必须
 *     @param  {String}  params.Method  请求方法，必须
 *     @param  {String}  params.Key     object名称，必须
 *     @param  {String}  params.Expires 名超时时间，单位秒，可选
 * @return  {String}  data              返回签名字符串
 */


function getAuth(params) {
  var self = this;
  return util.getAuth({
    SecretId: params.SecretId || this.options.SecretId || '',
    SecretKey: params.SecretKey || this.options.SecretKey || '',
    Bucket: params.Bucket,
    Region: params.Region,
    Method: params.Method,
    Key: params.Key,
    Query: params.Query,
    Headers: params.Headers,
    Expires: params.Expires,
    UseRawKey: self.options.UseRawKey,
    SystemClockOffset: self.options.SystemClockOffset
  });
}
/**
 * 获取文件下载链接
 * @param  {Object}  params                 参数对象，必须
 *     @param  {String}  params.Bucket      Bucket名称，必须
 *     @param  {String}  params.Region      地域名称，必须
 *     @param  {String}  params.Key         object名称，必须
 *     @param  {String}  params.Method      请求的方法，可选
 *     @param  {String}  params.Expires     签名超时时间，单位秒，可选
 * @param  {Function}  callback             回调函数，必须
 *     @return  {Object}    err             请求失败的错误，如果请求成功，则为空。https://cloud.tencent.com/document/product/436/7730
 *     @return  {Object}    data            返回的数据
 */


function getObjectUrl(params, callback) {
  var self = this;
  var useAccelerate = params.UseAccelerate === undefined ? self.options.UseAccelerate : params.UseAccelerate;
  var url = getUrl({
    ForcePathStyle: self.options.ForcePathStyle,
    protocol: params.Protocol || self.options.Protocol,
    domain: params.Domain || self.options.Domain,
    bucket: params.Bucket,
    region: useAccelerate ? 'accelerate' : params.Region,
    object: params.Key
  });
  var queryParamsStr = '';

  if (params.Query) {
    queryParamsStr += util.obj2str(params.Query);
  }

  if (params.QueryString) {
    queryParamsStr += (queryParamsStr ? '&' : '') + params.QueryString;
  }

  var syncUrl = url;

  if (params.Sign !== undefined && !params.Sign) {
    queryParamsStr && (syncUrl += '?' + queryParamsStr);
    callback(null, {
      Url: syncUrl
    });
    return syncUrl;
  } // 签名加上 Host，避免跨桶访问


  var SignHost = getSignHost.call(this, {
    Bucket: params.Bucket,
    Region: params.Region,
    UseAccelerate: params.UseAccelerate,
    Url: url
  });
  var AuthData = getAuthorizationAsync.call(this, {
    Action: (params.Method || '').toUpperCase() === 'PUT' ? 'name/cos:PutObject' : 'name/cos:GetObject',
    Bucket: params.Bucket || '',
    Region: params.Region || '',
    Method: params.Method || 'get',
    Key: params.Key,
    Expires: params.Expires,
    Headers: params.Headers,
    Query: params.Query,
    SignHost: SignHost,
    ForceSignHost: params.ForceSignHost === false ? false : self.options.ForceSignHost // getObjectUrl支持传参ForceSignHost

  }, function (err, AuthData) {
    if (!callback) return;

    if (err) {
      callback(err);
      return;
    } // 兼容万象url qUrlParamList需要再encode一次


    var replaceUrlParamList = function replaceUrlParamList(url) {
      var urlParams = url.match(/q-url-param-list.*?(?=&)/g)[0];
      var encodedParams = 'q-url-param-list=' + encodeURIComponent(urlParams.replace(/q-url-param-list=/, '')).toLowerCase();
      var reg = new RegExp(urlParams, 'g');
      var replacedUrl = url.replace(reg, encodedParams);
      return replacedUrl;
    };

    var signUrl = url;
    signUrl += '?' + (AuthData.Authorization.indexOf('q-signature') > -1 ? replaceUrlParamList(AuthData.Authorization) : 'sign=' + encodeURIComponent(AuthData.Authorization));
    AuthData.SecurityToken && (signUrl += '&x-cos-security-token=' + AuthData.SecurityToken);
    AuthData.ClientIP && (signUrl += '&clientIP=' + AuthData.ClientIP);
    AuthData.ClientUA && (signUrl += '&clientUA=' + AuthData.ClientUA);
    AuthData.Token && (signUrl += '&token=' + AuthData.Token);
    queryParamsStr && (signUrl += '&' + queryParamsStr);
    setTimeout(function () {
      callback(null, {
        Url: signUrl
      });
    });
  });

  if (AuthData) {
    syncUrl += '?' + AuthData.Authorization + (AuthData.SecurityToken ? '&x-cos-security-token=' + AuthData.SecurityToken : '');
    queryParamsStr && (syncUrl += '&' + queryParamsStr);
  } else {
    queryParamsStr && (syncUrl += '?' + queryParamsStr);
  }

  return syncUrl;
}
/**
 * 私有方法
 */


function decodeAcl(AccessControlPolicy) {
  var result = {
    GrantFullControl: [],
    GrantWrite: [],
    GrantRead: [],
    GrantReadAcp: [],
    GrantWriteAcp: [],
    ACL: ''
  };
  var GrantMap = {
    'FULL_CONTROL': 'GrantFullControl',
    'WRITE': 'GrantWrite',
    'READ': 'GrantRead',
    'READ_ACP': 'GrantReadAcp',
    'WRITE_ACP': 'GrantWriteAcp'
  };
  var AccessControlList = AccessControlPolicy && AccessControlPolicy.AccessControlList || {};
  var Grant = AccessControlList.Grant;

  if (Grant) {
    Grant = util.isArray(Grant) ? Grant : [Grant];
  }

  var PublicAcl = {
    READ: 0,
    WRITE: 0,
    FULL_CONTROL: 0
  };
  Grant && Grant.length && util.each(Grant, function (item) {
    if (item.Grantee.ID === 'qcs::cam::anyone:anyone' || item.Grantee.URI === 'http://cam.qcloud.com/groups/global/AllUsers') {
      PublicAcl[item.Permission] = 1;
    } else if (item.Grantee.ID !== AccessControlPolicy.Owner.ID) {
      result[GrantMap[item.Permission]].push('id="' + item.Grantee.ID + '"');
    }
  });

  if (PublicAcl.FULL_CONTROL || PublicAcl.WRITE && PublicAcl.READ) {
    result.ACL = 'public-read-write';
  } else if (PublicAcl.READ) {
    result.ACL = 'public-read';
  } else {
    result.ACL = 'private';
  }

  util.each(GrantMap, function (item) {
    result[item] = uniqGrant(result[item].join(','));
  });
  return result;
} // Grant 去重


function uniqGrant(str) {
  var arr = str.split(',');
  var exist = {};
  var i, item;

  for (i = 0; i < arr.length;) {
    item = arr[i].trim();

    if (exist[item]) {
      arr.splice(i, 1);
    } else {
      exist[item] = true;
      arr[i] = item;
      i++;
    }
  }

  return arr.join(',');
} // 生成操作 url


function getUrl(params) {
  var region = params.region || '';
  var longBucket = params.bucket || '';
  var shortBucket = longBucket.substr(0, longBucket.lastIndexOf('-'));
  var appId = longBucket.substr(longBucket.lastIndexOf('-') + 1);
  var domain = params.domain;
  var object = params.object;

  if (typeof domain === 'function') {
    domain = domain({
      Bucket: longBucket,
      Region: region
    });
  } // 兼容不带冒号的http、https


  if (['http', 'https'].includes(params.protocol)) {
    params.protocol = params.protocol + ':';
  }

  var protocol = params.protocol || (util.isBrowser && location.protocol === 'http:' ? 'http:' : 'https:');

  if (!domain) {
    if (['cn-south', 'cn-south-2', 'cn-north', 'cn-east', 'cn-southwest', 'sg'].indexOf(region) > -1) {
      domain = '{Region}.myqcloud.com';
    } else {
      domain = 'cos.{Region}.myqcloud.com';
    }

    if (!params.ForcePathStyle) {
      domain = '{Bucket}.' + domain;
    }
  }

  domain = domain.replace(/\{\{AppId\}\}/ig, appId).replace(/\{\{Bucket\}\}/ig, shortBucket).replace(/\{\{Region\}\}/ig, region).replace(/\{\{.*?\}\}/ig, '');
  domain = domain.replace(/\{AppId\}/ig, appId).replace(/\{BucketName\}/ig, shortBucket).replace(/\{Bucket\}/ig, longBucket).replace(/\{Region\}/ig, region).replace(/\{.*?\}/ig, '');

  if (!/^[a-zA-Z]+:\/\//.test(domain)) {
    domain = protocol + '//' + domain;
  } // 去掉域名最后的斜杆


  if (domain.slice(-1) === '/') {
    domain = domain.slice(0, -1);
  }

  var url = domain;

  if (params.ForcePathStyle) {
    url += '/' + longBucket;
  }

  url += '/';

  if (object) {
    url += util.camSafeUrlEncode(object).replace(/%2F/g, '/');
  }

  if (params.isLocation) {
    url = url.replace(/^https?:\/\//, '');
  }

  return url;
}

var getSignHost = function getSignHost(opt) {
  if (!opt.Bucket || !opt.Region) return '';
  var useAccelerate = opt.UseAccelerate === undefined ? this.options.UseAccelerate : opt.UseAccelerate;
  var url = opt.Url || getUrl({
    ForcePathStyle: this.options.ForcePathStyle,
    protocol: this.options.Protocol,
    domain: this.options.Domain,
    bucket: opt.Bucket,
    region: useAccelerate ? 'accelerate' : opt.Region
  });
  var urlHost = url.replace(/^https?:\/\/([^/]+)(\/.*)?$/, '$1');
  var standardHostReg = new RegExp('^([a-z\\d-]+-\\d+\\.)?(cos|cosv6|ci|pic)\\.([a-z\\d-]+)\\.myqcloud\\.com$');
  if (standardHostReg.test(urlHost)) return urlHost;
  return '';
}; // 异步获取签名


function getAuthorizationAsync(params, callback) {
  var headers = util.clone(params.Headers);
  var headerHost = '';
  util.each(headers, function (v, k) {
    (v === '' || ['content-type', 'cache-control', 'expires'].indexOf(k.toLowerCase()) > -1) && delete headers[k];
    if (k.toLowerCase() === 'host') headerHost = v;
  }); // ForceSignHost明确传入false才不加入host签名

  var forceSignHost = params.ForceSignHost === false ? false : true; // Host 加入签名计算

  if (!headerHost && params.SignHost && forceSignHost) headers.Host = params.SignHost; // 获取凭证的回调，避免用户 callback 多次

  var cbDone = false;

  var cb = function cb(err, AuthData) {
    if (cbDone) return;
    cbDone = true;

    if (AuthData && AuthData.XCosSecurityToken && !AuthData.SecurityToken) {
      AuthData = util.clone(AuthData);
      AuthData.SecurityToken = AuthData.XCosSecurityToken;
      delete AuthData.XCosSecurityToken;
    }

    callback && callback(err, AuthData);
  };

  var self = this;
  var Bucket = params.Bucket || '';
  var Region = params.Region || ''; // PathName

  var KeyName = params.Key || '';

  if (self.options.ForcePathStyle && Bucket) {
    KeyName = Bucket + '/' + KeyName;
  }

  var Pathname = '/' + KeyName; // Action、ResourceKey

  var StsData = {};
  var Scope = params.Scope;

  if (!Scope) {
    var Action = params.Action || '';
    var ResourceKey = params.ResourceKey || params.Key || '';
    Scope = params.Scope || [{
      action: Action,
      bucket: Bucket,
      region: Region,
      prefix: ResourceKey
    }];
  }

  var ScopeKey = util.md5(JSON.stringify(Scope)); // STS

  self._StsCache = self._StsCache || [];

  (function () {
    var i, AuthData;

    for (i = self._StsCache.length - 1; i >= 0; i--) {
      AuthData = self._StsCache[i];
      var compareTime = Math.round(util.getSkewTime(self.options.SystemClockOffset) / 1000) + 30;

      if (AuthData.StartTime && compareTime < AuthData.StartTime || compareTime >= AuthData.ExpiredTime) {
        self._StsCache.splice(i, 1);

        continue;
      }

      if (!AuthData.ScopeLimit || AuthData.ScopeLimit && AuthData.ScopeKey === ScopeKey) {
        StsData = AuthData;
        break;
      }
    }
  })();

  var calcAuthByTmpKey = function calcAuthByTmpKey() {
    var KeyTime = '';
    if (StsData.StartTime && params.Expires) KeyTime = StsData.StartTime + ';' + (StsData.StartTime + params.Expires * 1);else if (StsData.StartTime && StsData.ExpiredTime) KeyTime = StsData.StartTime + ';' + StsData.ExpiredTime;
    var Authorization = util.getAuth({
      SecretId: StsData.TmpSecretId,
      SecretKey: StsData.TmpSecretKey,
      Method: params.Method,
      Pathname: Pathname,
      Query: params.Query,
      Headers: headers,
      Expires: params.Expires,
      UseRawKey: self.options.UseRawKey,
      SystemClockOffset: self.options.SystemClockOffset,
      KeyTime: KeyTime,
      ForceSignHost: forceSignHost
    });
    var AuthData = {
      Authorization: Authorization,
      SecurityToken: StsData.SecurityToken || StsData.XCosSecurityToken || '',
      Token: StsData.Token || '',
      ClientIP: StsData.ClientIP || '',
      ClientUA: StsData.ClientUA || ''
    };
    cb(null, AuthData);
  };

  var checkAuthError = function checkAuthError(AuthData) {
    if (AuthData.Authorization) {
      // 检查签名格式
      var formatAllow = false;
      var auth = AuthData.Authorization;

      if (auth) {
        if (auth.indexOf(' ') > -1) {
          formatAllow = false;
        } else if (auth.indexOf('q-sign-algorithm=') > -1 && auth.indexOf('q-ak=') > -1 && auth.indexOf('q-sign-time=') > -1 && auth.indexOf('q-key-time=') > -1 && auth.indexOf('q-url-param-list=') > -1) {
          formatAllow = true;
        } else {
          try {
            auth = atob(auth);

            if (auth.indexOf('a=') > -1 && auth.indexOf('k=') > -1 && auth.indexOf('t=') > -1 && auth.indexOf('r=') > -1 && auth.indexOf('b=') > -1) {
              formatAllow = true;
            }
          } catch (e) {}
        }
      }

      if (!formatAllow) return util.error(new Error('getAuthorization callback params format error'));
    } else {
      if (!AuthData.TmpSecretId) return util.error(new Error('getAuthorization callback params missing "TmpSecretId"'));
      if (!AuthData.TmpSecretKey) return util.error(new Error('getAuthorization callback params missing "TmpSecretKey"'));
      if (!AuthData.SecurityToken && !AuthData.XCosSecurityToken) return util.error(new Error('getAuthorization callback params missing "SecurityToken"'));
      if (!AuthData.ExpiredTime) return util.error(new Error('getAuthorization callback params missing "ExpiredTime"'));
      if (AuthData.ExpiredTime && AuthData.ExpiredTime.toString().length !== 10) return util.error(new Error('getAuthorization callback params "ExpiredTime" should be 10 digits'));
      if (AuthData.StartTime && AuthData.StartTime.toString().length !== 10) return util.error(new Error('getAuthorization callback params "StartTime" should be 10 StartTime'));
    }

    return false;
  }; // 先判断是否有临时密钥


  if (StsData.ExpiredTime && StsData.ExpiredTime - util.getSkewTime(self.options.SystemClockOffset) / 1000 > 60) {
    // 如果缓存的临时密钥有效，并还有超过60秒有效期就直接使用
    calcAuthByTmpKey();
  } else if (self.options.getAuthorization) {
    // 外部计算签名或获取临时密钥
    self.options.getAuthorization.call(self, {
      Bucket: Bucket,
      Region: Region,
      Method: params.Method,
      Key: KeyName,
      Pathname: Pathname,
      Query: params.Query,
      Headers: headers,
      Scope: Scope,
      SystemClockOffset: self.options.SystemClockOffset,
      ForceSignHost: forceSignHost
    }, function (AuthData) {
      if (typeof AuthData === 'string') AuthData = {
        Authorization: AuthData
      };
      var AuthError = checkAuthError(AuthData);
      if (AuthError) return cb(AuthError);

      if (AuthData.Authorization) {
        cb(null, AuthData);
      } else {
        StsData = AuthData || {};
        StsData.Scope = Scope;
        StsData.ScopeKey = ScopeKey;

        self._StsCache.push(StsData);

        calcAuthByTmpKey();
      }
    });
  } else if (self.options.getSTS) {
    // 外部获取临时密钥
    self.options.getSTS.call(self, {
      Bucket: Bucket,
      Region: Region
    }, function (data) {
      StsData = data || {};
      StsData.Scope = Scope;
      StsData.ScopeKey = ScopeKey;
      if (!StsData.TmpSecretId) StsData.TmpSecretId = StsData.SecretId;
      if (!StsData.TmpSecretKey) StsData.TmpSecretKey = StsData.SecretKey;
      var AuthError = checkAuthError(StsData);
      if (AuthError) return cb(AuthError);

      self._StsCache.push(StsData);

      calcAuthByTmpKey();
    });
  } else {
    // 内部计算获取签名
    return function () {
      var Authorization = util.getAuth({
        SecretId: params.SecretId || self.options.SecretId,
        SecretKey: params.SecretKey || self.options.SecretKey,
        Method: params.Method,
        Pathname: Pathname,
        Query: params.Query,
        Headers: headers,
        Expires: params.Expires,
        UseRawKey: self.options.UseRawKey,
        SystemClockOffset: self.options.SystemClockOffset,
        ForceSignHost: forceSignHost
      });
      var AuthData = {
        Authorization: Authorization,
        SecurityToken: self.options.SecurityToken || self.options.XCosSecurityToken
      };
      cb(null, AuthData);
      return AuthData;
    }();
  }

  return '';
} // 调整时间偏差


function allowRetry(err) {
  var allowRetry = false;
  var isTimeError = false;
  var serverDate = err.headers && (err.headers.date || err.headers.Date) || err.error && err.error.ServerTime;

  try {
    var errorCode = err.error.Code;
    var errorMessage = err.error.Message;

    if (errorCode === 'RequestTimeTooSkewed' || errorCode === 'AccessDenied' && errorMessage === 'Request has expired') {
      isTimeError = true;
    }
  } catch (e) {}

  if (err) {
    if (isTimeError && serverDate) {
      var serverTime = Date.parse(serverDate);

      if (this.options.CorrectClockSkew && Math.abs(util.getSkewTime(this.options.SystemClockOffset) - serverTime) >= 30000) {
        console.error('error: Local time is too skewed.');
        this.options.SystemClockOffset = serverTime - Date.now();
        allowRetry = true;
      }
    } else if (Math.floor(err.statusCode / 100) === 5) {
      allowRetry = true;
    }
  }

  return allowRetry;
} // 获取签名并发起请求


function submitRequest(params, callback) {
  var self = this; // 处理 headers

  !params.headers && (params.headers = {}); // 处理 query

  !params.qs && (params.qs = {});
  params.VersionId && (params.qs.versionId = params.VersionId);
  params.qs = util.clearKey(params.qs); // 清理 undefined 和 null 字段

  params.headers && (params.headers = util.clearKey(params.headers));
  params.qs && (params.qs = util.clearKey(params.qs));
  var Query = util.clone(params.qs);
  params.action && (Query[params.action] = '');
  var paramsUrl = params.url || params.Url;
  var SignHost = params.SignHost || getSignHost.call(this, {
    Bucket: params.Bucket,
    Region: params.Region,
    Url: paramsUrl
  });
  var tracker = params.tracker;

  var next = function next(tryTimes) {
    var oldClockOffset = self.options.SystemClockOffset;
    tracker && tracker.setParams({
      signStartTime: new Date().getTime(),
      retryTimes: tryTimes - 1
    });
    getAuthorizationAsync.call(self, {
      Bucket: params.Bucket || '',
      Region: params.Region || '',
      Method: params.method,
      Key: params.Key,
      Query: Query,
      Headers: params.headers,
      SignHost: SignHost,
      Action: params.Action,
      ResourceKey: params.ResourceKey,
      Scope: params.Scope,
      ForceSignHost: self.options.ForceSignHost
    }, function (err, AuthData) {
      if (err) {
        callback(err);
        return;
      }

      tracker && tracker.setParams({
        signEndTime: new Date().getTime(),
        httpStartTime: new Date().getTime()
      });
      params.AuthData = AuthData;

      _submitRequest.call(self, params, function (err, data) {
        tracker && tracker.setParams({
          httpEndTime: new Date().getTime()
        });

        if (err && tryTimes < 2 && (oldClockOffset !== self.options.SystemClockOffset || allowRetry.call(self, err))) {
          if (params.headers) {
            delete params.headers.Authorization;
            delete params.headers['token'];
            delete params.headers['clientIP'];
            delete params.headers['clientUA'];
            params.headers['x-cos-security-token'] && delete params.headers['x-cos-security-token'];
            params.headers['x-ci-security-token'] && delete params.headers['x-ci-security-token'];
          }

          next(tryTimes + 1);
        } else {
          callback(err, data);
        }
      });
    });
  };

  next(1);
} // 发起请求


function _submitRequest(params, callback) {
  var self = this;
  var TaskId = params.TaskId;
  if (TaskId && !self._isRunningTask(TaskId)) return;
  var bucket = params.Bucket;
  var region = params.Region;
  var object = params.Key;
  var method = params.method || 'GET';
  var url = params.Url || params.url;
  var body = params.body;
  var rawBody = params.rawBody; // url

  if (self.options.UseAccelerate) {
    region = 'accelerate';
  }

  url = url || getUrl({
    ForcePathStyle: self.options.ForcePathStyle,
    protocol: self.options.Protocol,
    domain: self.options.Domain,
    bucket: bucket,
    region: region,
    object: object
  });

  if (params.action) {
    // 已知问题，某些版本的qq会对url自动拼接（比如/upload被拼接成/upload=(null)）导致签名错误，这里做下兼容。
    url = url + '?' + (util.isIOS_QQ ? "".concat(params.action, "=") : params.action);
  }

  if (params.qsStr) {
    if (url.indexOf('?') > -1) {
      url = url + '&' + params.qsStr;
    } else {
      url = url + '?' + params.qsStr;
    }
  }

  var opt = {
    method: method,
    url: url,
    headers: params.headers,
    qs: params.qs,
    body: body
  }; // 兼容ci接口

  var token = 'x-cos-security-token';

  if (util.isCIHost(url)) {
    token = 'x-ci-security-token';
  } // 获取签名


  opt.headers.Authorization = params.AuthData.Authorization;
  params.AuthData.Token && (opt.headers['token'] = params.AuthData.Token);
  params.AuthData.ClientIP && (opt.headers['clientIP'] = params.AuthData.ClientIP);
  params.AuthData.ClientUA && (opt.headers['clientUA'] = params.AuthData.ClientUA);
  params.AuthData.SecurityToken && (opt.headers[token] = params.AuthData.SecurityToken); // 清理 undefined 和 null 字段

  opt.headers && (opt.headers = util.clearKey(opt.headers));
  opt = util.clearKey(opt); // progress

  if (params.onProgress && typeof params.onProgress === 'function') {
    var contentLength = body && (body.size || body.length) || 0;

    opt.onProgress = function (e) {
      if (TaskId && !self._isRunningTask(TaskId)) return;
      var loaded = e ? e.loaded : 0;
      params.onProgress({
        loaded: loaded,
        total: contentLength
      });
    };
  }

  if (params.onDownloadProgress) {
    opt.onDownloadProgress = params.onDownloadProgress;
  }

  if (params.DataType) {
    opt.dataType = params.DataType;
  }

  if (this.options.Timeout) {
    opt.timeout = this.options.Timeout;
  }

  self.options.ForcePathStyle && (opt.pathStyle = self.options.ForcePathStyle);
  self.emit('before-send', opt);
  var useAccelerate = opt.url.includes('accelerate.');
  var queryString = opt.qs ? Object.keys(opt.qs).map(function (key) {
    return "".concat(key, "=").concat(opt.qs[key]);
  }).join('&') : '';
  var fullUrl = queryString ? opt.url + '?' + queryString : opt.url;
  params.tracker && params.tracker.setParams({
    reqUrl: fullUrl,
    accelerate: useAccelerate ? 'Y' : 'N'
  }); // 分块上传时给父级tracker设置url信息

  params.tracker && params.tracker.parent && params.tracker.parent.setParams({
    reqUrl: fullUrl,
    accelerate: useAccelerate ? 'Y' : 'N'
  });
  var sender = (self.options.Request || REQUEST)(opt, function (r) {
    if (r.error === 'abort') return;
    var receive = {
      options: opt,
      error: err,
      statusCode: response && response.statusCode || 0,
      headers: response && response.headers || {},
      body: body
    };
    self.emit('after-receive', receive);
    err = receive.error;
    body = receive.body;
    response = {
      statusCode: receive.statusCode,
      headers: receive.headers
    }; // 抛出事件，允许修改返回值的 error、statusCode、statusMessage、body

    self.emit('after-receive', r);
    var response = {
      statusCode: r.statusCode,
      statusMessage: r.statusMessage,
      headers: r.headers
    };
    var err = r.error;
    var body = r.body; // 返回内容添加 状态码 和 headers

    var hasReturned;

    var cb = function cb(err, data) {
      TaskId && self.off('inner-kill-task', killTask);
      if (hasReturned) return;
      hasReturned = true;
      var attrs = {};
      response && response.statusCode && (attrs.statusCode = response.statusCode);
      response && response.headers && (attrs.headers = response.headers);

      if (err) {
        err = util.extend(err || {}, attrs);
        callback(err, null);
      } else {
        data = util.extend(data || {}, attrs);
        callback(null, data);
      }

      sender = null;
    }; // 请求错误，发生网络错误


    if (err) return cb(util.error(err)); // 请求返回码不为 200

    var statusCode = response.statusCode;
    var statusSuccess = Math.floor(statusCode / 100) === 2; // 200 202 204 206
    // 不对 body 进行转换，body 直接挂载返回

    if (rawBody && statusSuccess) return cb(null, {
      body: body
    }); // 解析 xml body

    var json;

    try {
      json = body && body.indexOf('<') > -1 && body.indexOf('>') > -1 && util.xml2json(body) || {};
    } catch (e) {
      json = {};
    } // 处理返回值


    var xmlError = json && json.Error;

    if (statusSuccess) {
      // 正确返回，状态码 2xx 时，body 不会有 Error
      cb(null, json);
    } else if (xmlError) {
      // 正常返回了 xml body，且有 Error 节点
      cb(util.error(new Error(xmlError.Message), {
        code: xmlError.Code,
        error: xmlError
      }));
    } else if (statusCode) {
      // 有错误的状态码
      cb(util.error(new Error(response.statusMessage), {
        code: '' + statusCode
      }));
    } else if (statusCode) {
      // 无状态码，或者获取不到状态码
      cb(util.error(new Error('statusCode error')));
    }
  }); // kill task

  var killTask = function killTask(data) {
    if (data.TaskId === TaskId) {
      sender && sender.abort && sender.abort();
      self.off('inner-kill-task', killTask);
    }
  };

  TaskId && self.on('inner-kill-task', killTask);
}

var API_MAP = {
  // Bucket 相关方法
  getService: getService,
  // Bucket
  putBucket: putBucket,
  headBucket: headBucket,
  // Bucket
  getBucket: getBucket,
  deleteBucket: deleteBucket,
  putBucketAcl: putBucketAcl,
  // BucketACL
  getBucketAcl: getBucketAcl,
  putBucketCors: putBucketCors,
  // BucketCors
  getBucketCors: getBucketCors,
  deleteBucketCors: deleteBucketCors,
  getBucketLocation: getBucketLocation,
  // BucketLocation
  getBucketPolicy: getBucketPolicy,
  // BucketPolicy
  putBucketPolicy: putBucketPolicy,
  deleteBucketPolicy: deleteBucketPolicy,
  putBucketTagging: putBucketTagging,
  // BucketTagging
  getBucketTagging: getBucketTagging,
  deleteBucketTagging: deleteBucketTagging,
  putBucketLifecycle: putBucketLifecycle,
  // BucketLifecycle
  getBucketLifecycle: getBucketLifecycle,
  deleteBucketLifecycle: deleteBucketLifecycle,
  putBucketVersioning: putBucketVersioning,
  // BucketVersioning
  getBucketVersioning: getBucketVersioning,
  putBucketReplication: putBucketReplication,
  // BucketReplication
  getBucketReplication: getBucketReplication,
  deleteBucketReplication: deleteBucketReplication,
  putBucketWebsite: putBucketWebsite,
  // BucketWebsite
  getBucketWebsite: getBucketWebsite,
  deleteBucketWebsite: deleteBucketWebsite,
  putBucketReferer: putBucketReferer,
  // BucketReferer
  getBucketReferer: getBucketReferer,
  putBucketDomain: putBucketDomain,
  // BucketDomain
  getBucketDomain: getBucketDomain,
  deleteBucketDomain: deleteBucketDomain,
  putBucketOrigin: putBucketOrigin,
  // BucketOrigin
  getBucketOrigin: getBucketOrigin,
  deleteBucketOrigin: deleteBucketOrigin,
  putBucketLogging: putBucketLogging,
  // BucketLogging
  getBucketLogging: getBucketLogging,
  putBucketInventory: putBucketInventory,
  // BucketInventory
  getBucketInventory: getBucketInventory,
  listBucketInventory: listBucketInventory,
  deleteBucketInventory: deleteBucketInventory,
  putBucketAccelerate: putBucketAccelerate,
  getBucketAccelerate: getBucketAccelerate,
  putBucketEncryption: putBucketEncryption,
  getBucketEncryption: getBucketEncryption,
  deleteBucketEncryption: deleteBucketEncryption,
  // Object 相关方法
  getObject: getObject,
  headObject: headObject,
  listObjectVersions: listObjectVersions,
  putObject: putObject,
  deleteObject: deleteObject,
  getObjectAcl: getObjectAcl,
  putObjectAcl: putObjectAcl,
  optionsObject: optionsObject,
  putObjectCopy: putObjectCopy,
  deleteMultipleObject: deleteMultipleObject,
  restoreObject: restoreObject,
  putObjectTagging: putObjectTagging,
  getObjectTagging: getObjectTagging,
  deleteObjectTagging: deleteObjectTagging,
  selectObjectContent: selectObjectContent,
  appendObject: appendObject,
  // 分块上传相关方法
  uploadPartCopy: uploadPartCopy,
  multipartInit: multipartInit,
  multipartUpload: multipartUpload,
  multipartComplete: multipartComplete,
  multipartList: multipartList,
  multipartListPart: multipartListPart,
  multipartAbort: multipartAbort,
  // 工具方法
  request: request,
  getObjectUrl: getObjectUrl,
  getAuth: getAuth
};

function warnOldApi(apiName, fn, proto) {
  util.each(['Cors', 'Acl'], function (suffix) {
    if (apiName.slice(-suffix.length) === suffix) {
      var oldName = apiName.slice(0, -suffix.length) + suffix.toUpperCase();
      var apiFn = util.apiWrapper(apiName, fn);
      var warned = false;

      proto[oldName] = function () {
        !warned && console.warn('warning: cos.' + oldName + ' has been deprecated. Please Use cos.' + apiName + ' instead.');
        warned = true;
        apiFn.apply(this, arguments);
      };
    }
  });
}

module.exports.init = function (COS, task) {
  task.transferToTaskMethod(API_MAP, 'putObject');
  util.each(API_MAP, function (fn, apiName) {
    COS.prototype[apiName] = util.apiWrapper(apiName, fn);
    warnOldApi(apiName, fn, COS.prototype);
  });
};

/***/ }),

/***/ "./src/cos.js":
/*!********************!*\
  !*** ./src/cos.js ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var util = __webpack_require__(/*! ./util */ "./src/util.js");

var event = __webpack_require__(/*! ./event */ "./src/event.js");

var task = __webpack_require__(/*! ./task */ "./src/task.js");

var base = __webpack_require__(/*! ./base */ "./src/base.js");

var advance = __webpack_require__(/*! ./advance */ "./src/advance.js");

var pkg = __webpack_require__(/*! ../package.json */ "./package.json");

var defaultOptions = {
  AppId: '',
  // AppId 已废弃，请拼接到 Bucket 后传入，例如：test-1250000000
  SecretId: '',
  SecretKey: '',
  SecurityToken: '',
  // 使用临时密钥需要注意自行刷新 Token
  ChunkRetryTimes: 2,
  FileParallelLimit: 3,
  ChunkParallelLimit: 3,
  ChunkSize: 1024 * 1024,
  SliceSize: 1024 * 1024,
  CopyChunkParallelLimit: 20,
  CopyChunkSize: 1024 * 1024 * 10,
  CopySliceSize: 1024 * 1024 * 10,
  MaxPartNumber: 10000,
  ProgressInterval: 1000,
  Domain: '',
  ServiceDomain: '',
  Protocol: '',
  CompatibilityMode: false,
  ForcePathStyle: false,
  UseRawKey: false,
  Timeout: 0,
  // 单位毫秒，0 代表不设置超时时间
  CorrectClockSkew: true,
  SystemClockOffset: 0,
  // 单位毫秒，ms
  UploadCheckContentMd5: false,
  UploadQueueSize: 10000,
  UploadAddMetaMd5: false,
  UploadIdCacheLimit: 50,
  UseAccelerate: false,
  ForceSignHost: true,
  // 默认将host加入签名计算，关闭后可能导致越权风险，建议保持为true
  EnableTracker: false,
  // 默认关闭上报
  DeepTracker: false,
  // 上报时是否对每个分块上传做单独上报
  TrackerDelay: 5000,
  // 周期性上报，单位毫秒。0代表实时上报
  CustomId: '' // 自定义上报id

}; // 对外暴露的类

var COS = function COS(options) {
  this.options = util.extend(util.clone(defaultOptions), options || {});
  this.options.FileParallelLimit = Math.max(1, this.options.FileParallelLimit);
  this.options.ChunkParallelLimit = Math.max(1, this.options.ChunkParallelLimit);
  this.options.ChunkRetryTimes = Math.max(0, this.options.ChunkRetryTimes);
  this.options.ChunkSize = Math.max(1024 * 1024, this.options.ChunkSize);
  this.options.CopyChunkParallelLimit = Math.max(1, this.options.CopyChunkParallelLimit);
  this.options.CopyChunkSize = Math.max(1024 * 1024, this.options.CopyChunkSize);
  this.options.CopySliceSize = Math.max(0, this.options.CopySliceSize);
  this.options.MaxPartNumber = Math.max(1024, Math.min(10000, this.options.MaxPartNumber));
  this.options.Timeout = Math.max(0, this.options.Timeout);

  if (this.options.AppId) {
    console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g: "test-1250000000").');
  }

  if (this.options.SecretId && this.options.SecretId.indexOf(' ') > -1) {
    console.error('error: SecretId格式错误，请检查');
    console.error('error: SecretId format is incorrect. Please check');
  }

  if (this.options.SecretKey && this.options.SecretKey.indexOf(' ') > -1) {
    console.error('error: SecretKey格式错误，请检查');
    console.error('error: SecretKey format is incorrect. Please check');
  }

  if (util.isNode()) {
    console.warn('warning: cos-js-sdk-v5 不支持 nodejs 环境使用，请改用 cos-nodejs-sdk-v5，参考文档： https://cloud.tencent.com/document/product/436/8629');
    console.warn('warning: cos-js-sdk-v5 does not support nodejs environment. Please use cos-nodejs-sdk-v5 instead. See: https://cloud.tencent.com/document/product/436/8629');
  }

  event.init(this);
  task.init(this);
};

base.init(COS, task);
advance.init(COS, task);
COS.util = {
  md5: util.md5,
  xml2json: util.xml2json,
  json2xml: util.json2xml
};
COS.getAuthorization = util.getAuth;
COS.version = pkg.version;
module.exports = COS;

/***/ }),

/***/ "./src/event.js":
/*!**********************!*\
  !*** ./src/event.js ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports) {

var initEvent = function initEvent(cos) {
  var listeners = {};

  var getList = function getList(action) {
    !listeners[action] && (listeners[action] = []);
    return listeners[action];
  };

  cos.on = function (action, callback) {
    if (action === 'task-list-update') {
      console.warn('warning: Event "' + action + '" has been deprecated. Please use "list-update" instead.');
    }

    getList(action).push(callback);
  };

  cos.off = function (action, callback) {
    var list = getList(action);

    for (var i = list.length - 1; i >= 0; i--) {
      callback === list[i] && list.splice(i, 1);
    }
  };

  cos.emit = function (action, data) {
    var list = getList(action).map(function (cb) {
      return cb;
    });

    for (var i = 0; i < list.length; i++) {
      list[i](data);
    }
  };
};

var EventProxy = function EventProxy() {
  initEvent(this);
};

module.exports.init = initEvent;
module.exports.EventProxy = EventProxy;

/***/ }),

/***/ "./src/session.js":
/*!************************!*\
  !*** ./src/session.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var util = __webpack_require__(/*! ./util */ "./src/util.js"); // 按照文件特征值，缓存 UploadId


var cacheKey = 'cos_sdk_upload_cache';
var expires = 30 * 24 * 3600;
var cache;
var timer;

var getCache = function getCache() {
  try {
    var val = JSON.parse(localStorage.getItem(cacheKey));
  } catch (e) {}

  if (!val) val = [];
  cache = val;
};

var setCache = function setCache() {
  try {
    if (cache.length) localStorage.setItem(cacheKey, JSON.stringify(cache));else localStorage.removeItem(cacheKey);
  } catch (e) {}
};

var init = function init() {
  if (cache) return;
  getCache.call(this); // 清理太老旧的数据

  var changed = false;
  var now = Math.round(Date.now() / 1000);

  for (var i = cache.length - 1; i >= 0; i--) {
    var mtime = cache[i][2];

    if (!mtime || mtime + expires < now) {
      cache.splice(i, 1);
      changed = true;
    }
  }

  changed && setCache();
}; // 把缓存存到本地


var save = function save() {
  if (timer) return;
  timer = setTimeout(function () {
    setCache();
    timer = null;
  }, 400);
};

var mod = {
  using: {},
  // 标记 UploadId 正在使用
  setUsing: function setUsing(uuid) {
    mod.using[uuid] = true;
  },
  // 标记 UploadId 已经没在使用
  removeUsing: function removeUsing(uuid) {
    delete mod.using[uuid];
  },
  // 用上传参数生成哈希值
  getFileId: function getFileId(file, ChunkSize, Bucket, Key) {
    if (file.name && file.size && file.lastModifiedDate && ChunkSize) {
      return util.md5([file.name, file.size, file.lastModifiedDate, ChunkSize, Bucket, Key].join('::'));
    } else {
      return null;
    }
  },
  // 用上传参数生成哈希值
  getCopyFileId: function getCopyFileId(copySource, sourceHeaders, ChunkSize, Bucket, Key) {
    var size = sourceHeaders['content-length'];
    var etag = sourceHeaders.etag || '';
    var lastModified = sourceHeaders['last-modified'];

    if (copySource && ChunkSize) {
      return util.md5([copySource, size, etag, lastModified, ChunkSize, Bucket, Key].join('::'));
    } else {
      return null;
    }
  },
  // 获取文件对应的 UploadId 列表
  getUploadIdList: function getUploadIdList(uuid) {
    if (!uuid) return null;
    init.call(this);
    var list = [];

    for (var i = 0; i < cache.length; i++) {
      if (cache[i][0] === uuid) list.push(cache[i][1]);
    }

    return list.length ? list : null;
  },
  // 缓存 UploadId
  saveUploadId: function saveUploadId(uuid, UploadId, limit) {
    init.call(this);
    if (!uuid) return; // 清理没用的 UploadId，js 文件没有 FilePath ，只清理相同记录

    for (var i = cache.length - 1; i >= 0; i--) {
      var item = cache[i];

      if (item[0] === uuid && item[1] === UploadId) {
        cache.splice(i, 1);
      }
    }

    cache.unshift([uuid, UploadId, Math.round(Date.now() / 1000)]);
    if (cache.length > limit) cache.splice(limit);
    save();
  },
  // UploadId 已用完，移除掉
  removeUploadId: function removeUploadId(UploadId) {
    init.call(this);
    delete mod.using[UploadId];

    for (var i = cache.length - 1; i >= 0; i--) {
      if (cache[i][1] === UploadId) cache.splice(i, 1);
    }

    save();
  }
};
module.exports = mod;

/***/ }),

/***/ "./src/task.js":
/*!*********************!*\
  !*** ./src/task.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var session = __webpack_require__(/*! ./session */ "./src/session.js");

var util = __webpack_require__(/*! ./util */ "./src/util.js");

var originApiMap = {};

var transferToTaskMethod = function transferToTaskMethod(apiMap, apiName) {
  originApiMap[apiName] = apiMap[apiName];

  apiMap[apiName] = function (params, callback) {
    if (params.SkipTask) {
      originApiMap[apiName].call(this, params, callback);
    } else {
      this._addTask(apiName, params, callback);
    }
  };
};

var initTask = function initTask(cos) {
  var queue = [];
  var tasks = {};
  var uploadingFileCount = 0;
  var nextUploadIndex = 0; // 接口返回简略的任务信息

  var formatTask = function formatTask(task) {
    var t = {
      id: task.id,
      Bucket: task.Bucket,
      Region: task.Region,
      Key: task.Key,
      FilePath: task.FilePath,
      state: task.state,
      loaded: task.loaded,
      size: task.size,
      speed: task.speed,
      percent: task.percent,
      hashPercent: task.hashPercent,
      error: task.error
    };
    if (task.FilePath) t.FilePath = task.FilePath;
    if (task._custom) t._custom = task._custom; // 控制台使用

    return t;
  };

  var emitListUpdate = function () {
    var timer;

    var emit = function emit() {
      timer = 0;
      cos.emit('task-list-update', {
        list: util.map(queue, formatTask)
      });
      cos.emit('list-update', {
        list: util.map(queue, formatTask)
      });
    };

    return function () {
      if (!timer) timer = setTimeout(emit);
    };
  }();

  var clearQueue = function clearQueue() {
    if (queue.length <= cos.options.UploadQueueSize) return;

    for (var i = 0; i < nextUploadIndex && // 小于当前操作的 index 才清理
    i < queue.length && // 大于队列才清理
    queue.length > cos.options.UploadQueueSize // 如果还太多，才继续清理
    ;) {
      var isActive = queue[i].state === 'waiting' || queue[i].state === 'checking' || queue[i].state === 'uploading';

      if (!queue[i] || !isActive) {
        tasks[queue[i].id] && delete tasks[queue[i].id];
        queue.splice(i, 1);
        nextUploadIndex--;
      } else {
        i++;
      }
    }

    emitListUpdate();
  };

  var startNextTask = function startNextTask() {
    // 检查是否允许增加执行进程
    if (uploadingFileCount >= cos.options.FileParallelLimit) return; // 跳过不可执行的任务

    while (queue[nextUploadIndex] && queue[nextUploadIndex].state !== 'waiting') {
      nextUploadIndex++;
    } // 检查是否已遍历结束


    if (nextUploadIndex >= queue.length) return; // 上传该遍历到的任务

    var task = queue[nextUploadIndex];
    nextUploadIndex++;
    uploadingFileCount++;
    task.state = 'checking';
    task.params.onTaskStart && task.params.onTaskStart(formatTask(task));
    !task.params.UploadData && (task.params.UploadData = {});
    var apiParams = util.formatParams(task.api, task.params);
    originApiMap[task.api].call(cos, apiParams, function (err, data) {
      if (!cos._isRunningTask(task.id)) return;

      if (task.state === 'checking' || task.state === 'uploading') {
        task.state = err ? 'error' : 'success';
        err && (task.error = err);
        uploadingFileCount--;
        emitListUpdate();
        startNextTask();
        task.callback && task.callback(err, data);

        if (task.state === 'success') {
          if (task.params) {
            delete task.params.UploadData;
            delete task.params.Body;
            delete task.params;
          }

          delete task.callback;
        }
      }

      clearQueue();
    });
    emitListUpdate(); // 异步执行下一个任务

    setTimeout(startNextTask);
  };

  var killTask = function killTask(id, switchToState) {
    var task = tasks[id];
    if (!task) return;
    var waiting = task && task.state === 'waiting';
    var running = task && (task.state === 'checking' || task.state === 'uploading');

    if (switchToState === 'canceled' && task.state !== 'canceled' || switchToState === 'paused' && waiting || switchToState === 'paused' && running) {
      if (switchToState === 'paused' && task.params.Body && typeof task.params.Body.pipe === 'function') {
        console.error('stream not support pause');
        return;
      }

      task.state = switchToState;
      cos.emit('inner-kill-task', {
        TaskId: id,
        toState: switchToState
      });

      try {
        var UploadId = task && task.params && task.params.UploadData.UploadId;
      } catch (e) {}

      if (switchToState === 'canceled' && UploadId) session.removeUsing(UploadId);
      emitListUpdate();

      if (running) {
        uploadingFileCount--;
        startNextTask();
      }

      if (switchToState === 'canceled') {
        if (task.params) {
          delete task.params.UploadData;
          delete task.params.Body;
          delete task.params;
        }

        delete task.callback;
      }
    }

    clearQueue();
  };

  cos._addTasks = function (taskList) {
    util.each(taskList, function (task) {
      cos._addTask(task.api, task.params, task.callback, true);
    });
    emitListUpdate();
  };

  var isTaskReadyWarning = true;

  cos._addTask = function (api, params, callback, ignoreAddEvent) {
    // 复制参数对象
    params = util.formatParams(api, params); // 生成 id

    var id = util.uuid();
    params.TaskId = id;
    params.onTaskReady && params.onTaskReady(id);

    if (params.TaskReady) {
      params.TaskReady(id);
      isTaskReadyWarning && console.warn('warning: Param "TaskReady" has been deprecated. Please use "onTaskReady" instead.');
      isTaskReadyWarning = false;
    }

    var task = {
      // env
      params: params,
      callback: callback,
      api: api,
      index: queue.length,
      // task
      id: id,
      Bucket: params.Bucket,
      Region: params.Region,
      Key: params.Key,
      FilePath: params.FilePath || '',
      state: 'waiting',
      loaded: 0,
      size: 0,
      speed: 0,
      percent: 0,
      hashPercent: 0,
      error: null,
      _custom: params._custom
    };
    var onHashProgress = params.onHashProgress;

    params.onHashProgress = function (info) {
      if (!cos._isRunningTask(task.id)) return;
      task.hashPercent = info.percent;
      onHashProgress && onHashProgress(info);
      emitListUpdate();
    };

    var onProgress = params.onProgress;

    params.onProgress = function (info) {
      if (!cos._isRunningTask(task.id)) return;
      task.state === 'checking' && (task.state = 'uploading');
      task.loaded = info.loaded;
      task.speed = info.speed;
      task.percent = info.percent;
      onProgress && onProgress(info);
      emitListUpdate();
    }; // 异步获取 filesize


    util.getFileSize(api, params, function (err, size) {
      // 开始处理上传
      if (err) return callback(util.error(err)); // 如果获取大小出错，不加入队列
      // 获取完文件大小再把任务加入队列

      tasks[id] = task;
      queue.push(task);
      task.size = size;
      !ignoreAddEvent && emitListUpdate();
      startNextTask();
      clearQueue();
    });
    return id;
  };

  cos._isRunningTask = function (id) {
    var task = tasks[id];
    return !!(task && (task.state === 'checking' || task.state === 'uploading'));
  };

  cos.getTaskList = function () {
    return util.map(queue, formatTask);
  };

  cos.cancelTask = function (id) {
    killTask(id, 'canceled');
  };

  cos.pauseTask = function (id) {
    killTask(id, 'paused');
  };

  cos.restartTask = function (id) {
    var task = tasks[id];

    if (task && (task.state === 'paused' || task.state === 'error')) {
      task.state = 'waiting';
      emitListUpdate();
      nextUploadIndex = Math.min(nextUploadIndex, task.index);
      startNextTask();
    }
  };

  cos.isUploadRunning = function () {
    return uploadingFileCount || nextUploadIndex < queue.length;
  };
};

module.exports.transferToTaskMethod = transferToTaskMethod;
module.exports.init = initTask;

/***/ }),

/***/ "./src/tracker.js":
/*!************************!*\
  !*** ./src/tracker.js ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

var _classCallCheck = __webpack_require__(/*! @babel/runtime/helpers/classCallCheck */ "./node_modules/@babel/runtime/helpers/classCallCheck.js");

var _createClass = __webpack_require__(/*! @babel/runtime/helpers/createClass */ "./node_modules/@babel/runtime/helpers/createClass.js");

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var pkg = __webpack_require__(/*! ../package.json */ "./package.json");

var beacon = null;

var getBeacon = function getBeacon(delay) {
  if (!beacon) {
    // 不放在顶层是避免首次引入就被加载，从而避免在某些环境比如webworker里加载灯塔sdk内window相关对象报错
    var BeaconAction = __webpack_require__(/*! ../lib/beacon.min */ "./lib/beacon.min.js");

    beacon = new BeaconAction({
      appkey: "0AND0VEVB24UBGDU",
      versionCode: pkg.version,
      channelID: 'js_sdk',
      //渠道,选填
      openid: 'openid',
      // 用户id, 选填
      unionid: 'unid',
      //用户unionid , 类似idfv,选填
      strictMode: false,
      //严苛模式开关, 打开严苛模式会主动抛出异常, 上线请务必关闭!!!
      delay: delay,
      // 普通事件延迟上报时间(单位毫秒), 默认1000(1秒),选填
      sessionDuration: 60 * 1000 // session变更的时间间隔, 一个用户持续30分钟(默认值)没有任何上报则算另一次 session,每变更一次session上报一次启动事件(rqd_applaunched),使用毫秒(ms),最小值30秒,选填

    });
  }

  return beacon;
};

var utils = {
  // 生成uid 每个链路对应唯一一条uid
  getUid: function getUid() {
    var S4 = function S4() {
      return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);
    };

    return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
  },
  // 获取网络类型
  getNetType: function getNetType() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object') {
      var connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      return (connection === null || connection === void 0 ? void 0 : connection.type) || (connection === null || connection === void 0 ? void 0 : connection.effectiveType) || 'unknown';
    }

    return 'unknown';
  },
  // 获取pc端操作系统类型
  getOsType: function getOsType() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
      return 'unknown os';
    }

    var agent = navigator.userAgent.toLowerCase();
    var isMac = /macintosh|mac os x/i.test(navigator.userAgent);

    if (agent.indexOf("win32") >= 0 || agent.indexOf("wow32") >= 0) {
      return 'win32';
    }

    if (agent.indexOf("win64") >= 0 || agent.indexOf("wow64") >= 0) {
      return 'win64';
    }

    if (isMac) {
      return 'mac';
    }

    return 'unknown os';
  },
  isMobile: function isMobile() {
    var exp = /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true; // 移动端
    }

    return false; // PC端
  },
  isAndroid: function isAndroid() {
    var exp = /(Android|Adr|Linux)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true;
    }

    return false;
  },
  isIOS: function isIOS() {
    var exp = /(iPhone|iPod|iPad|iOS)/i;

    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) === 'object' && navigator.userAgent.match(exp)) {
      return true;
    }

    return false;
  },
  isOtherMobile: function isOtherMobile() {
    return isMobile && !isAndroid && !isIOS;
  },
  // 获取浏览器类型
  getDeviceName: function getDeviceName() {
    if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
      return 'unknown device';
    }

    var explorer = navigator.userAgent.toLowerCase(); // 腾讯会议内置浏览器

    if (explorer.includes('app/tencent_wemeet')) {
      return 'tencent_wemeet';
    } // 遨游浏览器


    if (explorer.indexOf('maxthon') >= 0) {
      var match = explorer.match(/maxthon\/([\d.]+)/);
      var ver = match && match[1] || '';
      return "\u50B2\u6E38\u6D4F\u89C8\u5668 ".concat(ver).trim();
    } // QQ浏览器


    if (explorer.indexOf('qqbrowser') >= 0) {
      var _match = explorer.match(/qqbrowser\/([\d.]+)/);

      var _ver = _match && _match[1] || '';

      return "QQ\u6D4F\u89C8\u5668 ".concat(_ver).trim();
    } // 搜狗浏览器


    if (explorer.indexOf('se 2.x') >= 0) {
      return '搜狗浏览器';
    } // 微信浏览器


    if (explorer.indexOf('wxwork') >= 0) {
      return '微信内置浏览器';
    } // ie


    if (explorer.indexOf('msie') >= 0) {
      var _match2 = explorer.match(/msie ([\d.]+)/);

      var _ver2 = _match2 && _match2[1] || '';

      return "IE ".concat(_ver2).trim();
    } // firefox


    if (explorer.indexOf('firefox') >= 0) {
      var _match3 = explorer.match(/firefox\/([\d.]+)/);

      var _ver3 = _match3 && _match3[1] || '';

      return "Firefox ".concat(_ver3).trim();
    } // Chrome


    if (explorer.indexOf('chrome') >= 0) {
      var _match4 = explorer.match(/chrome\/([\d.]+)/);

      var _ver4 = _match4 && _match4[1] || '';

      return "Chrome ".concat(_ver4).trim();
    } // Opera


    if (explorer.indexOf('opera') >= 0) {
      var _match5 = explorer.match(/opera.([\d.]+)/);

      var _ver5 = _match5 && _match5[1] || '';

      return "Opera ".concat(_ver5).trim();
    } // Safari


    if (explorer.indexOf('safari') >= 0) {
      var _match6 = explorer.match(/version\/([\d.]+)/);

      var _ver6 = _match6 && _match6[1] || '';

      return "Safari ".concat(_ver6).trim();
    }

    if (explorer.indexOf('edge') >= 0) {
      var _match7 = explorer.match(/edge\/([\d.]+)/);

      var _ver7 = _match7 && _match7[1] || '';

      return "edge ".concat(_ver7).trim();
    }

    return explorer.substr(0, 200);
  }
};
var constant = {
  isMobile: utils.isMobile(),
  isBrowser: !utils.isMobile(),
  mobileOsType: utils.isAndroid() ? 'android' : utils.isIOS ? 'ios' : 'other_mobile',
  pcOsType: utils.getOsType()
}; // 设备信息，只取一次值

var deviceInfo = {
  // ↓上报项
  deviceType: constant.isMobile ? 'mobile' : constant.isBrowser ? 'browser' : 'unknown',
  devicePlatform: constant.isMobile ? constant.mobileOsType : constant.pcOsType,
  deviceName: utils.getDeviceName() //浏览器名称

}; // 分块上传原子方法

var sliceUploadMethods = ['multipartInit', 'multipartUpload', 'multipartComplete', 'multipartList', 'multipartListPart', 'multipartAbort'];
var uploadApi = ['putObject', 'postObject', 'appendObject', 'sliceUploadFile', 'uploadFile', 'uploadFiles'].concat(sliceUploadMethods);
var downloadApi = ['getObject'];

function getEventCode(apiName) {
  if (uploadApi.includes(apiName)) {
    return 'cos_upload';
  }

  if (downloadApi.includes(apiName)) {
    return 'cos_download';
  }

  return 'base_service';
} // 上报参数驼峰改下划线


function camel2underline(key) {
  return key.replace(/([A-Z])/g, "_$1").toLowerCase();
}

function formatParams(params) {
  var formattedParams = {};
  var allReporterKeys = ['tracePlatform', 'cossdkVersion', 'region', 'networkType', 'host', 'accelerate', 'requestPath', 'size', 'httpMd5', 'httpSign', 'httpFull', 'name', 'result', 'tookTime', 'errorNode', 'errorCode', 'errorMessage', 'errorRequestId', 'errorStatusCode', 'errorServiceName', 'errorType', 'traceId', 'bucket', 'appid', 'partNumber', 'retryTimes', 'reqUrl', 'customId', 'fullError', 'deviceType', 'devicePlatform', 'deviceName'];
  var successKeys = ['tracePlatform', 'cossdkVersion', 'region', 'bucket', 'appid', 'networkType', 'host', 'accelerate', 'requestPath', 'partNumber', 'size', 'name', 'result', 'tookTime', 'errorRequestId', 'retryTimes', 'reqUrl', 'customId', 'deviceType', 'devicePlatform', 'deviceName']; // 需要上报的参数字段

  var reporterKeys = params.result === 'Success' ? successKeys : allReporterKeys;

  for (var key in params) {
    if (!reporterKeys.includes(key)) continue;
    var formattedKey = camel2underline(key);
    formattedParams[formattedKey] = params[key];
  }

  return formattedParams;
} // 链路追踪器


var Tracker = /*#__PURE__*/function () {
  "use strict";

  function Tracker(opt) {
    _classCallCheck(this, Tracker);

    var parent = opt.parent,
        traceId = opt.traceId,
        bucket = opt.bucket,
        region = opt.region,
        apiName = opt.apiName,
        fileKey = opt.fileKey,
        fileSize = opt.fileSize,
        accelerate = opt.accelerate,
        customId = opt.customId,
        delay = opt.delay,
        deepTracker = opt.deepTracker;
    var appid = bucket && bucket.substr(bucket.lastIndexOf('-') + 1) || '';
    this.parent = parent;
    this.deepTracker = deepTracker;
    this.delay = delay; // 上报用到的字段

    this.params = {
      // 通用字段
      cossdkVersion: pkg.version,
      region: region,
      networkType: '',
      host: '',
      accelerate: accelerate ? 'Y' : 'N',
      requestPath: fileKey || '',
      size: fileSize || -1,
      httpMd5: 0,
      // MD5耗时
      httpSign: 0,
      // 计算签名耗时
      httpFull: 0,
      // http请求耗时
      name: apiName || '',
      result: '',
      // sdk api调用结果Success、Fail
      tookTime: 0,
      // 总耗时
      errorNode: '',
      errorCode: '',
      errorMessage: '',
      errorRequestId: '',
      errorStatusCode: 0,
      errorServiceName: '',
      // js补充字段
      tracePlatform: 'cos-js-sdk-v5',
      // 上报平台=js
      traceId: traceId || utils.getUid(),
      // 每条上报唯一标识
      bucket: bucket,
      appid: appid,
      partNumber: 0,
      // 分块上传编号
      retryTimes: 0,
      // sdk内部发起的请求重试
      reqUrl: '',
      // 请求url
      customId: customId || '',
      // 业务id
      deviceType: deviceInfo.deviceType,
      // 设备类型 移动端浏览器、web浏览器
      devicePlatform: deviceInfo.devicePlatform,
      deviceName: deviceInfo.deviceName,
      md5StartTime: 0,
      // md5计算开始时间
      md5EndTime: 0,
      // md5计算结束时间
      signStartTime: 0,
      // 计算签名开始时间
      signEndTime: 0,
      // 计算签名结束时间
      httpStartTime: 0,
      // 发起网络请求开始时间
      httpEndTime: 0,
      // 网路请求结束时间
      startTime: new Date().getTime(),
      // sdk api调用起始时间，不是纯网络耗时
      endTime: 0 //  sdk api调用结束时间，不是纯网络耗时

    };
    this.beacon = getBeacon(delay);
  } // 格式化sdk回调


  _createClass(Tracker, [{
    key: "formatResult",
    value: function formatResult(err, data) {
      var _err$error, _err$error2, _err$error3, _err$error4, _err$error5, _err$error6;

      var now = new Date().getTime();
      var tookTime = now - this.params.startTime;
      var networkType = utils.getNetType();
      var errorCode = err ? (err === null || err === void 0 ? void 0 : err.code) || (err === null || err === void 0 ? void 0 : (_err$error = err.error) === null || _err$error === void 0 ? void 0 : _err$error.code) || (err === null || err === void 0 ? void 0 : (_err$error2 = err.error) === null || _err$error2 === void 0 ? void 0 : _err$error2.Code) : '';
      var errorMessage = err ? (err === null || err === void 0 ? void 0 : err.message) || (err === null || err === void 0 ? void 0 : (_err$error3 = err.error) === null || _err$error3 === void 0 ? void 0 : _err$error3.message) || (err === null || err === void 0 ? void 0 : (_err$error4 = err.error) === null || _err$error4 === void 0 ? void 0 : _err$error4.Message) : '';
      var errorServiceName = err ? (err === null || err === void 0 ? void 0 : err.resource) || (err === null || err === void 0 ? void 0 : (_err$error5 = err.error) === null || _err$error5 === void 0 ? void 0 : _err$error5.resource) || (err === null || err === void 0 ? void 0 : (_err$error6 = err.error) === null || _err$error6 === void 0 ? void 0 : _err$error6.Resource) : '';
      var errorStatusCode = err ? err === null || err === void 0 ? void 0 : err.statusCode : data.statusCode;
      var requestId = err ? (err === null || err === void 0 ? void 0 : err.headers) && (err === null || err === void 0 ? void 0 : err.headers['x-cos-request-id']) : (data === null || data === void 0 ? void 0 : data.headers) && (data === null || data === void 0 ? void 0 : data.headers['x-cos-request-id']);
      var errorType = err ? requestId ? 'Server' : 'Client' : '';
      Object.assign(this.params, {
        tookTime: tookTime,
        networkType: networkType,
        httpMd5: this.params.md5EndTime - this.params.md5StartTime,
        httpSign: this.params.signEndTime - this.params.signStartTime,
        httpFull: this.params.httpEndTime - this.params.httpStartTime,
        result: err ? 'Fail' : 'Success',
        errorType: errorType,
        errorCode: errorCode,
        errorStatusCode: errorStatusCode,
        errorMessage: errorMessage,
        errorServiceName: errorServiceName,
        errorRequestId: requestId
      });

      if (err && (!errorCode || !errorMessage)) {
        // 暂存全量err一段时间 观察是否所有err格式都可被解析
        this.params.fullError = err ? JSON.stringify(err) : '';
      }

      if (this.params.name === 'getObject') {
        this.params.size = data ? data.headers && data.headers['content-length'] : -1;
      }

      if (this.params.reqUrl) {
        try {
          var execRes = /^http(s)?:\/\/(.*?)\//.exec(this.params.reqUrl);
          this.params.host = execRes[2];
        } catch (e) {
          this.params.host = this.params.reqUrl;
        }
      }

      this.sendEvents();
    } // 设置当前链路的参数

  }, {
    key: "setParams",
    value: function setParams(params) {
      Object.assign(this.params, params);
    } // 使用灯塔延时上报

  }, {
    key: "sendEvents",
    value: function sendEvents() {
      // DeepTracker模式下才会上报分块上传内部细节
      if (sliceUploadMethods.includes(this.params.name) && !this.deepTracker) {
        return;
      }

      var eventCode = getEventCode(this.params.name);
      var formattedParams = formatParams(this.params); // 兜底处理

      if (!this.beacon) {
        this.beacon = getBeacon(this.delay || 5000);
      }

      if (this.delay === 0) {
        // 实时上报
        this.beacon && this.beacon.onDirectUserAction(eventCode, formattedParams);
      } else {
        // 周期性上报
        this.beacon && this.beacon.onUserAction(eventCode, formattedParams);
      }
    } // 生成子实例，与父所属一个链路，可用于分块上传内部流程上报单个分块操作

  }, {
    key: "generateSubTracker",
    value: function generateSubTracker(subParams) {
      Object.assign(subParams, {
        parent: this,
        deepTracker: this.deepTracker,
        traceId: this.params.traceId,
        bucket: this.params.bucket,
        region: this.params.region,
        fileKey: this.params.requestPath,
        customId: this.params.customId,
        delay: this.delay
      });
      return new Tracker(subParams);
    }
  }]);

  return Tracker;
}();

module.exports = Tracker;

/***/ }),

/***/ "./src/util.js":
/*!*********************!*\
  !*** ./src/util.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(process) {

var _typeof = __webpack_require__(/*! @babel/runtime/helpers/typeof */ "./node_modules/@babel/runtime/helpers/typeof.js");

var md5 = __webpack_require__(/*! ../lib/md5 */ "./lib/md5.js");

var CryptoJS = __webpack_require__(/*! ../lib/crypto */ "./lib/crypto.js");

var xml2json = __webpack_require__(/*! ../lib/xml2json */ "./lib/xml2json.js");

var json2xml = __webpack_require__(/*! ../lib/json2xml */ "./lib/json2xml.js");

var Tracker = __webpack_require__(/*! ./tracker */ "./src/tracker.js");

function camSafeUrlEncode(str) {
  return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\(/g, '%28').replace(/\)/g, '%29').replace(/\*/g, '%2A');
}

function getObjectKeys(obj, forKey) {
  var list = [];

  for (var key in obj) {
    if (obj.hasOwnProperty(key)) {
      list.push(forKey ? camSafeUrlEncode(key).toLowerCase() : key);
    }
  }

  return list.sort(function (a, b) {
    a = a.toLowerCase();
    b = b.toLowerCase();
    return a === b ? 0 : a > b ? 1 : -1;
  });
}

;
/**
 * obj转为string
 * @param  {Object}  obj                需要转的对象，必须
 * @param  {Boolean} lowerCaseKey       key是否转为小写，默认false，非必须
 * @return {String}  data               返回字符串
 */

var obj2str = function obj2str(obj, lowerCaseKey) {
  var i, key, val;
  var list = [];
  var keyList = getObjectKeys(obj);

  for (i = 0; i < keyList.length; i++) {
    key = keyList[i];
    val = obj[key] === undefined || obj[key] === null ? '' : '' + obj[key];
    key = lowerCaseKey ? camSafeUrlEncode(key).toLowerCase() : camSafeUrlEncode(key);
    val = camSafeUrlEncode(val) || '';
    list.push(key + '=' + val);
  }

  return list.join('&');
}; // 可以签入签名的headers


var signHeaders = ['content-disposition', 'content-encoding', 'content-length', 'content-md5', 'expect', 'host', 'if-match', 'if-modified-since', 'if-none-match', 'if-unmodified-since', 'origin', 'range', 'response-cache-control', 'response-content-disposition', 'response-content-encoding', 'response-content-language', 'response-content-type', 'response-expires', 'transfer-encoding', 'versionid'];

var getSignHeaderObj = function getSignHeaderObj(headers) {
  var signHeaderObj = {};

  for (var i in headers) {
    var key = i.toLowerCase();

    if (key.indexOf('x-cos-') > -1 || signHeaders.indexOf(key) > -1) {
      signHeaderObj[i] = headers[i];
    }
  }

  return signHeaderObj;
}; //测试用的key后面可以去掉


var getAuth = function getAuth(opt) {
  opt = opt || {};
  var SecretId = opt.SecretId;
  var SecretKey = opt.SecretKey;
  var KeyTime = opt.KeyTime;
  var method = (opt.method || opt.Method || 'get').toLowerCase();
  var queryParams = clone(opt.Query || opt.params || {});
  var headers = getSignHeaderObj(clone(opt.Headers || opt.headers || {}));
  var Key = opt.Key || '';
  var pathname;

  if (opt.UseRawKey) {
    pathname = opt.Pathname || opt.pathname || '/' + Key;
  } else {
    pathname = opt.Pathname || opt.pathname || Key;
    pathname.indexOf('/') !== 0 && (pathname = '/' + pathname);
  } // ForceSignHost明确传入false才不加入host签名


  var forceSignHost = opt.ForceSignHost === false ? false : true; // 如果有传入存储桶且需要强制签名，那么签名默认加 Host 参与计算，避免跨桶访问

  if (!headers.Host && !headers.host && opt.Bucket && opt.Region && forceSignHost) headers.Host = opt.Bucket + '.cos.' + opt.Region + '.myqcloud.com';
  if (!SecretId) throw new Error('missing param SecretId');
  if (!SecretKey) throw new Error('missing param SecretKey'); // 签名有效起止时间

  var now = Math.round(getSkewTime(opt.SystemClockOffset) / 1000) - 1;
  var exp = now;
  var Expires = opt.Expires || opt.expires;

  if (Expires === undefined) {
    exp += 900; // 签名过期时间为当前 + 900s
  } else {
    exp += Expires * 1 || 0;
  } // 要用到的 Authorization 参数列表


  var qSignAlgorithm = 'sha1';
  var qAk = SecretId;
  var qSignTime = KeyTime || now + ';' + exp;
  var qKeyTime = KeyTime || now + ';' + exp;
  var qHeaderList = getObjectKeys(headers, true).join(';').toLowerCase();
  var qUrlParamList = getObjectKeys(queryParams, true).join(';').toLowerCase(); // 签名算法说明文档：https://www.qcloud.com/document/product/436/7778
  // 步骤一：计算 SignKey

  var signKey = CryptoJS.HmacSHA1(qKeyTime, SecretKey).toString(); // 步骤二：构成 FormatString

  var formatString = [method, pathname, util.obj2str(queryParams, true), util.obj2str(headers, true), ''].join('\n'); // 步骤三：计算 StringToSign

  var stringToSign = ['sha1', qSignTime, CryptoJS.SHA1(formatString).toString(), ''].join('\n'); // 步骤四：计算 Signature

  var qSignature = CryptoJS.HmacSHA1(stringToSign, signKey).toString(); // 步骤五：构造 Authorization

  var authorization = ['q-sign-algorithm=' + qSignAlgorithm, 'q-ak=' + qAk, 'q-sign-time=' + qSignTime, 'q-key-time=' + qKeyTime, 'q-header-list=' + qHeaderList, 'q-url-param-list=' + qUrlParamList, 'q-signature=' + qSignature].join('&');
  return authorization;
};

var readIntBE = function readIntBE(chunk, size, offset) {
  var bytes = size / 8;
  var buf = chunk.slice(offset, offset + bytes);
  new Uint8Array(buf).reverse();
  return new {
    8: Uint8Array,
    16: Uint16Array,
    32: Uint32Array
  }[size](buf)[0];
};

var buf2str = function buf2str(chunk, start, end, isUtf8) {
  var buf = chunk.slice(start, end);
  var str = '';
  new Uint8Array(buf).forEach(function (charCode) {
    str += String.fromCharCode(charCode);
  });
  if (isUtf8) str = decodeURIComponent(escape(str));
  return str;
};

var parseSelectPayload = function parseSelectPayload(chunk) {
  var header = {};
  var body = buf2str(chunk);
  var result = {
    records: []
  };

  while (chunk.byteLength) {
    var totalLength = readIntBE(chunk, 32, 0);
    var headerLength = readIntBE(chunk, 32, 4);
    var payloadRestLength = totalLength - headerLength - 16;
    var offset = 0;
    var content;
    chunk = chunk.slice(12); // 获取 Message 的 header 信息

    while (offset < headerLength) {
      var headerNameLength = readIntBE(chunk, 8, offset);
      var headerName = buf2str(chunk, offset + 1, offset + 1 + headerNameLength);
      var headerValueLength = readIntBE(chunk, 16, offset + headerNameLength + 2);
      var headerValue = buf2str(chunk, offset + headerNameLength + 4, offset + headerNameLength + 4 + headerValueLength);
      header[headerName] = headerValue;
      offset += headerNameLength + 4 + headerValueLength;
    }

    if (header[':event-type'] === 'Records') {
      content = buf2str(chunk, offset, offset + payloadRestLength, true);
      result.records.push(content);
    } else if (header[':event-type'] === 'Stats') {
      content = buf2str(chunk, offset, offset + payloadRestLength, true);
      result.stats = util.xml2json(content).Stats;
    } else if (header[':event-type'] === 'error') {
      var errCode = header[':error-code'];
      var errMessage = header[':error-message'];
      var err = new Error(errMessage);
      err.message = errMessage;
      err.name = err.code = errCode;
      result.error = err;
    } else if (['Progress', 'Continuation', 'End'].includes(header[':event-type'])) {// do nothing
    }

    chunk = chunk.slice(offset + payloadRestLength + 4);
  }

  return {
    payload: result.records.join(''),
    body: body
  };
};

var getSourceParams = function getSourceParams(source) {
  var parser = this.options.CopySourceParser;
  if (parser) return parser(source);
  var m = source.match(/^([^.]+-\d+)\.cos(v6|-cdc|-internal)?\.([^.]+)\.((myqcloud\.com)|(tencentcos\.cn))\/(.+)$/);
  if (!m) return null;
  return {
    Bucket: m[1],
    Region: m[3],
    Key: m[7]
  };
};

var noop = function noop() {}; // 清除对象里值为的 undefined 或 null 的属性


var clearKey = function clearKey(obj) {
  var retObj = {};

  for (var key in obj) {
    if (obj.hasOwnProperty(key) && obj[key] !== undefined && obj[key] !== null) {
      retObj[key] = obj[key];
    }
  }

  return retObj;
};

var readAsBinaryString = function readAsBinaryString(blob, callback) {
  var readFun;
  var fr = new FileReader();

  if (FileReader.prototype.readAsBinaryString) {
    readFun = FileReader.prototype.readAsBinaryString;

    fr.onload = function () {
      callback(this.result);
    };
  } else if (FileReader.prototype.readAsArrayBuffer) {
    // 在 ie11 添加 readAsBinaryString 兼容
    readFun = function readFun(fileData) {
      var binary = "";
      var pt = this;
      var reader = new FileReader();

      reader.onload = function (e) {
        var bytes = new Uint8Array(reader.result);
        var length = bytes.byteLength;

        for (var i = 0; i < length; i++) {
          binary += String.fromCharCode(bytes[i]);
        }

        callback(binary);
      };

      reader.readAsArrayBuffer(fileData);
    };
  } else {
    console.error('FileReader not support readAsBinaryString');
  }

  readFun.call(fr, blob);
};

var fileSliceNeedCopy = function () {
  var compareVersion = function compareVersion(a, b) {
    a = a.split('.');
    b = b.split('.');

    for (var i = 0; i < b.length; i++) {
      if (a[i] !== b[i]) {
        return parseInt(a[i]) > parseInt(b[i]) ? 1 : -1;
      }
    }

    return 0;
  };

  var check = function check(ua) {
    if (!ua) return false;
    var ChromeVersion = (ua.match(/Chrome\/([.\d]+)/) || [])[1];
    var QBCoreVersion = (ua.match(/QBCore\/([.\d]+)/) || [])[1];
    var QQBrowserVersion = (ua.match(/QQBrowser\/([.\d]+)/) || [])[1];
    var need = ChromeVersion && compareVersion(ChromeVersion, '53.0.2785.116') < 0 && QBCoreVersion && compareVersion(QBCoreVersion, '3.53.991.400') < 0 && QQBrowserVersion && compareVersion(QQBrowserVersion, '9.0.2524.400') <= 0 || false;
    return need;
  };

  return check(typeof navigator !== 'undefined' && navigator.userAgent);
}(); // 获取文件分片


var fileSlice = function fileSlice(file, start, end, isUseToUpload, callback) {
  var blob;

  if (file.slice) {
    blob = file.slice(start, end);
  } else if (file.mozSlice) {
    blob = file.mozSlice(start, end);
  } else if (file.webkitSlice) {
    blob = file.webkitSlice(start, end);
  }

  if (isUseToUpload && fileSliceNeedCopy) {
    var reader = new FileReader();

    reader.onload = function (e) {
      blob = null;
      callback(new Blob([reader.result]));
    };

    reader.readAsArrayBuffer(blob);
  } else {
    callback(blob);
  }
}; // 获取文件内容的 MD5


var getBodyMd5 = function getBodyMd5(UploadCheckContentMd5, Body, callback, onProgress) {
  callback = callback || noop;

  if (UploadCheckContentMd5) {
    if (typeof Body === 'string') {
      callback(util.md5(Body, true));
    } else if (Blob && Body instanceof Blob) {
      util.getFileMd5(Body, function (err, md5) {
        callback(md5);
      }, onProgress);
    } else {
      callback();
    }
  } else {
    callback();
  }
}; // 获取文件 md5 值


var md5ChunkSize = 1024 * 1024;

var getFileMd5 = function getFileMd5(blob, callback, onProgress) {
  var size = blob.size;
  var loaded = 0;
  var md5ctx = md5.getCtx();

  var next = function next(start) {
    if (start >= size) {
      var hash = md5ctx.digest('hex');
      callback(null, hash);
      return;
    }

    var end = Math.min(size, start + md5ChunkSize);
    util.fileSlice(blob, start, end, false, function (chunk) {
      readAsBinaryString(chunk, function (content) {
        chunk = null;
        md5ctx = md5ctx.update(content, true);
        loaded += content.length;
        content = null;
        if (onProgress) onProgress({
          loaded: loaded,
          total: size,
          percent: Math.round(loaded / size * 10000) / 10000
        });
        next(start + md5ChunkSize);
      });
    });
  };

  next(0);
};

function clone(obj) {
  return map(obj, function (v) {
    return _typeof(v) === 'object' && v !== null ? clone(v) : v;
  });
}

function attr(obj, name, defaultValue) {
  return obj && name in obj ? obj[name] : defaultValue;
}

function extend(target, source) {
  each(source, function (val, key) {
    target[key] = source[key];
  });
  return target;
}

function isArray(arr) {
  return arr instanceof Array;
}

function isInArray(arr, item) {
  var flag = false;

  for (var i = 0; i < arr.length; i++) {
    if (item === arr[i]) {
      flag = true;
      break;
    }
  }

  return flag;
}

function makeArray(arr) {
  return isArray(arr) ? arr : [arr];
}

function each(obj, fn) {
  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      fn(obj[i], i);
    }
  }
}

function map(obj, fn) {
  var o = isArray(obj) ? [] : {};

  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      o[i] = fn(obj[i], i);
    }
  }

  return o;
}

function filter(obj, fn) {
  var iaArr = isArray(obj);
  var o = iaArr ? [] : {};

  for (var i in obj) {
    if (obj.hasOwnProperty(i)) {
      if (fn(obj[i], i)) {
        if (iaArr) {
          o.push(obj[i]);
        } else {
          o[i] = obj[i];
        }
      }
    }
  }

  return o;
}

var binaryBase64 = function binaryBase64(str) {
  var i,
      len,
      char,
      res = '';

  for (i = 0, len = str.length / 2; i < len; i++) {
    char = parseInt(str[i * 2] + str[i * 2 + 1], 16);
    res += String.fromCharCode(char);
  }

  return btoa(res);
};

var uuid = function uuid() {
  var S4 = function S4() {
    return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);
  };

  return S4() + S4() + "-" + S4() + "-" + S4() + "-" + S4() + "-" + S4() + S4() + S4();
};

var hasMissingParams = function hasMissingParams(apiName, params) {
  var Bucket = params.Bucket;
  var Region = params.Region;
  var Key = params.Key;
  var Domain = this.options.Domain;
  var checkBucket = !Domain || typeof Domain === 'string' && Domain.indexOf('{Bucket}') > -1;
  var checkRegion = !Domain || typeof Domain === 'string' && Domain.indexOf('{Region}') > -1;

  if (apiName.indexOf('Bucket') > -1 || apiName === 'deleteMultipleObject' || apiName === 'multipartList' || apiName === 'listObjectVersions') {
    if (checkBucket && !Bucket) return 'Bucket';
    if (checkRegion && !Region) return 'Region';
  } else if (apiName.indexOf('Object') > -1 || apiName.indexOf('multipart') > -1 || apiName === 'sliceUploadFile' || apiName === 'abortUploadTask') {
    if (checkBucket && !Bucket) return 'Bucket';
    if (checkRegion && !Region) return 'Region';
    if (!Key) return 'Key';
  }

  return false;
};

var formatParams = function formatParams(apiName, params) {
  // 复制参数对象
  params = extend({}, params); // 统一处理 Headers

  if (apiName !== 'getAuth' && apiName !== 'getV4Auth' && apiName !== 'getObjectUrl') {
    var Headers = params.Headers || {};

    if (params && _typeof(params) === 'object') {
      (function () {
        for (var key in params) {
          if (params.hasOwnProperty(key) && key.indexOf('x-cos-') > -1) {
            Headers[key] = params[key];
          }
        }
      })();

      var headerMap = {
        // params headers
        'x-cos-mfa': 'MFA',
        'Content-MD5': 'ContentMD5',
        'Content-Length': 'ContentLength',
        'Content-Type': 'ContentType',
        'Expect': 'Expect',
        'Expires': 'Expires',
        'Cache-Control': 'CacheControl',
        'Content-Disposition': 'ContentDisposition',
        'Content-Encoding': 'ContentEncoding',
        'Range': 'Range',
        'If-Modified-Since': 'IfModifiedSince',
        'If-Unmodified-Since': 'IfUnmodifiedSince',
        'If-Match': 'IfMatch',
        'If-None-Match': 'IfNoneMatch',
        'x-cos-copy-source': 'CopySource',
        'x-cos-copy-source-Range': 'CopySourceRange',
        'x-cos-metadata-directive': 'MetadataDirective',
        'x-cos-copy-source-If-Modified-Since': 'CopySourceIfModifiedSince',
        'x-cos-copy-source-If-Unmodified-Since': 'CopySourceIfUnmodifiedSince',
        'x-cos-copy-source-If-Match': 'CopySourceIfMatch',
        'x-cos-copy-source-If-None-Match': 'CopySourceIfNoneMatch',
        'x-cos-acl': 'ACL',
        'x-cos-grant-read': 'GrantRead',
        'x-cos-grant-write': 'GrantWrite',
        'x-cos-grant-full-control': 'GrantFullControl',
        'x-cos-grant-read-acp': 'GrantReadAcp',
        'x-cos-grant-write-acp': 'GrantWriteAcp',
        'x-cos-storage-class': 'StorageClass',
        'x-cos-traffic-limit': 'TrafficLimit',
        'x-cos-mime-limit': 'MimeLimit',
        // SSE-C
        'x-cos-server-side-encryption-customer-algorithm': 'SSECustomerAlgorithm',
        'x-cos-server-side-encryption-customer-key': 'SSECustomerKey',
        'x-cos-server-side-encryption-customer-key-MD5': 'SSECustomerKeyMD5',
        // SSE-COS、SSE-KMS
        'x-cos-server-side-encryption': 'ServerSideEncryption',
        'x-cos-server-side-encryption-cos-kms-key-id': 'SSEKMSKeyId',
        'x-cos-server-side-encryption-context': 'SSEContext'
      };
      util.each(headerMap, function (paramKey, headerKey) {
        if (params[paramKey] !== undefined) {
          Headers[headerKey] = params[paramKey];
        }
      });
      params.Headers = clearKey(Headers);
    }
  }

  return params;
};

var apiWrapper = function apiWrapper(apiName, apiFn) {
  return function (params, callback) {
    var self = this; // 处理参数

    if (typeof params === 'function') {
      callback = params;
      params = {};
    } // 整理参数格式


    params = formatParams(apiName, params); // tracker传递

    var tracker;

    if (self.options.EnableTracker) {
      if (params.calledBySdk === 'sliceUploadFile') {
        // 分块上传内部方法使用sliceUploadFile的子链路
        tracker = params.tracker && params.tracker.generateSubTracker({
          apiName: apiName
        });
      } else if (['uploadFile', 'uploadFiles'].includes(apiName)) {
        // uploadFile、uploadFiles方法在内部处理，此处不处理
        tracker = null;
      } else {
        var fileSize = -1;

        if (params.Body) {
          fileSize = typeof params.Body === 'string' ? params.Body.length : params.Body.size || params.Body.byteLength || -1;
        }

        tracker = new Tracker({
          bucket: params.Bucket,
          region: params.Region,
          apiName: apiName,
          fileKey: params.Key,
          fileSize: fileSize,
          deepTracker: self.options.DeepTracker,
          customId: self.options.CustomId,
          delay: self.options.TrackerDelay
        });
      }
    }

    params.tracker = tracker; // 代理回调函数

    var formatResult = function formatResult(result) {
      if (result && result.headers) {
        result.headers['x-cos-request-id'] && (result.RequestId = result.headers['x-cos-request-id']);
        result.headers['x-ci-request-id'] && (result.RequestId = result.headers['x-ci-request-id']);
        result.headers['x-cos-version-id'] && (result.VersionId = result.headers['x-cos-version-id']);
        result.headers['x-cos-delete-marker'] && (result.DeleteMarker = result.headers['x-cos-delete-marker']);
      }

      return result;
    };

    var _callback = function _callback(err, data) {
      // 格式化上报参数并上报
      tracker && tracker.formatResult(err, data);
      callback && callback(formatResult(err), formatResult(data));
    };

    var checkParams = function checkParams() {
      if (apiName !== 'getService' && apiName !== 'abortUploadTask') {
        // 判断参数是否完整
        var missingResult = hasMissingParams.call(self, apiName, params);

        if (missingResult) {
          return 'missing param ' + missingResult;
        } // 判断 region 格式


        if (params.Region) {
          if (self.options.CompatibilityMode) {
            if (!/^([a-z\d-.]+)$/.test(params.Region)) {
              return 'Region format error.';
            }
          } else {
            if (params.Region.indexOf('cos.') > -1) {
              return 'param Region should not be start with "cos."';
            } else if (!/^([a-z\d-]+)$/.test(params.Region)) {
              return 'Region format error.';
            }
          } // 判断 region 格式


          if (!self.options.CompatibilityMode && params.Region.indexOf('-') === -1 && params.Region !== 'yfb' && params.Region !== 'default' && params.Region !== 'accelerate') {
            console.warn('warning: param Region format error, find help here: https://cloud.tencent.com/document/product/436/6224');
          }
        } // 兼容不带 AppId 的 Bucket


        if (params.Bucket) {
          if (!/^([a-z\d-]+)-(\d+)$/.test(params.Bucket)) {
            if (params.AppId) {
              params.Bucket = params.Bucket + '-' + params.AppId;
            } else if (self.options.AppId) {
              params.Bucket = params.Bucket + '-' + self.options.AppId;
            } else {
              return 'Bucket should format as "test-1250000000".';
            }
          }

          if (params.AppId) {
            console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g Bucket:"test-1250000000" ).');
            delete params.AppId;
          }
        } // 如果 Key 是 / 开头，强制去掉第一个 /


        if (!self.options.UseRawKey && params.Key && params.Key.substr(0, 1) === '/') {
          params.Key = params.Key.substr(1);
        }
      }
    };

    var errMsg = checkParams();
    var isSync = ['getAuth', 'getObjectUrl'].includes(apiName);

    if (typeof Promise === 'function' && !isSync && !callback) {
      return new Promise(function (resolve, reject) {
        callback = function callback(err, data) {
          err ? reject(err) : resolve(data);
        };

        if (errMsg) return _callback(util.error(new Error(errMsg)));
        apiFn.call(self, params, _callback);
      });
    } else {
      if (errMsg) return _callback(util.error(new Error(errMsg)));
      var res = apiFn.call(self, params, _callback);
      if (isSync) return res;
    }
  };
};

var throttleOnProgress = function throttleOnProgress(total, onProgress) {
  var self = this;
  var size0 = 0;
  var size1 = 0;
  var time0 = Date.now();
  var time1;
  var timer;

  function update() {
    timer = 0;

    if (onProgress && typeof onProgress === 'function') {
      time1 = Date.now();
      var speed = Math.max(0, Math.round((size1 - size0) / ((time1 - time0) / 1000) * 100) / 100) || 0;
      var percent;

      if (size1 === 0 && total === 0) {
        percent = 1;
      } else {
        percent = Math.floor(size1 / total * 100) / 100 || 0;
      }

      time0 = time1;
      size0 = size1;

      try {
        onProgress({
          loaded: size1,
          total: total,
          speed: speed,
          percent: percent
        });
      } catch (e) {}
    }
  }

  return function (info, immediately) {
    if (info) {
      size1 = info.loaded;
      total = info.total;
    }

    if (immediately) {
      clearTimeout(timer);
      update();
    } else {
      if (timer) return;
      timer = setTimeout(update, self.options.ProgressInterval);
    }
  };
};

var getFileSize = function getFileSize(api, params, callback) {
  var size;

  if (typeof params.Body === 'string') {
    params.Body = new Blob([params.Body], {
      type: 'text/plain'
    });
  } else if (params.Body instanceof ArrayBuffer) {
    params.Body = new Blob([params.Body]);
  }

  if (params.Body && (params.Body instanceof Blob || params.Body.toString() === '[object File]' || params.Body.toString() === '[object Blob]')) {
    size = params.Body.size;
  } else {
    callback(util.error(new Error('params body format error, Only allow File|Blob|String.')));
    return;
  }

  params.ContentLength = size;
  callback(null, size);
}; // 获取调正的时间戳


var getSkewTime = function getSkewTime(offset) {
  return Date.now() + (offset || 0);
};

var error = function error(err, opt) {
  var sourceErr = err;
  err.message = err.message || null;

  if (typeof opt === 'string') {
    err.error = opt;
    err.message = opt;
  } else if (_typeof(opt) === 'object' && opt !== null) {
    extend(err, opt);
    if (opt.code || opt.name) err.code = opt.code || opt.name;
    if (opt.message) err.message = opt.message;
    if (opt.stack) err.stack = opt.stack;
  }

  if (typeof Object.defineProperty === 'function') {
    Object.defineProperty(err, 'name', {
      writable: true,
      enumerable: false
    });
    Object.defineProperty(err, 'message', {
      enumerable: true
    });
  }

  err.name = opt && opt.name || err.name || err.code || 'Error';
  if (!err.code) err.code = err.name;
  if (!err.error) err.error = clone(sourceErr); // 兼容老的错误格式

  return err;
};

var isWebWorker = function isWebWorker() {
  // 有限判断 worker 环境的 constructor name 其次用 worker 独有的 FileReaderSync 兜底 详细参考 https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers
  return (typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) === 'object' && (globalThis.constructor.name === 'DedicatedWorkerGlobalScope' || globalThis.FileReaderSync);
};

var isNode = function isNode() {
  // 得兜底 web worker 环境中 webpack 用了 process 插件之类的情况
  return (typeof window === "undefined" ? "undefined" : _typeof(window)) !== 'object' && (typeof process === "undefined" ? "undefined" : _typeof(process)) === 'object' && "function" === 'function' && !isWebWorker();
};

var isCIHost = function isCIHost(url) {
  return /^https?:\/\/([^/]+\.)?ci\.[^/]+/.test(url);
}; //判断是否是ios


var isIOS = function () {
  if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
    return false;
  }

  var u = navigator.userAgent;
  var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端

  return isIOS;
}(); // 判断是qq内置浏览器


var isQQ = function () {
  if ((typeof navigator === "undefined" ? "undefined" : _typeof(navigator)) !== 'object') {
    return false;
  }

  return /\sQQ/i.test(navigator.userAgent);
}();

var util = {
  noop: noop,
  formatParams: formatParams,
  apiWrapper: apiWrapper,
  xml2json: xml2json,
  json2xml: json2xml,
  md5: md5,
  clearKey: clearKey,
  fileSlice: fileSlice,
  getBodyMd5: getBodyMd5,
  getFileMd5: getFileMd5,
  binaryBase64: binaryBase64,
  extend: extend,
  isArray: isArray,
  isInArray: isInArray,
  makeArray: makeArray,
  each: each,
  map: map,
  filter: filter,
  clone: clone,
  attr: attr,
  uuid: uuid,
  camSafeUrlEncode: camSafeUrlEncode,
  throttleOnProgress: throttleOnProgress,
  getFileSize: getFileSize,
  getSkewTime: getSkewTime,
  error: error,
  obj2str: obj2str,
  getAuth: getAuth,
  parseSelectPayload: parseSelectPayload,
  getSourceParams: getSourceParams,
  isBrowser: true,
  isNode: isNode,
  isCIHost: isCIHost,
  isIOS_QQ: isIOS && isQQ
};
module.exports = util;
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../node_modules/process/browser.js */ "./node_modules/process/browser.js")))

/***/ })

/******/ });
});

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbm9kZV9tb2R1bGVzL2Nvcy1qcy1zZGstdjUvZGlzdC9jb3MtanMtc2RrLXY1LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBO0FBQ0EsSUFBSSxJQUF5RDtBQUM3RDtBQUNBLE1BQU0sRUFLb0I7QUFDMUIsQ0FBQztBQUNELG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxnQ0FBZ0M7QUFDbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFLGtCQUFrQjtBQUNsRjtBQUNBLHlEQUF5RCxjQUFjO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELGlDQUFpQztBQUNsRix3SEFBd0gsbUJBQW1CLEVBQUU7QUFDN0k7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLDBCQUEwQixFQUFFO0FBQy9ELHlDQUF5QyxlQUFlO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQsK0RBQStEO0FBQzdIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDhDQUE4QyxrRUFBa0U7O0FBRWhIO0FBQ0Esd0JBQXdCLFNBQVM7QUFDakM7QUFDQTtBQUNBO0FB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VDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWCxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYLFNBQVM7QUFDVDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1gsU0FBUztBQUNULE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUE4QyxPQUFPO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxLQUFLOztBQUVMO0FBQ0E7QUFDQTtBQUNBOztBQUVBLGdCQUFnQixHQUFHO0FBQ25CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxhQUFhO0FBQ2I7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQSxPQUFP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QUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0EsR0FBRztBQUNILEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBOztBQUVBLEVBQUU7QUFDRjtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG1CQUFtQjtBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxVQUFVO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsVUFBVTtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQSxjQUFjLE1BQU07QUFDcEI7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGdEQUFnRDtBQUM1RSxJQUFJO0FBQ0osNEJBQTRCLG9DQUFvQztBQUNoRTtBQUNBOztBQUVBLGNBQWMsTUFBTTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGdDQUFnQztBQUM1RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnQ0FBZ0M7QUFDM0Q7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsV0FBVztBQUN0QiwyRUFBMkU7QUFDM0Usa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixNQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyxNQUFNO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxJQUFJOztBQUVKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLFNBQVM7QUFDVjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLDRDQUE0Qzs7QUFFM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEs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T0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHLEVBQUU7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLDhDQUE4Qzs7QUFFOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPOzs7QUFHUDtBQUNBO0FBQ0E7QUFDQSxPQUFPOzs7QUFHUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQSxPQUFPO0FBQ1A7O0FBRUE7QUFDQSxHQUFHLEVBQUU7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSw0Q0FBNEM7O0FBRTVDO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQSxPQUFPOztBQUVQO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUcsRUFBRTs7QUFFTDtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULE9BQU87QUFDUDtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVA7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILENBQUM7OztBQUdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUcsRUFBRTs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQSxHQUFHO0FBQ0gsQ0FBQzs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxFQUFFOztBQUVMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0EsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7O0FBRUEsNENBQTRDLFNBQVM7QUFDckQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0gsQ0FBQzs7O0FBR0Q7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7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Q0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsdURBQXVEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0EscURBQXFEO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxHQUFHO0FBQ0g7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsTUFBTTtBQUN0QixZQUFZLFNBQVM7QUFDckIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsWUFBWSxPQUFPO0FBQ25CLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLFlBQVksU0FBUztBQUNyQixhQUFhLE9BQU87QUFDcEIsYUFBYSxPQUFPO0FBQ3BCOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsWUFBWSxTQUFTO0FBQ3JCLGFBQWEsT0FBTztBQUNwQixhQUFhLE9BQU87QUFDcEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixZQUFZLFNBQVM7QUFDckIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNILENBQUM7O0FBRUQ7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixZQUFZLFNBQVM7QUFDckIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQjs7O0FBR0E7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0EsK0JBQStCOztBQUUvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBOztBQUVBLGtDQUFrQzs7QUFFbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7O0FBRUE7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsdUJBQXVCO0FBQ3ZDLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLFlBQVksU0FBUztBQUNyQixpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4Qjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxPQUFPO0FBQ1AsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE1BQU07QUFDdEIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsWUFBWSxTQUFTO0FBQ3JCLGFBQWEsT0FBTztBQUNwQixhQUFhLE9BQU87QUFDcEIsaUJBQWlCLE9BQU87QUFDeEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEscUNBQXFDLFNBQVM7QUFDOUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHLEVBQUU7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixZQUFZLFNBQVM7QUFDckIsYUFBYSxPQUFPO0FBQ3BCLGFBQWEsT0FBTztBQUNwQixpQkFBaUIsT0FBTztBQUN4Qjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsaUVBQWlFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsWUFBWSxTQUFTO0FBQ3JCLGFBQWEsT0FBTztBQUNwQixhQUFhLE9BQU87QUFDcEIsaUJBQWlCLE9BQU87QUFDeEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixZQUFZLFNBQVM7QUFDckIsaUJBQWlCLE9BQU87QUFDeEIsaUJBQWlCLE9BQU87QUFDeEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixZQUFZLFNBQVM7QUFDckIsaUJBQWlCLE9BQU87QUFDeEIsaUJBQWlCLE9BQU87QUFDeEI7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLFlBQVksT0FBTztBQUNuQixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsT0FBTztBQUN2QixnQkFBZ0IsdUJBQXVCO0FBQ3ZDLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLFlBQVksU0FBUztBQUNyQixpQkFBaUIsT0FBTztBQUN4QixpQkFBaUIsT0FBTztBQUN4Qjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsWUFBWSxPQUFPO0FBQ25CLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGdCQUFnQixPQUFPO0FBQ3ZCLGFBQWEsT0FBTztBQUNwQjs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxZQUFZLE9BQU87QUFDbkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsZ0JBQWdCLE9BQU87QUFDdkIsWUFBWSxTQUFTO0FBQ3JCLGlCQUFpQixPQUFPO0FBQ3hCLGlCQUFpQixPQUFPO0FBQ3hCOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBLEdBQUc7QUFDSDtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxDQUFDOzs7QUFHRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxhQUFhLGdCQUFnQjtBQUM3Qjs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxDQUFDOzs7QUFHRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxHQUFHOzs7QUFHSDtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBLGlCQUFpQixPQUFPO0FBQ3hCLEtBQUs7QUFDTCxxQkFBcUIsT0FBTztBQUM1Qjs7QUFFQTtBQUNBLGlCQUFpQixPQUFPO0FBQ3hCO0FBQ0E7O0FBRUEsNkJBQTZCLEVBQUUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFFBQVEsRUFBRSw2QkFBNkIsRUFBRSxRQUFRLEVBQUUsd0JBQXdCLEVBQUUsS0FBSyxFQUFFO0FBQ3JKLDZCQUE2QixPQUFPLHVCQUF1QixZQUFZLDZCQUE2QixRQUFRLDRCQUE0QixRQUFRLHdCQUF3QixLQUFLOztBQUU3SztBQUNBO0FBQ0EsR0FBRzs7O0FBR0g7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTs7O0FBR0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRyxFQUFFOztBQUVMLG9FQUFvRTs7QUFFcEUsc0ZBQXNGOztBQUV0Rjs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQ0FBbUM7O0FBRW5DOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSwrQkFBK0I7O0FBRS9CO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQSxpREFBaUQ7O0FBRWpEOztBQUVBO0FBQ0E7O0FBRUEsdUNBQXVDLFFBQVE7QUFDL0M7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLDZFQUE2RSw2Q0FBNkMsbUZBQW1GO0FBQzdNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxXQUFXO0FBQ1g7QUFDQTs7QUFFQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7OztBQUdKO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0EsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOzs7QUFHQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsRUFBRTs7QUFFRjtBQUNBLHNFQUFzRTtBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxPQUFPOztBQUVQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtB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RUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsNENBQTRDOztBQUU1QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07OztBQUdOO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsS0FBSztBQUNMOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTs7QUFFQTtBQUNBLGtCQUFrQjtBQUNsQjs7QUFFQSxpQkFBaUI7QUFDakIsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxxREFBcUQ7O0FBRXJEO0FBQ0E7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7OztBQUdMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOzs7QUFHTDtBQUNBO0FBQ0EsS0FBSzs7O0FBR0w7QUFDQTtBQUNBLEtBQUs7OztBQUdMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOzs7QUFHTDtBQUNBOztBQUVBOztBQUVBO0FBQ0EsS0FBSzs7O0FBR0w7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEtBQUs7OztBQUdMO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxLQUFLOzs7QUFHTDtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFOztBQUVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsRUFBRTs7QUFFRjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsQ0FBQzs7O0FBR0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdTQUFnUzs7QUFFaFM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLENBQUM7OztBQUdEO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCOztBQUV2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7OztBQUdIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTzs7QUFFUDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBO0FBQ0EsS0FBSzs7QUFFTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esc0RBQXNEOztBQUV0RDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUwsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQSxDQUFDOztBQUVEOztBQUVBLE9BQU87O0FBRVA7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztB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b24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJDT1NcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wiQ09TXCJdID0gZmFjdG9yeSgpO1xufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbi8qKioqKiovIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuLyoqKioqKi8gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbi8qKioqKiovIFx0XHRcdGk6IG1vZHVsZUlkLFxuLyoqKioqKi8gXHRcdFx0bDogZmFsc2UsXG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fVxuLyoqKioqKi8gXHRcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuLyoqKioqKi8gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4vKioqKioqLyBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuLyoqKioqKi8gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbi8qKioqKiovIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuLyoqKioqKi8gXHRcdH1cbi8qKioqKiovIFx0fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuLyoqKioqKi8gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuLyoqKioqKi8gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4vKioqKioqLyBcdFx0fVxuLyoqKioqKi8gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3Rcbi8qKioqKiovIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4vKioqKioqLyBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLyoqKioqKi8gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3Rcbi8qKioqKiovIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuLyoqKioqKi8gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuLyoqKioqKi8gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4vKioqKioqLyBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbi8qKioqKiovIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuLyoqKioqKi8gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4vKioqKioqLyBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuLyoqKioqKi8gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbi8qKioqKiovIFx0XHRyZXR1cm4gbnM7XG4vKioqKioqLyBcdH07XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbi8qKioqKiovIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbi8qKioqKiovIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4vKioqKioqLyBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuLyoqKioqKi8gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbi8qKioqKiovIFx0XHRyZXR1cm4gZ2V0dGVyO1xuLyoqKioqKi8gXHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiL2Rpc3QvXCI7XG4vKioqKioqL1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vKioqKioqLyBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IFwiLi9pbmRleC5qc1wiKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKHtcblxuLyoqKi8gXCIuL2luZGV4LmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9pbmRleC5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbnZhciBDT1MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3NyYy9jb3MgKi8gXCIuL3NyYy9jb3MuanNcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gQ09TO1xuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL2xpYi9iZWFjb24ubWluLmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9saWIvYmVhY29uLm1pbi5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihnbG9iYWwpIHt2YXIgX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fLCBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzt2YXIgX3R5cGVvZiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIEBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mICovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanNcIik7XG5cbiFmdW5jdGlvbiAodCwgZSkge1xuICBcIm9iamVjdFwiID09ICggZmFsc2UgPyB1bmRlZmluZWQgOiBfdHlwZW9mKGV4cG9ydHMpKSAmJiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBtb2R1bGUgPyBtb2R1bGUuZXhwb3J0cyA9IGUoKSA6ICB0cnVlID8gIShfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18gPSAoZSksXG5cdFx0XHRcdF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fID0gKHR5cGVvZiBfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18gPT09ICdmdW5jdGlvbicgP1xuXHRcdFx0XHQoX19XRUJQQUNLX0FNRF9ERUZJTkVfRkFDVE9SWV9fLmNhbGwoZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXywgZXhwb3J0cywgbW9kdWxlKSkgOlxuXHRcdFx0XHRfX1dFQlBBQ0tfQU1EX0RFRklORV9GQUNUT1JZX18pLFxuXHRcdFx0XHRfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSkgOiB1bmRlZmluZWQ7XG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIF90ID0gZnVuY3Rpb24gdChlLCByKSB7XG4gICAgcmV0dXJuIChfdCA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7XG4gICAgICBfX3Byb3RvX186IFtdXG4gICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB0Ll9fcHJvdG9fXyA9IGU7XG4gICAgfSB8fCBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgZm9yICh2YXIgciBpbiBlKSB7XG4gICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCByKSAmJiAodFtyXSA9IGVbcl0pO1xuICAgICAgfVxuICAgIH0pKGUsIHIpO1xuICB9O1xuXG4gIHZhciBfZSA9IGZ1bmN0aW9uIGUoKSB7XG4gICAgcmV0dXJuIChfZSA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHQpIHtcbiAgICAgIGZvciAodmFyIGUsIHIgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgciA8IG47IHIrKykge1xuICAgICAgICBmb3IgKHZhciBvIGluIGUgPSBhcmd1bWVudHNbcl0pIHtcbiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbykgJiYgKHRbb10gPSBlW29dKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdDtcbiAgICB9KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHIodCwgZSwgciwgbikge1xuICAgIHJldHVybiBuZXcgKHIgfHwgKHIgPSBQcm9taXNlKSkoZnVuY3Rpb24gKG8sIGkpIHtcbiAgICAgIGZ1bmN0aW9uIGEodCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGMobi5uZXh0KHQpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgIGkodCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gcyh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYyhuLnRocm93KHQpKTtcbiAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgIGkodCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gYyh0KSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICB0LmRvbmUgPyBvKHQudmFsdWUpIDogKGUgPSB0LnZhbHVlLCBlIGluc3RhbmNlb2YgciA/IGUgOiBuZXcgcihmdW5jdGlvbiAodCkge1xuICAgICAgICAgIHQoZSk7XG4gICAgICAgIH0pKS50aGVuKGEsIHMpO1xuICAgICAgfVxuXG4gICAgICBjKChuID0gbi5hcHBseSh0LCBlIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG4odCwgZSkge1xuICAgIHZhciByLFxuICAgICAgICBuLFxuICAgICAgICBvLFxuICAgICAgICBpLFxuICAgICAgICBhID0ge1xuICAgICAgbGFiZWw6IDAsXG4gICAgICBzZW50OiBmdW5jdGlvbiBzZW50KCkge1xuICAgICAgICBpZiAoMSAmIG9bMF0pIHRocm93IG9bMV07XG4gICAgICAgIHJldHVybiBvWzFdO1xuICAgICAgfSxcbiAgICAgIHRyeXM6IFtdLFxuICAgICAgb3BzOiBbXVxuICAgIH07XG4gICAgcmV0dXJuIGkgPSB7XG4gICAgICBuZXh0OiBzKDApLFxuICAgICAgdGhyb3c6IHMoMSksXG4gICAgICByZXR1cm46IHMoMilcbiAgICB9LCBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiAoaVtTeW1ib2wuaXRlcmF0b3JdID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSksIGk7XG5cbiAgICBmdW5jdGlvbiBzKGkpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICBpZiAocikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG5cbiAgICAgICAgICBmb3IgKDsgYTspIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGlmIChyID0gMSwgbiAmJiAobyA9IDIgJiBpWzBdID8gbi5yZXR1cm4gOiBpWzBdID8gbi50aHJvdyB8fCAoKG8gPSBuLnJldHVybikgJiYgby5jYWxsKG4pLCAwKSA6IG4ubmV4dCkgJiYgIShvID0gby5jYWxsKG4sIGlbMV0pKS5kb25lKSByZXR1cm4gbztcblxuICAgICAgICAgICAgICBzd2l0Y2ggKG4gPSAwLCBvICYmIChpID0gWzIgJiBpWzBdLCBvLnZhbHVlXSksIGlbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgbyA9IGk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgIHJldHVybiBhLmxhYmVsKyssIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGlbMV0sXG4gICAgICAgICAgICAgICAgICAgIGRvbmU6ICExXG4gICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgICAgYS5sYWJlbCsrLCBuID0gaVsxXSwgaSA9IFswXTtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgaSA9IGEub3BzLnBvcCgpLCBhLnRyeXMucG9wKCk7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICBpZiAoIShvID0gYS50cnlzLCAobyA9IG8ubGVuZ3RoID4gMCAmJiBvW28ubGVuZ3RoIC0gMV0pIHx8IDYgIT09IGlbMF0gJiYgMiAhPT0gaVswXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYSA9IDA7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoMyA9PT0gaVswXSAmJiAoIW8gfHwgaVsxXSA+IG9bMF0gJiYgaVsxXSA8IG9bM10pKSB7XG4gICAgICAgICAgICAgICAgICAgIGEubGFiZWwgPSBpWzFdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKDYgPT09IGlbMF0gJiYgYS5sYWJlbCA8IG9bMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCA9IG9bMV0sIG8gPSBpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKG8gJiYgYS5sYWJlbCA8IG9bMl0pIHtcbiAgICAgICAgICAgICAgICAgICAgYS5sYWJlbCA9IG9bMl0sIGEub3BzLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBvWzJdICYmIGEub3BzLnBvcCgpLCBhLnRyeXMucG9wKCk7XG4gICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGkgPSBlLmNhbGwodCwgYSk7XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgIGkgPSBbNiwgdF0sIG4gPSAwO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgciA9IG8gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICg1ICYgaVswXSkgdGhyb3cgaVsxXTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdmFsdWU6IGlbMF0gPyBpWzFdIDogdm9pZCAwLFxuICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICB9O1xuICAgICAgICB9KFtpLCBzXSk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHZhciBvID0gXCJfX0JFQUNPTl9cIixcbiAgICAgIGkgPSBcIl9fQkVBQ09OX2RldmljZUlkXCIsXG4gICAgICBhID0gXCJsYXN0X3JlcG9ydF90aW1lXCIsXG4gICAgICBzID0gXCJzZW5kaW5nX2V2ZW50X2lkc1wiLFxuICAgICAgYyA9IFwiYmVhY29uX2NvbmZpZ1wiLFxuICAgICAgdSA9IFwiYmVhY29uX2NvbmZpZ19yZXF1ZXN0X3RpbWVcIixcbiAgICAgIGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCgpIHtcbiAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgIHRoaXMuZW1pdCA9IGZ1bmN0aW9uIChlLCByKSB7XG4gICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgdmFyIG4sXG4gICAgICAgICAgICAgIG8gPSB0Ll9fRXZlbnRzTGlzdFtlXTtcblxuICAgICAgICAgIGlmIChudWxsID09IG8gPyB2b2lkIDAgOiBvLmxlbmd0aCkge1xuICAgICAgICAgICAgbyA9IG8uc2xpY2UoKTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIG4gPSBvW2ldO1xuXG4gICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIGEgPSBuLmNhbGxiYWNrLmFwcGx5KHQsIFtyXSk7XG4gICAgICAgICAgICAgICAgaWYgKDEgPT09IG4udHlwZSAmJiB0LnJlbW92ZShlLCBuLmNhbGxiYWNrKSwgITEgPT09IGEpIGJyZWFrO1xuICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICB9XG4gICAgICB9LCB0aGlzLl9fRXZlbnRzTGlzdCA9IHt9O1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdC5sZW5ndGg7IHIrKykge1xuICAgICAgICBpZiAodFtyXS5jYWxsYmFjayA9PT0gZSkgcmV0dXJuIHI7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAtMTtcbiAgICB9LCB0LnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICBpZiAodm9pZCAwID09PSByICYmIChyID0gMCksIHRoaXMpIHtcbiAgICAgICAgdmFyIG4gPSB0aGlzLl9fRXZlbnRzTGlzdFt0XTtcblxuICAgICAgICBpZiAobiB8fCAobiA9IHRoaXMuX19FdmVudHNMaXN0W3RdID0gW10pLCAtMSA9PT0gdGhpcy5pbmRleE9mKG4sIGUpKSB7XG4gICAgICAgICAgdmFyIG8gPSB7XG4gICAgICAgICAgICBuYW1lOiB0LFxuICAgICAgICAgICAgdHlwZTogciB8fCAwLFxuICAgICAgICAgICAgY2FsbGJhY2s6IGVcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiBuLnB1c2gobyksIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICB9LCB0LnByb3RvdHlwZS5vbmUgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdGhpcy5vbih0LCBlLCAxKTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgaWYgKHRoaXMpIHtcbiAgICAgICAgdmFyIHIgPSB0aGlzLl9fRXZlbnRzTGlzdFt0XTtcbiAgICAgICAgaWYgKCFyKSByZXR1cm4gbnVsbDtcblxuICAgICAgICBpZiAoIWUpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX19FdmVudHNMaXN0W3RdO1xuICAgICAgICAgIH0gY2F0Y2ggKHQpIHt9XG5cbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyLmxlbmd0aCkge1xuICAgICAgICAgIHZhciBuID0gdGhpcy5pbmRleE9mKHIsIGUpO1xuICAgICAgICAgIHIuc3BsaWNlKG4sIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgfSwgdDtcbiAgfSgpO1xuXG4gIGZ1bmN0aW9uIGgodCwgZSkge1xuICAgIGZvciAodmFyIHIgPSB7fSwgbiA9IDAsIG8gPSBPYmplY3Qua2V5cyh0KTsgbiA8IG8ubGVuZ3RoOyBuKyspIHtcbiAgICAgIHZhciBpID0gb1tuXSxcbiAgICAgICAgICBhID0gdFtpXTtcbiAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBhKSByW2YoaSldID0gZihhKTtlbHNlIHtcbiAgICAgICAgaWYgKGUpIHRocm93IG5ldyBFcnJvcihcInZhbHVlIG1hc3QgYmUgc3RyaW5nICAhISEhXCIpO1xuICAgICAgICByW2YoU3RyaW5nKGkpKV0gPSBmKFN0cmluZyhhKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHI7XG4gIH1cblxuICBmdW5jdGlvbiBmKHQpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiAhPSB0eXBlb2YgdCkgcmV0dXJuIHQ7XG5cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHQucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXHxcIiwgXCJnXCIpLCBcIiU3Q1wiKS5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcJlwiLCBcImdcIiksIFwiJTI2XCIpLnJlcGxhY2UobmV3IFJlZ0V4cChcIlxcXFw9XCIsIFwiZ1wiKSwgXCIlM0RcIikucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXCtcIiwgXCJnXCIpLCBcIiUyQlwiKTtcbiAgICB9IGNhdGNoICh0KSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwKHQpIHtcbiAgICByZXR1cm4gU3RyaW5nKHQuQTk5KSArIFN0cmluZyh0LkExMDApO1xuICB9XG5cbiAgdmFyIGQgPSBmdW5jdGlvbiBkKCkge307XG5cbiAgdmFyIHYgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0KSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICB0aGlzLmxpZmVDeWNsZSA9IG5ldyBsKCksIHRoaXMudXBsb2FkSm9iUXVldWUgPSBbXSwgdGhpcy5hZGRpdGlvbmFsUGFyYW1zID0ge30sIHRoaXMuZGVsYXlUaW1lID0gMCwgdGhpcy5fbm9ybWFsTG9nUGlwZWxpbmUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICBpZiAoIXQgfHwgIXQucmVkdWNlIHx8ICF0Lmxlbmd0aCkgdGhyb3cgbmV3IFR5cGVFcnJvcihcImNyZWF0ZVBpcGVsaW5lIOaWueazlemcgOimgeS8oOWFpeiHs+WwkeacieS4gOS4qiBwaXBlIOeahOaVsOe7hFwiKTtcbiAgICAgICAgcmV0dXJuIDEgPT09IHQubGVuZ3RoID8gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgICB0WzBdKGUsIHIgfHwgZCk7XG4gICAgICAgIH0gOiB0LnJlZHVjZShmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAociwgbikge1xuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gbiAmJiAobiA9IGQpLCB0KHIsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsID09IGUgPyB2b2lkIDAgOiBlKHQsIG4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9KFtmdW5jdGlvbiAodCkge1xuICAgICAgICByLnNlbmQoe1xuICAgICAgICAgIHVybDogci5zdHJhdGVneS5nZXRVcGxvYWRVcmwoKSxcbiAgICAgICAgICBkYXRhOiB0LFxuICAgICAgICAgIG1ldGhvZDogXCJwb3N0XCIsXG4gICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PVVURi04XCJcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBlID0gci5jb25maWcub25SZXBvcnRTdWNjZXNzO1xuICAgICAgICAgIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgZSAmJiBlKEpTT04uc3RyaW5naWZ5KHQuZXZlbnRzKSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgZSA9IHIuY29uZmlnLm9uUmVwb3J0RmFpbDtcbiAgICAgICAgICBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGUgJiYgZShKU09OLnN0cmluZ2lmeSh0LmV2ZW50cykpO1xuICAgICAgICB9KTtcbiAgICAgIH1dKSwgZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgaWYgKCF0KSB0aHJvdyBlIGluc3RhbmNlb2YgRXJyb3IgPyBlIDogbmV3IEVycm9yKGUpO1xuICAgICAgfShCb29sZWFuKHQuYXBwa2V5KSwgXCJhcHBrZXkgbXVzdCBiZSBpbml0aWFsXCIpLCB0aGlzLmNvbmZpZyA9IF9lKHt9LCB0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUub25Vc2VyQWN0aW9uID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHRoaXMucHJlUmVwb3J0KHQsIGUsICExKTtcbiAgICB9LCB0LnByb3RvdHlwZS5vbkRpcmVjdFVzZXJBY3Rpb24gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdGhpcy5wcmVSZXBvcnQodCwgZSwgITApO1xuICAgIH0sIHQucHJvdG90eXBlLnByZVJlcG9ydCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICB0ID8gdGhpcy5zdHJhdGVneS5pc0V2ZW50VXBPbk9mZigpICYmICh0aGlzLnN0cmF0ZWd5LmlzQmxhY2tFdmVudCh0KSB8fCB0aGlzLnN0cmF0ZWd5LmlzU2FtcGxlRXZlbnQodCkgfHwgdGhpcy5vblJlcG9ydCh0LCBlLCByKSkgOiB0aGlzLmVycm9yUmVwb3J0LnJlcG9ydEVycm9yKFwiNjAyXCIsIFwiIG5vIGV2ZW50Q29kZVwiKTtcbiAgICB9LCB0LnByb3RvdHlwZS5hZGRBZGRpdGlvbmFsUGFyYW1zID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIGZvciAodmFyIGUgPSAwLCByID0gT2JqZWN0LmtleXModCk7IGUgPCByLmxlbmd0aDsgZSsrKSB7XG4gICAgICAgIHZhciBuID0gcltlXTtcbiAgICAgICAgdGhpcy5hZGRpdGlvbmFsUGFyYW1zW25dID0gdFtuXTtcbiAgICAgIH1cbiAgICB9LCB0LnByb3RvdHlwZS5zZXRDaGFubmVsSWQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdGhpcy5jb21tb25JbmZvLmNoYW5uZWxJRCA9IFN0cmluZyh0KTtcbiAgICB9LCB0LnByb3RvdHlwZS5zZXRPcGVuSWQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdGhpcy5jb21tb25JbmZvLm9wZW5pZCA9IFN0cmluZyh0KTtcbiAgICB9LCB0LnByb3RvdHlwZS5zZXRVbmlvbmlkID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRoaXMuY29tbW9uSW5mby51bmlkID0gU3RyaW5nKHQpO1xuICAgIH0sIHQucHJvdG90eXBlLmdldERldmljZUlkID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tbW9uSW5mby5kZXZpY2VJZDtcbiAgICB9LCB0LnByb3RvdHlwZS5nZXRDb21tb25JbmZvID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuY29tbW9uSW5mbztcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVTZW5kaW5nSWQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIGUgPSBKU09OLnBhcnNlKHRoaXMuc3RvcmFnZS5nZXRJdGVtKHMpKSxcbiAgICAgICAgICAgIHIgPSBlLmluZGV4T2YodCk7XG4gICAgICAgIC0xICE9IHIgJiYgKGUuc3BsaWNlKHIsIDEpLCB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShzLCBKU09OLnN0cmluZ2lmeShlKSkpO1xuICAgICAgfSBjYXRjaCAodCkge31cbiAgICB9LCB0O1xuICB9KCksXG4gICAgICB5ID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQodCwgZSwgciwgbikge1xuICAgICAgdGhpcy5yZXF1ZXN0UGFyYW1zID0ge30sIHRoaXMubmV0d29yayA9IG4sIHRoaXMucmVxdWVzdFBhcmFtcy5hdHRhaWQgPSBcIjAwNDAwMDE0MTQ0XCIsIHRoaXMucmVxdWVzdFBhcmFtcy50b2tlbiA9IFwiNjQ3ODE1OTkzN1wiLCB0aGlzLnJlcXVlc3RQYXJhbXMucHJvZHVjdF9pZCA9IHQuYXBwa2V5LCB0aGlzLnJlcXVlc3RQYXJhbXMucGxhdGZvcm0gPSByLCB0aGlzLnJlcXVlc3RQYXJhbXMudWluID0gZS5kZXZpY2VJZCwgdGhpcy5yZXF1ZXN0UGFyYW1zLm1vZGVsID0gXCJcIiwgdGhpcy5yZXF1ZXN0UGFyYW1zLm9zID0gciwgdGhpcy5yZXF1ZXN0UGFyYW1zLmFwcF92ZXJzaW9uID0gdC5hcHBWZXJzaW9uLCB0aGlzLnJlcXVlc3RQYXJhbXMuc2RrX3ZlcnNpb24gPSBlLnNka1ZlcnNpb24sIHRoaXMucmVxdWVzdFBhcmFtcy5lcnJvcl9zdGFjayA9IFwiXCIsIHRoaXMudXBsb2FkVXJsID0gdC5pc092ZXJzZWEgPyBcImh0dHBzOi8vaHRyYWNlLndldHZpbmZvLmNvbS9rdlwiIDogXCJodHRwczovL2gudHJhY2UucXEuY29tL2t2XCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLnJlcG9ydEVycm9yID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHRoaXMucmVxdWVzdFBhcmFtcy5fZGMgPSBNYXRoLnJhbmRvbSgpLCB0aGlzLnJlcXVlc3RQYXJhbXMuZXJyb3JfbXNnID0gZSwgdGhpcy5yZXF1ZXN0UGFyYW1zLmVycm9yX2NvZGUgPSB0LCB0aGlzLm5ldHdvcmsuZ2V0KHRoaXMudXBsb2FkVXJsLCB7XG4gICAgICAgIHBhcmFtczogdGhpcy5yZXF1ZXN0UGFyYW1zXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAodCkge30pO1xuICAgIH0sIHQ7XG4gIH0oKSxcbiAgICAgIGcgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0LCBlLCByLCBuKSB7XG4gICAgICB0aGlzLnN0cmF0ZWd5ID0ge1xuICAgICAgICBpc0V2ZW50VXBPbk9mZjogITAsXG4gICAgICAgIGh0dHBzVXBsb2FkVXJsOiBcImh0dHBzOi8vb3RoZXZlLmJlYWNvbi5xcS5jb20vYW5hbHl0aWNzL3YyX3VwbG9hZFwiLFxuICAgICAgICByZXF1ZXN0SW50ZXJ2YWw6IDMwLFxuICAgICAgICBibGFja2xpc3Q6IFtdLFxuICAgICAgICBzYW1wbGVsaXN0OiBbXVxuICAgICAgfSwgdGhpcy5yZWFsU2FtcGxlID0ge30sIHRoaXMuYXBwa2V5ID0gXCJcIiwgdGhpcy5hcHBrZXkgPSB0LmFwcGtleSwgdGhpcy5zdG9yYWdlID0gcjtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIG8gPSBKU09OLnBhcnNlKHRoaXMuc3RvcmFnZS5nZXRJdGVtKGMpKTtcbiAgICAgICAgbyAmJiB0aGlzLnByb2Nlc3NEYXRhKG8pO1xuICAgICAgfSBjYXRjaCAodCkge31cblxuICAgICAgdC5pc092ZXJzZWEgJiYgKHRoaXMuc3RyYXRlZ3kuaHR0cHNVcGxvYWRVcmwgPSBcImh0dHBzOi8vc3ZpYmVhY29uLm9uZXphcHAuY29tL2FuYWx5dGljcy92Ml91cGxvYWRcIiksICF0LmlzT3ZlcnNlYSAmJiB0aGlzLm5lZWRSZXF1ZXN0Q29uZmlnKCkgJiYgdGhpcy5yZXF1ZXN0Q29uZmlnKHQuYXBwVmVyc2lvbiwgZSwgbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLnJlcXVlc3RDb25maWcgPSBmdW5jdGlvbiAodCwgZSwgcikge1xuICAgICAgdmFyIG4gPSB0aGlzO1xuICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odSwgRGF0ZS5ub3coKS50b1N0cmluZygpKSwgci5wb3N0KFwiaHR0cHM6Ly9vdGguc3RyLmJlYWNvbi5xcS5jb20vdHJwYy5iZWFjb24uY29uZmlnc2VydmVyLkJlYWNvbkNvbmZpZ1NlcnZpY2UvUXVlcnlDb25maWdcIiwge1xuICAgICAgICBwbGF0Zm9ybUlkOiBcInVuZGVmaW5lZFwiID09IHR5cGVvZiB3eCA/IFwiM1wiIDogXCI0XCIsXG4gICAgICAgIG1haW5BcHBLZXk6IHRoaXMuYXBwa2V5LFxuICAgICAgICBhcHBWZXJzaW9uOiB0LFxuICAgICAgICBzZGtWZXJzaW9uOiBlLnNka1ZlcnNpb24sXG4gICAgICAgIG9zVmVyc2lvbjogZS51c2VyQWdlbnQsXG4gICAgICAgIG1vZGVsOiBcIlwiLFxuICAgICAgICBwYWNrYWdlTmFtZTogXCJcIixcbiAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgQTM6IGUuZGV2aWNlSWRcbiAgICAgICAgfVxuICAgICAgfSkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICBpZiAoMCA9PSB0LmRhdGEucmV0KSB0cnkge1xuICAgICAgICAgIHZhciBlID0gSlNPTi5wYXJzZSh0LmRhdGEuYmVhY29uQ29uZmlnKTtcbiAgICAgICAgICBlICYmIChuLnByb2Nlc3NEYXRhKGUpLCBuLnN0b3JhZ2Uuc2V0SXRlbShjLCB0LmRhdGEuYmVhY29uQ29uZmlnKSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHt9IGVsc2Ugbi5wcm9jZXNzRGF0YShudWxsKSwgbi5zdG9yYWdlLnNldEl0ZW0oYywgXCJcIik7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAodCkge30pO1xuICAgIH0sIHQucHJvdG90eXBlLnByb2Nlc3NEYXRhID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlLCByLCBuLCBvLCBpO1xuICAgICAgdGhpcy5zdHJhdGVneS5pc0V2ZW50VXBPbk9mZiA9IG51bGwgIT09IChlID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5pc0V2ZW50VXBPbk9mZikgJiYgdm9pZCAwICE9PSBlID8gZSA6IHRoaXMuc3RyYXRlZ3kuaXNFdmVudFVwT25PZmYsIHRoaXMuc3RyYXRlZ3kuaHR0cHNVcGxvYWRVcmwgPSBudWxsICE9PSAociA9IG51bGwgPT0gdCA/IHZvaWQgMCA6IHQuaHR0cHNVcGxvYWRVcmwpICYmIHZvaWQgMCAhPT0gciA/IHIgOiB0aGlzLnN0cmF0ZWd5Lmh0dHBzVXBsb2FkVXJsLCB0aGlzLnN0cmF0ZWd5LnJlcXVlc3RJbnRlcnZhbCA9IG51bGwgIT09IChuID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5yZXF1ZXN0SW50ZXJ2YWwpICYmIHZvaWQgMCAhPT0gbiA/IG4gOiB0aGlzLnN0cmF0ZWd5LnJlcXVlc3RJbnRlcnZhbCwgdGhpcy5zdHJhdGVneS5ibGFja2xpc3QgPSBudWxsICE9PSAobyA9IG51bGwgPT0gdCA/IHZvaWQgMCA6IHQuYmxhY2tsaXN0KSAmJiB2b2lkIDAgIT09IG8gPyBvIDogdGhpcy5zdHJhdGVneS5ibGFja2xpc3QsIHRoaXMuc3RyYXRlZ3kuc2FtcGxlbGlzdCA9IG51bGwgIT09IChpID0gbnVsbCA9PSB0ID8gdm9pZCAwIDogdC5zYW1wbGVsaXN0KSAmJiB2b2lkIDAgIT09IGkgPyBpIDogdGhpcy5zdHJhdGVneS5zYW1wbGVsaXN0O1xuXG4gICAgICBmb3IgKHZhciBhID0gMCwgcyA9IHRoaXMuc3RyYXRlZ3kuc2FtcGxlbGlzdDsgYSA8IHMubGVuZ3RoOyBhKyspIHtcbiAgICAgICAgdmFyIGMgPSBzW2FdLnNwbGl0KFwiLFwiKTtcbiAgICAgICAgMiA9PSBjLmxlbmd0aCAmJiAodGhpcy5yZWFsU2FtcGxlW2NbMF1dID0gY1sxXSk7XG4gICAgICB9XG4gICAgfSwgdC5wcm90b3R5cGUubmVlZFJlcXVlc3RDb25maWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdCA9IE51bWJlcih0aGlzLnN0b3JhZ2UuZ2V0SXRlbSh1KSk7XG4gICAgICByZXR1cm4gRGF0ZS5ub3coKSAtIHQgPiA2MCAqIHRoaXMuc3RyYXRlZ3kucmVxdWVzdEludGVydmFsICogMWUzO1xuICAgIH0sIHQucHJvdG90eXBlLmdldFVwbG9hZFVybCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnN0cmF0ZWd5Lmh0dHBzVXBsb2FkVXJsICsgXCI/YXBwa2V5PVwiICsgdGhpcy5hcHBrZXk7XG4gICAgfSwgdC5wcm90b3R5cGUuaXNCbGFja0V2ZW50ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiAtMSAhPSB0aGlzLnN0cmF0ZWd5LmJsYWNrbGlzdC5pbmRleE9mKHQpO1xuICAgIH0sIHQucHJvdG90eXBlLmlzRXZlbnRVcE9uT2ZmID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RyYXRlZ3kuaXNFdmVudFVwT25PZmY7XG4gICAgfSwgdC5wcm90b3R5cGUuaXNTYW1wbGVFdmVudCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gISFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGhpcy5yZWFsU2FtcGxlLCB0KSAmJiB0aGlzLnJlYWxTYW1wbGVbdF0gPCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBNYXRoLmZsb29yKDFlNCkpO1xuICAgIH0sIHQ7XG4gIH0oKSxcbiAgICAgIG0gPSBcInNlc3Npb25fc3RvcmFnZV9rZXlcIixcbiAgICAgIHcgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0LCBlLCByKSB7XG4gICAgICB0aGlzLmJlYWNvbiA9IHIsIHRoaXMuc3RvcmFnZSA9IHQsIHRoaXMuZHVyYXRpb24gPSBlLCB0aGlzLmFwcGtleSA9IHIuY29uZmlnLmFwcGtleTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUuZ2V0U2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0obSk7XG4gICAgICBpZiAoIXQpIHJldHVybiB0aGlzLmNyZWF0ZVNlc3Npb24oKTtcbiAgICAgIHZhciBlID0gXCJcIixcbiAgICAgICAgICByID0gMDtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIG4gPSBKU09OLnBhcnNlKHQpIHx8IHtcbiAgICAgICAgICBzZXNzaW9uSWQ6IHZvaWQgMCxcbiAgICAgICAgICBzZXNzaW9uU3RhcnQ6IHZvaWQgMFxuICAgICAgICB9O1xuICAgICAgICBpZiAoIW4uc2Vzc2lvbklkIHx8ICFuLnNlc3Npb25TdGFydCkgcmV0dXJuIHRoaXMuY3JlYXRlU2Vzc2lvbigpO1xuICAgICAgICB2YXIgbyA9IE51bWJlcih0aGlzLnN0b3JhZ2UuZ2V0SXRlbShhKSk7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gbyA+IHRoaXMuZHVyYXRpb24pIHJldHVybiB0aGlzLmNyZWF0ZVNlc3Npb24oKTtcbiAgICAgICAgZSA9IG4uc2Vzc2lvbklkLCByID0gbi5zZXNzaW9uU3RhcnQ7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXNzaW9uSWQ6IGUsXG4gICAgICAgIHNlc3Npb25TdGFydDogclxuICAgICAgfTtcbiAgICB9LCB0LnByb3RvdHlwZS5jcmVhdGVTZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSBEYXRlLm5vdygpLFxuICAgICAgICAgIGUgPSB7XG4gICAgICAgIHNlc3Npb25JZDogdGhpcy5hcHBrZXkgKyBcIl9cIiArIHQudG9TdHJpbmcoKSxcbiAgICAgICAgc2Vzc2lvblN0YXJ0OiB0XG4gICAgICB9O1xuICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0obSwgSlNPTi5zdHJpbmdpZnkoZSkpLCB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShhLCB0LnRvU3RyaW5nKCkpO1xuICAgICAgdmFyIHIgPSBcImlzX25ld191c2VyXCIsXG4gICAgICAgICAgbiA9IHRoaXMuc3RvcmFnZS5nZXRJdGVtKHIpO1xuICAgICAgcmV0dXJuIHRoaXMuYmVhY29uLm9uRGlyZWN0VXNlckFjdGlvbihcInJxZF9hcHBsYXVuY2hlZFwiLCB7XG4gICAgICAgIEEyMTogbiA/IFwiTlwiIDogXCJZXCJcbiAgICAgIH0pLCB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShyLCBKU09OLnN0cmluZ2lmeSghMSkpLCBlO1xuICAgIH0sIHQ7XG4gIH0oKTtcblxuICBmdW5jdGlvbiBiKCkge1xuICAgIHZhciB0ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgZSA9IHQuaW5kZXhPZihcImNvbXBhdGlibGVcIikgPiAtMSAmJiB0LmluZGV4T2YoXCJNU0lFXCIpID4gLTEsXG4gICAgICAgIHIgPSB0LmluZGV4T2YoXCJFZGdlXCIpID4gLTEgJiYgIWUsXG4gICAgICAgIG4gPSB0LmluZGV4T2YoXCJUcmlkZW50XCIpID4gLTEgJiYgdC5pbmRleE9mKFwicnY6MTEuMFwiKSA+IC0xO1xuXG4gICAgaWYgKGUpIHtcbiAgICAgIG5ldyBSZWdFeHAoXCJNU0lFIChcXFxcZCtcXFxcLlxcXFxkKyk7XCIpLnRlc3QodCk7XG4gICAgICB2YXIgbyA9IHBhcnNlRmxvYXQoUmVnRXhwLiQxKTtcbiAgICAgIHJldHVybiA3ID09IG8gPyA3IDogOCA9PSBvID8gOCA6IDkgPT0gbyA/IDkgOiAxMCA9PSBvID8gMTAgOiA2O1xuICAgIH1cblxuICAgIHJldHVybiByID8gLTIgOiBuID8gMTEgOiAtMTtcbiAgfVxuXG4gIHZhciBfUyA9IGZ1bmN0aW9uIFMoKSB7XG4gICAgcmV0dXJuIChfUyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHQpIHtcbiAgICAgIGZvciAodmFyIGUsIHIgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgciA8IG47IHIrKykge1xuICAgICAgICBmb3IgKHZhciBvIGluIGUgPSBhcmd1bWVudHNbcl0pIHtcbiAgICAgICAgICBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbykgJiYgKHRbb10gPSBlW29dKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdDtcbiAgICB9KS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9O1xuXG4gIHZhciBFLFxuICAgICAgSSA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQsIGUpIHtcbiAgICAgIHZvaWQgMCA9PT0gZSAmJiAoZSA9IHt9KSwgdGhpcy5yZXBvcnRPcHRpb25zID0ge30sIHRoaXMuY29uZmlnID0gdCwgdGhpcy5yZXBvcnRPcHRpb25zID0gZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5jYW5Vc2VEQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAhIShudWxsID09PSB3aW5kb3cgfHwgdm9pZCAwID09PSB3aW5kb3cgPyB2b2lkIDAgOiB3aW5kb3cuaW5kZXhlZERCKTtcbiAgICB9LCB0LnByb3RvdHlwZS5vcGVuREIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHIsIG4pIHtcbiAgICAgICAgaWYgKCF0LmNhblVzZURCKCkpIHJldHVybiBuKHtcbiAgICAgICAgICBtZXNzYWdlOiBcIuW9k+WJjeS4jeaUr+aMgSBpbmRleGVkZGJcIlxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIG8gPSBlLmNvbmZpZyxcbiAgICAgICAgICAgIGkgPSBvLm5hbWUsXG4gICAgICAgICAgICBhID0gby52ZXJzaW9uLFxuICAgICAgICAgICAgcyA9IG8uc3RvcmVzLFxuICAgICAgICAgICAgYyA9IGluZGV4ZWREQi5vcGVuKGksIGEpO1xuICAgICAgICBjLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlLmRiID0gYy5yZXN1bHQsIHIoKSwgX1Moe1xuICAgICAgICAgICAgcmVzdWx0OiAxLFxuICAgICAgICAgICAgZnVuYzogXCJvcGVuXCIsXG4gICAgICAgICAgICBwYXJhbXM6IEpTT04uc3RyaW5naWZ5KGUuY29uZmlnKVxuICAgICAgICAgIH0sIGUucmVwb3J0T3B0aW9ucyk7XG4gICAgICAgIH0sIGMub25lcnJvciA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgdmFyIHIsIG87XG4gICAgICAgICAgbih0KSwgX1Moe1xuICAgICAgICAgICAgcmVzdWx0OiAwLFxuICAgICAgICAgICAgZnVuYzogXCJvcGVuXCIsXG4gICAgICAgICAgICBwYXJhbXM6IEpTT04uc3RyaW5naWZ5KGUuY29uZmlnKSxcbiAgICAgICAgICAgIGVycm9yX21zZzogbnVsbCA9PT0gKG8gPSBudWxsID09PSAociA9IHQudGFyZ2V0KSB8fCB2b2lkIDAgPT09IHIgPyB2b2lkIDAgOiByLmVycm9yKSB8fCB2b2lkIDAgPT09IG8gPyB2b2lkIDAgOiBvLm1lc3NhZ2VcbiAgICAgICAgICB9LCBlLnJlcG9ydE9wdGlvbnMpO1xuICAgICAgICB9LCBjLm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBlLmRiID0gYy5yZXN1bHQ7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgbnVsbCA9PSBzIHx8IHMuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICBlLmNyZWF0ZVN0b3JlKHQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgX1Moe1xuICAgICAgICAgICAgICByZXN1bHQ6IDAsXG4gICAgICAgICAgICAgIGZ1bmM6IFwib3BlblwiLFxuICAgICAgICAgICAgICBwYXJhbXM6IEpTT04uc3RyaW5naWZ5KGUuY29uZmlnKSxcbiAgICAgICAgICAgICAgZXJyb3JfbXNnOiB0Lm1lc3NhZ2VcbiAgICAgICAgICAgIH0sIGUucmVwb3J0T3B0aW9ucyksIG4odCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUudXNlU3RvcmUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcmVOYW1lID0gdCwgdGhpcztcbiAgICB9LCB0LnByb3RvdHlwZS5kZWxldGVEQiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLmNsb3NlREIoKSwgbmV3IFByb21pc2UoZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgdmFyIG4gPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UodC5jb25maWcubmFtZSk7XG4gICAgICAgIG4ub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBlKCk7XG4gICAgICAgIH0sIG4ub25lcnJvciA9IHI7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5jbG9zZURCID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQ7XG4gICAgICBudWxsID09PSAodCA9IHRoaXMuZGIpIHx8IHZvaWQgMCA9PT0gdCB8fCB0LmNsb3NlKCksIHRoaXMuZGIgPSBudWxsO1xuICAgIH0sIHQucHJvdG90eXBlLmdldFN0b3JlQ291bnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgICAgdmFyIG4gPSB0LmdldFN0b3JlKFwicmVhZG9ubHlcIikuY291bnQoKTtcbiAgICAgICAgbi5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGUobi5yZXN1bHQpO1xuICAgICAgICB9LCBuLm9uZXJyb3IgPSByO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuY2xlYXJTdG9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAoZSwgcikge1xuICAgICAgICB2YXIgbiA9IHQuZ2V0U3RvcmUoXCJyZWFkd3JpdGVcIikuY2xlYXIoKTtcbiAgICAgICAgbi5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIGUoKTtcbiAgICAgICAgfSwgbi5vbmVycm9yID0gcjtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKG4sIG8pIHtcbiAgICAgICAgdmFyIGkgPSByLmdldFN0b3JlKFwicmVhZHdyaXRlXCIpLmFkZCh0LCBlKTtcbiAgICAgICAgaS5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbihpLnJlc3VsdCk7XG4gICAgICAgIH0sIGkub25lcnJvciA9IG87XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdmFyIHIgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChuLCBvKSB7XG4gICAgICAgIHZhciBpID0gci5nZXRTdG9yZShcInJlYWR3cml0ZVwiKS5wdXQodCwgZSk7XG4gICAgICAgIGkub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG4oaS5yZXN1bHQpO1xuICAgICAgICB9LCBpLm9uZXJyb3IgPSBvO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0U3RvcmVBbGxEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChlLCByKSB7XG4gICAgICAgIHZhciBuID0gdC5nZXRTdG9yZShcInJlYWRvbmx5XCIpLm9wZW5DdXJzb3IoKSxcbiAgICAgICAgICAgIG8gPSBbXTtcbiAgICAgICAgbi5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHQ7XG5cbiAgICAgICAgICBpZiAobnVsbCA9PT0gKHQgPSBuLnJlc3VsdCkgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdC52YWx1ZSkge1xuICAgICAgICAgICAgdmFyIHIgPSBuLnJlc3VsdC52YWx1ZTtcbiAgICAgICAgICAgIG8ucHVzaChyKSwgbi5yZXN1bHQuY29udGludWUoKTtcbiAgICAgICAgICB9IGVsc2UgZShvKTtcbiAgICAgICAgfSwgbi5vbmVycm9yID0gcjtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLmdldERhdGFSYW5nZUJ5SW5kZXggPSBmdW5jdGlvbiAodCwgZSwgciwgbiwgbykge1xuICAgICAgdmFyIGkgPSB0aGlzO1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChhLCBzKSB7XG4gICAgICAgIHZhciBjID0gaS5nZXRTdG9yZSgpLmluZGV4KHQpLFxuICAgICAgICAgICAgdSA9IElEQktleVJhbmdlLmJvdW5kKGUsIHIsIG4sIG8pLFxuICAgICAgICAgICAgbCA9IFtdLFxuICAgICAgICAgICAgaCA9IGMub3BlbkN1cnNvcih1KTtcbiAgICAgICAgaC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIHQ7XG4gICAgICAgICAgKG51bGwgPT09ICh0ID0gbnVsbCA9PSBoID8gdm9pZCAwIDogaC5yZXN1bHQpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQudmFsdWUpID8gKGwucHVzaChudWxsID09IGggPyB2b2lkIDAgOiBoLnJlc3VsdC52YWx1ZSksIG51bGwgPT0gaCB8fCBoLnJlc3VsdC5jb250aW51ZSgpKSA6IGEobCk7XG4gICAgICAgIH0sIGgub25lcnJvciA9IHM7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVEYXRhQnlJbmRleCA9IGZ1bmN0aW9uICh0LCBlLCByLCBuLCBvKSB7XG4gICAgICB2YXIgaSA9IHRoaXM7XG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIHMpIHtcbiAgICAgICAgdmFyIGMgPSBpLmdldFN0b3JlKFwicmVhZHdyaXRlXCIpLmluZGV4KHQpLFxuICAgICAgICAgICAgdSA9IElEQktleVJhbmdlLmJvdW5kKGUsIHIsIG4sIG8pLFxuICAgICAgICAgICAgbCA9IGMub3BlbkN1cnNvcih1KSxcbiAgICAgICAgICAgIGggPSAwO1xuICAgICAgICBsLm9uc3VjY2VzcyA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgdmFyIGUgPSB0LnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgZSA/IChoICs9IDEsIGUuZGVsZXRlKCksIGUuY29udGludWUoKSkgOiBhKGgpO1xuICAgICAgICB9LCBsLm9uZXJyb3IgPSBzO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuY3JlYXRlU3RvcmUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGUgPSB0Lm5hbWUsXG4gICAgICAgICAgciA9IHQuaW5kZXhlcyxcbiAgICAgICAgICBuID0gdm9pZCAwID09PSByID8gW10gOiByLFxuICAgICAgICAgIG8gPSB0Lm9wdGlvbnM7XG5cbiAgICAgIGlmICh0aGlzLmRiKSB7XG4gICAgICAgIHRoaXMuZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhlKSAmJiB0aGlzLmRiLmRlbGV0ZU9iamVjdFN0b3JlKGUpO1xuICAgICAgICB2YXIgaSA9IHRoaXMuZGIuY3JlYXRlT2JqZWN0U3RvcmUoZSwgbyk7XG4gICAgICAgIG4uZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgIGkuY3JlYXRlSW5kZXgodC5pbmRleE5hbWUsIHQua2V5UGF0aCwgdC5vcHRpb25zKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0U3RvcmUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIGU7XG4gICAgICByZXR1cm4gdm9pZCAwID09PSB0ICYmICh0ID0gXCJyZWFkb25seVwiKSwgbnVsbCA9PT0gKGUgPSB0aGlzLmRiKSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLnRyYW5zYWN0aW9uKHRoaXMuc3RvcmVOYW1lLCB0KS5vYmplY3RTdG9yZSh0aGlzLnN0b3JlTmFtZSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgTyA9IFwiZXZlbnRfdGFibGVfdjNcIixcbiAgICAgIGsgPSBcImV2ZW50SWRcIixcbiAgICAgIHggPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0KSB7XG4gICAgICB0aGlzLmlzUmVhZHkgPSAhMSwgdGhpcy50YXNrUXVldWUgPSBQcm9taXNlLnJlc29sdmUoKSwgdGhpcy5kYiA9IG5ldyBJKHtcbiAgICAgICAgbmFtZTogXCJCZWFjb25fXCIgKyB0ICsgXCJfVjNcIixcbiAgICAgICAgdmVyc2lvbjogMSxcbiAgICAgICAgc3RvcmVzOiBbe1xuICAgICAgICAgIG5hbWU6IE8sXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAga2V5UGF0aDoga1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5kZXhlczogW3tcbiAgICAgICAgICAgIGluZGV4TmFtZTogayxcbiAgICAgICAgICAgIGtleVBhdGg6IGssXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgIHVuaXF1ZTogITBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgICAgfSksIHRoaXMub3BlbigpO1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLnJlYWR5RXhlYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0LmRiLmdldFN0b3JlQ291bnQoKTtcbiAgICAgIH0pO1xuICAgIH0sIHQucHJvdG90eXBlLnNldEl0ZW0gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdmFyIHIgPSB0aGlzO1xuICAgICAgcmV0dXJuIHRoaXMucmVhZHlFeGVjKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHIuZGIuYWRkKHtcbiAgICAgICAgICBldmVudElkOiB0LFxuICAgICAgICAgIHZhbHVlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0SXRlbSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuKHRoaXMsIGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgcmV0dXJuIFsyLCB0aGlzLnJlYWR5RXhlYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZS5kYi5nZXREYXRhUmFuZ2VCeUluZGV4KGssIHQsIHQpO1xuICAgICAgICAgIH0pXTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLnJlYWR5RXhlYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBlLmRiLnJlbW92ZURhdGFCeUluZGV4KGssIHQsIHQpO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUudXBkYXRlSXRlbSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2YXIgciA9IHRoaXM7XG4gICAgICByZXR1cm4gdGhpcy5yZWFkeUV4ZWMoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gci5kYi5wdXQoe1xuICAgICAgICAgIGV2ZW50SWQ6IHQsXG4gICAgICAgICAgdmFsdWU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5pdGVyYXRlID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gdGhpcztcbiAgICAgIHJldHVybiB0aGlzLnJlYWR5RXhlYyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBlLmRiLmdldFN0b3JlQWxsRGF0YSgpLnRoZW4oZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBlLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHQoZS52YWx1ZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiByKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBzd2l0Y2ggKGUubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFza1F1ZXVlID0gdGhpcy50YXNrUXVldWUudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuZGIub3BlbkRCKCk7XG4gICAgICAgICAgICAgIH0pLCBbNCwgdGhpcy50YXNrUXVldWVdO1xuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIHJldHVybiBlLnNlbnQoKSwgdGhpcy5pc1JlYWR5ID0gITAsIHRoaXMuZGIudXNlU3RvcmUoTyksIFsyXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUucmVhZHlFeGVjID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiB0aGlzLmlzUmVhZHkgPyB0KCkgOiAodGhpcy50YXNrUXVldWUgPSB0aGlzLnRhc2tRdWV1ZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHQoKTtcbiAgICAgIH0pLCB0aGlzLnRhc2tRdWV1ZSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgQyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQpIHtcbiAgICAgIHRoaXMua2V5T2JqZWN0ID0ge30sIHRoaXMuc3RvcmFnZSA9IHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLmdldENvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZS5nZXRTdG9yZUNvdW50KCk7XG4gICAgfSwgdC5wcm90b3R5cGUucmVtb3ZlSXRlbSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbSh0KSwgZGVsZXRlIHRoaXMua2V5T2JqZWN0W3RdO1xuICAgIH0sIHQucHJvdG90eXBlLnNldEl0ZW0gPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgdmFyIHIgPSBKU09OLnN0cmluZ2lmeShlKTtcbiAgICAgIHRoaXMuc3RvcmFnZS5zZXRJdGVtKHQsIHIpLCB0aGlzLmtleU9iamVjdFt0XSA9IGU7XG4gICAgfSwgdC5wcm90b3R5cGUuaXRlcmF0ZSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICBmb3IgKHZhciBlID0gT2JqZWN0LmtleXModGhpcy5rZXlPYmplY3QpLCByID0gMDsgciA8IGUubGVuZ3RoOyByKyspIHtcbiAgICAgICAgdmFyIG4gPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShlW3JdKTtcbiAgICAgICAgdChKU09OLnBhcnNlKG4pKTtcbiAgICAgIH1cbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBfID0gZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIHQodCwgZSkge1xuICAgICAgdmFyIHIgPSB0aGlzO1xuICAgICAgdGhpcy5kYkV2ZW50Q291bnQgPSAwLCBiKCkgPiAwIHx8ICF3aW5kb3cuaW5kZXhlZERCIHx8IC9YNUxpdGUvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgPyAodGhpcy5zdG9yZSA9IG5ldyBDKGUpLCB0aGlzLmRiRXZlbnRDb3VudCA9IHRoaXMuc3RvcmUuZ2V0Q291bnQoKSkgOiAodGhpcy5zdG9yZSA9IG5ldyB4KHQpLCB0aGlzLmdldENvdW50KCkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICByLmRiRXZlbnRDb3VudCA9IHQ7XG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHQucHJvdG90eXBlLmdldENvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICBzd2l0Y2ggKHQubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgcmV0dXJuIHQudHJ5cy5wdXNoKFswLCAyLCwgM10pLCBbNCwgdGhpcy5zdG9yZS5nZXRDb3VudCgpXTtcblxuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICByZXR1cm4gWzIsIHQuc2VudCgpXTtcblxuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICByZXR1cm4gdC5zZW50KCksIFsyLCBQcm9taXNlLnJlamVjdCgpXTtcblxuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5pbnNlcnRFdmVudCA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgciwgbztcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICBzd2l0Y2ggKG4ubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgaWYgKHRoaXMuZGJFdmVudENvdW50ID49IDFlNCkgcmV0dXJuIFsyLCBQcm9taXNlLnJlamVjdCgpXTtcbiAgICAgICAgICAgICAgciA9IHAodC5tYXBWYWx1ZSksIG4ubGFiZWwgPSAxO1xuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIHJldHVybiBuLnRyeXMucHVzaChbMSwgMywsIDRdKSwgdGhpcy5kYkV2ZW50Q291bnQrKywgWzQsIHRoaXMuc3RvcmUuc2V0SXRlbShyLCB0KV07XG5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgcmV0dXJuIFsyLCBuLnNlbnQoKV07XG5cbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgcmV0dXJuIG8gPSBuLnNlbnQoKSwgZSAmJiBlKG8sIHQpLCB0aGlzLmRiRXZlbnRDb3VudC0tLCBbMiwgUHJvbWlzZS5yZWplY3QoKV07XG5cbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgcmV0dXJuIFsyXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUuZ2V0RXZlbnRzID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQ7XG4gICAgICAgIHJldHVybiBuKHRoaXMsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgc3dpdGNoIChlLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgIHQgPSBbXSwgZS5sYWJlbCA9IDE7XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIGUudHJ5cy5wdXNoKFsxLCAzLCwgNF0pLCBbNCwgdGhpcy5zdG9yZS5pdGVyYXRlKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdC5wdXNoKGUpO1xuICAgICAgICAgICAgICB9KV07XG5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgcmV0dXJuIGUuc2VudCgpLCBbMiwgUHJvbWlzZS5hbGwodCldO1xuXG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgIHJldHVybiBlLnNlbnQoKSwgWzIsIFByb21pc2UuYWxsKHQpXTtcblxuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVFdmVudCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZTtcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICBzd2l0Y2ggKHIubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgZSA9IHAodC5tYXBWYWx1ZSksIHIubGFiZWwgPSAxO1xuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgIHJldHVybiByLnRyeXMucHVzaChbMSwgMywsIDRdKSwgdGhpcy5kYkV2ZW50Q291bnQtLSwgWzQsIHRoaXMuc3RvcmUucmVtb3ZlSXRlbShlKV07XG5cbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgcmV0dXJuIFsyLCByLnNlbnQoKV07XG5cbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgcmV0dXJuIHIuc2VudCgpLCB0aGlzLmRiRXZlbnRDb3VudCsrLCBbMiwgUHJvbWlzZS5yZWplY3QoKV07XG5cbiAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgcmV0dXJuIFsyXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgX0EgPSBmdW5jdGlvbiBBKCkge1xuICAgIHJldHVybiAoX0EgPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uICh0KSB7XG4gICAgICBmb3IgKHZhciBlLCByID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IHIgPCBuOyByKyspIHtcbiAgICAgICAgZm9yICh2YXIgbyBpbiBlID0gYXJndW1lbnRzW3JdKSB7XG4gICAgICAgICAgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG8pICYmICh0W29dID0gZVtvXSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHQ7XG4gICAgfSkuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfTtcblxuICBmdW5jdGlvbiBQKHQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh0LnJlcGxhY2UoL1xcKy9nLCBcIiBcIikpO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGoodCwgZSkge1xuICAgIHZhciByID0gW251bGwsIHZvaWQgMCwgXCJcIiwgTmFOXS5pbmNsdWRlcyh0KTtcbiAgICBpZiAoZS5pc1NraXBFbXB0eSAmJiByKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgbiA9ICFlLmlzU2tpcEVtcHR5ICYmIHIgPyBcIlwiIDogdDtcblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZS5lbmNvZGUgPyBlbmNvZGVVUklDb21wb25lbnQobikgOiBuO1xuICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEQodCkge1xuICAgIHZhciBlID0gdC5zcGxpdChcIiNcIiksXG4gICAgICAgIHIgPSBlWzBdLFxuICAgICAgICBuID0gZVsxXSxcbiAgICAgICAgbyA9IHZvaWQgMCA9PT0gbiA/IFwiXCIgOiBuLFxuICAgICAgICBpID0gci5zcGxpdChcIj9cIiksXG4gICAgICAgIGEgPSBpWzBdLFxuICAgICAgICBzID0gaVsxXSxcbiAgICAgICAgYyA9IHZvaWQgMCA9PT0gcyA/IFwiXCIgOiBzLFxuICAgICAgICB1ID0gUChvKSxcbiAgICAgICAgbCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgcmV0dXJuIGMuc3BsaXQoXCImXCIpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gdC5zcGxpdChcIj1cIiksXG4gICAgICAgICAgciA9IGVbMF0sXG4gICAgICAgICAgbiA9IGVbMV0sXG4gICAgICAgICAgbyA9IHZvaWQgMCA9PT0gbiA/IFwiXCIgOiBuLFxuICAgICAgICAgIGkgPSBQKHIpLFxuICAgICAgICAgIGEgPSBQKG8pO1xuICAgICAgbnVsbCA9PT0gaSB8fCBudWxsID09PSBhIHx8IFwiXCIgPT09IGkgJiYgXCJcIiA9PT0gYSB8fCBsW2ldIHx8IChsW2ldID0gYSk7XG4gICAgfSksIHtcbiAgICAgIHVybDogYSxcbiAgICAgIHF1ZXJ5OiBsLFxuICAgICAgaGFzaDogdVxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBUKHQsIGUpIHtcbiAgICB2b2lkIDAgPT09IGUgJiYgKGUgPSB7XG4gICAgICBlbmNvZGU6ICEwLFxuICAgICAgaXNTa2lwRW1wdHk6ICExXG4gICAgfSk7XG5cbiAgICB2YXIgciA9IHQudXJsLFxuICAgICAgICBuID0gdC5xdWVyeSxcbiAgICAgICAgbyA9IHZvaWQgMCA9PT0gbiA/IHt9IDogbixcbiAgICAgICAgaSA9IHQuaGFzaCxcbiAgICAgICAgYSA9IHIuc3BsaXQoXCIjXCIpLFxuICAgICAgICBzID0gYVswXSxcbiAgICAgICAgYyA9IGFbMV0sXG4gICAgICAgIHUgPSB2b2lkIDAgPT09IGMgPyBcIlwiIDogYyxcbiAgICAgICAgbCA9IHMuc3BsaXQoXCI/XCIpWzBdLFxuICAgICAgICBoID0gW10sXG4gICAgICAgIGYgPSBqKGkgfHwgdSwgZSksXG4gICAgICAgIHAgPSBfQShfQSh7fSwgRChyKS5xdWVyeSksIG8pO1xuXG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHApLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciByID0gaih0LCBlKSxcbiAgICAgICAgICBuID0gaihwW3RdLCBlKTtcbiAgICAgIG51bGwgIT09IHIgJiYgbnVsbCAhPT0gbiAmJiBoLnB1c2gociArIFwiPVwiICsgbik7XG4gICAgfSksIGwgKyAoaC5sZW5ndGggPyBcIj9cIiArIGguam9pbihcIiZcIikgOiBcIlwiKSArIChmID8gXCIjXCIgKyBmIDogXCJcIik7XG4gIH1cblxuICBmdW5jdGlvbiBOKHQsIGUpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHIsIG4pIHtcbiAgICAgIGlmIChlICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJzY3JpcHRbZGF0YS10YWc9XCIgKyBlICsgXCJdXCIpLmxlbmd0aCkgcmV0dXJuIHIoKTtcblxuICAgICAgdmFyIG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpLFxuICAgICAgICAgIGkgPSBfQSh7XG4gICAgICAgIHR5cGU6IFwidGV4dC9qYXZhc2NyaXB0XCIsXG4gICAgICAgIGNoYXJzZXQ6IFwidXRmLThcIlxuICAgICAgfSwgdCk7XG5cbiAgICAgIE9iamVjdC5rZXlzKGkpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICAgICAgaWYgKHQpIHJldHVybiB2b2lkIDAgPT09IHIgPyB0LmdldEF0dHJpYnV0ZShlKSA6IHQuc2V0QXR0cmlidXRlKGUsIHIpO1xuICAgICAgICB9KG8sIHQsIGlbdF0pO1xuICAgICAgfSksIGUgJiYgKG8uZGF0YXNldC50YWcgPSBlKSwgby5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiByKCk7XG4gICAgICB9LCBvLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSBvLnJlYWR5U3RhdGU7XG4gICAgICAgIFtcImNvbXBsZXRlXCIsIFwibG9hZGVkXCJdLmluY2x1ZGVzKHQpICYmIChvLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG51bGwsIHIoKSk7XG4gICAgICB9LCBvLm9uZXJyb3IgPSBuLCBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG8pO1xuICAgIH0pO1xuICB9XG5cbiAgIWZ1bmN0aW9uICh0KSB7XG4gICAgdFt0LmVxdWFsID0gMF0gPSBcImVxdWFsXCIsIHRbdC5sb3cgPSAtMV0gPSBcImxvd1wiLCB0W3QuaGlnaCA9IDFdID0gXCJoaWdoXCI7XG4gIH0oRSB8fCAoRSA9IHt9KSk7XG5cbiAgdmFyIF9VID0gZnVuY3Rpb24gVSgpIHtcbiAgICByZXR1cm4gKF9VID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodCkge1xuICAgICAgZm9yICh2YXIgZSwgciA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyByIDwgbjsgcisrKSB7XG4gICAgICAgIGZvciAodmFyIG8gaW4gZSA9IGFyZ3VtZW50c1tyXSkge1xuICAgICAgICAgIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCBvKSAmJiAodFtvXSA9IGVbb10pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH0pLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG5cbiAgZnVuY3Rpb24gcSh0LCBlLCByLCBuKSB7XG4gICAgcmV0dXJuIG5ldyAociB8fCAociA9IFByb21pc2UpKShmdW5jdGlvbiAobywgaSkge1xuICAgICAgZnVuY3Rpb24gYSh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYyhuLm5leHQodCkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgaSh0KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBzKHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjKG4udGhyb3codCkpO1xuICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgaSh0KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjKHQpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHQuZG9uZSA/IG8odC52YWx1ZSkgOiAoZSA9IHQudmFsdWUsIGUgaW5zdGFuY2VvZiByID8gZSA6IG5ldyByKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgdChlKTtcbiAgICAgICAgfSkpLnRoZW4oYSwgcyk7XG4gICAgICB9XG5cbiAgICAgIGMoKG4gPSBuLmFwcGx5KHQsIGUgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gUih0LCBlKSB7XG4gICAgdmFyIHIsXG4gICAgICAgIG4sXG4gICAgICAgIG8sXG4gICAgICAgIGksXG4gICAgICAgIGEgPSB7XG4gICAgICBsYWJlbDogMCxcbiAgICAgIHNlbnQ6IGZ1bmN0aW9uIHNlbnQoKSB7XG4gICAgICAgIGlmICgxICYgb1swXSkgdGhyb3cgb1sxXTtcbiAgICAgICAgcmV0dXJuIG9bMV07XG4gICAgICB9LFxuICAgICAgdHJ5czogW10sXG4gICAgICBvcHM6IFtdXG4gICAgfTtcbiAgICByZXR1cm4gaSA9IHtcbiAgICAgIG5leHQ6IHMoMCksXG4gICAgICB0aHJvdzogcygxKSxcbiAgICAgIHJldHVybjogcygyKVxuICAgIH0sIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgU3ltYm9sICYmIChpW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9KSwgaTtcblxuICAgIGZ1bmN0aW9uIHMoaSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoaSkge1xuICAgICAgICAgIGlmIChyKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtcblxuICAgICAgICAgIGZvciAoOyBhOykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgaWYgKHIgPSAxLCBuICYmIChvID0gMiAmIGlbMF0gPyBuLnJldHVybiA6IGlbMF0gPyBuLnRocm93IHx8ICgobyA9IG4ucmV0dXJuKSAmJiBvLmNhbGwobiksIDApIDogbi5uZXh0KSAmJiAhKG8gPSBvLmNhbGwobiwgaVsxXSkpLmRvbmUpIHJldHVybiBvO1xuXG4gICAgICAgICAgICAgIHN3aXRjaCAobiA9IDAsIG8gJiYgKGkgPSBbMiAmIGlbMF0sIG8udmFsdWVdKSwgaVswXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICBvID0gaTtcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGEubGFiZWwrKywge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaVsxXSxcbiAgICAgICAgICAgICAgICAgICAgZG9uZTogITFcbiAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICBhLmxhYmVsKyssIG4gPSBpWzFdLCBpID0gWzBdO1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICAgICAgICBpID0gYS5vcHMucG9wKCksIGEudHJ5cy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgIGlmICghKChvID0gKG8gPSBhLnRyeXMpLmxlbmd0aCA+IDAgJiYgb1tvLmxlbmd0aCAtIDFdKSB8fCA2ICE9PSBpWzBdICYmIDIgIT09IGlbMF0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGEgPSAwO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKDMgPT09IGlbMF0gJiYgKCFvIHx8IGlbMV0gPiBvWzBdICYmIGlbMV0gPCBvWzNdKSkge1xuICAgICAgICAgICAgICAgICAgICBhLmxhYmVsID0gaVsxXTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGlmICg2ID09PSBpWzBdICYmIGEubGFiZWwgPCBvWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIGEubGFiZWwgPSBvWzFdLCBvID0gaTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIGlmIChvICYmIGEubGFiZWwgPCBvWzJdKSB7XG4gICAgICAgICAgICAgICAgICAgIGEubGFiZWwgPSBvWzJdLCBhLm9wcy5wdXNoKGkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgb1syXSAmJiBhLm9wcy5wb3AoKSwgYS50cnlzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpID0gZS5jYWxsKHQsIGEpO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICBpID0gWzYsIHRdLCBuID0gMDtcbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgIHIgPSBvID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoNSAmIGlbMF0pIHRocm93IGlbMV07XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbHVlOiBpWzBdID8gaVsxXSA6IHZvaWQgMCxcbiAgICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgICAgfTtcbiAgICAgICAgfShbaSwgc10pO1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgTCA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KCkge1xuICAgICAgdGhpcy5pbnRlcmNlcHRvcnMgPSBbXTtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUudXNlID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmludGVyY2VwdG9ycy5wdXNoKHtcbiAgICAgICAgcmVzb2x2ZWQ6IHQsXG4gICAgICAgIHJlamVjdGVkOiBlXG4gICAgICB9KSwgdGhpcy5pbnRlcmNlcHRvcnMubGVuZ3RoIC0gMTtcbiAgICB9LCB0LnByb3RvdHlwZS50cmF2ZXJzZSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB2b2lkIDAgPT09IGUgJiYgKGUgPSAhMSk7XG4gICAgICB2YXIgciA9IFByb21pc2UucmVzb2x2ZSh0KTtcbiAgICAgIHJldHVybiAoZSA/IEFycmF5LnByb3RvdHlwZS5yZWR1Y2VSaWdodCA6IEFycmF5LnByb3RvdHlwZS5yZWR1Y2UpLmNhbGwodGhpcy5pbnRlcmNlcHRvcnMsIGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgdmFyIG4gPSBlLnJlc29sdmVkLFxuICAgICAgICAgICAgICBvID0gZS5yZWplY3RlZDtcbiAgICAgICAgICByID0gci50aGVuKG4sIG8pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9LCBcIlwiKSwgcjtcbiAgICB9LCB0LnByb3RvdHlwZS5lamVjdCA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0aGlzLmludGVyY2VwdG9yc1t0XSAmJiAodGhpcy5pbnRlcmNlcHRvcnNbdF0gPSBudWxsKTtcbiAgICB9LCB0O1xuICB9KCksXG4gICAgICBCID0ge1xuICAgIGRlZmF1bHRzOiB7XG4gICAgICB0aW1lb3V0OiAwLFxuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgbW9kZTogXCJjb3JzXCIsXG4gICAgICByZWRpcmVjdDogXCJmb2xsb3dcIixcbiAgICAgIGNyZWRlbnRpYWxzOiBcInNhbWUtb3JpZ2luXCJcbiAgICB9LFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIGNvbW1vbjoge1xuICAgICAgICBBY2NlcHQ6IFwiYXBwbGljYXRpb24vanNvbiwgdGV4dC9wbGFpbiwgKi8qXCJcbiAgICAgIH0sXG4gICAgICBQT1NUOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcbiAgICAgIH0sXG4gICAgICBQVVQ6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWRcIlxuICAgICAgfSxcbiAgICAgIFBBVENIOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcbiAgICAgIH1cbiAgICB9LFxuICAgIGJhc2VVUkw6IFwiXCIsXG4gICAgcG9seWZpbGxVcmw6IFwiaHR0cHM6Ly92bS5ndGltZy5jbi9jb21wcy9zY3JpcHQvZmV0Y2gubWluLmpzXCIsXG4gICAgaW50ZXJjZXB0b3JzOiB7XG4gICAgICByZXF1ZXN0OiBuZXcgTCgpLFxuICAgICAgcmVzcG9uc2U6IG5ldyBMKClcbiAgICB9XG4gIH0sXG4gICAgICBKID0gL14oW2Etel1bYS16XFxkK1xcLS5dKjopP1xcL1xcLy9pLFxuICAgICAgTSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7XG5cbiAgZnVuY3Rpb24gVih0KSB7XG4gICAgcmV0dXJuIHEodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBlO1xuICAgICAgcmV0dXJuIFIodGhpcywgZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgc3dpdGNoIChyLmxhYmVsKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgaWYgKHdpbmRvdy5mZXRjaCkgcmV0dXJuIFsyXTtcbiAgICAgICAgICAgIHIubGFiZWwgPSAxO1xuXG4gICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgcmV0dXJuIHIudHJ5cy5wdXNoKFsxLCAzLCwgNF0pLCBbNCwgTih7XG4gICAgICAgICAgICAgIHNyYzogdFxuICAgICAgICAgICAgfSldO1xuXG4gICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgcmV0dXJuIHIuc2VudCgpLCBbMywgNF07XG5cbiAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICB0aHJvdyBlID0gci5zZW50KCksIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIGlmIChcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBJbWFnZSkge1xuICAgICAgICAgICAgICAgIHZhciBlID0gbmV3IEltYWdlKDEsIDEpLFxuICAgICAgICAgICAgICAgICAgICByID0gX1Uoe1xuICAgICAgICAgICAgICAgICAgYXR0YWlkOiBcIjBmNDAwMDUzMTMwXCIsXG4gICAgICAgICAgICAgICAgICB0b2tlbjogXCI2NTUyMzc0NDQyXCIsXG4gICAgICAgICAgICAgICAgICBjb21wczogXCJAdGVuY2VudC9vdmItcmVxdWVzdFwiLFxuICAgICAgICAgICAgICAgICAgdmVyc2lvbjogXCIxLjEuMThcIixcbiAgICAgICAgICAgICAgICAgIHVhOiBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgICAgICAgICAgICAgdXJsOiBsb2NhdGlvbi5ocmVmLFxuICAgICAgICAgICAgICAgICAgX2RjOiBNYXRoLnJhbmRvbSgpXG4gICAgICAgICAgICAgICAgfSwgdCksXG4gICAgICAgICAgICAgICAgICAgIG4gPSBPYmplY3Qua2V5cyhyKS5tYXAoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0ICsgXCI9XCIgKyBlbmNvZGVVUklDb21wb25lbnQoclt0XSk7XG4gICAgICAgICAgICAgICAgfSkuam9pbihcIiZcIik7XG5cbiAgICAgICAgICAgICAgICBlLnNyYyA9IFwiaHR0cHM6Ly9oLnRyYWNlLnFxLmNvbS9rdj9cIiArIG47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0oe1xuICAgICAgICAgICAgICBmdW5jOiBcImxvYWRQb2x5ZmlsbFwiLFxuICAgICAgICAgICAgICByZXN1bHQ6IDAsXG4gICAgICAgICAgICAgIHBhcmFtczogdCxcbiAgICAgICAgICAgICAgZXJyb3JfbXNnOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgIH0pLCBuZXcgRXJyb3IoXCLliqDovb0gcG9seWZpbGwgXCIgKyB0ICsgXCIg5aSx6LSlOiBcIiArIGUubWVzc2FnZSk7XG5cbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICByZXR1cm4gWzJdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEcodCkge1xuICAgIHJldHVybiBbXCJBY2NlcHRcIiwgXCJDb250ZW50LVR5cGVcIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgcmV0dXJuIHIgPSBlLCB2b2lkICgobiA9IHQuaGVhZGVycykgJiYgT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICB0ICE9PSByICYmIHQudG9VcHBlckNhc2UoKSA9PT0gci50b1VwcGVyQ2FzZSgpICYmIChuW3JdID0gblt0XSwgZGVsZXRlIG5bdF0pO1xuICAgICAgfSkpO1xuICAgICAgdmFyIHIsIG47XG4gICAgfSksIGZ1bmN0aW9uICh0KSB7XG4gICAgICBpZiAoXCJbb2JqZWN0IE9iamVjdF1cIiAhPT0gTS5jYWxsKHQpKSByZXR1cm4gITE7XG4gICAgICB2YXIgZSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0KTtcbiAgICAgIHJldHVybiBudWxsID09PSBlIHx8IGUgPT09IE9iamVjdC5wcm90b3R5cGU7XG4gICAgfSh0LmJvZHkpICYmICh0LmJvZHkgPSBKU09OLnN0cmluZ2lmeSh0LmJvZHkpLCB0LmhlYWRlcnMgJiYgKHQuaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiXSA9IFwiYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04XCIpKSwgdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIEYodCkge1xuICAgIHJldHVybiBxKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgZSwgciwgbiwgbywgaSwgYSwgcywgYywgdSwgbCwgaCwgZiwgcCwgZCwgdiwgeSwgZztcbiAgICAgIHJldHVybiBSKHRoaXMsIGZ1bmN0aW9uIChtKSB7XG4gICAgICAgIHN3aXRjaCAobS5sYWJlbCkge1xuICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgIHJldHVybiBlID0gQi5iYXNlVVJMLCByID0gQi5kZWZhdWx0cywgbiA9IEIuaW50ZXJjZXB0b3JzLCBbNCwgVihCLnBvbHlmaWxsVXJsKV07XG5cbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICByZXR1cm4gbS5zZW50KCksIChvID0gX1UoX1Uoe30sIHIpLCB0KSkuaGVhZGVycyB8fCAoby5oZWFkZXJzID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgdm9pZCAwID09PSB0ICYmICh0ID0gXCJHRVRcIik7XG4gICAgICAgICAgICAgIHZhciBlID0gQi5oZWFkZXJzW3RdIHx8IHt9O1xuICAgICAgICAgICAgICByZXR1cm4gX1UoX1Uoe30sIEIuaGVhZGVycy5jb21tb24pLCBlKTtcbiAgICAgICAgICAgIH0oby5tZXRob2QpKSwgRyhvKSwgWzQsIG4ucmVxdWVzdC50cmF2ZXJzZShvLCAhMCldO1xuXG4gICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgaWYgKChpID0gbS5zZW50KCkpIGluc3RhbmNlb2YgRXJyb3IpIHRocm93IGk7XG4gICAgICAgICAgICByZXR1cm4gaS51cmwgPSBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICAgICAgICByZXR1cm4gIXQgfHwgSi50ZXN0KGUpID8gZSA6IHQucmVwbGFjZSgvXFwvKyQvLCBcIlwiKSArIFwiL1wiICsgZS5yZXBsYWNlKC9eXFwvKy8sIFwiXCIpO1xuICAgICAgICAgICAgfShlLCBpLnVybCksIGEgPSBpLnVybCwgcyA9IGkudGltZW91dCwgYyA9IGkucGFyYW1zLCB1ID0gaS5tZXRob2QsIGwgPSBbXCJHRVRcIiwgXCJERUxFVEVcIiwgXCJPUFRJT05TXCIsIFwiSEVBRFwiXS5pbmNsdWRlcyh2b2lkIDAgPT09IHUgPyBcIkdFVFwiIDogdSkgJiYgISFjLCBoID0gbCA/IFQoe1xuICAgICAgICAgICAgICB1cmw6IGEsXG4gICAgICAgICAgICAgIHF1ZXJ5OiBjXG4gICAgICAgICAgICB9KSA6IGEsIGYgPSBbXSwgcyAmJiAhaS5zaWduYWwgJiYgKHYgPSBuZXcgUHJvbWlzZShmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICBwID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdChuZXcgRXJyb3IoXCJ0aW1lb3V0XCIpKTtcbiAgICAgICAgICAgICAgfSwgcyk7XG4gICAgICAgICAgICB9KSwgZi5wdXNoKHYpLCBkID0gbmV3IEFib3J0Q29udHJvbGxlcigpLCBpLnNpZ25hbCA9IGQuc2lnbmFsKSwgZi5wdXNoKGZldGNoKGgsIGkpLmNhdGNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgICAgfSkpLCBbNCwgUHJvbWlzZS5yYWNlKGYpXTtcblxuICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHJldHVybiB5ID0gbS5zZW50KCksIHAgJiYgY2xlYXJUaW1lb3V0KHApLCBbNCwgbi5yZXNwb25zZS50cmF2ZXJzZSh5KV07XG5cbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBpZiAoKGcgPSBtLnNlbnQoKSkgaW5zdGFuY2VvZiBFcnJvcikgdGhyb3cgbnVsbCA9PSBkIHx8IGQuYWJvcnQoKSwgZztcbiAgICAgICAgICAgIHJldHVybiBbMiwgZ107XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgdmFyIFEgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gdCh0KSB7XG4gICAgICBCLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAocikge1xuICAgICAgICB2YXIgbiA9IHIudXJsLFxuICAgICAgICAgICAgbyA9IHIubWV0aG9kLFxuICAgICAgICAgICAgaSA9IHIuYm9keSxcbiAgICAgICAgICAgIGEgPSBpO1xuXG4gICAgICAgIGlmICh0Lm9uUmVwb3J0QmVmb3JlU2VuZCkge1xuICAgICAgICAgIHZhciBzID0gdC5vblJlcG9ydEJlZm9yZVNlbmQoe1xuICAgICAgICAgICAgdXJsOiBuLFxuICAgICAgICAgICAgbWV0aG9kOiBvLFxuICAgICAgICAgICAgZGF0YTogaSA/IEpTT04ucGFyc2UoaSkgOiBudWxsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYSA9IChudWxsID09IHMgPyB2b2lkIDAgOiBzLmRhdGEpID8gSlNPTi5zdHJpbmdpZnkocy5kYXRhKSA6IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXCJHRVRcIiAhPT0gbyAmJiAhYSkgdGhyb3cgbmV3IEVycm9yKFwiTm8gZGF0YSBmb3Igc2RrLCBjYW5jZWwuXCIpO1xuICAgICAgICByZXR1cm4gX2UoX2Uoe30sIHIpLCB7XG4gICAgICAgICAgYm9keTogYVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAodCwgbykge1xuICAgICAgcmV0dXJuIHIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHIsIGk7XG4gICAgICAgIHJldHVybiBuKHRoaXMsIGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgc3dpdGNoIChuLmxhYmVsKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgIHJldHVybiBbNCwgRihfZSh7XG4gICAgICAgICAgICAgICAgdXJsOiB0XG4gICAgICAgICAgICAgIH0sIG8pKV07XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIFs0LCAociA9IG4uc2VudCgpKS5qc29uKCldO1xuXG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgIHJldHVybiBpID0gbi5zZW50KCksIFsyLCBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IGksXG4gICAgICAgICAgICAgICAgc3RhdHVzOiByLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByLnN0YXR1c1RleHQsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogci5oZWFkZXJzXG4gICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdC5wcm90b3R5cGUucG9zdCA9IGZ1bmN0aW9uICh0LCBvLCBpKSB7XG4gICAgICByZXR1cm4gcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgciwgYTtcbiAgICAgICAgcmV0dXJuIG4odGhpcywgZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgICBzd2l0Y2ggKG4ubGFiZWwpIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgcmV0dXJuIFs0LCBGKF9lKHtcbiAgICAgICAgICAgICAgICB1cmw6IHQsXG4gICAgICAgICAgICAgICAgYm9keTogbyxcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiXG4gICAgICAgICAgICAgIH0sIGkpKV07XG5cbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgcmV0dXJuIFs0LCAociA9IG4uc2VudCgpKS5qc29uKCldO1xuXG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgIHJldHVybiBhID0gbi5zZW50KCksIFsyLCBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IGEsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiByLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiByLnN0YXR1c1RleHQsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogci5oZWFkZXJzXG4gICAgICAgICAgICAgIH0pXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSwgdDtcbiAgfSgpLFxuICAgICAgSyA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiB0KHQpIHtcbiAgICAgIHRoaXMuYXBwa2V5ID0gdDtcbiAgICB9XG5cbiAgICByZXR1cm4gdC5wcm90b3R5cGUuZ2V0SXRlbSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMuZ2V0U3RvcmVLZXkodCkpO1xuICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICB9LCB0LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLmdldFN0b3JlS2V5KHQpKTtcbiAgICAgIH0gY2F0Y2ggKHQpIHt9XG4gICAgfSwgdC5wcm90b3R5cGUuc2V0SXRlbSA9IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICB0cnkge1xuICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5nZXRTdG9yZUtleSh0KSwgZSk7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuICAgIH0sIHQucHJvdG90eXBlLnNldFNlc3Npb25JdGVtID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHdpbmRvdy5zZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHRoaXMuZ2V0U3RvcmVLZXkodCksIGUpO1xuICAgICAgfSBjYXRjaCAodCkge31cbiAgICB9LCB0LnByb3RvdHlwZS5nZXRTZXNzaW9uSXRlbSA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0odGhpcy5nZXRTdG9yZUtleSh0KSk7XG4gICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH0sIHQucHJvdG90eXBlLmdldFN0b3JlS2V5ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHJldHVybiBvICsgdGhpcy5hcHBrZXkgKyBcIl9cIiArIHQ7XG4gICAgfSwgdC5wcm90b3R5cGUuY3JlYXRlRGV2aWNlSWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgdCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShpKTtcbiAgICAgICAgcmV0dXJuIHQgfHwgKHQgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgIGZvciAodmFyIGUgPSBcIkFCQ0RFRkdISktNTlBRUlNUV1hZWmFiY2RlZmhpamttbnByc3R3eHl6MDEyMzQ1Njc4OVwiLCByID0gXCJcIiwgbiA9IDA7IG4gPCB0OyBuKyspIHtcbiAgICAgICAgICAgIHIgKz0gZS5jaGFyQXQoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZS5sZW5ndGgpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfSgzMiksIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShpLCB0KSksIHQ7XG4gICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH0sIHQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZm9yICh2YXIgdCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UubGVuZ3RoLCBlID0gMDsgZSA8IHQ7IGUrKykge1xuICAgICAgICAgIHZhciByID0gd2luZG93LmxvY2FsU3RvcmFnZS5rZXkoZSk7XG4gICAgICAgICAgKG51bGwgPT0gciA/IHZvaWQgMCA6IHIuc3Vic3RyKDAsIDkpKSA9PSBvICYmIHdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShyKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAodCkge31cbiAgICB9LCB0LnByb3RvdHlwZS5nZXRTdG9yZUNvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHQgPSAwO1xuXG4gICAgICB0cnkge1xuICAgICAgICB0ID0gd2luZG93LmxvY2FsU3RvcmFnZS5sZW5ndGg7XG4gICAgICB9IGNhdGNoICh0KSB7fVxuXG4gICAgICByZXR1cm4gdDtcbiAgICB9LCB0O1xuICB9KCk7XG5cbiAgXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgZ2xvYmFsVGhpcyA/IGdsb2JhbFRoaXMgOiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiB3aW5kb3cgPyB3aW5kb3cgOiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBnbG9iYWwgPyBnbG9iYWwgOiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBzZWxmICYmIHNlbGY7XG5cbiAgdmFyIFcgPSBmdW5jdGlvbiAodCkge1xuICAgIHZhciBlID0ge1xuICAgICAgZXhwb3J0czoge31cbiAgICB9O1xuICAgIHJldHVybiB0KGUsIGUuZXhwb3J0cyksIGUuZXhwb3J0cztcbiAgfShmdW5jdGlvbiAodCwgZSkge1xuICAgIHQuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGZ1bmN0aW9uIHQodCwgZSwgciwgbiwgbywgaSwgYSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBzID0gdFtpXShhKSxcbiAgICAgICAgICAgICAgYyA9IHMudmFsdWU7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICByZXR1cm4gdm9pZCByKHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgcy5kb25lID8gZShjKSA6IFByb21pc2UucmVzb2x2ZShjKS50aGVuKG4sIG8pO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBlKHQsIGUpIHtcbiAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCBlLmxlbmd0aDsgcisrKSB7XG4gICAgICAgICAgdmFyIG4gPSBlW3JdO1xuICAgICAgICAgIG4uZW51bWVyYWJsZSA9IG4uZW51bWVyYWJsZSB8fCAhMSwgbi5jb25maWd1cmFibGUgPSAhMCwgXCJ2YWx1ZVwiIGluIG4gJiYgKG4ud3JpdGFibGUgPSAhMCksIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCBuLmtleSwgbik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIHIsXG4gICAgICAgICAgbiA9IChmdW5jdGlvbiAodCkge1xuICAgICAgICB0ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICB2YXIgZSxcbiAgICAgICAgICAgICAgciA9IE9iamVjdC5wcm90b3R5cGUsXG4gICAgICAgICAgICAgIG4gPSByLmhhc093blByb3BlcnR5LFxuICAgICAgICAgICAgICBvID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxcbiAgICAgICAgICAgICAgaSA9IG8uaXRlcmF0b3IgfHwgXCJAQGl0ZXJhdG9yXCIsXG4gICAgICAgICAgICAgIGEgPSBvLmFzeW5jSXRlcmF0b3IgfHwgXCJAQGFzeW5jSXRlcmF0b3JcIixcbiAgICAgICAgICAgICAgcyA9IG8udG9TdHJpbmdUYWcgfHwgXCJAQHRvU3RyaW5nVGFnXCI7XG5cbiAgICAgICAgICBmdW5jdGlvbiBjKHQsIGUsIHIpIHtcbiAgICAgICAgICAgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgZSwge1xuICAgICAgICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgICAgICAgZW51bWVyYWJsZTogITAsXG4gICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogITAsXG4gICAgICAgICAgICAgIHdyaXRhYmxlOiAhMFxuICAgICAgICAgICAgfSksIHRbZV07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGMoe30sIFwiXCIpO1xuICAgICAgICAgIH0gY2F0Y2ggKHIpIHtcbiAgICAgICAgICAgIGMgPSBmdW5jdGlvbiBjKHQsIGUsIHIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRbZV0gPSByO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmdW5jdGlvbiB1KHQsIHIsIG4sIG8pIHtcbiAgICAgICAgICAgIHZhciBpLCBhLCBzLCBjO1xuICAgICAgICAgICAgcmV0dXJuIHIgPSByICYmIHIucHJvdG90eXBlIGluc3RhbmNlb2YgeSA/IHIgOiB5LCByID0gT2JqZWN0LmNyZWF0ZShyLnByb3RvdHlwZSksIG8gPSBuZXcgayhvIHx8IFtdKSwgci5faW52b2tlID0gKGkgPSB0LCBhID0gbiwgcyA9IG8sIGMgPSBoLCBmdW5jdGlvbiAodCwgcikge1xuICAgICAgICAgICAgICBpZiAoYyA9PT0gcCkgdGhyb3cgbmV3IEVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZ1wiKTtcblxuICAgICAgICAgICAgICBpZiAoYyA9PT0gZCkge1xuICAgICAgICAgICAgICAgIGlmIChcInRocm93XCIgPT09IHQpIHRocm93IHI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEMoKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGZvciAocy5tZXRob2QgPSB0LCBzLmFyZyA9IHI7Oykge1xuICAgICAgICAgICAgICAgIHZhciBuID0gcy5kZWxlZ2F0ZTtcblxuICAgICAgICAgICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbyA9IGZ1bmN0aW9uIHQociwgbikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbztcblxuICAgICAgICAgICAgICAgICAgICBpZiAoKG8gPSByLml0ZXJhdG9yW24ubWV0aG9kXSkgPT09IGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobi5kZWxlZ2F0ZSA9IG51bGwsIFwidGhyb3dcIiA9PT0gbi5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyLml0ZXJhdG9yLnJldHVybiAmJiAobi5tZXRob2QgPSBcInJldHVyblwiLCBuLmFyZyA9IGUsIHQociwgbiksIFwidGhyb3dcIiA9PT0gbi5tZXRob2QpKSByZXR1cm4gdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG4ubWV0aG9kID0gXCJ0aHJvd1wiLCBuLmFyZyA9IG5ldyBUeXBlRXJyb3IoXCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kXCIpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2O1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwidGhyb3dcIiA9PT0gKG8gPSBsKG8sIHIuaXRlcmF0b3IsIG4uYXJnKSkudHlwZSA/IChuLm1ldGhvZCA9IFwidGhyb3dcIiwgbi5hcmcgPSBvLmFyZywgbi5kZWxlZ2F0ZSA9IG51bGwsIHYpIDogKG8gPSBvLmFyZykgPyBvLmRvbmUgPyAobltyLnJlc3VsdE5hbWVdID0gby52YWx1ZSwgbi5uZXh0ID0gci5uZXh0TG9jLCBcInJldHVyblwiICE9PSBuLm1ldGhvZCAmJiAobi5tZXRob2QgPSBcIm5leHRcIiwgbi5hcmcgPSBlKSwgbi5kZWxlZ2F0ZSA9IG51bGwsIHYpIDogbyA6IChuLm1ldGhvZCA9IFwidGhyb3dcIiwgbi5hcmcgPSBuZXcgVHlwZUVycm9yKFwiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3RcIiksIG4uZGVsZWdhdGUgPSBudWxsLCB2KTtcbiAgICAgICAgICAgICAgICAgIH0obiwgcyk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvID09PSB2KSBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG87XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKFwibmV4dFwiID09PSBzLm1ldGhvZCkgcy5zZW50ID0gcy5fc2VudCA9IHMuYXJnO2Vsc2UgaWYgKFwidGhyb3dcIiA9PT0gcy5tZXRob2QpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChjID09PSBoKSB0aHJvdyBjID0gZCwgcy5hcmc7XG4gICAgICAgICAgICAgICAgICBzLmRpc3BhdGNoRXhjZXB0aW9uKHMuYXJnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgXCJyZXR1cm5cIiA9PT0gcy5tZXRob2QgJiYgcy5hYnJ1cHQoXCJyZXR1cm5cIiwgcy5hcmcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKGMgPSBwLCBcIm5vcm1hbFwiID09PSAobyA9IGwoaSwgYSwgcykpLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChjID0gcy5kb25lID8gZCA6IGYsIG8uYXJnICE9PSB2KSByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogby5hcmcsXG4gICAgICAgICAgICAgICAgICAgIGRvbmU6IHMuZG9uZVxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgXCJ0aHJvd1wiID09PSBvLnR5cGUgJiYgKGMgPSBkLCBzLm1ldGhvZCA9IFwidGhyb3dcIiwgcy5hcmcgPSBvLmFyZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLCByO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIGwodCwgZSwgcikge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIm5vcm1hbFwiLFxuICAgICAgICAgICAgICAgIGFyZzogdC5jYWxsKGUsIHIpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJ0aHJvd1wiLFxuICAgICAgICAgICAgICAgIGFyZzogdFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHQud3JhcCA9IHU7XG4gICAgICAgICAgdmFyIGggPSBcInN1c3BlbmRlZFN0YXJ0XCIsXG4gICAgICAgICAgICAgIGYgPSBcInN1c3BlbmRlZFlpZWxkXCIsXG4gICAgICAgICAgICAgIHAgPSBcImV4ZWN1dGluZ1wiLFxuICAgICAgICAgICAgICBkID0gXCJjb21wbGV0ZWRcIixcbiAgICAgICAgICAgICAgdiA9IHt9O1xuXG4gICAgICAgICAgZnVuY3Rpb24geSgpIHt9XG5cbiAgICAgICAgICBmdW5jdGlvbiBnKCkge31cblxuICAgICAgICAgIGZ1bmN0aW9uIG0oKSB7fVxuXG4gICAgICAgICAgdmFyIHcgPSB7fTtcbiAgICAgICAgICB3W2ldID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgfSwgKG8gPSAobyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZikgJiYgbyhvKHgoW10pKSkpICYmIG8gIT09IHIgJiYgbi5jYWxsKG8sIGkpICYmICh3ID0gbyk7XG4gICAgICAgICAgdmFyIGIgPSBtLnByb3RvdHlwZSA9IHkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSh3KTtcblxuICAgICAgICAgIGZ1bmN0aW9uIFModCkge1xuICAgICAgICAgICAgW1wibmV4dFwiLCBcInRocm93XCIsIFwicmV0dXJuXCJdLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgYyh0LCBlLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gRSh0LCBlKSB7XG4gICAgICAgICAgICB2YXIgcjtcblxuICAgICAgICAgICAgdGhpcy5faW52b2tlID0gZnVuY3Rpb24gKG8sIGkpIHtcbiAgICAgICAgICAgICAgZnVuY3Rpb24gYSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGUoZnVuY3Rpb24gKHIsIGEpIHtcbiAgICAgICAgICAgICAgICAgICFmdW5jdGlvbiByKG8sIGksIGEsIHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwidGhyb3dcIiAhPT0gKG8gPSBsKHRbb10sIHQsIGkpKS50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBvLmFyZztcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGkgPSBjLnZhbHVlKSAmJiBcIm9iamVjdFwiID09IF90eXBlb2YoaSkgJiYgbi5jYWxsKGksIFwiX19hd2FpdFwiKSA/IGUucmVzb2x2ZShpLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHIoXCJuZXh0XCIsIHQsIGEsIHMpO1xuICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByKFwidGhyb3dcIiwgdCwgYSwgcyk7XG4gICAgICAgICAgICAgICAgICAgICAgfSkgOiBlLnJlc29sdmUoaSkudGhlbihmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYy52YWx1ZSA9IHQsIGEoYyk7XG4gICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByKFwidGhyb3dcIiwgdCwgYSwgcyk7XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzKG8uYXJnKTtcbiAgICAgICAgICAgICAgICAgIH0obywgaSwgciwgYSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICByZXR1cm4gciA9IHIgPyByLnRoZW4oYSwgYSkgOiBhKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIEkodCkge1xuICAgICAgICAgICAgdmFyIGUgPSB7XG4gICAgICAgICAgICAgIHRyeUxvYzogdFswXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIDEgaW4gdCAmJiAoZS5jYXRjaExvYyA9IHRbMV0pLCAyIGluIHQgJiYgKGUuZmluYWxseUxvYyA9IHRbMl0sIGUuYWZ0ZXJMb2MgPSB0WzNdKSwgdGhpcy50cnlFbnRyaWVzLnB1c2goZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gTyh0KSB7XG4gICAgICAgICAgICB2YXIgZSA9IHQuY29tcGxldGlvbiB8fCB7fTtcbiAgICAgICAgICAgIGUudHlwZSA9IFwibm9ybWFsXCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmdW5jdGlvbiBrKHQpIHtcbiAgICAgICAgICAgIHRoaXMudHJ5RW50cmllcyA9IFt7XG4gICAgICAgICAgICAgIHRyeUxvYzogXCJyb290XCJcbiAgICAgICAgICAgIH1dLCB0LmZvckVhY2goSSwgdGhpcyksIHRoaXMucmVzZXQoITApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZ1bmN0aW9uIHgodCkge1xuICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgaWYgKHIgPSB0W2ldKSByZXR1cm4gci5jYWxsKHQpO1xuICAgICAgICAgICAgICBpZiAoXCJmdW5jdGlvblwiID09IHR5cGVvZiB0Lm5leHQpIHJldHVybiB0O1xuXG4gICAgICAgICAgICAgIGlmICghaXNOYU4odC5sZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHIsXG4gICAgICAgICAgICAgICAgICAgIG8gPSAtMTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHIgPSBmdW5jdGlvbiByKCkge1xuICAgICAgICAgICAgICAgICAgZm9yICg7ICsrbyA8IHQubGVuZ3RoOykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobi5jYWxsKHQsIG8pKSByZXR1cm4gci52YWx1ZSA9IHRbb10sIHIuZG9uZSA9ICExLCByO1xuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICByZXR1cm4gci52YWx1ZSA9IGUsIHIuZG9uZSA9ICEwLCByO1xuICAgICAgICAgICAgICAgIH0pLm5leHQgPSByO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIG5leHQ6IENcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgZnVuY3Rpb24gQygpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHZhbHVlOiBlLFxuICAgICAgICAgICAgICBkb25lOiAhMFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gKChnLnByb3RvdHlwZSA9IGIuY29uc3RydWN0b3IgPSBtKS5jb25zdHJ1Y3RvciA9IGcpLmRpc3BsYXlOYW1lID0gYyhtLCBzLCBcIkdlbmVyYXRvckZ1bmN0aW9uXCIpLCB0LmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuICEhKHQgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHQgJiYgdC5jb25zdHJ1Y3RvcikgJiYgKHQgPT09IGcgfHwgXCJHZW5lcmF0b3JGdW5jdGlvblwiID09PSAodC5kaXNwbGF5TmFtZSB8fCB0Lm5hbWUpKTtcbiAgICAgICAgICB9LCB0Lm1hcmsgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBtKSA6ICh0Ll9fcHJvdG9fXyA9IG0sIGModCwgcywgXCJHZW5lcmF0b3JGdW5jdGlvblwiKSksIHQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShiKSwgdDtcbiAgICAgICAgICB9LCB0LmF3cmFwID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIF9fYXdhaXQ6IHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSwgUyhFLnByb3RvdHlwZSksIEUucHJvdG90eXBlW2FdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgfSwgdC5Bc3luY0l0ZXJhdG9yID0gRSwgdC5hc3luYyA9IGZ1bmN0aW9uIChlLCByLCBuLCBvLCBpKSB7XG4gICAgICAgICAgICB2b2lkIDAgPT09IGkgJiYgKGkgPSBQcm9taXNlKTtcbiAgICAgICAgICAgIHZhciBhID0gbmV3IEUodShlLCByLCBuLCBvKSwgaSk7XG4gICAgICAgICAgICByZXR1cm4gdC5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpID8gYSA6IGEubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHQuZG9uZSA/IHQudmFsdWUgOiBhLm5leHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIFMoYiksIGMoYiwgcywgXCJHZW5lcmF0b3JcIiksIGJbaV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICB9LCBiLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIFwiW29iamVjdCBHZW5lcmF0b3JdXCI7XG4gICAgICAgICAgfSwgdC5rZXlzID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBlLFxuICAgICAgICAgICAgICAgIHIgPSBbXTtcblxuICAgICAgICAgICAgZm9yIChlIGluIHQpIHtcbiAgICAgICAgICAgICAgci5wdXNoKGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIGUoKSB7XG4gICAgICAgICAgICAgIGZvciAoOyByLmxlbmd0aDspIHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IHIucG9wKCk7XG4gICAgICAgICAgICAgICAgaWYgKG4gaW4gdCkgcmV0dXJuIGUudmFsdWUgPSBuLCBlLmRvbmUgPSAhMSwgZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiBlLmRvbmUgPSAhMCwgZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSwgdC52YWx1ZXMgPSB4LCBrLnByb3RvdHlwZSA9IHtcbiAgICAgICAgICAgIGNvbnN0cnVjdG9yOiBrLFxuICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHQpIHtcbiAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSBlLCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gXCJuZXh0XCIsIHRoaXMuYXJnID0gZSwgdGhpcy50cnlFbnRyaWVzLmZvckVhY2goTyksICF0KSBmb3IgKHZhciByIGluIHRoaXMpIHtcbiAgICAgICAgICAgICAgICBcInRcIiA9PT0gci5jaGFyQXQoMCkgJiYgbi5jYWxsKHRoaXMsIHIpICYmICFpc05hTigrci5zbGljZSgxKSkgJiYgKHRoaXNbcl0gPSBlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICAgICAgICAgIHRoaXMuZG9uZSA9ICEwO1xuICAgICAgICAgICAgICB2YXIgdCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO1xuICAgICAgICAgICAgICBpZiAoXCJ0aHJvd1wiID09PSB0LnR5cGUpIHRocm93IHQuYXJnO1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ydmFsO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbih0KSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHRocm93IHQ7XG4gICAgICAgICAgICAgIHZhciByID0gdGhpcztcblxuICAgICAgICAgICAgICBmdW5jdGlvbiBvKG4sIG8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcy50eXBlID0gXCJ0aHJvd1wiLCBzLmFyZyA9IHQsIHIubmV4dCA9IG4sIG8gJiYgKHIubWV0aG9kID0gXCJuZXh0XCIsIHIuYXJnID0gZSksICEhbztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgMCA8PSBpOyAtLWkpIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IHRoaXMudHJ5RW50cmllc1tpXSxcbiAgICAgICAgICAgICAgICAgICAgcyA9IGEuY29tcGxldGlvbjtcbiAgICAgICAgICAgICAgICBpZiAoXCJyb290XCIgPT09IGEudHJ5TG9jKSByZXR1cm4gbyhcImVuZFwiKTtcblxuICAgICAgICAgICAgICAgIGlmIChhLnRyeUxvYyA8PSB0aGlzLnByZXYpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBjID0gbi5jYWxsKGEsIFwiY2F0Y2hMb2NcIiksXG4gICAgICAgICAgICAgICAgICAgICAgdSA9IG4uY2FsbChhLCBcImZpbmFsbHlMb2NcIik7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChjICYmIHUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGEuY2F0Y2hMb2MpIHJldHVybiBvKGEuY2F0Y2hMb2MsICEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGEuZmluYWxseUxvYykgcmV0dXJuIG8oYS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgYS5jYXRjaExvYykgcmV0dXJuIG8oYS5jYXRjaExvYywgITApO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF1KSB0aHJvdyBuZXcgRXJyb3IoXCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGEuZmluYWxseUxvYykgcmV0dXJuIG8oYS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0LCBlKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIHIgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgMCA8PSByOyAtLXIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IHRoaXMudHJ5RW50cmllc1tyXTtcblxuICAgICAgICAgICAgICAgIGlmIChvLnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgbi5jYWxsKG8sIFwiZmluYWxseUxvY1wiKSAmJiB0aGlzLnByZXYgPCBvLmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICAgICAgICAgIHZhciBpID0gbztcbiAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHZhciBhID0gKGkgPSBpICYmIChcImJyZWFrXCIgPT09IHQgfHwgXCJjb250aW51ZVwiID09PSB0KSAmJiBpLnRyeUxvYyA8PSBlICYmIGUgPD0gaS5maW5hbGx5TG9jID8gbnVsbCA6IGkpID8gaS5jb21wbGV0aW9uIDoge307XG4gICAgICAgICAgICAgIHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSBcIm5leHRcIiwgdGhpcy5uZXh0ID0gaS5maW5hbGx5TG9jLCB2KSA6IHRoaXMuY29tcGxldGUoYSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHQsIGUpIHtcbiAgICAgICAgICAgICAgaWYgKFwidGhyb3dcIiA9PT0gdC50eXBlKSB0aHJvdyB0LmFyZztcbiAgICAgICAgICAgICAgcmV0dXJuIFwiYnJlYWtcIiA9PT0gdC50eXBlIHx8IFwiY29udGludWVcIiA9PT0gdC50eXBlID8gdGhpcy5uZXh0ID0gdC5hcmcgOiBcInJldHVyblwiID09PSB0LnR5cGUgPyAodGhpcy5ydmFsID0gdGhpcy5hcmcgPSB0LmFyZywgdGhpcy5tZXRob2QgPSBcInJldHVyblwiLCB0aGlzLm5leHQgPSBcImVuZFwiKSA6IFwibm9ybWFsXCIgPT09IHQudHlwZSAmJiBlICYmICh0aGlzLm5leHQgPSBlKSwgdjtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaCh0KSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGUgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgMCA8PSBlOyAtLWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMudHJ5RW50cmllc1tlXTtcbiAgICAgICAgICAgICAgICBpZiAoci5maW5hbGx5TG9jID09PSB0KSByZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sIHIuYWZ0ZXJMb2MpLCBPKHIpLCB2O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2F0Y2g6IGZ1bmN0aW9uIF9jYXRjaCh0KSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIGUgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgMCA8PSBlOyAtLWUpIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMudHJ5RW50cmllc1tlXTtcblxuICAgICAgICAgICAgICAgIGlmIChyLnRyeUxvYyA9PT0gdCkge1xuICAgICAgICAgICAgICAgICAgdmFyIG4sXG4gICAgICAgICAgICAgICAgICAgICAgbyA9IHIuY29tcGxldGlvbjtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBcInRocm93XCIgPT09IG8udHlwZSAmJiAobiA9IG8uYXJnLCBPKHIpKSwgbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHRcIik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZCh0LCByLCBuKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlID0ge1xuICAgICAgICAgICAgICAgIGl0ZXJhdG9yOiB4KHQpLFxuICAgICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHIsXG4gICAgICAgICAgICAgICAgbmV4dExvYzogblxuICAgICAgICAgICAgICB9LCBcIm5leHRcIiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gZSksIHY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgdDtcbiAgICAgICAgfSh0LmV4cG9ydHMpO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lID0gdDtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIEZ1bmN0aW9uKFwiclwiLCBcInJlZ2VuZXJhdG9yUnVudGltZSA9IHJcIikodCk7XG4gICAgICAgIH1cbiAgICAgIH0ociA9IHtcbiAgICAgICAgZXhwb3J0czoge31cbiAgICAgIH0pLCByLmV4cG9ydHMpO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZnVuY3Rpb24gcih0KSB7XG4gICAgICAgICAgIWZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgICAgICBpZiAoISh0IGluc3RhbmNlb2YgZSkpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7XG4gICAgICAgICAgfSh0aGlzLCByKSwgdGhpcy52ZXJzaW9uID0gXCIxLjAuMFwiO1xuICAgICAgICAgIHZhciBlID0gQXJyYXkucHJvdG90eXBlLm1hcCxcbiAgICAgICAgICAgICAgbiA9IEFycmF5LnByb3RvdHlwZS5mb3JFYWNoO1xuICAgICAgICAgIHQgJiYgKHRoaXMuaGFzaGVyID0gdCksIHRoaXMuZWFjaCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICAgICAgICBpZiAobnVsbCAhPSB0KSBpZiAobiAmJiB0LmZvckVhY2ggPT09IG4pIHQuZm9yRWFjaChlLCByKTtlbHNlIGlmICh0Lmxlbmd0aCA9PT0gK3QubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIG8gPSAwLCBpID0gdC5sZW5ndGg7IG8gPCBpOyBvKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZS5jYWxsKHIsIHRbb10sIG8sIHQpID09PSB7fSkgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgZm9yICh2YXIgYSBpbiB0KSB7XG4gICAgICAgICAgICAgIGlmICh0Lmhhc093blByb3BlcnR5KGEpICYmIGUuY2FsbChyLCB0W2FdLCBhLCB0KSA9PT0ge30pIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCB0aGlzLm1hcCA9IGZ1bmN0aW9uICh0LCByLCBuKSB7XG4gICAgICAgICAgICB2YXIgbyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIG51bGwgPT0gdCA/IG8gOiBlICYmIHQubWFwID09PSBlID8gdC5tYXAociwgbikgOiAodGhpcy5lYWNoKHQsIGZ1bmN0aW9uICh0LCBlLCBpKSB7XG4gICAgICAgICAgICAgIG9bby5sZW5ndGhdID0gci5jYWxsKG4sIHQsIGUsIGkpO1xuICAgICAgICAgICAgfSksIG8pO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbywgaSwgYSwgcztcbiAgICAgICAgcmV0dXJuIG8gPSByLCAoaSA9IFt7XG4gICAgICAgICAga2V5OiBcImdldFFpbWVpMzZcIixcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUodCwgZSkge1xuICAgICAgICAgICAgdmFyIHIgPSB0aGlzO1xuICAgICAgICAgICAgdGhpcy5nZXRIaWQoKS50aGVuKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgICAgIHZhciBvID0gXCIzQkpyXCIgKyB0LnN1YnN0cmluZygwLCAyKSArIChuICYmIG4uc3Vic3RyaW5nKDMsIDcpKSxcbiAgICAgICAgICAgICAgICAgIGkgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgaS5vcGVuKFwiUE9TVFwiLCBcImh0dHBzOi8vc25vd2ZsYWtlLnFxLmNvbS9vbGEvaDVcIiwgITApLCBpLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpLCBpLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoaS5yZWFkeVN0YXRlID09IFhNTEh0dHBSZXF1ZXN0LkRPTkUgJiYgMjAwID09IGkuc3RhdHVzKSB0cnkge1xuICAgICAgICAgICAgICAgICAgZSAmJiBlKEpTT04ucGFyc2UoaS5yZXNwb25zZVRleHQpKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoICh0KSB7XG4gICAgICAgICAgICAgICAgICBlKG51bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSwgaS5zZW5kKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBhcHBLZXk6IHQsXG4gICAgICAgICAgICAgICAgaGlkOiBuLFxuICAgICAgICAgICAgICAgIHNpZ246IG8sXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogci52ZXJzaW9uXG4gICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwge1xuICAgICAgICAgIGtleTogXCJnZXRIaWRcIixcbiAgICAgICAgICB2YWx1ZTogKGEgPSBuLm1hcmsoZnVuY3Rpb24gdCgpIHtcbiAgICAgICAgICAgIHZhciBlLCByO1xuICAgICAgICAgICAgcmV0dXJuIG4ud3JhcChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICBmb3IgKDs7KSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0LnByZXYgPSB0Lm5leHQpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChlID0gW10pLnB1c2goKG4gPSB2b2lkIDAsIChuID0gW01hdGguZmxvb3Iod2luZG93LnNjcmVlbi53aWR0aCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSwgTWF0aC5mbG9vcih3aW5kb3cuc2NyZWVuLmhlaWdodCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKV0pLnNvcnQoKS5yZXZlcnNlKCksIG4uam9pbihcInhcIikpKSwgZS5wdXNoKChuID0gdm9pZCAwLCAobiA9IFtNYXRoLmZsb29yKHdpbmRvdy5zY3JlZW4uYXZhaWxXaWR0aCAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSwgTWF0aC5mbG9vcih3aW5kb3cuc2NyZWVuLmF2YWlsSGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pXSkuc29ydCgpLnJldmVyc2UoKSwgbi5qb2luKFwieFwiKSkpLCBlLnB1c2gobmF2aWdhdG9yLmRldmljZU1lbW9yeSksIGUucHVzaCghIXdpbmRvdy5zZXNzaW9uU3RvcmFnZSksIGUucHVzaCghIXdpbmRvdy5pbmRleGVkREIpLCBlLnB1c2gobmF2aWdhdG9yLnByb2R1Y3RTdWIpLCBlLnB1c2gobmF2aWdhdG9yLmhhcmR3YXJlQ29uY3VycmVuY3kpLCBlLnB1c2godGhpcy5nZXRXZWJnbFZlbmRvckFuZFJlbmRlcmVyKCkpLCBlLnB1c2gobmV3IERhdGUoKS5nZXRUaW1lem9uZU9mZnNldCgpKSwgdC5uZXh0ID0gMTIsIHRoaXMuZ2V0RmFjdG9yKCk7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMTI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChyID0gdC5zZW50LCBlLnB1c2gociksIHRoaXMuaGFzaGVyKSByZXR1cm4gdC5hYnJ1cHQoXCJyZXR1cm5cIiwgdGhpcy5oYXNoZXIoZS5qb2luKFwiIyMjXCIpLCAzMSkpO1xuICAgICAgICAgICAgICAgICAgICB0Lm5leHQgPSAxODtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMTg6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmFicnVwdChcInJldHVyblwiLCB0aGlzLng2NGhhc2gxMjgoZS5qb2luKFwiIyMjXCIpLCAzMSkpO1xuXG4gICAgICAgICAgICAgICAgICBjYXNlIDE5OlxuICAgICAgICAgICAgICAgICAgY2FzZSBcImVuZFwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdC5zdG9wKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIG47XG4gICAgICAgICAgICB9LCB0LCB0aGlzKTtcbiAgICAgICAgICB9KSwgcyA9IGZ1bmN0aW9uIHMoKSB7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMsXG4gICAgICAgICAgICAgICAgciA9IGFyZ3VtZW50cztcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAobiwgbykge1xuICAgICAgICAgICAgICB2YXIgaSA9IGEuYXBwbHkoZSwgcik7XG5cbiAgICAgICAgICAgICAgZnVuY3Rpb24gcyhlKSB7XG4gICAgICAgICAgICAgICAgdChpLCBuLCBvLCBzLCBjLCBcIm5leHRcIiwgZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBmdW5jdGlvbiBjKGUpIHtcbiAgICAgICAgICAgICAgICB0KGksIG4sIG8sIHMsIGMsIFwidGhyb3dcIiwgZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBzKHZvaWQgMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH0pXG4gICAgICAgIH0sIHtcbiAgICAgICAgICBrZXk6IFwiZ2V0VXNlckFnZW50XCIsXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAga2V5OiBcImdldE5hdGl2ZVwiLFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHtcbiAgICAgICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuZ2V0SGlkKCkudGhlbihmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICBKU0ludGVyZmFjZS5jYWxsYmFjayh0LnZlcnNpb24sIGUsIHQuZ2V0VXNlckFnZW50KCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAga2V5OiBcImdldFdlYmdsVmVuZG9yQW5kUmVuZGVyZXJcIixcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICB2YXIgdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIiksXG4gICAgICAgICAgICAgICAgICAgIGUgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIGUgPSB0LmdldENvbnRleHQoXCJ3ZWJnbFwiKSB8fCB0LmdldENvbnRleHQoXCJleHBlcmltZW50YWwtd2ViZ2xcIik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAodCkge31cblxuICAgICAgICAgICAgICAgIHJldHVybiBlIHx8IG51bGw7XG4gICAgICAgICAgICAgIH0oKSxcbiAgICAgICAgICAgICAgICAgIGUgPSB0LmdldEV4dGVuc2lvbihcIldFQkdMX2RlYnVnX3JlbmRlcmVyX2luZm9cIiksXG4gICAgICAgICAgICAgICAgICByID0gW3QuZ2V0UGFyYW1ldGVyKGUuVU5NQVNLRURfVkVORE9SX1dFQkdMKSwgdC5nZXRQYXJhbWV0ZXIoZS5VTk1BU0tFRF9SRU5ERVJFUl9XRUJHTCldLmpvaW4oXCJ+XCIpLFxuICAgICAgICAgICAgICAgICAgbiA9IHQuZ2V0RXh0ZW5zaW9uKFwiV0VCR0xfbG9zZV9jb250ZXh0XCIpO1xuXG4gICAgICAgICAgICAgIHJldHVybiBudWxsICE9IG4gJiYgbi5sb3NlQ29udGV4dCgpLCByO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sIHtcbiAgICAgICAgICBrZXk6IFwiZ2V0RmFjdG9yXCIsXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgICAgICAgIHZhciByID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uIHx8IHdpbmRvdy53ZWJraXRSVENQZWVyQ29ubmVjdGlvbiB8fCB3aW5kb3cubW96UlRDUGVlckNvbm5lY3Rpb247XG4gICAgICAgICAgICAgIHIgPyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSBuZXcgcih7XG4gICAgICAgICAgICAgICAgICBpY2VTZXJ2ZXJzOiBbXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGUuY3JlYXRlRGF0YUNoYW5uZWwoXCJcIiwge1xuICAgICAgICAgICAgICAgICAgcmVsaWFibGU6ICExXG4gICAgICAgICAgICAgICAgfSksIGUub25pY2VjYW5kaWRhdGUgPSBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgdC5jYW5kaWRhdGUgJiYgaShcImE9XCIuY29uY2F0KHQuY2FuZGlkYXRlLmNhbmRpZGF0ZSkpO1xuICAgICAgICAgICAgICAgIH0sIGUuY3JlYXRlT2ZmZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgIGkodC5zZHApLCBlLnNldExvY2FsRGVzY3JpcHRpb24odCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHQpIHt9KTtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBvKGUpIHtcbiAgICAgICAgICAgICAgICAgIGlmICghKGUgaW4gbikpIHtcbiAgICAgICAgICAgICAgICAgICAgbltlXSA9ICEwO1xuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHIgPSBPYmplY3Qua2V5cyhuKS5maWx0ZXIoZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gblt0XTtcbiAgICAgICAgICAgICAgICAgICAgfSksIG8gPSAwOyBvIDwgci5sZW5ndGg7IG8rKykge1xuICAgICAgICAgICAgICAgICAgICAgIDE2IDwgcltvXS5sZW5ndGggJiYgKHIuc3BsaWNlKG8sIDEpLCBvLS0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdChyWzBdKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBpKHQpIHtcbiAgICAgICAgICAgICAgICAgICgwIDwgYXJndW1lbnRzLmxlbmd0aCAmJiB2b2lkIDAgIT09IHQgPyB0IDogXCJcIikuc3BsaXQoXCJcXHJcXG5cIikuZm9yRWFjaChmdW5jdGlvbiAodCwgZSwgcikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbiwgaTtcbiAgICAgICAgICAgICAgICAgICAgfnQuaW5kZXhPZihcImE9Y2FuZGlkYXRlXCIpID8gKGkgPSAobiA9IHQuc3BsaXQoXCIgXCIpKVs0XSwgXCJob3N0XCIgPT09IG5bN10gJiYgbyhpKSkgOiB+dC5pbmRleE9mKFwiYz1cIikgJiYgbyh0LnNwbGl0KFwiIFwiKVsyXSk7XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBuW1wiMC4wLjAuMFwiXSA9ICExO1xuICAgICAgICAgICAgICB9KCkgOiB0KG51bGwpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCB7XG4gICAgICAgICAga2V5OiBcIng2NGhhc2gxMjhcIixcbiAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUodCwgZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgciA9IGZ1bmN0aW9uIHIodCwgZSkge1xuICAgICAgICAgICAgICB0ID0gW3RbMF0gPj4+IDE2LCA2NTUzNSAmIHRbMF0sIHRbMV0gPj4+IDE2LCA2NTUzNSAmIHRbMV1dLCBlID0gW2VbMF0gPj4+IDE2LCA2NTUzNSAmIGVbMF0sIGVbMV0gPj4+IDE2LCA2NTUzNSAmIGVbMV1dO1xuICAgICAgICAgICAgICB2YXIgciA9IFswLCAwLCAwLCAwXTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJbM10gKz0gdFszXSArIGVbM10sIHJbMl0gKz0gclszXSA+Pj4gMTYsIHJbM10gJj0gNjU1MzUsIHJbMl0gKz0gdFsyXSArIGVbMl0sIHJbMV0gKz0gclsyXSA+Pj4gMTYsIHJbMl0gJj0gNjU1MzUsIHJbMV0gKz0gdFsxXSArIGVbMV0sIHJbMF0gKz0gclsxXSA+Pj4gMTYsIHJbMV0gJj0gNjU1MzUsIHJbMF0gKz0gdFswXSArIGVbMF0sIHJbMF0gJj0gNjU1MzUsIFtyWzBdIDw8IDE2IHwgclsxXSwgclsyXSA8PCAxNiB8IHJbM11dO1xuICAgICAgICAgICAgfSwgbiA9IGZ1bmN0aW9uIG4odCwgZSkge1xuICAgICAgICAgICAgICB0ID0gW3RbMF0gPj4+IDE2LCA2NTUzNSAmIHRbMF0sIHRbMV0gPj4+IDE2LCA2NTUzNSAmIHRbMV1dLCBlID0gW2VbMF0gPj4+IDE2LCA2NTUzNSAmIGVbMF0sIGVbMV0gPj4+IDE2LCA2NTUzNSAmIGVbMV1dO1xuICAgICAgICAgICAgICB2YXIgciA9IFswLCAwLCAwLCAwXTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJbM10gKz0gdFszXSAqIGVbM10sIHJbMl0gKz0gclszXSA+Pj4gMTYsIHJbM10gJj0gNjU1MzUsIHJbMl0gKz0gdFsyXSAqIGVbM10sIHJbMV0gKz0gclsyXSA+Pj4gMTYsIHJbMl0gJj0gNjU1MzUsIHJbMl0gKz0gdFszXSAqIGVbMl0sIHJbMV0gKz0gclsyXSA+Pj4gMTYsIHJbMl0gJj0gNjU1MzUsIHJbMV0gKz0gdFsxXSAqIGVbM10sIHJbMF0gKz0gclsxXSA+Pj4gMTYsIHJbMV0gJj0gNjU1MzUsIHJbMV0gKz0gdFsyXSAqIGVbMl0sIHJbMF0gKz0gclsxXSA+Pj4gMTYsIHJbMV0gJj0gNjU1MzUsIHJbMV0gKz0gdFszXSAqIGVbMV0sIHJbMF0gKz0gclsxXSA+Pj4gMTYsIHJbMV0gJj0gNjU1MzUsIHJbMF0gKz0gdFswXSAqIGVbM10gKyB0WzFdICogZVsyXSArIHRbMl0gKiBlWzFdICsgdFszXSAqIGVbMF0sIHJbMF0gJj0gNjU1MzUsIFtyWzBdIDw8IDE2IHwgclsxXSwgclsyXSA8PCAxNiB8IHJbM11dO1xuICAgICAgICAgICAgfSwgbyA9IGZ1bmN0aW9uIG8odCwgZSkge1xuICAgICAgICAgICAgICByZXR1cm4gMzIgPT0gKGUgJT0gNjQpID8gW3RbMV0sIHRbMF1dIDogZSA8IDMyID8gW3RbMF0gPDwgZSB8IHRbMV0gPj4+IDMyIC0gZSwgdFsxXSA8PCBlIHwgdFswXSA+Pj4gMzIgLSBlXSA6IFt0WzFdIDw8IChlIC09IDMyKSB8IHRbMF0gPj4+IDMyIC0gZSwgdFswXSA8PCBlIHwgdFsxXSA+Pj4gMzIgLSBlXTtcbiAgICAgICAgICAgIH0sIGkgPSBmdW5jdGlvbiBpKHQsIGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIDAgPT0gKGUgJT0gNjQpID8gdCA6IGUgPCAzMiA/IFt0WzBdIDw8IGUgfCB0WzFdID4+PiAzMiAtIGUsIHRbMV0gPDwgZV0gOiBbdFsxXSA8PCBlIC0gMzIsIDBdO1xuICAgICAgICAgICAgfSwgYSA9IGZ1bmN0aW9uIGEodCwgZSkge1xuICAgICAgICAgICAgICByZXR1cm4gW3RbMF0gXiBlWzBdLCB0WzFdIF4gZVsxXV07XG4gICAgICAgICAgICB9LCBzID0gZnVuY3Rpb24gcyh0KSB7XG4gICAgICAgICAgICAgIHJldHVybiB0ID0gYSh0LCBbMCwgdFswXSA+Pj4gMV0pLCB0ID0gbih0LCBbNDI4MzU0MzUxMSwgMzk4MTgwNjc5N10pLCB0ID0gYSh0LCBbMCwgdFswXSA+Pj4gMV0pLCB0ID0gbih0LCBbMzMwMTg4MjM2NiwgNDQ0OTg0NDAzXSksIGEodCwgWzAsIHRbMF0gPj4+IDFdKTtcbiAgICAgICAgICAgIH0sIGMgPSAodCA9IHQgfHwgXCJcIikubGVuZ3RoICUgMTYsIHUgPSB0Lmxlbmd0aCAtIGMsIGwgPSBbMCwgZSA9IGUgfHwgMF0sIGggPSBbMCwgZV0sIGYgPSBbMCwgMF0sIHAgPSBbMCwgMF0sIGQgPSBbMjI3NzczNTMxMywgMjg5NTU5NTA5XSwgdiA9IFsxMjkxMTY5MDkxLCA2NTg4NzExNjddLCB5ID0gMDsgeSA8IHU7IHkgKz0gMTYpIHtcbiAgICAgICAgICAgICAgZiA9IFsyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDQpIHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgNSkpIDw8IDggfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyA2KSkgPDwgMTYgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyA3KSkgPDwgMjQsIDI1NSAmIHQuY2hhckNvZGVBdCh5KSB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDEpKSA8PCA4IHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMikpIDw8IDE2IHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMykpIDw8IDI0XSwgcCA9IFsyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDEyKSB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDEzKSkgPDwgOCB8ICgyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDE0KSkgPDwgMTYgfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyAxNSkpIDw8IDI0LCAyNTUgJiB0LmNoYXJDb2RlQXQoeSArIDgpIHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgOSkpIDw8IDggfCAoMjU1ICYgdC5jaGFyQ29kZUF0KHkgKyAxMCkpIDw8IDE2IHwgKDI1NSAmIHQuY2hhckNvZGVBdCh5ICsgMTEpKSA8PCAyNF0sIGYgPSBvKGYgPSBuKGYsIGQpLCAzMSksIGYgPSBuKGYsIHYpLCBsID0gcihsID0gbyhsID0gYShsLCBmKSwgMjcpLCBoKSwgbCA9IHIobihsLCBbMCwgNV0pLCBbMCwgMTM5MDIwODgwOV0pLCBwID0gbyhwID0gbihwLCB2KSwgMzMpLCBwID0gbihwLCBkKSwgaCA9IHIoaCA9IG8oaCA9IGEoaCwgcCksIDMxKSwgbCksIGggPSByKG4oaCwgWzAsIDVdKSwgWzAsIDk0NDMzMTQ0NV0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKGYgPSBbMCwgMF0sIHAgPSBbMCwgMF0sIGMpIHtcbiAgICAgICAgICAgICAgY2FzZSAxNTpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDE0KV0sIDQ4KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxNDpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDEzKV0sIDQwKSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDEyKV0sIDMyKSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDExKV0sIDI0KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDEwKV0sIDE2KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxMDpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDkpXSwgOCkpO1xuXG4gICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICBwID0gYShwLCBbMCwgdC5jaGFyQ29kZUF0KHkgKyA4KV0pLCBwID0gbyhwID0gbihwLCB2KSwgMzMpLCBwID0gbihwLCBkKSwgaCA9IGEoaCwgcCk7XG5cbiAgICAgICAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgNyldLCA1NikpO1xuXG4gICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICBmID0gYShmLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDYpXSwgNDgpKTtcblxuICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgaShbMCwgdC5jaGFyQ29kZUF0KHkgKyA1KV0sIDQwKSk7XG5cbiAgICAgICAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgNCldLCAzMikpO1xuXG4gICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICBmID0gYShmLCBpKFswLCB0LmNoYXJDb2RlQXQoeSArIDMpXSwgMjQpKTtcblxuICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgZiA9IGEoZiwgaShbMCwgdC5jaGFyQ29kZUF0KHkgKyAyKV0sIDE2KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIGkoWzAsIHQuY2hhckNvZGVBdCh5ICsgMSldLCA4KSk7XG5cbiAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIGYgPSBhKGYsIFt0LmNoYXJDb2RlQXQoeSldKSwgZiA9IG8oZiA9IG4oZiwgZCksIDMxKSwgZiA9IG4oZiwgdiksIGwgPSBhKGwsIGYpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gbCA9IGEobCwgWzAsIHQubGVuZ3RoXSksIGggPSByKGggPSBhKGgsIFswLCB0Lmxlbmd0aF0pLCBsID0gcihsLCBoKSksIGwgPSBzKGwpLCBoID0gcihoID0gcyhoKSwgbCA9IHIobCwgaCkpLCAoXCIwMDAwMDAwMFwiICsgKGxbMF0gPj4+IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTgpICsgKFwiMDAwMDAwMDBcIiArIChsWzFdID4+PiAwKS50b1N0cmluZygxNikpLnNsaWNlKC04KSArIChcIjAwMDAwMDAwXCIgKyAoaFswXSA+Pj4gMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtOCkgKyAoXCIwMDAwMDAwMFwiICsgKGhbMV0gPj4+IDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfV0pICYmIGUoby5wcm90b3R5cGUsIGkpLCByO1xuICAgICAgfSgpO1xuICAgIH0oKTtcbiAgfSksXG4gICAgICBIID0gXCJsb2dpZF9zdGFydFwiLFxuICAgICAgeiA9IFwiNC41LjYtd2ViXCI7XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIChyKSB7XG4gICAgZnVuY3Rpb24gbih0KSB7XG4gICAgICB2YXIgZSA9IHIuY2FsbCh0aGlzLCB0KSB8fCB0aGlzO1xuICAgICAgZS5xaW1laTM2ID0gXCJcIiwgZS51c2VsZXNzQ3ljbGVUYXNrTnVtID0gMCwgZS51bmRlcldlYWtOZXQgPSAhMSwgZS5zZW5kID0gZnVuY3Rpb24gKHQsIHIsIG4pIHtcbiAgICAgICAgZS5zdG9yYWdlLnNldEl0ZW0oYSwgRGF0ZS5ub3coKS50b1N0cmluZygpKSwgZS5uZXR3b3JrLnBvc3QoZS51cGxvYWRVcmwgfHwgZS5zdHJhdGVneS5nZXRVcGxvYWRVcmwoKSwgdC5kYXRhKS50aGVuKGZ1bmN0aW9uIChuKSB7XG4gICAgICAgICAgdmFyIG87XG4gICAgICAgICAgMTAwID09IChudWxsID09PSAobyA9IG51bGwgPT0gbiA/IHZvaWQgMCA6IG4uZGF0YSkgfHwgdm9pZCAwID09PSBvID8gdm9pZCAwIDogby5yZXN1bHQpID8gZS5kZWxheVRpbWUgPSAxZTMgKiBuLmRhdGEuZGVsYXlUaW1lIDogZS5kZWxheVRpbWUgPSAwLCByICYmIHIodC5kYXRhKSwgdC5kYXRhLmV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICBlLnN0b3JlLnJlbW92ZUV2ZW50KHQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBlLnJlbW92ZVNlbmRpbmdJZChwKHQubWFwVmFsdWUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pLCBlLmRvQ3VzdG9tQ3ljbGVUYXNrKCk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgdmFyIG8gPSB0LmRhdGEuZXZlbnRzO1xuICAgICAgICAgIGUuZXJyb3JSZXBvcnQucmVwb3J0RXJyb3Ioci5jb2RlID8gci5jb2RlLnRvU3RyaW5nKCkgOiBcIjYwMFwiLCByLm1lc3NhZ2UpLCBuICYmIG4odC5kYXRhKTtcbiAgICAgICAgICB2YXIgaSA9IEpTT04ucGFyc2UoZS5zdG9yYWdlLmdldEl0ZW0ocykpO1xuICAgICAgICAgIG8uZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgaSAmJiAtMSAhPSBpLmluZGV4T2YocCh0KSkgJiYgZS5zdG9yZS5pbnNlcnRFdmVudCh0LCBmdW5jdGlvbiAodCwgcikge1xuICAgICAgICAgICAgICB0ICYmIGUuZXJyb3JSZXBvcnQucmVwb3J0RXJyb3IoXCI2MDRcIiwgXCJpbnNlcnRFdmVudCBmYWlsIVwiKTtcbiAgICAgICAgICAgIH0pLCBlLnJlbW92ZVNlbmRpbmdJZChwKHQpKTtcbiAgICAgICAgICB9KSwgZS5tb25pdG9yVXBsb2FkRmFpbGVkKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIHZhciBuLFxuICAgICAgICAgIG8sXG4gICAgICAgICAgaSA9IGIoKTtcbiAgICAgIHJldHVybiBlLmlzVW5kZXJJRTggPSBpID4gMCAmJiBpIDwgOCwgZS5pc1VuZGVySUU4IHx8IChlLmlzVW5kZXJJRSA9IGkgPiAwLCB0Lm5lZWRJbml0UWltZWkgJiYgZS5pbml0UWltZWkodC5hcHBrZXkpLCBlLm5ldHdvcmsgPSBuZXcgUSh0KSwgZS5zdG9yYWdlID0gbmV3IEsodC5hcHBrZXkpLCBlLmluaXRDb21tb25JbmZvKHQpLCBlLnN0b3JlID0gbmV3IF8odC5hcHBrZXksIGUuc3RvcmFnZSksIGUuZXJyb3JSZXBvcnQgPSBuZXcgeShlLmNvbmZpZywgZS5jb21tb25JbmZvLCBcIndlYlwiLCBlLm5ldHdvcmspLCBlLnN0cmF0ZWd5ID0gbmV3IGcoZS5jb25maWcsIGUuY29tbW9uSW5mbywgZS5zdG9yYWdlLCBlLm5ldHdvcmspLCBlLmxvZ2lkU3RhcnRUaW1lID0gZS5zdG9yYWdlLmdldEl0ZW0oSCksIGUubG9naWRTdGFydFRpbWUgfHwgKGUubG9naWRTdGFydFRpbWUgPSBEYXRlLm5vdygpLnRvU3RyaW5nKCksIGUuc3RvcmFnZS5zZXRJdGVtKEgsIGUubG9naWRTdGFydFRpbWUpKSwgbiA9IGUubG9naWRTdGFydFRpbWUsIG8gPSBEYXRlLm5vdygpIC0gTnVtYmVyLnBhcnNlRmxvYXQobiksIE1hdGguZmxvb3IobyAvIDg2NGU1KSA+PSAzNjUgJiYgZS5zdG9yYWdlLmNsZWFyKCksIGUuaW5pdFNlc3Npb24odCksIGUub25EaXJlY3RVc2VyQWN0aW9uKFwicnFkX2pzX2luaXRcIiwge30pLCBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGUubGlmZUN5Y2xlLmVtaXQoXCJpbml0XCIpO1xuICAgICAgfSwgMCksIGUuaW5pdERlbGF5VGltZSA9IHQuZGVsYXkgPyB0LmRlbGF5IDogMWUzLCBlLmN5Y2xlVGFzayhlLmluaXREZWxheVRpbWUpKSwgZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gKGUsIHIpIHtcbiAgICAgIGlmIChcImZ1bmN0aW9uXCIgIT0gdHlwZW9mIHIgJiYgbnVsbCAhPT0gcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcocikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xuXG4gICAgICBmdW5jdGlvbiBuKCkge1xuICAgICAgICB0aGlzLmNvbnN0cnVjdG9yID0gZTtcbiAgICAgIH1cblxuICAgICAgX3QoZSwgciksIGUucHJvdG90eXBlID0gbnVsbCA9PT0gciA/IE9iamVjdC5jcmVhdGUocikgOiAobi5wcm90b3R5cGUgPSByLnByb3RvdHlwZSwgbmV3IG4oKSk7XG4gICAgfShuLCByKSwgbi5wcm90b3R5cGUuaW5pdFFpbWVpID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gdGhpcztcbiAgICAgIG5ldyBXKCkuZ2V0UWltZWkzNih0LCBmdW5jdGlvbiAodCkge1xuICAgICAgICBlLnFpbWVpMzYgPSB0LnEzNjtcbiAgICAgIH0pO1xuICAgIH0sIG4ucHJvdG90eXBlLmluaXRTZXNzaW9uID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gMThlNTtcbiAgICAgIHQuc2Vzc2lvbkR1cmF0aW9uICYmIHQuc2Vzc2lvbkR1cmF0aW9uID4gM2U0ICYmIChlID0gdC5zZXNzaW9uRHVyYXRpb24pLCB0aGlzLmJlYWNvblNlc3Npb24gPSBuZXcgdyh0aGlzLnN0b3JhZ2UsIGUsIHRoaXMpO1xuICAgIH0sIG4ucHJvdG90eXBlLmluaXRDb21tb25JbmZvID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgIHZhciBlID0gTnVtYmVyKHRoaXMuc3RvcmFnZS5nZXRJdGVtKGEpKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIHIgPSBKU09OLnBhcnNlKHRoaXMuc3RvcmFnZS5nZXRJdGVtKHMpKTtcbiAgICAgICAgKERhdGUubm93KCkgLSBlID4gM2U0IHx8ICFyKSAmJiB0aGlzLnN0b3JhZ2Uuc2V0SXRlbShzLCBKU09OLnN0cmluZ2lmeShbXSkpO1xuICAgICAgfSBjYXRjaCAodCkge31cblxuICAgICAgdC51cGxvYWRVcmwgJiYgKHRoaXMudXBsb2FkVXJsID0gdC51cGxvYWRVcmwgKyBcIj9hcHBrZXk9XCIgKyB0LmFwcGtleSk7XG4gICAgICB2YXIgbiA9IFt3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodF07XG4gICAgICB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyAmJiBuLnB1c2god2luZG93LmRldmljZVBpeGVsUmF0aW8pLCB0aGlzLmNvbW1vbkluZm8gPSB7XG4gICAgICAgIGRldmljZUlkOiB0aGlzLnN0b3JhZ2UuY3JlYXRlRGV2aWNlSWQoKSxcbiAgICAgICAgbGFuZ3VhZ2U6IG5hdmlnYXRvciAmJiBuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgXCJ6aF9DTlwiLFxuICAgICAgICBxdWVyeTogd2luZG93LmxvY2F0aW9uLnNlYXJjaCxcbiAgICAgICAgdXNlckFnZW50OiBuYXZpZ2F0b3IudXNlckFnZW50LFxuICAgICAgICBwaXhlbDogbi5qb2luKFwiKlwiKSxcbiAgICAgICAgY2hhbm5lbElEOiB0LmNoYW5uZWxJRCA/IFN0cmluZyh0LmNoYW5uZWxJRCkgOiBcIlwiLFxuICAgICAgICBvcGVuaWQ6IHQub3BlbmlkID8gU3RyaW5nKHQub3BlbmlkKSA6IFwiXCIsXG4gICAgICAgIHVuaWQ6IHQudW5pb25pZCA/IFN0cmluZyh0LnVuaW9uaWQpIDogXCJcIixcbiAgICAgICAgc2RrVmVyc2lvbjogelxuICAgICAgfSwgdGhpcy5jb25maWcuYXBwVmVyc2lvbiA9IHQudmVyc2lvbkNvZGUgPyBTdHJpbmcodC52ZXJzaW9uQ29kZSkgOiBcIlwiLCB0aGlzLmNvbmZpZy5zdHJpY3RNb2RlID0gdC5zdHJpY3RNb2RlO1xuICAgIH0sIG4ucHJvdG90eXBlLmN5Y2xlVGFzayA9IGZ1bmN0aW9uICh0KSB7XG4gICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICB0aGlzLmludGVydmFsSUQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICBlLnN0b3JlLmdldEV2ZW50cygpLnRoZW4oZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICB2YXIgciA9IFtdLFxuICAgICAgICAgICAgICBuID0gSlNPTi5wYXJzZShlLnN0b3JhZ2UuZ2V0SXRlbShzKSk7XG4gICAgICAgICAgbiB8fCAobiA9IFtdKSwgdCAmJiB0LmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBlID0gcCh0Lm1hcFZhbHVlKTtcbiAgICAgICAgICAgIC0xID09IG4uaW5kZXhPZihlKSAmJiAoci5wdXNoKHQpLCBuLnB1c2goZSkpO1xuICAgICAgICAgIH0pLCAwICE9IHIubGVuZ3RoICYmIChlLnN0b3JhZ2Uuc2V0SXRlbShzLCBKU09OLnN0cmluZ2lmeShuKSksIGUuX25vcm1hbExvZ1BpcGVsaW5lKGUuYXNzZW1ibGVEYXRhKHIpKSk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICh0KSB7fSk7XG4gICAgICB9LCB0KTtcbiAgICB9LCBuLnByb3RvdHlwZS5vblJlcG9ydCA9IGZ1bmN0aW9uICh0LCBlLCByKSB7XG4gICAgICB2YXIgbiA9IHRoaXM7XG4gICAgICBpZiAodGhpcy5pc1VuZGVySUU4KSB0aGlzLmVycm9yUmVwb3J0LnJlcG9ydEVycm9yKFwiNjAxXCIsIFwiVW5kZXJJRThcIik7ZWxzZSB7XG4gICAgICAgIHZhciBvID0gdGhpcy5nZW5lcmF0ZURhdGEodCwgZSwgcik7XG4gICAgICAgIGlmIChyICYmIDAgPT0gdGhpcy5kZWxheVRpbWUgJiYgIXRoaXMudW5kZXJXZWFrTmV0KSB0aGlzLl9ub3JtYWxMb2dQaXBlbGluZSh0aGlzLmFzc2VtYmxlRGF0YShvKSk7ZWxzZSB7XG4gICAgICAgICAgdmFyIGkgPSBvLnNoaWZ0KCk7XG4gICAgICAgICAgaSAmJiB0aGlzLnN0b3JlLmluc2VydEV2ZW50KGksIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICB0ICYmIG4uZXJyb3JSZXBvcnQucmVwb3J0RXJyb3IoXCI2MDRcIiwgXCJpbnNlcnRFdmVudCBmYWlsIVwiKTtcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgbi5fbm9ybWFsTG9nUGlwZWxpbmUobi5hc3NlbWJsZURhdGEobykpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgbi5wcm90b3R5cGUub25TZW5kQmVhY29uID0gZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgIGlmICh0aGlzLmlzVW5kZXJJRSkgdGhpcy5lcnJvclJlcG9ydC5yZXBvcnRFcnJvcihcIjYwNVwiLCBcIlVuZGVySUVcIik7ZWxzZSB7XG4gICAgICAgIHZhciByID0gdGhpcy5hc3NlbWJsZURhdGEodGhpcy5nZW5lcmF0ZURhdGEodCwgZSwgITApKTtcbiAgICAgICAgXCJmdW5jdGlvblwiID09IHR5cGVvZiBuYXZpZ2F0b3Iuc2VuZEJlYWNvbiAmJiBuYXZpZ2F0b3Iuc2VuZEJlYWNvbih0aGlzLnVwbG9hZFVybCB8fCB0aGlzLnN0cmF0ZWd5LmdldFVwbG9hZFVybCgpLCBKU09OLnN0cmluZ2lmeShyKSk7XG4gICAgICB9XG4gICAgfSwgbi5wcm90b3R5cGUuZ2VuZXJhdGVEYXRhID0gZnVuY3Rpb24gKHQsIHIsIG4pIHtcbiAgICAgIHZhciBvID0gW10sXG4gICAgICAgICAgaSA9IFwiNC41LjYtd2ViX1wiICsgKG4gPyBcImRpcmVjdF9sb2dfaWRcIiA6IFwibm9ybWFsX2xvZ19pZFwiKSxcbiAgICAgICAgICBhID0gTnVtYmVyKHRoaXMuc3RvcmFnZS5nZXRJdGVtKGkpKTtcbiAgICAgIHJldHVybiBhID0gYSB8fCAxLCByID0gX2UoX2Uoe30sIHIpLCB7XG4gICAgICAgIEE5OTogbiA/IFwiWVwiIDogXCJOXCIsXG4gICAgICAgIEExMDA6IGEudG9TdHJpbmcoKSxcbiAgICAgICAgQTcyOiB6LFxuICAgICAgICBBODg6IHRoaXMubG9naWRTdGFydFRpbWVcbiAgICAgIH0pLCBhKyssIHRoaXMuc3RvcmFnZS5zZXRJdGVtKGksIGEudG9TdHJpbmcoKSksIG8ucHVzaCh7XG4gICAgICAgIGV2ZW50Q29kZTogdCxcbiAgICAgICAgZXZlbnRUaW1lOiBEYXRlLm5vdygpLnRvU3RyaW5nKCksXG4gICAgICAgIG1hcFZhbHVlOiBoKHIsIHRoaXMuY29uZmlnLnN0cmljdE1vZGUpXG4gICAgICB9KSwgbztcbiAgICB9LCBuLnByb3RvdHlwZS5hc3NlbWJsZURhdGEgPSBmdW5jdGlvbiAodCkge1xuICAgICAgdmFyIHIgPSB0aGlzLmJlYWNvblNlc3Npb24uZ2V0U2Vzc2lvbigpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXBwVmVyc2lvbjogdGhpcy5jb25maWcuYXBwVmVyc2lvbiA/IGYodGhpcy5jb25maWcuYXBwVmVyc2lvbikgOiBcIlwiLFxuICAgICAgICBzZGtJZDogXCJqc1wiLFxuICAgICAgICBzZGtWZXJzaW9uOiB6LFxuICAgICAgICBtYWluQXBwS2V5OiB0aGlzLmNvbmZpZy5hcHBrZXksXG4gICAgICAgIHBsYXRmb3JtSWQ6IDMsXG4gICAgICAgIGNvbW1vbjogaChfZShfZSh7fSwgdGhpcy5hZGRpdGlvbmFsUGFyYW1zKSwge1xuICAgICAgICAgIEEyOiB0aGlzLmNvbW1vbkluZm8uZGV2aWNlSWQsXG4gICAgICAgICAgQTg6IHRoaXMuY29tbW9uSW5mby5vcGVuaWQsXG4gICAgICAgICAgQTEyOiB0aGlzLmNvbW1vbkluZm8ubGFuZ3VhZ2UsXG4gICAgICAgICAgQTE3OiB0aGlzLmNvbW1vbkluZm8ucGl4ZWwsXG4gICAgICAgICAgQTIzOiB0aGlzLmNvbW1vbkluZm8uY2hhbm5lbElELFxuICAgICAgICAgIEE1MDogdGhpcy5jb21tb25JbmZvLnVuaWQsXG4gICAgICAgICAgQTc2OiByLnNlc3Npb25JZCxcbiAgICAgICAgICBBMTAxOiB0aGlzLmNvbW1vbkluZm8udXNlckFnZW50LFxuICAgICAgICAgIEExMDI6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLFxuICAgICAgICAgIEExMDQ6IGRvY3VtZW50LnJlZmVycmVyLFxuICAgICAgICAgIEExMTk6IHRoaXMuY29tbW9uSW5mby5xdWVyeSxcbiAgICAgICAgICBBMTUzOiB0aGlzLnFpbWVpMzZcbiAgICAgICAgfSksICExKSxcbiAgICAgICAgZXZlbnRzOiB0XG4gICAgICB9O1xuICAgIH0sIG4ucHJvdG90eXBlLm1vbml0b3JVcGxvYWRGYWlsZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnVzZWxlc3NDeWNsZVRhc2tOdW0rKywgdGhpcy51c2VsZXNzQ3ljbGVUYXNrTnVtID49IDUgJiYgKHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJRCksIHRoaXMuY3ljbGVUYXNrKDZlNCksIHRoaXMudW5kZXJXZWFrTmV0ID0gITApO1xuICAgIH0sIG4ucHJvdG90eXBlLmRvQ3VzdG9tQ3ljbGVUYXNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy51c2VsZXNzQ3ljbGVUYXNrTnVtID49IDUgJiYgKHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWxJRCksIHRoaXMuY3ljbGVUYXNrKHRoaXMuaW5pdERlbGF5VGltZSkpLCB0aGlzLnVzZWxlc3NDeWNsZVRhc2tOdW0gPSAwLCB0aGlzLnVuZGVyV2Vha05ldCA9ICExO1xuICAgIH0sIG47XG4gIH0odik7XG59KTtcbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vZ2xvYmFsLmpzICovIFwiLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qc1wiKSkpXG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbGliL2NyeXB0by5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9saWIvY3J5cHRvLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG4vKiBXRUJQQUNLIFZBUiBJTkpFQ1RJT04gKi8oZnVuY3Rpb24obW9kdWxlKSB7dmFyIF90eXBlb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiAqLyBcIi4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzXCIpO1xuXG4vKlxuIENyeXB0b0pTIHYzLjEuMlxuIGNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qc1xuIChjKSAyMDA5LTIwMTMgYnkgSmVmZiBNb3R0LiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuIGNvZGUuZ29vZ2xlLmNvbS9wL2NyeXB0by1qcy93aWtpL0xpY2Vuc2VcbiAqL1xudmFyIENyeXB0b0pTID0gQ3J5cHRvSlMgfHwgZnVuY3Rpb24gKGcsIGwpIHtcbiAgdmFyIGUgPSB7fSxcbiAgICAgIGQgPSBlLmxpYiA9IHt9LFxuICAgICAgbSA9IGZ1bmN0aW9uIG0oKSB7fSxcbiAgICAgIGsgPSBkLkJhc2UgPSB7XG4gICAgZXh0ZW5kOiBmdW5jdGlvbiBleHRlbmQoYSkge1xuICAgICAgbS5wcm90b3R5cGUgPSB0aGlzO1xuICAgICAgdmFyIGMgPSBuZXcgbSgpO1xuICAgICAgYSAmJiBjLm1peEluKGEpO1xuICAgICAgYy5oYXNPd25Qcm9wZXJ0eShcImluaXRcIikgfHwgKGMuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYy4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfSk7XG4gICAgICBjLmluaXQucHJvdG90eXBlID0gYztcbiAgICAgIGMuJHN1cGVyID0gdGhpcztcbiAgICAgIHJldHVybiBjO1xuICAgIH0sXG4gICAgY3JlYXRlOiBmdW5jdGlvbiBjcmVhdGUoKSB7XG4gICAgICB2YXIgYSA9IHRoaXMuZXh0ZW5kKCk7XG4gICAgICBhLmluaXQuYXBwbHkoYSwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHt9LFxuICAgIG1peEluOiBmdW5jdGlvbiBtaXhJbihhKSB7XG4gICAgICBmb3IgKHZhciBjIGluIGEpIHtcbiAgICAgICAgYS5oYXNPd25Qcm9wZXJ0eShjKSAmJiAodGhpc1tjXSA9IGFbY10pO1xuICAgICAgfVxuXG4gICAgICBhLmhhc093blByb3BlcnR5KFwidG9TdHJpbmdcIikgJiYgKHRoaXMudG9TdHJpbmcgPSBhLnRvU3RyaW5nKTtcbiAgICB9LFxuICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZSgpIHtcbiAgICAgIHJldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKTtcbiAgICB9XG4gIH0sXG4gICAgICBwID0gZC5Xb3JkQXJyYXkgPSBrLmV4dGVuZCh7XG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdChhLCBjKSB7XG4gICAgICBhID0gdGhpcy53b3JkcyA9IGEgfHwgW107XG4gICAgICB0aGlzLnNpZ0J5dGVzID0gYyAhPSBsID8gYyA6IDQgKiBhLmxlbmd0aDtcbiAgICB9LFxuICAgIHRvU3RyaW5nOiBmdW5jdGlvbiB0b1N0cmluZyhhKSB7XG4gICAgICByZXR1cm4gKGEgfHwgbikuc3RyaW5naWZ5KHRoaXMpO1xuICAgIH0sXG4gICAgY29uY2F0OiBmdW5jdGlvbiBjb25jYXQoYSkge1xuICAgICAgdmFyIGMgPSB0aGlzLndvcmRzLFxuICAgICAgICAgIHEgPSBhLndvcmRzLFxuICAgICAgICAgIGYgPSB0aGlzLnNpZ0J5dGVzO1xuICAgICAgYSA9IGEuc2lnQnl0ZXM7XG4gICAgICB0aGlzLmNsYW1wKCk7XG4gICAgICBpZiAoZiAlIDQpIGZvciAodmFyIGIgPSAwOyBiIDwgYTsgYisrKSB7XG4gICAgICAgIGNbZiArIGIgPj4+IDJdIHw9IChxW2IgPj4+IDJdID4+PiAyNCAtIDggKiAoYiAlIDQpICYgMjU1KSA8PCAyNCAtIDggKiAoKGYgKyBiKSAlIDQpO1xuICAgICAgfSBlbHNlIGlmICg2NTUzNSA8IHEubGVuZ3RoKSBmb3IgKGIgPSAwOyBiIDwgYTsgYiArPSA0KSB7XG4gICAgICAgIGNbZiArIGIgPj4+IDJdID0gcVtiID4+PiAyXTtcbiAgICAgIH0gZWxzZSBjLnB1c2guYXBwbHkoYywgcSk7XG4gICAgICB0aGlzLnNpZ0J5dGVzICs9IGE7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGNsYW1wOiBmdW5jdGlvbiBjbGFtcCgpIHtcbiAgICAgIHZhciBhID0gdGhpcy53b3JkcyxcbiAgICAgICAgICBjID0gdGhpcy5zaWdCeXRlcztcbiAgICAgIGFbYyA+Pj4gMl0gJj0gNDI5NDk2NzI5NSA8PCAzMiAtIDggKiAoYyAlIDQpO1xuICAgICAgYS5sZW5ndGggPSBnLmNlaWwoYyAvIDQpO1xuICAgIH0sXG4gICAgY2xvbmU6IGZ1bmN0aW9uIGNsb25lKCkge1xuICAgICAgdmFyIGEgPSBrLmNsb25lLmNhbGwodGhpcyk7XG4gICAgICBhLndvcmRzID0gdGhpcy53b3Jkcy5zbGljZSgwKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgcmFuZG9tOiBmdW5jdGlvbiByYW5kb20oYSkge1xuICAgICAgZm9yICh2YXIgYyA9IFtdLCBiID0gMDsgYiA8IGE7IGIgKz0gNCkge1xuICAgICAgICBjLnB1c2goNDI5NDk2NzI5NiAqIGcucmFuZG9tKCkgfCAwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBwLmluaXQoYywgYSk7XG4gICAgfVxuICB9KSxcbiAgICAgIGIgPSBlLmVuYyA9IHt9LFxuICAgICAgbiA9IGIuSGV4ID0ge1xuICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gc3RyaW5naWZ5KGEpIHtcbiAgICAgIHZhciBjID0gYS53b3JkcztcbiAgICAgIGEgPSBhLnNpZ0J5dGVzO1xuXG4gICAgICBmb3IgKHZhciBiID0gW10sIGYgPSAwOyBmIDwgYTsgZisrKSB7XG4gICAgICAgIHZhciBkID0gY1tmID4+PiAyXSA+Pj4gMjQgLSA4ICogKGYgJSA0KSAmIDI1NTtcbiAgICAgICAgYi5wdXNoKChkID4+PiA0KS50b1N0cmluZygxNikpO1xuICAgICAgICBiLnB1c2goKGQgJiAxNSkudG9TdHJpbmcoMTYpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGIuam9pbihcIlwiKTtcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShhKSB7XG4gICAgICBmb3IgKHZhciBjID0gYS5sZW5ndGgsIGIgPSBbXSwgZiA9IDA7IGYgPCBjOyBmICs9IDIpIHtcbiAgICAgICAgYltmID4+PiAzXSB8PSBwYXJzZUludChhLnN1YnN0cihmLCAyKSwgMTYpIDw8IDI0IC0gNCAqIChmICUgOCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgcC5pbml0KGIsIGMgLyAyKTtcbiAgICB9XG4gIH0sXG4gICAgICBqID0gYi5MYXRpbjEgPSB7XG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoYSkge1xuICAgICAgdmFyIGMgPSBhLndvcmRzO1xuICAgICAgYSA9IGEuc2lnQnl0ZXM7XG5cbiAgICAgIGZvciAodmFyIGIgPSBbXSwgZiA9IDA7IGYgPCBhOyBmKyspIHtcbiAgICAgICAgYi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY1tmID4+PiAyXSA+Pj4gMjQgLSA4ICogKGYgJSA0KSAmIDI1NSkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYi5qb2luKFwiXCIpO1xuICAgIH0sXG4gICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGEpIHtcbiAgICAgIGZvciAodmFyIGMgPSBhLmxlbmd0aCwgYiA9IFtdLCBmID0gMDsgZiA8IGM7IGYrKykge1xuICAgICAgICBiW2YgPj4+IDJdIHw9IChhLmNoYXJDb2RlQXQoZikgJiAyNTUpIDw8IDI0IC0gOCAqIChmICUgNCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuZXcgcC5pbml0KGIsIGMpO1xuICAgIH1cbiAgfSxcbiAgICAgIGggPSBiLlV0ZjggPSB7XG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoYSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoai5zdHJpbmdpZnkoYSkpKTtcbiAgICAgIH0gY2F0Y2ggKGMpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJNYWxmb3JtZWQgVVRGLTggZGF0YVwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShhKSB7XG4gICAgICByZXR1cm4gai5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoYSkpKTtcbiAgICB9XG4gIH0sXG4gICAgICByID0gZC5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtID0gay5leHRlbmQoe1xuICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBuZXcgcC5pbml0KCk7XG4gICAgICB0aGlzLl9uRGF0YUJ5dGVzID0gMDtcbiAgICB9LFxuICAgIF9hcHBlbmQ6IGZ1bmN0aW9uIF9hcHBlbmQoYSkge1xuICAgICAgXCJzdHJpbmdcIiA9PSB0eXBlb2YgYSAmJiAoYSA9IGgucGFyc2UoYSkpO1xuXG4gICAgICB0aGlzLl9kYXRhLmNvbmNhdChhKTtcblxuICAgICAgdGhpcy5fbkRhdGFCeXRlcyArPSBhLnNpZ0J5dGVzO1xuICAgIH0sXG4gICAgX3Byb2Nlc3M6IGZ1bmN0aW9uIF9wcm9jZXNzKGEpIHtcbiAgICAgIHZhciBjID0gdGhpcy5fZGF0YSxcbiAgICAgICAgICBiID0gYy53b3JkcyxcbiAgICAgICAgICBmID0gYy5zaWdCeXRlcyxcbiAgICAgICAgICBkID0gdGhpcy5ibG9ja1NpemUsXG4gICAgICAgICAgZSA9IGYgLyAoNCAqIGQpLFxuICAgICAgICAgIGUgPSBhID8gZy5jZWlsKGUpIDogZy5tYXgoKGUgfCAwKSAtIHRoaXMuX21pbkJ1ZmZlclNpemUsIDApO1xuICAgICAgYSA9IGUgKiBkO1xuICAgICAgZiA9IGcubWluKDQgKiBhLCBmKTtcblxuICAgICAgaWYgKGEpIHtcbiAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBhOyBrICs9IGQpIHtcbiAgICAgICAgICB0aGlzLl9kb1Byb2Nlc3NCbG9jayhiLCBrKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGsgPSBiLnNwbGljZSgwLCBhKTtcbiAgICAgICAgYy5zaWdCeXRlcyAtPSBmO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IHAuaW5pdChrLCBmKTtcbiAgICB9LFxuICAgIGNsb25lOiBmdW5jdGlvbiBjbG9uZSgpIHtcbiAgICAgIHZhciBhID0gay5jbG9uZS5jYWxsKHRoaXMpO1xuICAgICAgYS5fZGF0YSA9IHRoaXMuX2RhdGEuY2xvbmUoKTtcbiAgICAgIHJldHVybiBhO1xuICAgIH0sXG4gICAgX21pbkJ1ZmZlclNpemU6IDBcbiAgfSk7XG5cbiAgZC5IYXNoZXIgPSByLmV4dGVuZCh7XG4gICAgY2ZnOiBrLmV4dGVuZCgpLFxuICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoYSkge1xuICAgICAgdGhpcy5jZmcgPSB0aGlzLmNmZy5leHRlbmQoYSk7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICByLnJlc2V0LmNhbGwodGhpcyk7XG5cbiAgICAgIHRoaXMuX2RvUmVzZXQoKTtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24gdXBkYXRlKGEpIHtcbiAgICAgIHRoaXMuX2FwcGVuZChhKTtcblxuICAgICAgdGhpcy5fcHJvY2VzcygpO1xuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9LFxuICAgIGZpbmFsaXplOiBmdW5jdGlvbiBmaW5hbGl6ZShhKSB7XG4gICAgICBhICYmIHRoaXMuX2FwcGVuZChhKTtcbiAgICAgIHJldHVybiB0aGlzLl9kb0ZpbmFsaXplKCk7XG4gICAgfSxcbiAgICBibG9ja1NpemU6IDE2LFxuICAgIF9jcmVhdGVIZWxwZXI6IGZ1bmN0aW9uIF9jcmVhdGVIZWxwZXIoYSkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uIChiLCBkKSB7XG4gICAgICAgIHJldHVybiBuZXcgYS5pbml0KGQpLmZpbmFsaXplKGIpO1xuICAgICAgfTtcbiAgICB9LFxuICAgIF9jcmVhdGVIbWFjSGVscGVyOiBmdW5jdGlvbiBfY3JlYXRlSG1hY0hlbHBlcihhKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGIsIGQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBzLkhNQUMuaW5pdChhLCBkKS5maW5hbGl6ZShiKTtcbiAgICAgIH07XG4gICAgfVxuICB9KTtcbiAgdmFyIHMgPSBlLmFsZ28gPSB7fTtcbiAgcmV0dXJuIGU7XG59KE1hdGgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZyA9IENyeXB0b0pTLFxuICAgICAgbCA9IGcubGliLFxuICAgICAgZSA9IGwuV29yZEFycmF5LFxuICAgICAgZCA9IGwuSGFzaGVyLFxuICAgICAgbSA9IFtdLFxuICAgICAgbCA9IGcuYWxnby5TSEExID0gZC5leHRlbmQoe1xuICAgIF9kb1Jlc2V0OiBmdW5jdGlvbiBfZG9SZXNldCgpIHtcbiAgICAgIHRoaXMuX2hhc2ggPSBuZXcgZS5pbml0KFsxNzMyNTg0MTkzLCA0MDIzMjMzNDE3LCAyNTYyMzgzMTAyLCAyNzE3MzM4NzgsIDMyODUzNzc1MjBdKTtcbiAgICB9LFxuICAgIF9kb1Byb2Nlc3NCbG9jazogZnVuY3Rpb24gX2RvUHJvY2Vzc0Jsb2NrKGQsIGUpIHtcbiAgICAgIGZvciAodmFyIGIgPSB0aGlzLl9oYXNoLndvcmRzLCBuID0gYlswXSwgaiA9IGJbMV0sIGggPSBiWzJdLCBnID0gYlszXSwgbCA9IGJbNF0sIGEgPSAwOyA4MCA+IGE7IGErKykge1xuICAgICAgICBpZiAoMTYgPiBhKSBtW2FdID0gZFtlICsgYV0gfCAwO2Vsc2Uge1xuICAgICAgICAgIHZhciBjID0gbVthIC0gM10gXiBtW2EgLSA4XSBeIG1bYSAtIDE0XSBeIG1bYSAtIDE2XTtcbiAgICAgICAgICBtW2FdID0gYyA8PCAxIHwgYyA+Pj4gMzE7XG4gICAgICAgIH1cbiAgICAgICAgYyA9IChuIDw8IDUgfCBuID4+PiAyNykgKyBsICsgbVthXTtcbiAgICAgICAgYyA9IDIwID4gYSA/IGMgKyAoKGogJiBoIHwgfmogJiBnKSArIDE1MTg1MDAyNDkpIDogNDAgPiBhID8gYyArICgoaiBeIGggXiBnKSArIDE4NTk3NzUzOTMpIDogNjAgPiBhID8gYyArICgoaiAmIGggfCBqICYgZyB8IGggJiBnKSAtIDE4OTQwMDc1ODgpIDogYyArICgoaiBeIGggXiBnKSAtIDg5OTQ5NzUxNCk7XG4gICAgICAgIGwgPSBnO1xuICAgICAgICBnID0gaDtcbiAgICAgICAgaCA9IGogPDwgMzAgfCBqID4+PiAyO1xuICAgICAgICBqID0gbjtcbiAgICAgICAgbiA9IGM7XG4gICAgICB9XG5cbiAgICAgIGJbMF0gPSBiWzBdICsgbiB8IDA7XG4gICAgICBiWzFdID0gYlsxXSArIGogfCAwO1xuICAgICAgYlsyXSA9IGJbMl0gKyBoIHwgMDtcbiAgICAgIGJbM10gPSBiWzNdICsgZyB8IDA7XG4gICAgICBiWzRdID0gYls0XSArIGwgfCAwO1xuICAgIH0sXG4gICAgX2RvRmluYWxpemU6IGZ1bmN0aW9uIF9kb0ZpbmFsaXplKCkge1xuICAgICAgdmFyIGQgPSB0aGlzLl9kYXRhLFxuICAgICAgICAgIGUgPSBkLndvcmRzLFxuICAgICAgICAgIGIgPSA4ICogdGhpcy5fbkRhdGFCeXRlcyxcbiAgICAgICAgICBnID0gOCAqIGQuc2lnQnl0ZXM7XG4gICAgICBlW2cgPj4+IDVdIHw9IDEyOCA8PCAyNCAtIGcgJSAzMjtcbiAgICAgIGVbKGcgKyA2NCA+Pj4gOSA8PCA0KSArIDE0XSA9IE1hdGguZmxvb3IoYiAvIDQyOTQ5NjcyOTYpO1xuICAgICAgZVsoZyArIDY0ID4+PiA5IDw8IDQpICsgMTVdID0gYjtcbiAgICAgIGQuc2lnQnl0ZXMgPSA0ICogZS5sZW5ndGg7XG5cbiAgICAgIHRoaXMuX3Byb2Nlc3MoKTtcblxuICAgICAgcmV0dXJuIHRoaXMuX2hhc2g7XG4gICAgfSxcbiAgICBjbG9uZTogZnVuY3Rpb24gY2xvbmUoKSB7XG4gICAgICB2YXIgZSA9IGQuY2xvbmUuY2FsbCh0aGlzKTtcbiAgICAgIGUuX2hhc2ggPSB0aGlzLl9oYXNoLmNsb25lKCk7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gIH0pO1xuICBnLlNIQTEgPSBkLl9jcmVhdGVIZWxwZXIobCk7XG4gIGcuSG1hY1NIQTEgPSBkLl9jcmVhdGVIbWFjSGVscGVyKGwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGcgPSBDcnlwdG9KUyxcbiAgICAgIGwgPSBnLmVuYy5VdGY4O1xuICBnLmFsZ28uSE1BQyA9IGcubGliLkJhc2UuZXh0ZW5kKHtcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KGUsIGQpIHtcbiAgICAgIGUgPSB0aGlzLl9oYXNoZXIgPSBuZXcgZS5pbml0KCk7XG4gICAgICBcInN0cmluZ1wiID09IHR5cGVvZiBkICYmIChkID0gbC5wYXJzZShkKSk7XG4gICAgICB2YXIgZyA9IGUuYmxvY2tTaXplLFxuICAgICAgICAgIGsgPSA0ICogZztcbiAgICAgIGQuc2lnQnl0ZXMgPiBrICYmIChkID0gZS5maW5hbGl6ZShkKSk7XG4gICAgICBkLmNsYW1wKCk7XG5cbiAgICAgIGZvciAodmFyIHAgPSB0aGlzLl9vS2V5ID0gZC5jbG9uZSgpLCBiID0gdGhpcy5faUtleSA9IGQuY2xvbmUoKSwgbiA9IHAud29yZHMsIGogPSBiLndvcmRzLCBoID0gMDsgaCA8IGc7IGgrKykge1xuICAgICAgICBuW2hdIF49IDE1NDk1NTY4MjgsIGpbaF0gXj0gOTA5NTIyNDg2O1xuICAgICAgfVxuXG4gICAgICBwLnNpZ0J5dGVzID0gYi5zaWdCeXRlcyA9IGs7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICB2YXIgZSA9IHRoaXMuX2hhc2hlcjtcbiAgICAgIGUucmVzZXQoKTtcbiAgICAgIGUudXBkYXRlKHRoaXMuX2lLZXkpO1xuICAgIH0sXG4gICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoZSkge1xuICAgICAgdGhpcy5faGFzaGVyLnVwZGF0ZShlKTtcblxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBmaW5hbGl6ZTogZnVuY3Rpb24gZmluYWxpemUoZSkge1xuICAgICAgdmFyIGQgPSB0aGlzLl9oYXNoZXI7XG4gICAgICBlID0gZC5maW5hbGl6ZShlKTtcbiAgICAgIGQucmVzZXQoKTtcbiAgICAgIHJldHVybiBkLmZpbmFsaXplKHRoaXMuX29LZXkuY2xvbmUoKS5jb25jYXQoZSkpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBTaG9ydGN1dHNcbiAgdmFyIEMgPSBDcnlwdG9KUztcbiAgdmFyIENfbGliID0gQy5saWI7XG4gIHZhciBXb3JkQXJyYXkgPSBDX2xpYi5Xb3JkQXJyYXk7XG4gIHZhciBDX2VuYyA9IEMuZW5jO1xuICAvKipcbiAgICogQmFzZTY0IGVuY29kaW5nIHN0cmF0ZWd5LlxuICAgKi9cblxuICB2YXIgQmFzZTY0ID0gQ19lbmMuQmFzZTY0ID0ge1xuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgd29yZCBhcnJheSB0byBhIEJhc2U2NCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1dvcmRBcnJheX0gd29yZEFycmF5IFRoZSB3b3JkIGFycmF5LlxuICAgICAqXG4gICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgQmFzZTY0IHN0cmluZy5cbiAgICAgKlxuICAgICAqIEBzdGF0aWNcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICpcbiAgICAgKiAgICAgdmFyIGJhc2U2NFN0cmluZyA9IENyeXB0b0pTLmVuYy5CYXNlNjQuc3RyaW5naWZ5KHdvcmRBcnJheSk7XG4gICAgICovXG4gICAgc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkod29yZEFycmF5KSB7XG4gICAgICAvLyBTaG9ydGN1dHNcbiAgICAgIHZhciB3b3JkcyA9IHdvcmRBcnJheS53b3JkcztcbiAgICAgIHZhciBzaWdCeXRlcyA9IHdvcmRBcnJheS5zaWdCeXRlcztcbiAgICAgIHZhciBtYXAgPSB0aGlzLl9tYXA7IC8vIENsYW1wIGV4Y2VzcyBiaXRzXG5cbiAgICAgIHdvcmRBcnJheS5jbGFtcCgpOyAvLyBDb252ZXJ0XG5cbiAgICAgIHZhciBiYXNlNjRDaGFycyA9IFtdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpZ0J5dGVzOyBpICs9IDMpIHtcbiAgICAgICAgdmFyIGJ5dGUxID0gd29yZHNbaSA+Pj4gMl0gPj4+IDI0IC0gaSAlIDQgKiA4ICYgMHhmZjtcbiAgICAgICAgdmFyIGJ5dGUyID0gd29yZHNbaSArIDEgPj4+IDJdID4+PiAyNCAtIChpICsgMSkgJSA0ICogOCAmIDB4ZmY7XG4gICAgICAgIHZhciBieXRlMyA9IHdvcmRzW2kgKyAyID4+PiAyXSA+Pj4gMjQgLSAoaSArIDIpICUgNCAqIDggJiAweGZmO1xuICAgICAgICB2YXIgdHJpcGxldCA9IGJ5dGUxIDw8IDE2IHwgYnl0ZTIgPDwgOCB8IGJ5dGUzO1xuXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNCAmJiBpICsgaiAqIDAuNzUgPCBzaWdCeXRlczsgaisrKSB7XG4gICAgICAgICAgYmFzZTY0Q2hhcnMucHVzaChtYXAuY2hhckF0KHRyaXBsZXQgPj4+IDYgKiAoMyAtIGopICYgMHgzZikpO1xuICAgICAgICB9XG4gICAgICB9IC8vIEFkZCBwYWRkaW5nXG5cblxuICAgICAgdmFyIHBhZGRpbmdDaGFyID0gbWFwLmNoYXJBdCg2NCk7XG5cbiAgICAgIGlmIChwYWRkaW5nQ2hhcikge1xuICAgICAgICB3aGlsZSAoYmFzZTY0Q2hhcnMubGVuZ3RoICUgNCkge1xuICAgICAgICAgIGJhc2U2NENoYXJzLnB1c2gocGFkZGluZ0NoYXIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBiYXNlNjRDaGFycy5qb2luKCcnKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBCYXNlNjQgc3RyaW5nIHRvIGEgd29yZCBhcnJheS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjRTdHIgVGhlIEJhc2U2NCBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtXb3JkQXJyYXl9IFRoZSB3b3JkIGFycmF5LlxuICAgICAqXG4gICAgICogQHN0YXRpY1xuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKlxuICAgICAqICAgICB2YXIgd29yZEFycmF5ID0gQ3J5cHRvSlMuZW5jLkJhc2U2NC5wYXJzZShiYXNlNjRTdHJpbmcpO1xuICAgICAqL1xuICAgIHBhcnNlOiBmdW5jdGlvbiBwYXJzZShiYXNlNjRTdHIpIHtcbiAgICAgIC8vIFNob3J0Y3V0c1xuICAgICAgdmFyIGJhc2U2NFN0ckxlbmd0aCA9IGJhc2U2NFN0ci5sZW5ndGg7XG4gICAgICB2YXIgbWFwID0gdGhpcy5fbWFwOyAvLyBJZ25vcmUgcGFkZGluZ1xuXG4gICAgICB2YXIgcGFkZGluZ0NoYXIgPSBtYXAuY2hhckF0KDY0KTtcblxuICAgICAgaWYgKHBhZGRpbmdDaGFyKSB7XG4gICAgICAgIHZhciBwYWRkaW5nSW5kZXggPSBiYXNlNjRTdHIuaW5kZXhPZihwYWRkaW5nQ2hhcik7XG5cbiAgICAgICAgaWYgKHBhZGRpbmdJbmRleCAhPSAtMSkge1xuICAgICAgICAgIGJhc2U2NFN0ckxlbmd0aCA9IHBhZGRpbmdJbmRleDtcbiAgICAgICAgfVxuICAgICAgfSAvLyBDb252ZXJ0XG5cblxuICAgICAgdmFyIHdvcmRzID0gW107XG4gICAgICB2YXIgbkJ5dGVzID0gMDtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiYXNlNjRTdHJMZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaSAlIDQpIHtcbiAgICAgICAgICB2YXIgYml0czEgPSBtYXAuaW5kZXhPZihiYXNlNjRTdHIuY2hhckF0KGkgLSAxKSkgPDwgaSAlIDQgKiAyO1xuICAgICAgICAgIHZhciBiaXRzMiA9IG1hcC5pbmRleE9mKGJhc2U2NFN0ci5jaGFyQXQoaSkpID4+PiA2IC0gaSAlIDQgKiAyO1xuICAgICAgICAgIHdvcmRzW25CeXRlcyA+Pj4gMl0gfD0gKGJpdHMxIHwgYml0czIpIDw8IDI0IC0gbkJ5dGVzICUgNCAqIDg7XG4gICAgICAgICAgbkJ5dGVzKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFdvcmRBcnJheS5jcmVhdGUod29yZHMsIG5CeXRlcyk7XG4gICAgfSxcbiAgICBfbWFwOiAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nXG4gIH07XG59KSgpO1xuXG5pZiAoKCBmYWxzZSA/IHVuZGVmaW5lZCA6IF90eXBlb2YobW9kdWxlKSkgPT09ICdvYmplY3QnKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gQ3J5cHRvSlM7XG59IGVsc2Uge1xuICB3aW5kb3cuQ3J5cHRvSlMgPSBDcnlwdG9KUztcbn1cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqL30uY2FsbCh0aGlzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLy4uL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vbW9kdWxlLmpzICovIFwiLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL21vZHVsZS5qc1wiKShtb2R1bGUpKSlcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9saWIvanNvbjJ4bWwuanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9saWIvanNvbjJ4bWwuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxudmFyIF90eXBlb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiAqLyBcIi4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzXCIpO1xuXG4vL2NvcHlyaWdodCBSeWFuIERheSAyMDEwIDxodHRwOi8vcnlhbmRheS5vcmc+LCBKb3NjaGEgRmV0aCAyMDEzIDxodHRwOi8vd3d3LmZldGguY29tPiBbTUlUIExpY2Vuc2VkXVxudmFyIGVsZW1lbnRfc3RhcnRfY2hhciA9IFwiYS16QS1aX1xceEMwLVxceEQ2XFx4RDgtXFx4RjZcXHhGOC1cXHhGRlxcdTAzNzAtXFx1MDM3RFxcdTAzN0YtXFx1MUZGRlxcdTIwMEMtXFx1MjAwRFxcdTIwNzAtXFx1MjE4RlxcdTJDMDAtXFx1MkZGRlxcdTMwMDEtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZGRFwiO1xudmFyIGVsZW1lbnRfbm9uX3N0YXJ0X2NoYXIgPSBcIi0uMC05XFx4QjdcXHUwMzAwLVxcdTAzNkZcXHUyMDNGXFx1MjA0MFwiO1xudmFyIGVsZW1lbnRfcmVwbGFjZSA9IG5ldyBSZWdFeHAoXCJeKFteXCIgKyBlbGVtZW50X3N0YXJ0X2NoYXIgKyBcIl0pfF4oKHh8WCkobXxNKShsfEwpKXwoW15cIiArIGVsZW1lbnRfc3RhcnRfY2hhciArIGVsZW1lbnRfbm9uX3N0YXJ0X2NoYXIgKyBcIl0pXCIsIFwiZ1wiKTtcbnZhciBub3Rfc2FmZV9pbl94bWwgPSAvW15cXHgwOVxceDBBXFx4MERcXHgyMC1cXHhGRlxceDg1XFx4QTAtXFx1RDdGRlxcdUUwMDAtXFx1RkRDRlxcdUZERTAtXFx1RkZGRF0vZ207XG5cbnZhciBvYmpLZXlzID0gZnVuY3Rpb24gb2JqS2V5cyhvYmopIHtcbiAgdmFyIGwgPSBbXTtcblxuICBpZiAob2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgZm9yICh2YXIgayBpbiBvYmopIHtcbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgbC5wdXNoKGspO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsO1xufTtcblxudmFyIHByb2Nlc3NfdG9feG1sID0gZnVuY3Rpb24gcHJvY2Vzc190b194bWwobm9kZV9kYXRhLCBvcHRpb25zKSB7XG4gIHZhciBtYWtlTm9kZSA9IGZ1bmN0aW9uIG1ha2VOb2RlKG5hbWUsIGNvbnRlbnQsIGF0dHJpYnV0ZXMsIGxldmVsLCBoYXNTdWJOb2Rlcykge1xuICAgIHZhciBpbmRlbnRfdmFsdWUgPSBvcHRpb25zLmluZGVudCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5pbmRlbnQgOiBcIlxcdFwiO1xuICAgIHZhciBpbmRlbnQgPSBvcHRpb25zLnByZXR0eVByaW50ID8gJ1xcbicgKyBuZXcgQXJyYXkobGV2ZWwpLmpvaW4oaW5kZW50X3ZhbHVlKSA6ICcnO1xuXG4gICAgaWYgKG9wdGlvbnMucmVtb3ZlSWxsZWdhbE5hbWVDaGFyYWN0ZXJzKSB7XG4gICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKGVsZW1lbnRfcmVwbGFjZSwgJ18nKTtcbiAgICB9XG5cbiAgICB2YXIgbm9kZSA9IFtpbmRlbnQsICc8JywgbmFtZSwgYXR0cmlidXRlcyB8fCAnJ107XG5cbiAgICBpZiAoY29udGVudCAmJiBjb250ZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgIG5vZGUucHVzaCgnPicpO1xuICAgICAgbm9kZS5wdXNoKGNvbnRlbnQpO1xuICAgICAgaGFzU3ViTm9kZXMgJiYgbm9kZS5wdXNoKGluZGVudCk7XG4gICAgICBub2RlLnB1c2goJzwvJyk7XG4gICAgICBub2RlLnB1c2gobmFtZSk7XG4gICAgICBub2RlLnB1c2goJz4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm9kZS5wdXNoKCcvPicpO1xuICAgIH1cblxuICAgIHJldHVybiBub2RlLmpvaW4oJycpO1xuICB9O1xuXG4gIHJldHVybiBmdW5jdGlvbiBmbihub2RlX2RhdGEsIG5vZGVfZGVzY3JpcHRvciwgbGV2ZWwpIHtcbiAgICB2YXIgdHlwZSA9IF90eXBlb2Yobm9kZV9kYXRhKTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5ID8gQXJyYXkuaXNBcnJheShub2RlX2RhdGEpIDogbm9kZV9kYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHR5cGUgPSAnYXJyYXknO1xuICAgIH0gZWxzZSBpZiAobm9kZV9kYXRhIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgdHlwZSA9ICdkYXRlJztcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIC8vaWYgdmFsdWUgaXMgYW4gYXJyYXkgY3JlYXRlIGNoaWxkIG5vZGVzIGZyb20gdmFsdWVzXG4gICAgICBjYXNlICdhcnJheSc6XG4gICAgICAgIHZhciByZXQgPSBbXTtcbiAgICAgICAgbm9kZV9kYXRhLm1hcChmdW5jdGlvbiAodikge1xuICAgICAgICAgIHJldC5wdXNoKGZuKHYsIDEsIGxldmVsICsgMSkpOyAvL2VudHJpZXMgdGhhdCBhcmUgdmFsdWVzIG9mIGFuIGFycmF5IGFyZSB0aGUgb25seSBvbmVzIHRoYXQgY2FuIGJlIHNwZWNpYWwgbm9kZSBkZXNjcmlwdG9yc1xuICAgICAgICB9KTtcbiAgICAgICAgb3B0aW9ucy5wcmV0dHlQcmludCAmJiByZXQucHVzaCgnXFxuJyk7XG4gICAgICAgIHJldHVybiByZXQuam9pbignJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdkYXRlJzpcbiAgICAgICAgLy8gY2FzdCBkYXRlcyB0byBJU08gODYwMSBkYXRlIChzb2FwIGxpa2VzIGl0KVxuICAgICAgICByZXR1cm4gbm9kZV9kYXRhLnRvSlNPTiA/IG5vZGVfZGF0YS50b0pTT04oKSA6IG5vZGVfZGF0YSArICcnO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgICAgdmFyIG5vZGVzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgbmFtZSBpbiBub2RlX2RhdGEpIHtcbiAgICAgICAgICBpZiAobm9kZV9kYXRhLmhhc093blByb3BlcnR5KG5hbWUpKSB7XG4gICAgICAgICAgICBpZiAobm9kZV9kYXRhW25hbWVdIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBub2RlX2RhdGFbbmFtZV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobm9kZV9kYXRhW25hbWVdLmhhc093blByb3BlcnR5KGopKSB7XG4gICAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKG1ha2VOb2RlKG5hbWUsIGZuKG5vZGVfZGF0YVtuYW1lXVtqXSwgMCwgbGV2ZWwgKyAxKSwgbnVsbCwgbGV2ZWwgKyAxLCBvYmpLZXlzKG5vZGVfZGF0YVtuYW1lXVtqXSkubGVuZ3RoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBub2Rlcy5wdXNoKG1ha2VOb2RlKG5hbWUsIGZuKG5vZGVfZGF0YVtuYW1lXSwgMCwgbGV2ZWwgKyAxKSwgbnVsbCwgbGV2ZWwgKyAxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgb3B0aW9ucy5wcmV0dHlQcmludCAmJiBub2Rlcy5sZW5ndGggPiAwICYmIG5vZGVzLnB1c2goJ1xcbicpO1xuICAgICAgICByZXR1cm4gbm9kZXMuam9pbignJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgIHJldHVybiBub2RlX2RhdGEoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBvcHRpb25zLmVzY2FwZSA/IGVzYyhub2RlX2RhdGEpIDogJycgKyBub2RlX2RhdGE7XG4gICAgfVxuICB9KG5vZGVfZGF0YSwgMCwgMCk7XG59O1xuXG52YXIgeG1sX2hlYWRlciA9IGZ1bmN0aW9uIHhtbF9oZWFkZXIoc3RhbmRhbG9uZSkge1xuICB2YXIgcmV0ID0gWyc8P3htbCB2ZXJzaW9uPVwiMS4wXCIgZW5jb2Rpbmc9XCJVVEYtOFwiJ107XG5cbiAgaWYgKHN0YW5kYWxvbmUpIHtcbiAgICByZXQucHVzaCgnIHN0YW5kYWxvbmU9XCJ5ZXNcIicpO1xuICB9XG5cbiAgcmV0LnB1c2goJz8+Jyk7XG4gIHJldHVybiByZXQuam9pbignJyk7XG59O1xuXG5mdW5jdGlvbiBlc2Moc3RyKSB7XG4gIHJldHVybiAoJycgKyBzdHIpLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKS5yZXBsYWNlKC8nL2csICcmYXBvczsnKS5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7JykucmVwbGFjZShub3Rfc2FmZV9pbl94bWwsICcnKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob2JqLCBvcHRpb25zKSB7XG4gIGlmICghb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSB7XG4gICAgICB4bWxIZWFkZXI6IHtcbiAgICAgICAgc3RhbmRhbG9uZTogdHJ1ZVxuICAgICAgfSxcbiAgICAgIHByZXR0eVByaW50OiB0cnVlLFxuICAgICAgaW5kZW50OiBcIiAgXCIsXG4gICAgICBlc2NhcGU6IHRydWVcbiAgICB9O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBvYmogPT0gJ3N0cmluZycpIHtcbiAgICB0cnkge1xuICAgICAgb2JqID0gSlNPTi5wYXJzZShvYmoudG9TdHJpbmcoKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHZhciB4bWxoZWFkZXIgPSAnJztcbiAgdmFyIGRvY1R5cGUgPSAnJztcblxuICBpZiAob3B0aW9ucykge1xuICAgIGlmIChfdHlwZW9mKG9wdGlvbnMpID09ICdvYmplY3QnKSB7XG4gICAgICAvLyBvdXIgY29uZmlnIGlzIGFuIG9iamVjdFxuICAgICAgaWYgKG9wdGlvbnMueG1sSGVhZGVyKSB7XG4gICAgICAgIC8vIHRoZSB1c2VyIHdhbnRzIGFuIHhtbCBoZWFkZXJcbiAgICAgICAgeG1saGVhZGVyID0geG1sX2hlYWRlcighIW9wdGlvbnMueG1sSGVhZGVyLnN0YW5kYWxvbmUpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMuZG9jVHlwZSAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICBkb2NUeXBlID0gJzwhRE9DVFlQRSAnICsgb3B0aW9ucy5kb2NUeXBlICsgJz4nO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBvdXIgY29uZmlnIGlzIGEgYm9vbGVhbiB2YWx1ZSwgc28ganVzdCBhZGQgeG1sIGhlYWRlclxuICAgICAgeG1saGVhZGVyID0geG1sX2hlYWRlcigpO1xuICAgIH1cbiAgfVxuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICB2YXIgcmV0ID0gW3htbGhlYWRlciwgb3B0aW9ucy5wcmV0dHlQcmludCAmJiBkb2NUeXBlID8gJ1xcbicgOiAnJywgZG9jVHlwZSwgcHJvY2Vzc190b194bWwob2JqLCBvcHRpb25zKV07XG4gIHJldHVybiByZXQuam9pbignJykucmVwbGFjZSgvXFxuezIsfS9nLCAnXFxuJykucmVwbGFjZSgvXFxzKyQvZywgJycpO1xufTtcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9saWIvbWQ1LmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKiEqXFxcbiAgISoqKiAuL2xpYi9tZDUuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzLCBnbG9iYWwsIG1vZHVsZSkge3ZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzt2YXIgX3R5cGVvZiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIEBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mICovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanNcIik7XG5cbi8qIGh0dHBzOi8vZ2l0aHViLmNvbS9lbW4xNzgvanMtbWQ1ICovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIEVSUk9SID0gJ2lucHV0IGlzIGludmFsaWQgdHlwZSc7XG4gIHZhciBXSU5ET1cgPSAodHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKHdpbmRvdykpID09PSAnb2JqZWN0JztcbiAgdmFyIHJvb3QgPSBXSU5ET1cgPyB3aW5kb3cgOiB7fTtcblxuICBpZiAocm9vdC5KU19NRDVfTk9fV0lORE9XKSB7XG4gICAgV0lORE9XID0gZmFsc2U7XG4gIH1cblxuICB2YXIgV0VCX1dPUktFUiA9ICFXSU5ET1cgJiYgKHR5cGVvZiBzZWxmID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2Yoc2VsZikpID09PSAnb2JqZWN0JztcbiAgdmFyIE5PREVfSlMgPSAhcm9vdC5KU19NRDVfTk9fTk9ERV9KUyAmJiAodHlwZW9mIHByb2Nlc3MgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihwcm9jZXNzKSkgPT09ICdvYmplY3QnICYmIHByb2Nlc3MudmVyc2lvbnMgJiYgcHJvY2Vzcy52ZXJzaW9ucy5ub2RlO1xuXG4gIGlmIChOT0RFX0pTKSB7XG4gICAgcm9vdCA9IGdsb2JhbDtcbiAgfSBlbHNlIGlmIChXRUJfV09SS0VSKSB7XG4gICAgcm9vdCA9IHNlbGY7XG4gIH1cblxuICB2YXIgQ09NTU9OX0pTID0gIXJvb3QuSlNfTUQ1X05PX0NPTU1PTl9KUyAmJiAoIGZhbHNlID8gdW5kZWZpbmVkIDogX3R5cGVvZihtb2R1bGUpKSA9PT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHM7XG4gIHZhciBBTUQgPSAgdHJ1ZSAmJiBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAhd2VicGFjayBhbWQgb3B0aW9ucyAqLyBcIi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9hbWQtb3B0aW9ucy5qc1wiKTtcbiAgdmFyIEFSUkFZX0JVRkZFUiA9ICFyb290LkpTX01ENV9OT19BUlJBWV9CVUZGRVIgJiYgdHlwZW9mIEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJztcbiAgdmFyIEhFWF9DSEFSUyA9ICcwMTIzNDU2Nzg5YWJjZGVmJy5zcGxpdCgnJyk7XG4gIHZhciBFWFRSQSA9IFsxMjgsIDMyNzY4LCA4Mzg4NjA4LCAtMjE0NzQ4MzY0OF07XG4gIHZhciBTSElGVCA9IFswLCA4LCAxNiwgMjRdO1xuICB2YXIgT1VUUFVUX1RZUEVTID0gWydoZXgnLCAnYXJyYXknLCAnZGlnZXN0JywgJ2J1ZmZlcicsICdhcnJheUJ1ZmZlcicsICdiYXNlNjQnXTtcbiAgdmFyIEJBU0U2NF9FTkNPREVfQ0hBUiA9ICdBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvJy5zcGxpdCgnJyk7XG4gIHZhciBibG9ja3MgPSBbXSxcbiAgICAgIGJ1ZmZlcjg7XG5cbiAgaWYgKEFSUkFZX0JVRkZFUikge1xuICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoNjgpO1xuICAgIGJ1ZmZlcjggPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgIGJsb2NrcyA9IG5ldyBVaW50MzJBcnJheShidWZmZXIpO1xuICB9XG5cbiAgaWYgKHJvb3QuSlNfTUQ1X05PX05PREVfSlMgfHwgIUFycmF5LmlzQXJyYXkpIHtcbiAgICBBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24gKG9iaikge1xuICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nO1xuICAgIH07XG4gIH1cblxuICBpZiAoQVJSQVlfQlVGRkVSICYmIChyb290LkpTX01ENV9OT19BUlJBWV9CVUZGRVJfSVNfVklFVyB8fCAhQXJyYXlCdWZmZXIuaXNWaWV3KSkge1xuICAgIEFycmF5QnVmZmVyLmlzVmlldyA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHJldHVybiBfdHlwZW9mKG9iaikgPT09ICdvYmplY3QnICYmIG9iai5idWZmZXIgJiYgb2JqLmJ1ZmZlci5jb25zdHJ1Y3RvciA9PT0gQXJyYXlCdWZmZXI7XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogQG1ldGhvZCBoZXhcbiAgICogQG1lbWJlcm9mIG1kNVxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgaGV4IHN0cmluZ1xuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBIZXggc3RyaW5nXG4gICAqIEBleGFtcGxlXG4gICAqIG1kNS5oZXgoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICogLy8gZXF1YWwgdG9cbiAgICogbWQ1KCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XG4gICAqL1xuXG4gIC8qKlxuICAgKiBAbWV0aG9kIGRpZ2VzdFxuICAgKiBAbWVtYmVyb2YgbWQ1XG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBieXRlcyBhcnJheVxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxuICAgKiBAcmV0dXJucyB7QXJyYXl9IEJ5dGVzIGFycmF5XG4gICAqIEBleGFtcGxlXG4gICAqIG1kNS5kaWdlc3QoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICovXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXJyYXlcbiAgICogQG1lbWJlcm9mIG1kNVxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgYnl0ZXMgYXJyYXlcbiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcbiAgICogQHJldHVybnMge0FycmF5fSBCeXRlcyBhcnJheVxuICAgKiBAZXhhbXBsZVxuICAgKiBtZDUuYXJyYXkoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICovXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYXJyYXlCdWZmZXJcbiAgICogQG1lbWJlcm9mIG1kNVxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgQXJyYXlCdWZmZXJcbiAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcbiAgICogQHJldHVybnMge0FycmF5QnVmZmVyfSBBcnJheUJ1ZmZlclxuICAgKiBAZXhhbXBsZVxuICAgKiBtZDUuYXJyYXlCdWZmZXIoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICovXG5cbiAgLyoqXG4gICAqIEBtZXRob2QgYnVmZmVyXG4gICAqIEBkZXByZWNhdGVkIFRoaXMgbWF5YmUgY29uZnVzZSB3aXRoIEJ1ZmZlciBpbiBub2RlLmpzLiBQbGVhc2UgdXNlIGFycmF5QnVmZmVyIGluc3RlYWQuXG4gICAqIEBtZW1iZXJvZiBtZDVcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIEFycmF5QnVmZmVyXG4gICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fFVpbnQ4QXJyYXl8QXJyYXlCdWZmZXJ9IG1lc3NhZ2UgbWVzc2FnZSB0byBoYXNoXG4gICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gQXJyYXlCdWZmZXJcbiAgICogQGV4YW1wbGVcbiAgICogbWQ1LmJ1ZmZlcignVGhlIHF1aWNrIGJyb3duIGZveCBqdW1wcyBvdmVyIHRoZSBsYXp5IGRvZycpO1xuICAgKi9cblxuICAvKipcbiAgICogQG1ldGhvZCBiYXNlNjRcbiAgICogQG1lbWJlcm9mIG1kNVxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgYmFzZTY0IHN0cmluZ1xuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBiYXNlNjQgc3RyaW5nXG4gICAqIEBleGFtcGxlXG4gICAqIG1kNS5iYXNlNjQoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICovXG5cblxuICB2YXIgY3JlYXRlT3V0cHV0TWV0aG9kID0gZnVuY3Rpb24gY3JlYXRlT3V0cHV0TWV0aG9kKG91dHB1dFR5cGUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKG1lc3NhZ2UsIGlzQmluU3RyKSB7XG4gICAgICByZXR1cm4gbmV3IE1kNSh0cnVlKS51cGRhdGUobWVzc2FnZSwgaXNCaW5TdHIpW291dHB1dFR5cGVdKCk7XG4gICAgfTtcbiAgfTtcbiAgLyoqXG4gICAqIEBtZXRob2QgY3JlYXRlXG4gICAqIEBtZW1iZXJvZiBtZDVcbiAgICogQGRlc2NyaXB0aW9uIENyZWF0ZSBNZDUgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtNZDV9IE1kNSBvYmplY3QuXG4gICAqIEBleGFtcGxlXG4gICAqIHZhciBoYXNoID0gbWQ1LmNyZWF0ZSgpO1xuICAgKi9cblxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVcbiAgICogQG1lbWJlcm9mIG1kNVxuICAgKiBAZGVzY3JpcHRpb24gQ3JlYXRlIGFuZCB1cGRhdGUgTWQ1IG9iamVjdFxuICAgKiBAcGFyYW0ge1N0cmluZ3xBcnJheXxVaW50OEFycmF5fEFycmF5QnVmZmVyfSBtZXNzYWdlIG1lc3NhZ2UgdG8gaGFzaFxuICAgKiBAcmV0dXJucyB7TWQ1fSBNZDUgb2JqZWN0LlxuICAgKiBAZXhhbXBsZVxuICAgKiB2YXIgaGFzaCA9IG1kNS51cGRhdGUoJ1RoZSBxdWljayBicm93biBmb3gganVtcHMgb3ZlciB0aGUgbGF6eSBkb2cnKTtcbiAgICogLy8gZXF1YWwgdG9cbiAgICogdmFyIGhhc2ggPSBtZDUuY3JlYXRlKCk7XG4gICAqIGhhc2gudXBkYXRlKCdUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9nJyk7XG4gICAqL1xuXG5cbiAgdmFyIGNyZWF0ZU1ldGhvZCA9IGZ1bmN0aW9uIGNyZWF0ZU1ldGhvZCgpIHtcbiAgICB2YXIgbWV0aG9kID0gY3JlYXRlT3V0cHV0TWV0aG9kKCdoZXgnKTtcblxuICAgIGlmIChOT0RFX0pTKSB7XG4gICAgICBtZXRob2QgPSBub2RlV3JhcChtZXRob2QpO1xuICAgIH1cblxuICAgIG1ldGhvZC5nZXRDdHggPSBtZXRob2QuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG5ldyBNZDUoKTtcbiAgICB9O1xuXG4gICAgbWV0aG9kLnVwZGF0ZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICByZXR1cm4gbWV0aG9kLmNyZWF0ZSgpLnVwZGF0ZShtZXNzYWdlKTtcbiAgICB9O1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBPVVRQVVRfVFlQRVMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciB0eXBlID0gT1VUUFVUX1RZUEVTW2ldO1xuICAgICAgbWV0aG9kW3R5cGVdID0gY3JlYXRlT3V0cHV0TWV0aG9kKHR5cGUpO1xuICAgIH1cblxuICAgIHJldHVybiBtZXRob2Q7XG4gIH07XG5cbiAgdmFyIG5vZGVXcmFwID0gZnVuY3Rpb24gbm9kZVdyYXAobWV0aG9kKSB7XG4gICAgdmFyIGNyeXB0byA9IGV2YWwoXCJyZXF1aXJlKCdjcnlwdG8nKVwiKTtcbiAgICB2YXIgQnVmZmVyID0gZXZhbChcInJlcXVpcmUoJ2J1ZmZlcicpLkJ1ZmZlclwiKTtcblxuICAgIHZhciBub2RlTWV0aG9kID0gZnVuY3Rpb24gbm9kZU1ldGhvZChtZXNzYWdlKSB7XG4gICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiBjcnlwdG8uY3JlYXRlSGFzaCgnbWQ1JykudXBkYXRlKG1lc3NhZ2UsICd1dGY4JykuZGlnZXN0KCdoZXgnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChtZXNzYWdlID09PSBudWxsIHx8IG1lc3NhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRocm93IEVSUk9SO1xuICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2UuY29uc3RydWN0b3IgPT09IEFycmF5QnVmZmVyKSB7XG4gICAgICAgICAgbWVzc2FnZSA9IG5ldyBVaW50OEFycmF5KG1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KG1lc3NhZ2UpIHx8IEFycmF5QnVmZmVyLmlzVmlldyhtZXNzYWdlKSB8fCBtZXNzYWdlLmNvbnN0cnVjdG9yID09PSBCdWZmZXIpIHtcbiAgICAgICAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdtZDUnKS51cGRhdGUobmV3IEJ1ZmZlcihtZXNzYWdlKSkuZGlnZXN0KCdoZXgnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBtZXRob2QobWVzc2FnZSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBub2RlTWV0aG9kO1xuICB9O1xuICAvKipcbiAgICogTWQ1IGNsYXNzXG4gICAqIEBjbGFzcyBNZDVcbiAgICogQGRlc2NyaXB0aW9uIFRoaXMgaXMgaW50ZXJuYWwgY2xhc3MuXG4gICAqIEBzZWUge0BsaW5rIG1kNS5jcmVhdGV9XG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gTWQ1KHNoYXJlZE1lbW9yeSkge1xuICAgIGlmIChzaGFyZWRNZW1vcnkpIHtcbiAgICAgIGJsb2Nrc1swXSA9IGJsb2Nrc1sxNl0gPSBibG9ja3NbMV0gPSBibG9ja3NbMl0gPSBibG9ja3NbM10gPSBibG9ja3NbNF0gPSBibG9ja3NbNV0gPSBibG9ja3NbNl0gPSBibG9ja3NbN10gPSBibG9ja3NbOF0gPSBibG9ja3NbOV0gPSBibG9ja3NbMTBdID0gYmxvY2tzWzExXSA9IGJsb2Nrc1sxMl0gPSBibG9ja3NbMTNdID0gYmxvY2tzWzE0XSA9IGJsb2Nrc1sxNV0gPSAwO1xuICAgICAgdGhpcy5ibG9ja3MgPSBibG9ja3M7XG4gICAgICB0aGlzLmJ1ZmZlcjggPSBidWZmZXI4O1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoQVJSQVlfQlVGRkVSKSB7XG4gICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoNjgpO1xuICAgICAgICB0aGlzLmJ1ZmZlcjggPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xuICAgICAgICB0aGlzLmJsb2NrcyA9IG5ldyBVaW50MzJBcnJheShidWZmZXIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5ibG9ja3MgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5oMCA9IHRoaXMuaDEgPSB0aGlzLmgyID0gdGhpcy5oMyA9IHRoaXMuc3RhcnQgPSB0aGlzLmJ5dGVzID0gdGhpcy5oQnl0ZXMgPSAwO1xuICAgIHRoaXMuZmluYWxpemVkID0gdGhpcy5oYXNoZWQgPSBmYWxzZTtcbiAgICB0aGlzLmZpcnN0ID0gdHJ1ZTtcbiAgfVxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVcbiAgICogQG1lbWJlcm9mIE1kNVxuICAgKiBAaW5zdGFuY2VcbiAgICogQGRlc2NyaXB0aW9uIFVwZGF0ZSBoYXNoXG4gICAqIEBwYXJhbSB7U3RyaW5nfEFycmF5fFVpbnQ4QXJyYXl8QXJyYXlCdWZmZXJ9IG1lc3NhZ2UgbWVzc2FnZSB0byBoYXNoXG4gICAqIEByZXR1cm5zIHtNZDV9IE1kNSBvYmplY3QuXG4gICAqIEBzZWUge0BsaW5rIG1kNS51cGRhdGV9XG4gICAqL1xuXG5cbiAgTWQ1LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAobWVzc2FnZSwgaXNCaW5TdHIpIHtcbiAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgY29kZSxcbiAgICAgICAgaW5kZXggPSAwLFxuICAgICAgICBpLFxuICAgICAgICBsZW5ndGggPSBtZXNzYWdlLmxlbmd0aCxcbiAgICAgICAgYmxvY2tzID0gdGhpcy5ibG9ja3M7XG4gICAgdmFyIGJ1ZmZlcjggPSB0aGlzLmJ1ZmZlcjg7XG5cbiAgICB3aGlsZSAoaW5kZXggPCBsZW5ndGgpIHtcbiAgICAgIGlmICh0aGlzLmhhc2hlZCkge1xuICAgICAgICB0aGlzLmhhc2hlZCA9IGZhbHNlO1xuICAgICAgICBibG9ja3NbMF0gPSBibG9ja3NbMTZdO1xuICAgICAgICBibG9ja3NbMTZdID0gYmxvY2tzWzFdID0gYmxvY2tzWzJdID0gYmxvY2tzWzNdID0gYmxvY2tzWzRdID0gYmxvY2tzWzVdID0gYmxvY2tzWzZdID0gYmxvY2tzWzddID0gYmxvY2tzWzhdID0gYmxvY2tzWzldID0gYmxvY2tzWzEwXSA9IGJsb2Nrc1sxMV0gPSBibG9ja3NbMTJdID0gYmxvY2tzWzEzXSA9IGJsb2Nrc1sxNF0gPSBibG9ja3NbMTVdID0gMDtcbiAgICAgIH1cblxuICAgICAgaWYgKEFSUkFZX0JVRkZFUikge1xuICAgICAgICBmb3IgKGkgPSB0aGlzLnN0YXJ0OyBpbmRleCA8IGxlbmd0aCAmJiBpIDwgNjQ7ICsraW5kZXgpIHtcbiAgICAgICAgICBjb2RlID0gbWVzc2FnZS5jaGFyQ29kZUF0KGluZGV4KTtcblxuICAgICAgICAgIGlmIChpc0JpblN0ciB8fCBjb2RlIDwgMHg4MCkge1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gY29kZTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCAweDgwMCkge1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHhjMCB8IGNvZGUgPj4gNjtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4ODAgfCBjb2RlICYgMHgzZjtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCAweGQ4MDAgfHwgY29kZSA+PSAweGUwMDApIHtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4ZTAgfCBjb2RlID4+IDEyO1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHg4MCB8IGNvZGUgPj4gNiAmIDB4M2Y7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweDgwIHwgY29kZSAmIDB4M2Y7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvZGUgPSAweDEwMDAwICsgKChjb2RlICYgMHgzZmYpIDw8IDEwIHwgbWVzc2FnZS5jaGFyQ29kZUF0KCsraW5kZXgpICYgMHgzZmYpO1xuICAgICAgICAgICAgYnVmZmVyOFtpKytdID0gMHhmMCB8IGNvZGUgPj4gMTg7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweDgwIHwgY29kZSA+PiAxMiAmIDB4M2Y7XG4gICAgICAgICAgICBidWZmZXI4W2krK10gPSAweDgwIHwgY29kZSA+PiA2ICYgMHgzZjtcbiAgICAgICAgICAgIGJ1ZmZlcjhbaSsrXSA9IDB4ODAgfCBjb2RlICYgMHgzZjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAoaSA9IHRoaXMuc3RhcnQ7IGluZGV4IDwgbGVuZ3RoICYmIGkgPCA2NDsgKytpbmRleCkge1xuICAgICAgICAgIGNvZGUgPSBtZXNzYWdlLmNoYXJDb2RlQXQoaW5kZXgpO1xuXG4gICAgICAgICAgaWYgKGlzQmluU3RyIHx8IGNvZGUgPCAweDgwKSB7XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSBjb2RlIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29kZSA8IDB4ODAwKSB7XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHhjMCB8IGNvZGUgPj4gNikgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHg4MCB8IGNvZGUgJiAweDNmKSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNvZGUgPCAweGQ4MDAgfHwgY29kZSA+PSAweGUwMDApIHtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweGUwIHwgY29kZSA+PiAxMikgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgICBibG9ja3NbaSA+PiAyXSB8PSAoMHg4MCB8IGNvZGUgPj4gNiAmIDB4M2YpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4ODAgfCBjb2RlICYgMHgzZikgPDwgU0hJRlRbaSsrICYgM107XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvZGUgPSAweDEwMDAwICsgKChjb2RlICYgMHgzZmYpIDw8IDEwIHwgbWVzc2FnZS5jaGFyQ29kZUF0KCsraW5kZXgpICYgMHgzZmYpO1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4ZjAgfCBjb2RlID4+IDE4KSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweDgwIHwgY29kZSA+PiAxMiAmIDB4M2YpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgICAgYmxvY2tzW2kgPj4gMl0gfD0gKDB4ODAgfCBjb2RlID4+IDYgJiAweDNmKSA8PCBTSElGVFtpKysgJiAzXTtcbiAgICAgICAgICAgIGJsb2Nrc1tpID4+IDJdIHw9ICgweDgwIHwgY29kZSAmIDB4M2YpIDw8IFNISUZUW2krKyAmIDNdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmxhc3RCeXRlSW5kZXggPSBpO1xuICAgICAgdGhpcy5ieXRlcyArPSBpIC0gdGhpcy5zdGFydDtcblxuICAgICAgaWYgKGkgPj0gNjQpIHtcbiAgICAgICAgdGhpcy5zdGFydCA9IGkgLSA2NDtcbiAgICAgICAgdGhpcy5oYXNoKCk7XG4gICAgICAgIHRoaXMuaGFzaGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3RhcnQgPSBpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmJ5dGVzID4gNDI5NDk2NzI5NSkge1xuICAgICAgdGhpcy5oQnl0ZXMgKz0gdGhpcy5ieXRlcyAvIDQyOTQ5NjcyOTYgPDwgMDtcbiAgICAgIHRoaXMuYnl0ZXMgPSB0aGlzLmJ5dGVzICUgNDI5NDk2NzI5NjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZDUucHJvdG90eXBlLmZpbmFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmZpbmFsaXplZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZmluYWxpemVkID0gdHJ1ZTtcbiAgICB2YXIgYmxvY2tzID0gdGhpcy5ibG9ja3MsXG4gICAgICAgIGkgPSB0aGlzLmxhc3RCeXRlSW5kZXg7XG4gICAgYmxvY2tzW2kgPj4gMl0gfD0gRVhUUkFbaSAmIDNdO1xuXG4gICAgaWYgKGkgPj0gNTYpIHtcbiAgICAgIGlmICghdGhpcy5oYXNoZWQpIHtcbiAgICAgICAgdGhpcy5oYXNoKCk7XG4gICAgICB9XG5cbiAgICAgIGJsb2Nrc1swXSA9IGJsb2Nrc1sxNl07XG4gICAgICBibG9ja3NbMTZdID0gYmxvY2tzWzFdID0gYmxvY2tzWzJdID0gYmxvY2tzWzNdID0gYmxvY2tzWzRdID0gYmxvY2tzWzVdID0gYmxvY2tzWzZdID0gYmxvY2tzWzddID0gYmxvY2tzWzhdID0gYmxvY2tzWzldID0gYmxvY2tzWzEwXSA9IGJsb2Nrc1sxMV0gPSBibG9ja3NbMTJdID0gYmxvY2tzWzEzXSA9IGJsb2Nrc1sxNF0gPSBibG9ja3NbMTVdID0gMDtcbiAgICB9XG5cbiAgICBibG9ja3NbMTRdID0gdGhpcy5ieXRlcyA8PCAzO1xuICAgIGJsb2Nrc1sxNV0gPSB0aGlzLmhCeXRlcyA8PCAzIHwgdGhpcy5ieXRlcyA+Pj4gMjk7XG4gICAgdGhpcy5oYXNoKCk7XG4gIH07XG5cbiAgTWQ1LnByb3RvdHlwZS5oYXNoID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBhLFxuICAgICAgICBiLFxuICAgICAgICBjLFxuICAgICAgICBkLFxuICAgICAgICBiYyxcbiAgICAgICAgZGEsXG4gICAgICAgIGJsb2NrcyA9IHRoaXMuYmxvY2tzO1xuXG4gICAgaWYgKHRoaXMuZmlyc3QpIHtcbiAgICAgIGEgPSBibG9ja3NbMF0gLSA2ODA4NzY5Mzc7XG4gICAgICBhID0gKGEgPDwgNyB8IGEgPj4+IDI1KSAtIDI3MTczMzg3OSA8PCAwO1xuICAgICAgZCA9ICgtMTczMjU4NDE5NCBeIGEgJiAyMDA0MzE4MDcxKSArIGJsb2Nrc1sxXSAtIDExNzgzMDcwODtcbiAgICAgIGQgPSAoZCA8PCAxMiB8IGQgPj4+IDIwKSArIGEgPDwgMDtcbiAgICAgIGMgPSAoLTI3MTczMzg3OSBeIGQgJiAoYSBeIC0yNzE3MzM4NzkpKSArIGJsb2Nrc1syXSAtIDExMjY0NzgzNzU7XG4gICAgICBjID0gKGMgPDwgMTcgfCBjID4+PiAxNSkgKyBkIDw8IDA7XG4gICAgICBiID0gKGEgXiBjICYgKGQgXiBhKSkgKyBibG9ja3NbM10gLSAxMzE2MjU5MjA5O1xuICAgICAgYiA9IChiIDw8IDIyIHwgYiA+Pj4gMTApICsgYyA8PCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBhID0gdGhpcy5oMDtcbiAgICAgIGIgPSB0aGlzLmgxO1xuICAgICAgYyA9IHRoaXMuaDI7XG4gICAgICBkID0gdGhpcy5oMztcbiAgICAgIGEgKz0gKGQgXiBiICYgKGMgXiBkKSkgKyBibG9ja3NbMF0gLSA2ODA4NzY5MzY7XG4gICAgICBhID0gKGEgPDwgNyB8IGEgPj4+IDI1KSArIGIgPDwgMDtcbiAgICAgIGQgKz0gKGMgXiBhICYgKGIgXiBjKSkgKyBibG9ja3NbMV0gLSAzODk1NjQ1ODY7XG4gICAgICBkID0gKGQgPDwgMTIgfCBkID4+PiAyMCkgKyBhIDw8IDA7XG4gICAgICBjICs9IChiIF4gZCAmIChhIF4gYikpICsgYmxvY2tzWzJdICsgNjA2MTA1ODE5O1xuICAgICAgYyA9IChjIDw8IDE3IHwgYyA+Pj4gMTUpICsgZCA8PCAwO1xuICAgICAgYiArPSAoYSBeIGMgJiAoZCBeIGEpKSArIGJsb2Nrc1szXSAtIDEwNDQ1MjUzMzA7XG4gICAgICBiID0gKGIgPDwgMjIgfCBiID4+PiAxMCkgKyBjIDw8IDA7XG4gICAgfVxuXG4gICAgYSArPSAoZCBeIGIgJiAoYyBeIGQpKSArIGJsb2Nrc1s0XSAtIDE3NjQxODg5NztcbiAgICBhID0gKGEgPDwgNyB8IGEgPj4+IDI1KSArIGIgPDwgMDtcbiAgICBkICs9IChjIF4gYSAmIChiIF4gYykpICsgYmxvY2tzWzVdICsgMTIwMDA4MDQyNjtcbiAgICBkID0gKGQgPDwgMTIgfCBkID4+PiAyMCkgKyBhIDw8IDA7XG4gICAgYyArPSAoYiBeIGQgJiAoYSBeIGIpKSArIGJsb2Nrc1s2XSAtIDE0NzMyMzEzNDE7XG4gICAgYyA9IChjIDw8IDE3IHwgYyA+Pj4gMTUpICsgZCA8PCAwO1xuICAgIGIgKz0gKGEgXiBjICYgKGQgXiBhKSkgKyBibG9ja3NbN10gLSA0NTcwNTk4MztcbiAgICBiID0gKGIgPDwgMjIgfCBiID4+PiAxMCkgKyBjIDw8IDA7XG4gICAgYSArPSAoZCBeIGIgJiAoYyBeIGQpKSArIGJsb2Nrc1s4XSArIDE3NzAwMzU0MTY7XG4gICAgYSA9IChhIDw8IDcgfCBhID4+PiAyNSkgKyBiIDw8IDA7XG4gICAgZCArPSAoYyBeIGEgJiAoYiBeIGMpKSArIGJsb2Nrc1s5XSAtIDE5NTg0MTQ0MTc7XG4gICAgZCA9IChkIDw8IDEyIHwgZCA+Pj4gMjApICsgYSA8PCAwO1xuICAgIGMgKz0gKGIgXiBkICYgKGEgXiBiKSkgKyBibG9ja3NbMTBdIC0gNDIwNjM7XG4gICAgYyA9IChjIDw8IDE3IHwgYyA+Pj4gMTUpICsgZCA8PCAwO1xuICAgIGIgKz0gKGEgXiBjICYgKGQgXiBhKSkgKyBibG9ja3NbMTFdIC0gMTk5MDQwNDE2MjtcbiAgICBiID0gKGIgPDwgMjIgfCBiID4+PiAxMCkgKyBjIDw8IDA7XG4gICAgYSArPSAoZCBeIGIgJiAoYyBeIGQpKSArIGJsb2Nrc1sxMl0gKyAxODA0NjAzNjgyO1xuICAgIGEgPSAoYSA8PCA3IHwgYSA+Pj4gMjUpICsgYiA8PCAwO1xuICAgIGQgKz0gKGMgXiBhICYgKGIgXiBjKSkgKyBibG9ja3NbMTNdIC0gNDAzNDExMDE7XG4gICAgZCA9IChkIDw8IDEyIHwgZCA+Pj4gMjApICsgYSA8PCAwO1xuICAgIGMgKz0gKGIgXiBkICYgKGEgXiBiKSkgKyBibG9ja3NbMTRdIC0gMTUwMjAwMjI5MDtcbiAgICBjID0gKGMgPDwgMTcgfCBjID4+PiAxNSkgKyBkIDw8IDA7XG4gICAgYiArPSAoYSBeIGMgJiAoZCBeIGEpKSArIGJsb2Nrc1sxNV0gKyAxMjM2NTM1MzI5O1xuICAgIGIgPSAoYiA8PCAyMiB8IGIgPj4+IDEwKSArIGMgPDwgMDtcbiAgICBhICs9IChjIF4gZCAmIChiIF4gYykpICsgYmxvY2tzWzFdIC0gMTY1Nzk2NTEwO1xuICAgIGEgPSAoYSA8PCA1IHwgYSA+Pj4gMjcpICsgYiA8PCAwO1xuICAgIGQgKz0gKGIgXiBjICYgKGEgXiBiKSkgKyBibG9ja3NbNl0gLSAxMDY5NTAxNjMyO1xuICAgIGQgPSAoZCA8PCA5IHwgZCA+Pj4gMjMpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiBiICYgKGQgXiBhKSkgKyBibG9ja3NbMTFdICsgNjQzNzE3NzEzO1xuICAgIGMgPSAoYyA8PCAxNCB8IGMgPj4+IDE4KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gYSAmIChjIF4gZCkpICsgYmxvY2tzWzBdIC0gMzczODk3MzAyO1xuICAgIGIgPSAoYiA8PCAyMCB8IGIgPj4+IDEyKSArIGMgPDwgMDtcbiAgICBhICs9IChjIF4gZCAmIChiIF4gYykpICsgYmxvY2tzWzVdIC0gNzAxNTU4NjkxO1xuICAgIGEgPSAoYSA8PCA1IHwgYSA+Pj4gMjcpICsgYiA8PCAwO1xuICAgIGQgKz0gKGIgXiBjICYgKGEgXiBiKSkgKyBibG9ja3NbMTBdICsgMzgwMTYwODM7XG4gICAgZCA9IChkIDw8IDkgfCBkID4+PiAyMykgKyBhIDw8IDA7XG4gICAgYyArPSAoYSBeIGIgJiAoZCBeIGEpKSArIGJsb2Nrc1sxNV0gLSA2NjA0NzgzMzU7XG4gICAgYyA9IChjIDw8IDE0IHwgYyA+Pj4gMTgpICsgZCA8PCAwO1xuICAgIGIgKz0gKGQgXiBhICYgKGMgXiBkKSkgKyBibG9ja3NbNF0gLSA0MDU1Mzc4NDg7XG4gICAgYiA9IChiIDw8IDIwIHwgYiA+Pj4gMTIpICsgYyA8PCAwO1xuICAgIGEgKz0gKGMgXiBkICYgKGIgXiBjKSkgKyBibG9ja3NbOV0gKyA1Njg0NDY0Mzg7XG4gICAgYSA9IChhIDw8IDUgfCBhID4+PiAyNykgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIGMgJiAoYSBeIGIpKSArIGJsb2Nrc1sxNF0gLSAxMDE5ODAzNjkwO1xuICAgIGQgPSAoZCA8PCA5IHwgZCA+Pj4gMjMpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiBiICYgKGQgXiBhKSkgKyBibG9ja3NbM10gLSAxODczNjM5NjE7XG4gICAgYyA9IChjIDw8IDE0IHwgYyA+Pj4gMTgpICsgZCA8PCAwO1xuICAgIGIgKz0gKGQgXiBhICYgKGMgXiBkKSkgKyBibG9ja3NbOF0gKyAxMTYzNTMxNTAxO1xuICAgIGIgPSAoYiA8PCAyMCB8IGIgPj4+IDEyKSArIGMgPDwgMDtcbiAgICBhICs9IChjIF4gZCAmIChiIF4gYykpICsgYmxvY2tzWzEzXSAtIDE0NDQ2ODE0Njc7XG4gICAgYSA9IChhIDw8IDUgfCBhID4+PiAyNykgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIGMgJiAoYSBeIGIpKSArIGJsb2Nrc1syXSAtIDUxNDAzNzg0O1xuICAgIGQgPSAoZCA8PCA5IHwgZCA+Pj4gMjMpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiBiICYgKGQgXiBhKSkgKyBibG9ja3NbN10gKyAxNzM1MzI4NDczO1xuICAgIGMgPSAoYyA8PCAxNCB8IGMgPj4+IDE4KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gYSAmIChjIF4gZCkpICsgYmxvY2tzWzEyXSAtIDE5MjY2MDc3MzQ7XG4gICAgYiA9IChiIDw8IDIwIHwgYiA+Pj4gMTIpICsgYyA8PCAwO1xuICAgIGJjID0gYiBeIGM7XG4gICAgYSArPSAoYmMgXiBkKSArIGJsb2Nrc1s1XSAtIDM3ODU1ODtcbiAgICBhID0gKGEgPDwgNCB8IGEgPj4+IDI4KSArIGIgPDwgMDtcbiAgICBkICs9IChiYyBeIGEpICsgYmxvY2tzWzhdIC0gMjAyMjU3NDQ2MztcbiAgICBkID0gKGQgPDwgMTEgfCBkID4+PiAyMSkgKyBhIDw8IDA7XG4gICAgZGEgPSBkIF4gYTtcbiAgICBjICs9IChkYSBeIGIpICsgYmxvY2tzWzExXSArIDE4MzkwMzA1NjI7XG4gICAgYyA9IChjIDw8IDE2IHwgYyA+Pj4gMTYpICsgZCA8PCAwO1xuICAgIGIgKz0gKGRhIF4gYykgKyBibG9ja3NbMTRdIC0gMzUzMDk1NTY7XG4gICAgYiA9IChiIDw8IDIzIHwgYiA+Pj4gOSkgKyBjIDw8IDA7XG4gICAgYmMgPSBiIF4gYztcbiAgICBhICs9IChiYyBeIGQpICsgYmxvY2tzWzFdIC0gMTUzMDk5MjA2MDtcbiAgICBhID0gKGEgPDwgNCB8IGEgPj4+IDI4KSArIGIgPDwgMDtcbiAgICBkICs9IChiYyBeIGEpICsgYmxvY2tzWzRdICsgMTI3Mjg5MzM1MztcbiAgICBkID0gKGQgPDwgMTEgfCBkID4+PiAyMSkgKyBhIDw8IDA7XG4gICAgZGEgPSBkIF4gYTtcbiAgICBjICs9IChkYSBeIGIpICsgYmxvY2tzWzddIC0gMTU1NDk3NjMyO1xuICAgIGMgPSAoYyA8PCAxNiB8IGMgPj4+IDE2KSArIGQgPDwgMDtcbiAgICBiICs9IChkYSBeIGMpICsgYmxvY2tzWzEwXSAtIDEwOTQ3MzA2NDA7XG4gICAgYiA9IChiIDw8IDIzIHwgYiA+Pj4gOSkgKyBjIDw8IDA7XG4gICAgYmMgPSBiIF4gYztcbiAgICBhICs9IChiYyBeIGQpICsgYmxvY2tzWzEzXSArIDY4MTI3OTE3NDtcbiAgICBhID0gKGEgPDwgNCB8IGEgPj4+IDI4KSArIGIgPDwgMDtcbiAgICBkICs9IChiYyBeIGEpICsgYmxvY2tzWzBdIC0gMzU4NTM3MjIyO1xuICAgIGQgPSAoZCA8PCAxMSB8IGQgPj4+IDIxKSArIGEgPDwgMDtcbiAgICBkYSA9IGQgXiBhO1xuICAgIGMgKz0gKGRhIF4gYikgKyBibG9ja3NbM10gLSA3MjI1MjE5Nzk7XG4gICAgYyA9IChjIDw8IDE2IHwgYyA+Pj4gMTYpICsgZCA8PCAwO1xuICAgIGIgKz0gKGRhIF4gYykgKyBibG9ja3NbNl0gKyA3NjAyOTE4OTtcbiAgICBiID0gKGIgPDwgMjMgfCBiID4+PiA5KSArIGMgPDwgMDtcbiAgICBiYyA9IGIgXiBjO1xuICAgIGEgKz0gKGJjIF4gZCkgKyBibG9ja3NbOV0gLSA2NDAzNjQ0ODc7XG4gICAgYSA9IChhIDw8IDQgfCBhID4+PiAyOCkgKyBiIDw8IDA7XG4gICAgZCArPSAoYmMgXiBhKSArIGJsb2Nrc1sxMl0gLSA0MjE4MTU4MzU7XG4gICAgZCA9IChkIDw8IDExIHwgZCA+Pj4gMjEpICsgYSA8PCAwO1xuICAgIGRhID0gZCBeIGE7XG4gICAgYyArPSAoZGEgXiBiKSArIGJsb2Nrc1sxNV0gKyA1MzA3NDI1MjA7XG4gICAgYyA9IChjIDw8IDE2IHwgYyA+Pj4gMTYpICsgZCA8PCAwO1xuICAgIGIgKz0gKGRhIF4gYykgKyBibG9ja3NbMl0gLSA5OTUzMzg2NTE7XG4gICAgYiA9IChiIDw8IDIzIHwgYiA+Pj4gOSkgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIChiIHwgfmQpKSArIGJsb2Nrc1swXSAtIDE5ODYzMDg0NDtcbiAgICBhID0gKGEgPDwgNiB8IGEgPj4+IDI2KSArIGIgPDwgMDtcbiAgICBkICs9IChiIF4gKGEgfCB+YykpICsgYmxvY2tzWzddICsgMTEyNjg5MTQxNTtcbiAgICBkID0gKGQgPDwgMTAgfCBkID4+PiAyMikgKyBhIDw8IDA7XG4gICAgYyArPSAoYSBeIChkIHwgfmIpKSArIGJsb2Nrc1sxNF0gLSAxNDE2MzU0OTA1O1xuICAgIGMgPSAoYyA8PCAxNSB8IGMgPj4+IDE3KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gKGMgfCB+YSkpICsgYmxvY2tzWzVdIC0gNTc0MzQwNTU7XG4gICAgYiA9IChiIDw8IDIxIHwgYiA+Pj4gMTEpICsgYyA8PCAwO1xuICAgIGEgKz0gKGMgXiAoYiB8IH5kKSkgKyBibG9ja3NbMTJdICsgMTcwMDQ4NTU3MTtcbiAgICBhID0gKGEgPDwgNiB8IGEgPj4+IDI2KSArIGIgPDwgMDtcbiAgICBkICs9IChiIF4gKGEgfCB+YykpICsgYmxvY2tzWzNdIC0gMTg5NDk4NjYwNjtcbiAgICBkID0gKGQgPDwgMTAgfCBkID4+PiAyMikgKyBhIDw8IDA7XG4gICAgYyArPSAoYSBeIChkIHwgfmIpKSArIGJsb2Nrc1sxMF0gLSAxMDUxNTIzO1xuICAgIGMgPSAoYyA8PCAxNSB8IGMgPj4+IDE3KSArIGQgPDwgMDtcbiAgICBiICs9IChkIF4gKGMgfCB+YSkpICsgYmxvY2tzWzFdIC0gMjA1NDkyMjc5OTtcbiAgICBiID0gKGIgPDwgMjEgfCBiID4+PiAxMSkgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIChiIHwgfmQpKSArIGJsb2Nrc1s4XSArIDE4NzMzMTMzNTk7XG4gICAgYSA9IChhIDw8IDYgfCBhID4+PiAyNikgKyBiIDw8IDA7XG4gICAgZCArPSAoYiBeIChhIHwgfmMpKSArIGJsb2Nrc1sxNV0gLSAzMDYxMTc0NDtcbiAgICBkID0gKGQgPDwgMTAgfCBkID4+PiAyMikgKyBhIDw8IDA7XG4gICAgYyArPSAoYSBeIChkIHwgfmIpKSArIGJsb2Nrc1s2XSAtIDE1NjAxOTgzODA7XG4gICAgYyA9IChjIDw8IDE1IHwgYyA+Pj4gMTcpICsgZCA8PCAwO1xuICAgIGIgKz0gKGQgXiAoYyB8IH5hKSkgKyBibG9ja3NbMTNdICsgMTMwOTE1MTY0OTtcbiAgICBiID0gKGIgPDwgMjEgfCBiID4+PiAxMSkgKyBjIDw8IDA7XG4gICAgYSArPSAoYyBeIChiIHwgfmQpKSArIGJsb2Nrc1s0XSAtIDE0NTUyMzA3MDtcbiAgICBhID0gKGEgPDwgNiB8IGEgPj4+IDI2KSArIGIgPDwgMDtcbiAgICBkICs9IChiIF4gKGEgfCB+YykpICsgYmxvY2tzWzExXSAtIDExMjAyMTAzNzk7XG4gICAgZCA9IChkIDw8IDEwIHwgZCA+Pj4gMjIpICsgYSA8PCAwO1xuICAgIGMgKz0gKGEgXiAoZCB8IH5iKSkgKyBibG9ja3NbMl0gKyA3MTg3ODcyNTk7XG4gICAgYyA9IChjIDw8IDE1IHwgYyA+Pj4gMTcpICsgZCA8PCAwO1xuICAgIGIgKz0gKGQgXiAoYyB8IH5hKSkgKyBibG9ja3NbOV0gLSAzNDM0ODU1NTE7XG4gICAgYiA9IChiIDw8IDIxIHwgYiA+Pj4gMTEpICsgYyA8PCAwO1xuXG4gICAgaWYgKHRoaXMuZmlyc3QpIHtcbiAgICAgIHRoaXMuaDAgPSBhICsgMTczMjU4NDE5MyA8PCAwO1xuICAgICAgdGhpcy5oMSA9IGIgLSAyNzE3MzM4NzkgPDwgMDtcbiAgICAgIHRoaXMuaDIgPSBjIC0gMTczMjU4NDE5NCA8PCAwO1xuICAgICAgdGhpcy5oMyA9IGQgKyAyNzE3MzM4NzggPDwgMDtcbiAgICAgIHRoaXMuZmlyc3QgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oMCA9IHRoaXMuaDAgKyBhIDw8IDA7XG4gICAgICB0aGlzLmgxID0gdGhpcy5oMSArIGIgPDwgMDtcbiAgICAgIHRoaXMuaDIgPSB0aGlzLmgyICsgYyA8PCAwO1xuICAgICAgdGhpcy5oMyA9IHRoaXMuaDMgKyBkIDw8IDA7XG4gICAgfVxuICB9O1xuICAvKipcbiAgICogQG1ldGhvZCBoZXhcbiAgICogQG1lbWJlcm9mIE1kNVxuICAgKiBAaW5zdGFuY2VcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGhleCBzdHJpbmdcbiAgICogQHJldHVybnMge1N0cmluZ30gSGV4IHN0cmluZ1xuICAgKiBAc2VlIHtAbGluayBtZDUuaGV4fVxuICAgKiBAZXhhbXBsZVxuICAgKiBoYXNoLmhleCgpO1xuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUuaGV4ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmluYWxpemUoKTtcbiAgICB2YXIgaDAgPSB0aGlzLmgwLFxuICAgICAgICBoMSA9IHRoaXMuaDEsXG4gICAgICAgIGgyID0gdGhpcy5oMixcbiAgICAgICAgaDMgPSB0aGlzLmgzO1xuICAgIHJldHVybiBIRVhfQ0hBUlNbaDAgPj4gNCAmIDB4MEZdICsgSEVYX0NIQVJTW2gwICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDAgPj4gMTIgJiAweDBGXSArIEhFWF9DSEFSU1toMCA+PiA4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDAgPj4gMjAgJiAweDBGXSArIEhFWF9DSEFSU1toMCA+PiAxNiAmIDB4MEZdICsgSEVYX0NIQVJTW2gwID4+IDI4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDAgPj4gMjQgJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiA0ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiAxMiAmIDB4MEZdICsgSEVYX0NIQVJTW2gxID4+IDggJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiAyMCAmIDB4MEZdICsgSEVYX0NIQVJTW2gxID4+IDE2ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDEgPj4gMjggJiAweDBGXSArIEhFWF9DSEFSU1toMSA+PiAyNCAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDQgJiAweDBGXSArIEhFWF9DSEFSU1toMiAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDEyICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDIgPj4gOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDIwICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDIgPj4gMTYgJiAweDBGXSArIEhFWF9DSEFSU1toMiA+PiAyOCAmIDB4MEZdICsgSEVYX0NIQVJTW2gyID4+IDI0ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gNCAmIDB4MEZdICsgSEVYX0NIQVJTW2gzICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gMTIgJiAweDBGXSArIEhFWF9DSEFSU1toMyA+PiA4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gMjAgJiAweDBGXSArIEhFWF9DSEFSU1toMyA+PiAxNiAmIDB4MEZdICsgSEVYX0NIQVJTW2gzID4+IDI4ICYgMHgwRl0gKyBIRVhfQ0hBUlNbaDMgPj4gMjQgJiAweDBGXTtcbiAgfTtcbiAgLyoqXG4gICAqIEBtZXRob2QgdG9TdHJpbmdcbiAgICogQG1lbWJlcm9mIE1kNVxuICAgKiBAaW5zdGFuY2VcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGhleCBzdHJpbmdcbiAgICogQHJldHVybnMge1N0cmluZ30gSGV4IHN0cmluZ1xuICAgKiBAc2VlIHtAbGluayBtZDUuaGV4fVxuICAgKiBAZXhhbXBsZVxuICAgKiBoYXNoLnRvU3RyaW5nKCk7XG4gICAqL1xuXG5cbiAgTWQ1LnByb3RvdHlwZS50b1N0cmluZyA9IE1kNS5wcm90b3R5cGUuaGV4O1xuICAvKipcbiAgICogQG1ldGhvZCBkaWdlc3RcbiAgICogQG1lbWJlcm9mIE1kNVxuICAgKiBAaW5zdGFuY2VcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIGJ5dGVzIGFycmF5XG4gICAqIEByZXR1cm5zIHtBcnJheX0gQnl0ZXMgYXJyYXlcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmRpZ2VzdH1cbiAgICogQGV4YW1wbGVcbiAgICogaGFzaC5kaWdlc3QoKTtcbiAgICovXG5cbiAgTWQ1LnByb3RvdHlwZS5kaWdlc3QgPSBmdW5jdGlvbiAoZm9ybWF0KSB7XG4gICAgaWYgKGZvcm1hdCA9PT0gJ2hleCcpIHJldHVybiB0aGlzLmhleCgpO1xuICAgIHRoaXMuZmluYWxpemUoKTtcbiAgICB2YXIgaDAgPSB0aGlzLmgwLFxuICAgICAgICBoMSA9IHRoaXMuaDEsXG4gICAgICAgIGgyID0gdGhpcy5oMixcbiAgICAgICAgaDMgPSB0aGlzLmgzO1xuICAgIHZhciByZXMgPSBbaDAgJiAweEZGLCBoMCA+PiA4ICYgMHhGRiwgaDAgPj4gMTYgJiAweEZGLCBoMCA+PiAyNCAmIDB4RkYsIGgxICYgMHhGRiwgaDEgPj4gOCAmIDB4RkYsIGgxID4+IDE2ICYgMHhGRiwgaDEgPj4gMjQgJiAweEZGLCBoMiAmIDB4RkYsIGgyID4+IDggJiAweEZGLCBoMiA+PiAxNiAmIDB4RkYsIGgyID4+IDI0ICYgMHhGRiwgaDMgJiAweEZGLCBoMyA+PiA4ICYgMHhGRiwgaDMgPj4gMTYgJiAweEZGLCBoMyA+PiAyNCAmIDB4RkZdO1xuICAgIHJldHVybiByZXM7XG4gIH07XG4gIC8qKlxuICAgKiBAbWV0aG9kIGFycmF5XG4gICAqIEBtZW1iZXJvZiBNZDVcbiAgICogQGluc3RhbmNlXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBieXRlcyBhcnJheVxuICAgKiBAcmV0dXJucyB7QXJyYXl9IEJ5dGVzIGFycmF5XG4gICAqIEBzZWUge0BsaW5rIG1kNS5hcnJheX1cbiAgICogQGV4YW1wbGVcbiAgICogaGFzaC5hcnJheSgpO1xuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUuYXJyYXkgPSBNZDUucHJvdG90eXBlLmRpZ2VzdDtcbiAgLyoqXG4gICAqIEBtZXRob2QgYXJyYXlCdWZmZXJcbiAgICogQG1lbWJlcm9mIE1kNVxuICAgKiBAaW5zdGFuY2VcbiAgICogQGRlc2NyaXB0aW9uIE91dHB1dCBoYXNoIGFzIEFycmF5QnVmZmVyXG4gICAqIEByZXR1cm5zIHtBcnJheUJ1ZmZlcn0gQXJyYXlCdWZmZXJcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmFycmF5QnVmZmVyfVxuICAgKiBAZXhhbXBsZVxuICAgKiBoYXNoLmFycmF5QnVmZmVyKCk7XG4gICAqL1xuXG4gIE1kNS5wcm90b3R5cGUuYXJyYXlCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maW5hbGl6ZSgpO1xuICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoMTYpO1xuICAgIHZhciBibG9ja3MgPSBuZXcgVWludDMyQXJyYXkoYnVmZmVyKTtcbiAgICBibG9ja3NbMF0gPSB0aGlzLmgwO1xuICAgIGJsb2Nrc1sxXSA9IHRoaXMuaDE7XG4gICAgYmxvY2tzWzJdID0gdGhpcy5oMjtcbiAgICBibG9ja3NbM10gPSB0aGlzLmgzO1xuICAgIHJldHVybiBidWZmZXI7XG4gIH07XG4gIC8qKlxuICAgKiBAbWV0aG9kIGJ1ZmZlclxuICAgKiBAZGVwcmVjYXRlZCBUaGlzIG1heWJlIGNvbmZ1c2Ugd2l0aCBCdWZmZXIgaW4gbm9kZS5qcy4gUGxlYXNlIHVzZSBhcnJheUJ1ZmZlciBpbnN0ZWFkLlxuICAgKiBAbWVtYmVyb2YgTWQ1XG4gICAqIEBpbnN0YW5jZVxuICAgKiBAZGVzY3JpcHRpb24gT3V0cHV0IGhhc2ggYXMgQXJyYXlCdWZmZXJcbiAgICogQHJldHVybnMge0FycmF5QnVmZmVyfSBBcnJheUJ1ZmZlclxuICAgKiBAc2VlIHtAbGluayBtZDUuYnVmZmVyfVxuICAgKiBAZXhhbXBsZVxuICAgKiBoYXNoLmJ1ZmZlcigpO1xuICAgKi9cblxuXG4gIE1kNS5wcm90b3R5cGUuYnVmZmVyID0gTWQ1LnByb3RvdHlwZS5hcnJheUJ1ZmZlcjtcbiAgLyoqXG4gICAqIEBtZXRob2QgYmFzZTY0XG4gICAqIEBtZW1iZXJvZiBNZDVcbiAgICogQGluc3RhbmNlXG4gICAqIEBkZXNjcmlwdGlvbiBPdXRwdXQgaGFzaCBhcyBiYXNlNjQgc3RyaW5nXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IGJhc2U2NCBzdHJpbmdcbiAgICogQHNlZSB7QGxpbmsgbWQ1LmJhc2U2NH1cbiAgICogQGV4YW1wbGVcbiAgICogaGFzaC5iYXNlNjQoKTtcbiAgICovXG5cbiAgTWQ1LnByb3RvdHlwZS5iYXNlNjQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHYxLFxuICAgICAgICB2MixcbiAgICAgICAgdjMsXG4gICAgICAgIGJhc2U2NFN0ciA9ICcnLFxuICAgICAgICBieXRlcyA9IHRoaXMuYXJyYXkoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTU7KSB7XG4gICAgICB2MSA9IGJ5dGVzW2krK107XG4gICAgICB2MiA9IGJ5dGVzW2krK107XG4gICAgICB2MyA9IGJ5dGVzW2krK107XG4gICAgICBiYXNlNjRTdHIgKz0gQkFTRTY0X0VOQ09ERV9DSEFSW3YxID4+PiAyXSArIEJBU0U2NF9FTkNPREVfQ0hBUlsodjEgPDwgNCB8IHYyID4+PiA0KSAmIDYzXSArIEJBU0U2NF9FTkNPREVfQ0hBUlsodjIgPDwgMiB8IHYzID4+PiA2KSAmIDYzXSArIEJBU0U2NF9FTkNPREVfQ0hBUlt2MyAmIDYzXTtcbiAgICB9XG5cbiAgICB2MSA9IGJ5dGVzW2ldO1xuICAgIGJhc2U2NFN0ciArPSBCQVNFNjRfRU5DT0RFX0NIQVJbdjEgPj4+IDJdICsgQkFTRTY0X0VOQ09ERV9DSEFSW3YxIDw8IDQgJiA2M10gKyAnPT0nO1xuICAgIHJldHVybiBiYXNlNjRTdHI7XG4gIH07XG5cbiAgdmFyIGV4cG9ydHMgPSBjcmVhdGVNZXRob2QoKTtcblxuICBpZiAoQ09NTU9OX0pTKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzO1xuICB9IGVsc2Uge1xuICAgIC8qKlxuICAgICAqIEBtZXRob2QgbWQ1XGJcbiAgICAgKiBAZGVzY3JpcHRpb24gTWQ1IGhhc2ggZnVuY3Rpb24sIGV4cG9ydCB0byBnbG9iYWwgaW4gYnJvd3NlcnMuXG4gICAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXl8VWludDhBcnJheXxBcnJheUJ1ZmZlcn0gbWVzc2FnZSBtZXNzYWdlIHRvIGhhc2hcbiAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSBtZDUgaGFzaGVzXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBtZDUoJycpOyAvLyBkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OThlY2Y4NDI3ZVxuICAgICAqIG1kNSgnVGhlIHF1aWNrIGJyb3duIGZveCBqdW1wcyBvdmVyIHRoZSBsYXp5IGRvZycpOyAvLyA5ZTEwN2Q5ZDM3MmJiNjgyNmJkODFkMzU0MmE0MTlkNlxuICAgICAqIG1kNSgnVGhlIHF1aWNrIGJyb3duIGZveCBqdW1wcyBvdmVyIHRoZSBsYXp5IGRvZy4nKTsgLy8gZTRkOTA5YzI5MGQwZmIxY2EwNjhmZmFkZGYyMmNiZDBcbiAgICAgKlxuICAgICAqIC8vIEl0IGFsc28gc3VwcG9ydHMgVVRGLTggZW5jb2RpbmdcbiAgICAgKiBtZDUoJ+S4reaWhycpOyAvLyBhN2JhYzIyMzlmY2RjYjNhMDY3OTAzZDgwNzdjNGEwN1xuICAgICAqXG4gICAgICogLy8gSXQgYWxzbyBzdXBwb3J0cyBieXRlIGBBcnJheWAsIGBVaW50OEFycmF5YCwgYEFycmF5QnVmZmVyYFxuICAgICAqIG1kNShbXSk7IC8vIGQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlXG4gICAgICogbWQ1KG5ldyBVaW50OEFycmF5KFtdKSk7IC8vIGQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlXG4gICAgICovXG4gICAgcm9vdC5tZDUgPSBleHBvcnRzO1xuXG4gICAgaWYgKEFNRCkge1xuICAgICAgIShfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyA9IChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBleHBvcnRzO1xuICAgICAgfSkuY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fLCBleHBvcnRzLCBtb2R1bGUpLFxuXHRcdFx0XHRfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXyAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fKSk7XG4gICAgfVxuICB9XG59KSgpO1xuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyBcIi4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qc1wiKSwgX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi8uLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qcyAqLyBcIi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9nbG9iYWwuanNcIiksIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9tb2R1bGUuanMgKi8gXCIuL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vbW9kdWxlLmpzXCIpKG1vZHVsZSkpKVxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL2xpYi9yZXF1ZXN0LmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9saWIvcmVxdWVzdC5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbnZhciBfdHlwZW9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YgKi8gXCIuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZi5qc1wiKTtcblxudmFyIHN0cmluZ2lmeVByaW1pdGl2ZSA9IGZ1bmN0aW9uIHN0cmluZ2lmeVByaW1pdGl2ZSh2KSB7XG4gIHN3aXRjaCAoX3R5cGVvZih2KSkge1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXR1cm4gdjtcblxuICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgcmV0dXJuIHYgPyAndHJ1ZScgOiAnZmFsc2UnO1xuXG4gICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgIHJldHVybiBpc0Zpbml0ZSh2KSA/IHYgOiAnJztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gJyc7XG4gIH1cbn07XG5cbnZhciBxdWVyeVN0cmluZ2lmeSA9IGZ1bmN0aW9uIHF1ZXJ5U3RyaW5naWZ5KG9iaiwgc2VwLCBlcSwgbmFtZSkge1xuICBzZXAgPSBzZXAgfHwgJyYnO1xuICBlcSA9IGVxIHx8ICc9JztcblxuICBpZiAob2JqID09PSBudWxsKSB7XG4gICAgb2JqID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5tYXAoZnVuY3Rpb24gKGspIHtcbiAgICAgIHZhciBrcyA9IGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUoaykpICsgZXE7XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9ialtrXSkpIHtcbiAgICAgICAgcmV0dXJuIG9ialtrXS5tYXAoZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICByZXR1cm4ga3MgKyBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKHYpKTtcbiAgICAgICAgfSkuam9pbihzZXApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGtzICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmpba10pKTtcbiAgICAgIH1cbiAgICB9KS5maWx0ZXIoQm9vbGVhbikuam9pbihzZXApO1xuICB9XG5cbiAgaWYgKCFuYW1lKSByZXR1cm4gJyc7XG4gIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKG5hbWUpKSArIGVxICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmopKTtcbn07XG5cbnZhciB4aHJSZXMgPSBmdW5jdGlvbiB4aHJSZXMoZXJyLCB4aHIsIGJvZHkpIHtcbiAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpLnRyaW0oKS5zcGxpdCgnXFxuJykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmIChpdGVtKSB7XG4gICAgICB2YXIgaW5kZXggPSBpdGVtLmluZGV4T2YoJzonKTtcbiAgICAgIHZhciBrZXkgPSBpdGVtLnN1YnN0cigwLCBpbmRleCkudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgdmFsID0gaXRlbS5zdWJzdHIoaW5kZXggKyAxKS50cmltKCk7XG4gICAgICBoZWFkZXJzW2tleV0gPSB2YWw7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBlcnJvcjogZXJyLFxuICAgIHN0YXR1c0NvZGU6IHhoci5zdGF0dXMsXG4gICAgc3RhdHVzTWVzc2FnZTogeGhyLnN0YXR1c1RleHQsXG4gICAgaGVhZGVyczogaGVhZGVycyxcbiAgICBib2R5OiBib2R5XG4gIH07XG59O1xuXG52YXIgeGhyQm9keSA9IGZ1bmN0aW9uIHhockJvZHkoeGhyLCBkYXRhVHlwZSkge1xuICByZXR1cm4gIWRhdGFUeXBlICYmIGRhdGFUeXBlID09PSAndGV4dCcgPyB4aHIucmVzcG9uc2VUZXh0IDogeGhyLnJlc3BvbnNlO1xufTtcblxudmFyIHJlcXVlc3QgPSBmdW5jdGlvbiByZXF1ZXN0KG9wdCwgY2FsbGJhY2spIHtcbiAgLy8gbWV0aG9kXG4gIHZhciBtZXRob2QgPSAob3B0Lm1ldGhvZCB8fCAnR0VUJykudG9VcHBlckNhc2UoKTsgLy8gdXJs44CBcXNcblxuICB2YXIgdXJsID0gb3B0LnVybDtcblxuICBpZiAob3B0LnFzKSB7XG4gICAgdmFyIHFzU3RyID0gcXVlcnlTdHJpbmdpZnkob3B0LnFzKTtcblxuICAgIGlmIChxc1N0cikge1xuICAgICAgdXJsICs9ICh1cmwuaW5kZXhPZignPycpID09PSAtMSA/ICc/JyA6ICcmJykgKyBxc1N0cjtcbiAgICB9XG4gIH0gLy8g5Yib5bu6IGFqYXgg5a6e5L6LXG5cblxuICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTtcbiAgeGhyLnJlc3BvbnNlVHlwZSA9IG9wdC5kYXRhVHlwZSB8fCAndGV4dCc7IC8vIOWkhOeQhiB4aHJGaWVsZHMg5bGe5oCnXG5cbiAgaWYgKG9wdC54aHJGaWVsZHMpIHtcbiAgICBmb3IgKHZhciB4aHJGaWVsZCBpbiBvcHQueGhyRmllbGRzKSB7XG4gICAgICB4aHJbeGhyRmllbGRdID0gb3B0LnhockZpZWxkc1t4aHJGaWVsZF07XG4gICAgfVxuICB9IC8vIOWkhOeQhiBoZWFkZXJzXG5cblxuICB2YXIgaGVhZGVycyA9IG9wdC5oZWFkZXJzO1xuXG4gIGlmIChoZWFkZXJzKSB7XG4gICAgZm9yICh2YXIga2V5IGluIGhlYWRlcnMpIHtcbiAgICAgIGlmIChoZWFkZXJzLmhhc093blByb3BlcnR5KGtleSkgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICdjb250ZW50LWxlbmd0aCcgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICd1c2VyLWFnZW50JyAmJiBrZXkudG9Mb3dlckNhc2UoKSAhPT0gJ29yaWdpbicgJiYga2V5LnRvTG93ZXJDYXNlKCkgIT09ICdob3N0Jykge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIGhlYWRlcnNba2V5XSk7XG4gICAgICB9XG4gICAgfVxuICB9IC8vIG9ucHJvZ3Jlc3NcblxuXG4gIGlmIChvcHQub25Qcm9ncmVzcyAmJiB4aHIudXBsb2FkKSB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBvcHQub25Qcm9ncmVzcztcbiAgaWYgKG9wdC5vbkRvd25sb2FkUHJvZ3Jlc3MpIHhoci5vbnByb2dyZXNzID0gb3B0Lm9uRG93bmxvYWRQcm9ncmVzczsgLy8gdGltZW91dFxuXG4gIGlmIChvcHQudGltZW91dCkgeGhyLnRpbWVvdXQgPSBvcHQudGltZW91dDtcblxuICB4aHIub250aW1lb3V0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgdmFyIGVycm9yID0gbmV3IEVycm9yKCd0aW1lb3V0Jyk7XG4gICAgY2FsbGJhY2soeGhyUmVzKGVycm9yLCB4aHIpKTtcbiAgfTsgLy8gc3VjY2VzcyAyeHgvM3h4LzR4eFxuXG5cbiAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjYWxsYmFjayh4aHJSZXMobnVsbCwgeGhyLCB4aHJCb2R5KHhociwgb3B0LmRhdGFUeXBlKSkpO1xuICB9OyAvLyBlcnJvciA1eHgvMCAo572R57uc6ZSZ6K+v44CB6Leo5Z+f5oql6ZSZ44CBSHR0cHMgY29ubmVjdC1zcmMg6ZmQ5Yi255qE5oql6ZSZ5pe2IHN0YXR1c0NvZGUg5Li6IDApXG5cblxuICB4aHIub25lcnJvciA9IGZ1bmN0aW9uIChlcnIpIHtcbiAgICB2YXIgYm9keSA9IHhockJvZHkoeGhyLCBvcHQuZGF0YVR5cGUpO1xuXG4gICAgaWYgKGJvZHkpIHtcbiAgICAgIC8vIDV4eFxuICAgICAgY2FsbGJhY2soeGhyUmVzKG51bGwsIHhociwgYm9keSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyAwXG4gICAgICB2YXIgZXJyb3IgPSB4aHIuc3RhdHVzVGV4dDtcbiAgICAgIGlmICghZXJyb3IgJiYgeGhyLnN0YXR1cyA9PT0gMCkgZXJyb3IgPSBuZXcgRXJyb3IoJ0NPUlMgYmxvY2tlZCBvciBuZXR3b3JrIGVycm9yJyk7XG4gICAgICBjYWxsYmFjayh4aHJSZXMoZXJyb3IsIHhociwgYm9keSkpO1xuICAgIH1cbiAgfTsgLy8gc2VuZFxuXG5cbiAgeGhyLnNlbmQob3B0LmJvZHkgfHwgJycpOyAvLyDov5Tlm54gYWpheCDlrp7kvovvvIznlKjkuo7lpJbpg6josIPnlKggeGhyLmFib3J0XG5cbiAgcmV0dXJuIHhocjtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gcmVxdWVzdDtcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9saWIveG1sMmpzb24uanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9saWIveG1sMmpzb24uanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxuLyogQ29weXJpZ2h0IDIwMTUgV2lsbGlhbSBTdW1tZXJzLCBNZXRhVHJpYmFsIExMQ1xuICogYWRhcHRlZCBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvSlhPTlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cHM6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qKlxuICogQGF1dGhvciBXaWxsaWFtIFN1bW1lcnNcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9tZXRhdHJpYmFsL3htbFRvSlNPTlxuICovXG52YXIgRE9NUGFyc2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQHhtbGRvbS94bWxkb20gKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvaW5kZXguanNcIikuRE9NUGFyc2VyO1xuXG52YXIgeG1sVG9KU09OID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnZlcnNpb24gPSBcIjEuMy41XCI7XG4gIHZhciBvcHRpb25zID0ge1xuICAgIC8vIHNldCB1cCB0aGUgZGVmYXVsdCBvcHRpb25zXG4gICAgbWVyZ2VDREFUQTogdHJ1ZSxcbiAgICAvLyBleHRyYWN0IGNkYXRhIGFuZCBtZXJnZSB3aXRoIHRleHRcbiAgICBub3JtYWxpemU6IHRydWUsXG4gICAgLy8gY29sbGFwc2UgbXVsdGlwbGUgc3BhY2VzIHRvIHNpbmdsZSBzcGFjZVxuICAgIHN0cmlwRWxlbVByZWZpeDogdHJ1ZSAvLyBmb3IgZWxlbWVudHMgb2Ygc2FtZSBuYW1lIGluIGRpZmYgbmFtZXNwYWNlcywgeW91IGNhbiBlbmFibGUgbmFtZXNwYWNlcyBhbmQgYWNjZXNzIHRoZSBuc2tleSBwcm9wZXJ0eVxuXG4gIH07XG4gIHZhciBwcmVmaXhNYXRjaCA9IG5ldyBSZWdFeHAoLyg/IXhtbG5zKV4uKjovKTtcbiAgdmFyIHRyaW1NYXRjaCA9IG5ldyBSZWdFeHAoL15cXHMrfFxccyskL2cpO1xuXG4gIHRoaXMuZ3Jva1R5cGUgPSBmdW5jdGlvbiAoc1ZhbHVlKSB7XG4gICAgaWYgKC9eXFxzKiQvLnRlc3Qoc1ZhbHVlKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgaWYgKC9eKD86dHJ1ZXxmYWxzZSkkL2kudGVzdChzVmFsdWUpKSB7XG4gICAgICByZXR1cm4gc1ZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xuICAgIH1cblxuICAgIGlmIChpc0Zpbml0ZShzVmFsdWUpKSB7XG4gICAgICByZXR1cm4gcGFyc2VGbG9hdChzVmFsdWUpO1xuICAgIH1cblxuICAgIHJldHVybiBzVmFsdWU7XG4gIH07XG5cbiAgdGhpcy5wYXJzZVN0cmluZyA9IGZ1bmN0aW9uICh4bWxTdHJpbmcsIG9wdCkge1xuICAgIGlmICh4bWxTdHJpbmcpIHtcbiAgICAgIHZhciB4bWwgPSB0aGlzLnN0cmluZ1RvWE1MKHhtbFN0cmluZyk7XG5cbiAgICAgIGlmICh4bWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3BhcnNlcmVycm9yJykubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VYTUwoeG1sLCBvcHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgdGhpcy5wYXJzZVhNTCA9IGZ1bmN0aW9uIChvWE1MUGFyZW50LCBvcHQpIHtcbiAgICAvLyBpbml0aWFsaXplIG9wdGlvbnNcbiAgICBmb3IgKHZhciBrZXkgaW4gb3B0KSB7XG4gICAgICBvcHRpb25zW2tleV0gPSBvcHRba2V5XTtcbiAgICB9XG5cbiAgICB2YXIgdlJlc3VsdCA9IHt9LFxuICAgICAgICBuTGVuZ3RoID0gMCxcbiAgICAgICAgc0NvbGxlY3RlZFR4dCA9IFwiXCI7IC8vIGl0ZXJhdGUgb3ZlciB0aGUgY2hpbGRyZW5cblxuICAgIHZhciBjaGlsZE51bSA9IG9YTUxQYXJlbnQuY2hpbGROb2Rlcy5sZW5ndGg7XG5cbiAgICBpZiAoY2hpbGROdW0pIHtcbiAgICAgIGZvciAodmFyIG9Ob2RlLCBzUHJvcCwgdkNvbnRlbnQsIG5JdGVtID0gMDsgbkl0ZW0gPCBvWE1MUGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoOyBuSXRlbSsrKSB7XG4gICAgICAgIG9Ob2RlID0gb1hNTFBhcmVudC5jaGlsZE5vZGVzLml0ZW0obkl0ZW0pO1xuXG4gICAgICAgIGlmIChvTm9kZS5ub2RlVHlwZSA9PT0gNCkge1xuICAgICAgICAgIGlmIChvcHRpb25zLm1lcmdlQ0RBVEEpIHtcbiAgICAgICAgICAgIHNDb2xsZWN0ZWRUeHQgKz0gb05vZGUubm9kZVZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvKiBub2RlVHlwZSBpcyBcIkNEQVRBU2VjdGlvblwiICg0KSAqL1xuICAgICAgICBlbHNlIGlmIChvTm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgIHNDb2xsZWN0ZWRUeHQgKz0gb05vZGUubm9kZVZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIC8qIG5vZGVUeXBlIGlzIFwiVGV4dFwiICgzKSAqL1xuICAgICAgICBlbHNlIGlmIChvTm9kZS5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgICAgIC8qIG5vZGVUeXBlIGlzIFwiRWxlbWVudFwiICgxKSAqL1xuICAgICAgICAgIGlmIChuTGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB2UmVzdWx0ID0ge307XG4gICAgICAgICAgfSAvLyB1c2luZyBub2RlTmFtZSB0byBzdXBwb3J0IGJyb3dzZXIgKElFKSBpbXBsZW1lbnRhdGlvbiB3aXRoIG5vICdsb2NhbE5hbWUnIHByb3BlcnR5XG5cblxuICAgICAgICAgIGlmIChvcHRpb25zLnN0cmlwRWxlbVByZWZpeCkge1xuICAgICAgICAgICAgc1Byb3AgPSBvTm9kZS5ub2RlTmFtZS5yZXBsYWNlKHByZWZpeE1hdGNoLCAnJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNQcm9wID0gb05vZGUubm9kZU5hbWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdkNvbnRlbnQgPSB4bWxUb0pTT04ucGFyc2VYTUwob05vZGUpO1xuXG4gICAgICAgICAgaWYgKHZSZXN1bHQuaGFzT3duUHJvcGVydHkoc1Byb3ApKSB7XG4gICAgICAgICAgICBpZiAodlJlc3VsdFtzUHJvcF0uY29uc3RydWN0b3IgIT09IEFycmF5KSB7XG4gICAgICAgICAgICAgIHZSZXN1bHRbc1Byb3BdID0gW3ZSZXN1bHRbc1Byb3BdXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0ucHVzaCh2Q29udGVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZSZXN1bHRbc1Byb3BdID0gdkNvbnRlbnQ7XG4gICAgICAgICAgICBuTGVuZ3RoKys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCFPYmplY3Qua2V5cyh2UmVzdWx0KS5sZW5ndGgpIHtcbiAgICAgIC8vIHZSZXN1bHQgPSBzQ29sbGVjdGVkVHh0LnJlcGxhY2UodHJpbU1hdGNoLCAnJykgfHwgJyc7IC8vIGJ5IGNhcnNvbnh1IOS/ruWkjSBnZXRCdWNrZXTov5Tlm57nmoQgS2V5IOaYryBcIiAvXCIg6L+Z56eN5Zy65pmvXG4gICAgICB2UmVzdWx0ID0gc0NvbGxlY3RlZFR4dCB8fCAnJztcbiAgICB9XG5cbiAgICByZXR1cm4gdlJlc3VsdDtcbiAgfTsgLy8gQ29udmVydCB4bWxEb2N1bWVudCB0byBhIHN0cmluZ1xuICAvLyBSZXR1cm5zIG51bGwgb24gZmFpbHVyZVxuXG5cbiAgdGhpcy54bWxUb1N0cmluZyA9IGZ1bmN0aW9uICh4bWxEb2MpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHhtbFN0cmluZyA9IHhtbERvYy54bWwgPyB4bWxEb2MueG1sIDogbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyh4bWxEb2MpO1xuICAgICAgcmV0dXJuIHhtbFN0cmluZztcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfTsgLy8gQ29udmVydCBhIHN0cmluZyB0byBYTUwgTm9kZSBTdHJ1Y3R1cmVcbiAgLy8gUmV0dXJucyBudWxsIG9uIGZhaWx1cmVcblxuXG4gIHRoaXMuc3RyaW5nVG9YTUwgPSBmdW5jdGlvbiAoeG1sU3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciB4bWxEb2MgPSBudWxsO1xuXG4gICAgICBpZiAod2luZG93LkRPTVBhcnNlcikge1xuICAgICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgICB4bWxEb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHhtbFN0cmluZywgXCJ0ZXh0L3htbFwiKTtcbiAgICAgICAgcmV0dXJuIHhtbERvYztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHhtbERvYyA9IG5ldyBBY3RpdmVYT2JqZWN0KFwiTWljcm9zb2Z0LlhNTERPTVwiKTtcbiAgICAgICAgeG1sRG9jLmFzeW5jID0gZmFsc2U7XG4gICAgICAgIHhtbERvYy5sb2FkWE1MKHhtbFN0cmluZyk7XG4gICAgICAgIHJldHVybiB4bWxEb2M7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB0aGlzO1xufS5jYWxsKHt9KTtcblxudmFyIHhtbDJqc29uID0gZnVuY3Rpb24geG1sMmpzb24oeG1sU3RyaW5nKSB7XG4gIHJldHVybiB4bWxUb0pTT04ucGFyc2VTdHJpbmcoeG1sU3RyaW5nKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0geG1sMmpzb247XG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2suanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiEqXFxcbiAgISoqKiAuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge1xuICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfY2xhc3NDYWxsQ2hlY2ssIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0cztcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcy5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3MuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO1xuICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtcbiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7XG4gIH1cbn1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge1xuICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtcbiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsIFwicHJvdG90eXBlXCIsIHtcbiAgICB3cml0YWJsZTogZmFsc2VcbiAgfSk7XG4gIHJldHVybiBDb25zdHJ1Y3Rvcjtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfY3JlYXRlQ2xhc3MsIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0cztcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuZnVuY3Rpb24gX3R5cGVvZihvYmopIHtcbiAgXCJAYmFiZWwvaGVscGVycyAtIHR5cGVvZlwiO1xuXG4gIHJldHVybiAobW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mID0gXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgXCJzeW1ib2xcIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge1xuICAgIHJldHVybiB0eXBlb2Ygb2JqO1xuICB9IDogZnVuY3Rpb24gKG9iaikge1xuICAgIHJldHVybiBvYmogJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7XG4gIH0sIG1vZHVsZS5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlLCBtb2R1bGUuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBtb2R1bGUuZXhwb3J0cyksIF90eXBlb2Yob2JqKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBfdHlwZW9mLCBtb2R1bGUuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZSwgbW9kdWxlLmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gbW9kdWxlLmV4cG9ydHM7XG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9jb252ZW50aW9ucy5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2NvbnZlbnRpb25zLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG4vKipcbiAqIFwiU2hhbGxvdyBmcmVlemVzXCIgYW4gb2JqZWN0IHRvIHJlbmRlciBpdCBpbW11dGFibGUuXG4gKiBVc2VzIGBPYmplY3QuZnJlZXplYCBpZiBhdmFpbGFibGUsXG4gKiBvdGhlcndpc2UgdGhlIGltbXV0YWJpbGl0eSBpcyBvbmx5IGluIHRoZSB0eXBlLlxuICpcbiAqIElzIHVzZWQgdG8gY3JlYXRlIFwiZW51bSBsaWtlXCIgb2JqZWN0cy5cbiAqXG4gKiBAdGVtcGxhdGUgVFxuICogQHBhcmFtIHtUfSBvYmplY3QgdGhlIG9iamVjdCB0byBmcmVlemVcbiAqIEBwYXJhbSB7UGljazxPYmplY3RDb25zdHJ1Y3RvciwgJ2ZyZWV6ZSc+ID0gT2JqZWN0fSBvYyBgT2JqZWN0YCBieSBkZWZhdWx0LFxuICogXHRcdFx0XHRhbGxvd3MgdG8gaW5qZWN0IGN1c3RvbSBvYmplY3QgY29uc3RydWN0b3IgZm9yIHRlc3RzXG4gKiBAcmV0dXJucyB7UmVhZG9ubHk8VD59XG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvZnJlZXplXG4gKi9cbmZ1bmN0aW9uIGZyZWV6ZShvYmplY3QsIG9jKSB7XG5cdGlmIChvYyA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0b2MgPSBPYmplY3Rcblx0fVxuXHRyZXR1cm4gb2MgJiYgdHlwZW9mIG9jLmZyZWV6ZSA9PT0gJ2Z1bmN0aW9uJyA/IG9jLmZyZWV6ZShvYmplY3QpIDogb2JqZWN0XG59XG5cbi8qKlxuICogU2luY2Ugd2UgY2FuIG5vdCByZWx5IG9uIGBPYmplY3QuYXNzaWduYCB3ZSBwcm92aWRlIGEgc2ltcGxpZmllZCB2ZXJzaW9uXG4gKiB0aGF0IGlzIHN1ZmZpY2llbnQgZm9yIG91ciBuZWVkcy5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0XG4gKiBAcGFyYW0ge09iamVjdCB8IG51bGwgfCB1bmRlZmluZWR9IHNvdXJjZVxuICpcbiAqIEByZXR1cm5zIHtPYmplY3R9IHRhcmdldFxuICogQHRocm93cyBUeXBlRXJyb3IgaWYgdGFyZ2V0IGlzIG5vdCBhbiBvYmplY3RcbiAqXG4gKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9hc3NpZ25cbiAqIEBzZWUgaHR0cHM6Ly90YzM5LmVzL2VjbWEyNjIvbXVsdGlwYWdlL2Z1bmRhbWVudGFsLW9iamVjdHMuaHRtbCNzZWMtb2JqZWN0LmFzc2lnblxuICovXG5mdW5jdGlvbiBhc3NpZ24odGFyZ2V0LCBzb3VyY2UpIHtcblx0aWYgKHRhcmdldCA9PT0gbnVsbCB8fCB0eXBlb2YgdGFyZ2V0ICE9PSAnb2JqZWN0Jykge1xuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoJ3RhcmdldCBpcyBub3QgYW4gb2JqZWN0Jylcblx0fVxuXHRmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7XG5cdFx0aWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHtcblx0XHRcdHRhcmdldFtrZXldID0gc291cmNlW2tleV1cblx0XHR9XG5cdH1cblx0cmV0dXJuIHRhcmdldFxufVxuXG4vKipcbiAqIEFsbCBtaW1lIHR5cGVzIHRoYXQgYXJlIGFsbG93ZWQgYXMgaW5wdXQgdG8gYERPTVBhcnNlci5wYXJzZUZyb21TdHJpbmdgXG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NUGFyc2VyL3BhcnNlRnJvbVN0cmluZyNBcmd1bWVudDAyIE1ETlxuICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9keW5hbWljLW1hcmt1cC1pbnNlcnRpb24uaHRtbCNkb21wYXJzZXJzdXBwb3J0ZWR0eXBlIFdIQVRXRyBIVE1MIFNwZWNcbiAqIEBzZWUgRE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmdcbiAqL1xudmFyIE1JTUVfVFlQRSA9IGZyZWV6ZSh7XG5cdC8qKlxuXHQgKiBgdGV4dC9odG1sYCwgdGhlIG9ubHkgbWltZSB0eXBlIHRoYXQgdHJpZ2dlcnMgdHJlYXRpbmcgYW4gWE1MIGRvY3VtZW50IGFzIEhUTUwuXG5cdCAqXG5cdCAqIEBzZWUgRE9NUGFyc2VyLlN1cHBvcnRlZFR5cGUuaXNIVE1MXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvdGV4dC9odG1sIElBTkEgTWltZVR5cGUgcmVnaXN0cmF0aW9uXG5cdCAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFRNTCBXaWtpcGVkaWFcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NUGFyc2VyL3BhcnNlRnJvbVN0cmluZyBNRE5cblx0ICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9keW5hbWljLW1hcmt1cC1pbnNlcnRpb24uaHRtbCNkb20tZG9tcGFyc2VyLXBhcnNlZnJvbXN0cmluZyBXSEFUV0cgSFRNTCBTcGVjXG5cdCAqL1xuXHRIVE1MOiAndGV4dC9odG1sJyxcblxuXHQvKipcblx0ICogSGVscGVyIG1ldGhvZCB0byBjaGVjayBhIG1pbWUgdHlwZSBpZiBpdCBpbmRpY2F0ZXMgYW4gSFRNTCBkb2N1bWVudFxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXVxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICpcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy90ZXh0L2h0bWwgSUFOQSBNaW1lVHlwZSByZWdpc3RyYXRpb25cblx0ICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IVE1MIFdpa2lwZWRpYVxuXHQgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9ET01QYXJzZXIvcGFyc2VGcm9tU3RyaW5nIE1ETlxuXHQgKiBAc2VlIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2R5bmFtaWMtbWFya3VwLWluc2VydGlvbi5odG1sI2RvbS1kb21wYXJzZXItcGFyc2Vmcm9tc3RyaW5nIFx0ICovXG5cdGlzSFRNTDogZnVuY3Rpb24gKHZhbHVlKSB7XG5cdFx0cmV0dXJuIHZhbHVlID09PSBNSU1FX1RZUEUuSFRNTFxuXHR9LFxuXG5cdC8qKlxuXHQgKiBgYXBwbGljYXRpb24veG1sYCwgdGhlIHN0YW5kYXJkIG1pbWUgdHlwZSBmb3IgWE1MIGRvY3VtZW50cy5cblx0ICpcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy9hcHBsaWNhdGlvbi94bWwgSUFOQSBNaW1lVHlwZSByZWdpc3RyYXRpb25cblx0ICogQHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNzMwMyNzZWN0aW9uLTkuMSBSRkMgNzMwM1xuXHQgKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1hNTF9hbmRfTUlNRSBXaWtpcGVkaWFcblx0ICovXG5cdFhNTF9BUFBMSUNBVElPTjogJ2FwcGxpY2F0aW9uL3htbCcsXG5cblx0LyoqXG5cdCAqIGB0ZXh0L2h0bWxgLCBhbiBhbGlhcyBmb3IgYGFwcGxpY2F0aW9uL3htbGAuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzczMDMjc2VjdGlvbi05LjIgUkZDIDczMDNcblx0ICogQHNlZSBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9tZWRpYS10eXBlcy90ZXh0L3htbCBJQU5BIE1pbWVUeXBlIHJlZ2lzdHJhdGlvblxuXHQgKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1hNTF9hbmRfTUlNRSBXaWtpcGVkaWFcblx0ICovXG5cdFhNTF9URVhUOiAndGV4dC94bWwnLFxuXG5cdC8qKlxuXHQgKiBgYXBwbGljYXRpb24veGh0bWwreG1sYCwgaW5kaWNhdGVzIGFuIFhNTCBkb2N1bWVudCB0aGF0IGhhcyB0aGUgZGVmYXVsdCBIVE1MIG5hbWVzcGFjZSxcblx0ICogYnV0IGlzIHBhcnNlZCBhcyBhbiBYTUwgZG9jdW1lbnQuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvYXBwbGljYXRpb24veGh0bWwreG1sIElBTkEgTWltZVR5cGUgcmVnaXN0cmF0aW9uXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNkb20tZG9taW1wbGVtZW50YXRpb24tY3JlYXRlZG9jdW1lbnQgV0hBVFdHIERPTSBTcGVjXG5cdCAqIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvWEhUTUwgV2lraXBlZGlhXG5cdCAqL1xuXHRYTUxfWEhUTUxfQVBQTElDQVRJT046ICdhcHBsaWNhdGlvbi94aHRtbCt4bWwnLFxuXG5cdC8qKlxuXHQgKiBgaW1hZ2Uvc3ZnK3htbGAsXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvaW1hZ2Uvc3ZnK3htbCBJQU5BIE1pbWVUeXBlIHJlZ2lzdHJhdGlvblxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9TVkcxMS8gVzNDIFNWRyAxLjFcblx0ICogQHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TY2FsYWJsZV9WZWN0b3JfR3JhcGhpY3MgV2lraXBlZGlhXG5cdCAqL1xuXHRYTUxfU1ZHX0lNQUdFOiAnaW1hZ2Uvc3ZnK3htbCcsXG59KVxuXG4vKipcbiAqIE5hbWVzcGFjZXMgdGhhdCBhcmUgdXNlZCBpbiB0aGlzIGNvZGUgYmFzZS5cbiAqXG4gKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL1RSL1JFQy14bWwtbmFtZXNcbiAqL1xudmFyIE5BTUVTUEFDRSA9IGZyZWV6ZSh7XG5cdC8qKlxuXHQgKiBUaGUgWEhUTUwgbmFtZXNwYWNlLlxuXHQgKlxuXHQgKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcblx0ICovXG5cdEhUTUw6ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJyxcblxuXHQvKipcblx0ICogQ2hlY2tzIGlmIGB1cmlgIGVxdWFscyBgTkFNRVNQQUNFLkhUTUxgLlxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gW3VyaV1cblx0ICpcblx0ICogQHNlZSBOQU1FU1BBQ0UuSFRNTFxuXHQgKi9cblx0aXNIVE1MOiBmdW5jdGlvbiAodXJpKSB7XG5cdFx0cmV0dXJuIHVyaSA9PT0gTkFNRVNQQUNFLkhUTUxcblx0fSxcblxuXHQvKipcblx0ICogVGhlIFNWRyBuYW1lc3BhY2UuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcblx0ICovXG5cdFNWRzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyxcblxuXHQvKipcblx0ICogVGhlIGB4bWw6YCBuYW1lc3BhY2UuXG5cdCAqXG5cdCAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlXG5cdCAqL1xuXHRYTUw6ICdodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UnLFxuXG5cdC8qKlxuXHQgKiBUaGUgYHhtbG5zOmAgbmFtZXNwYWNlXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvXG5cdCAqL1xuXHRYTUxOUzogJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAveG1sbnMvJyxcbn0pXG5cbmV4cG9ydHMuYXNzaWduID0gYXNzaWduO1xuZXhwb3J0cy5mcmVlemUgPSBmcmVlemU7XG5leHBvcnRzLk1JTUVfVFlQRSA9IE1JTUVfVFlQRTtcbmV4cG9ydHMuTkFNRVNQQUNFID0gTkFNRVNQQUNFO1xuXG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9kb20tcGFyc2VyLmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9kb20tcGFyc2VyLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbnZhciBjb252ZW50aW9ucyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vY29udmVudGlvbnMgKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvY29udmVudGlvbnMuanNcIik7XG52YXIgZG9tID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9kb20gKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvZG9tLmpzXCIpXG52YXIgZW50aXRpZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2VudGl0aWVzICovIFwiLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2VudGl0aWVzLmpzXCIpO1xudmFyIHNheCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vc2F4ICovIFwiLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL3NheC5qc1wiKTtcblxudmFyIERPTUltcGxlbWVudGF0aW9uID0gZG9tLkRPTUltcGxlbWVudGF0aW9uO1xuXG52YXIgTkFNRVNQQUNFID0gY29udmVudGlvbnMuTkFNRVNQQUNFO1xuXG52YXIgUGFyc2VFcnJvciA9IHNheC5QYXJzZUVycm9yO1xudmFyIFhNTFJlYWRlciA9IHNheC5YTUxSZWFkZXI7XG5cbi8qKlxuICogTm9ybWFsaXplcyBsaW5lIGVuZGluZyBhY2NvcmRpbmcgdG8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbDExLyNzZWMtbGluZS1lbmRzOlxuICpcbiAqID4gWE1MIHBhcnNlZCBlbnRpdGllcyBhcmUgb2Z0ZW4gc3RvcmVkIGluIGNvbXB1dGVyIGZpbGVzIHdoaWNoLFxuICogPiBmb3IgZWRpdGluZyBjb252ZW5pZW5jZSwgYXJlIG9yZ2FuaXplZCBpbnRvIGxpbmVzLlxuICogPiBUaGVzZSBsaW5lcyBhcmUgdHlwaWNhbGx5IHNlcGFyYXRlZCBieSBzb21lIGNvbWJpbmF0aW9uXG4gKiA+IG9mIHRoZSBjaGFyYWN0ZXJzIENBUlJJQUdFIFJFVFVSTiAoI3hEKSBhbmQgTElORSBGRUVEICgjeEEpLlxuICogPlxuICogPiBUbyBzaW1wbGlmeSB0aGUgdGFza3Mgb2YgYXBwbGljYXRpb25zLCB0aGUgWE1MIHByb2Nlc3NvciBtdXN0IGJlaGF2ZVxuICogPiBhcyBpZiBpdCBub3JtYWxpemVkIGFsbCBsaW5lIGJyZWFrcyBpbiBleHRlcm5hbCBwYXJzZWQgZW50aXRpZXMgKGluY2x1ZGluZyB0aGUgZG9jdW1lbnQgZW50aXR5KVxuICogPiBvbiBpbnB1dCwgYmVmb3JlIHBhcnNpbmcsIGJ5IHRyYW5zbGF0aW5nIGFsbCBvZiB0aGUgZm9sbG93aW5nIHRvIGEgc2luZ2xlICN4QSBjaGFyYWN0ZXI6XG4gKiA+XG4gKiA+IDEuIHRoZSB0d28tY2hhcmFjdGVyIHNlcXVlbmNlICN4RCAjeEFcbiAqID4gMi4gdGhlIHR3by1jaGFyYWN0ZXIgc2VxdWVuY2UgI3hEICN4ODVcbiAqID4gMy4gdGhlIHNpbmdsZSBjaGFyYWN0ZXIgI3g4NVxuICogPiA0LiB0aGUgc2luZ2xlIGNoYXJhY3RlciAjeDIwMjhcbiAqID4gNS4gYW55ICN4RCBjaGFyYWN0ZXIgdGhhdCBpcyBub3QgaW1tZWRpYXRlbHkgZm9sbG93ZWQgYnkgI3hBIG9yICN4ODUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0XG4gKiBAcmV0dXJucyB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBub3JtYWxpemVMaW5lRW5kaW5ncyhpbnB1dCkge1xuXHRyZXR1cm4gaW5wdXRcblx0XHQucmVwbGFjZSgvXFxyW1xcblxcdTAwODVdL2csICdcXG4nKVxuXHRcdC5yZXBsYWNlKC9bXFxyXFx1MDA4NVxcdTIwMjhdL2csICdcXG4nKVxufVxuXG4vKipcbiAqIEB0eXBlZGVmIExvY2F0b3JcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbY29sdW1uTnVtYmVyXVxuICogQHByb3BlcnR5IHtudW1iZXJ9IFtsaW5lTnVtYmVyXVxuICovXG5cbi8qKlxuICogQHR5cGVkZWYgRE9NUGFyc2VyT3B0aW9uc1xuICogQHByb3BlcnR5IHtET01IYW5kbGVyfSBbZG9tQnVpbGRlcl1cbiAqIEBwcm9wZXJ0eSB7RnVuY3Rpb259IFtlcnJvckhhbmRsZXJdXG4gKiBAcHJvcGVydHkgeyhzdHJpbmcpID0+IHN0cmluZ30gW25vcm1hbGl6ZUxpbmVFbmRpbmdzXSB1c2VkIHRvIHJlcGxhY2UgbGluZSBlbmRpbmdzIGJlZm9yZSBwYXJzaW5nXG4gKiBcdFx0XHRcdFx0XHRkZWZhdWx0cyB0byBgbm9ybWFsaXplTGluZUVuZGluZ3NgXG4gKiBAcHJvcGVydHkge0xvY2F0b3J9IFtsb2NhdG9yXVxuICogQHByb3BlcnR5IHtSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+fSBbeG1sbnNdXG4gKlxuICogQHNlZSBub3JtYWxpemVMaW5lRW5kaW5nc1xuICovXG5cbi8qKlxuICogVGhlIERPTVBhcnNlciBpbnRlcmZhY2UgcHJvdmlkZXMgdGhlIGFiaWxpdHkgdG8gcGFyc2UgWE1MIG9yIEhUTUwgc291cmNlIGNvZGVcbiAqIGZyb20gYSBzdHJpbmcgaW50byBhIERPTSBgRG9jdW1lbnRgLlxuICpcbiAqIF94bWxkb20gaXMgZGlmZmVyZW50IGZyb20gdGhlIHNwZWMgaW4gdGhhdCBpdCBhbGxvd3MgYW4gYG9wdGlvbnNgIHBhcmFtZXRlcixcbiAqIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yLl9cbiAqXG4gKiBAcGFyYW0ge0RPTVBhcnNlck9wdGlvbnN9IFtvcHRpb25zXVxuICogQGNvbnN0cnVjdG9yXG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NUGFyc2VyXG4gKiBAc2VlIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2R5bmFtaWMtbWFya3VwLWluc2VydGlvbi5odG1sI2RvbS1wYXJzaW5nLWFuZC1zZXJpYWxpemF0aW9uXG4gKi9cbmZ1bmN0aW9uIERPTVBhcnNlcihvcHRpb25zKXtcblx0dGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fHtsb2NhdG9yOnt9fTtcbn1cblxuRE9NUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZyb21TdHJpbmcgPSBmdW5jdGlvbihzb3VyY2UsbWltZVR5cGUpe1xuXHR2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcblx0dmFyIHNheCA9ICBuZXcgWE1MUmVhZGVyKCk7XG5cdHZhciBkb21CdWlsZGVyID0gb3B0aW9ucy5kb21CdWlsZGVyIHx8IG5ldyBET01IYW5kbGVyKCk7Ly9jb250ZW50SGFuZGxlciBhbmQgTGV4aWNhbEhhbmRsZXJcblx0dmFyIGVycm9ySGFuZGxlciA9IG9wdGlvbnMuZXJyb3JIYW5kbGVyO1xuXHR2YXIgbG9jYXRvciA9IG9wdGlvbnMubG9jYXRvcjtcblx0dmFyIGRlZmF1bHROU01hcCA9IG9wdGlvbnMueG1sbnN8fHt9O1xuXHR2YXIgaXNIVE1MID0gL1xcL3g/aHRtbD8kLy50ZXN0KG1pbWVUeXBlKTsvL21pbWVUeXBlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignaHRtbCcpID4gLTE7XG4gIFx0dmFyIGVudGl0eU1hcCA9IGlzSFRNTCA/IGVudGl0aWVzLkhUTUxfRU5USVRJRVMgOiBlbnRpdGllcy5YTUxfRU5USVRJRVM7XG5cdGlmKGxvY2F0b3Ipe1xuXHRcdGRvbUJ1aWxkZXIuc2V0RG9jdW1lbnRMb2NhdG9yKGxvY2F0b3IpXG5cdH1cblxuXHRzYXguZXJyb3JIYW5kbGVyID0gYnVpbGRFcnJvckhhbmRsZXIoZXJyb3JIYW5kbGVyLGRvbUJ1aWxkZXIsbG9jYXRvcik7XG5cdHNheC5kb21CdWlsZGVyID0gb3B0aW9ucy5kb21CdWlsZGVyIHx8IGRvbUJ1aWxkZXI7XG5cdGlmKGlzSFRNTCl7XG5cdFx0ZGVmYXVsdE5TTWFwWycnXSA9IE5BTUVTUEFDRS5IVE1MO1xuXHR9XG5cdGRlZmF1bHROU01hcC54bWwgPSBkZWZhdWx0TlNNYXAueG1sIHx8IE5BTUVTUEFDRS5YTUw7XG5cdHZhciBub3JtYWxpemUgPSBvcHRpb25zLm5vcm1hbGl6ZUxpbmVFbmRpbmdzIHx8IG5vcm1hbGl6ZUxpbmVFbmRpbmdzO1xuXHRpZiAoc291cmNlICYmIHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSB7XG5cdFx0c2F4LnBhcnNlKFxuXHRcdFx0bm9ybWFsaXplKHNvdXJjZSksXG5cdFx0XHRkZWZhdWx0TlNNYXAsXG5cdFx0XHRlbnRpdHlNYXBcblx0XHQpXG5cdH0gZWxzZSB7XG5cdFx0c2F4LmVycm9ySGFuZGxlci5lcnJvcignaW52YWxpZCBkb2Mgc291cmNlJylcblx0fVxuXHRyZXR1cm4gZG9tQnVpbGRlci5kb2M7XG59XG5mdW5jdGlvbiBidWlsZEVycm9ySGFuZGxlcihlcnJvckltcGwsZG9tQnVpbGRlcixsb2NhdG9yKXtcblx0aWYoIWVycm9ySW1wbCl7XG5cdFx0aWYoZG9tQnVpbGRlciBpbnN0YW5jZW9mIERPTUhhbmRsZXIpe1xuXHRcdFx0cmV0dXJuIGRvbUJ1aWxkZXI7XG5cdFx0fVxuXHRcdGVycm9ySW1wbCA9IGRvbUJ1aWxkZXIgO1xuXHR9XG5cdHZhciBlcnJvckhhbmRsZXIgPSB7fVxuXHR2YXIgaXNDYWxsYmFjayA9IGVycm9ySW1wbCBpbnN0YW5jZW9mIEZ1bmN0aW9uO1xuXHRsb2NhdG9yID0gbG9jYXRvcnx8e31cblx0ZnVuY3Rpb24gYnVpbGQoa2V5KXtcblx0XHR2YXIgZm4gPSBlcnJvckltcGxba2V5XTtcblx0XHRpZighZm4gJiYgaXNDYWxsYmFjayl7XG5cdFx0XHRmbiA9IGVycm9ySW1wbC5sZW5ndGggPT0gMj9mdW5jdGlvbihtc2cpe2Vycm9ySW1wbChrZXksbXNnKX06ZXJyb3JJbXBsO1xuXHRcdH1cblx0XHRlcnJvckhhbmRsZXJba2V5XSA9IGZuICYmIGZ1bmN0aW9uKG1zZyl7XG5cdFx0XHRmbignW3htbGRvbSAnK2tleSsnXVxcdCcrbXNnK19sb2NhdG9yKGxvY2F0b3IpKTtcblx0XHR9fHxmdW5jdGlvbigpe307XG5cdH1cblx0YnVpbGQoJ3dhcm5pbmcnKTtcblx0YnVpbGQoJ2Vycm9yJyk7XG5cdGJ1aWxkKCdmYXRhbEVycm9yJyk7XG5cdHJldHVybiBlcnJvckhhbmRsZXI7XG59XG5cbi8vY29uc29sZS5sb2coJyNcXG5cXG5cXG5cXG5cXG5cXG5cXG4jIyMjJylcbi8qKlxuICogK0NvbnRlbnRIYW5kbGVyK0Vycm9ySGFuZGxlclxuICogK0xleGljYWxIYW5kbGVyK0VudGl0eVJlc29sdmVyMlxuICogLURlY2xIYW5kbGVyLURUREhhbmRsZXJcbiAqXG4gKiBEZWZhdWx0SGFuZGxlcjpFbnRpdHlSZXNvbHZlciwgRFRESGFuZGxlciwgQ29udGVudEhhbmRsZXIsIEVycm9ySGFuZGxlclxuICogRGVmYXVsdEhhbmRsZXIyOkRlZmF1bHRIYW5kbGVyLExleGljYWxIYW5kbGVyLCBEZWNsSGFuZGxlciwgRW50aXR5UmVzb2x2ZXIyXG4gKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9oZWxwZXJzL0RlZmF1bHRIYW5kbGVyLmh0bWxcbiAqL1xuZnVuY3Rpb24gRE9NSGFuZGxlcigpIHtcbiAgICB0aGlzLmNkYXRhID0gZmFsc2U7XG59XG5mdW5jdGlvbiBwb3NpdGlvbihsb2NhdG9yLG5vZGUpe1xuXHRub2RlLmxpbmVOdW1iZXIgPSBsb2NhdG9yLmxpbmVOdW1iZXI7XG5cdG5vZGUuY29sdW1uTnVtYmVyID0gbG9jYXRvci5jb2x1bW5OdW1iZXI7XG59XG4vKipcbiAqIEBzZWUgb3JnLnhtbC5zYXguQ29udGVudEhhbmRsZXIjc3RhcnREb2N1bWVudFxuICogQGxpbmsgaHR0cDovL3d3dy5zYXhwcm9qZWN0Lm9yZy9hcGlkb2Mvb3JnL3htbC9zYXgvQ29udGVudEhhbmRsZXIuaHRtbFxuICovXG5ET01IYW5kbGVyLnByb3RvdHlwZSA9IHtcblx0c3RhcnREb2N1bWVudCA6IGZ1bmN0aW9uKCkge1xuICAgIFx0dGhpcy5kb2MgPSBuZXcgRE9NSW1wbGVtZW50YXRpb24oKS5jcmVhdGVEb2N1bWVudChudWxsLCBudWxsLCBudWxsKTtcbiAgICBcdGlmICh0aGlzLmxvY2F0b3IpIHtcbiAgICAgICAgXHR0aGlzLmRvYy5kb2N1bWVudFVSSSA9IHRoaXMubG9jYXRvci5zeXN0ZW1JZDtcbiAgICBcdH1cblx0fSxcblx0c3RhcnRFbGVtZW50OmZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lLCBxTmFtZSwgYXR0cnMpIHtcblx0XHR2YXIgZG9jID0gdGhpcy5kb2M7XG5cdCAgICB2YXIgZWwgPSBkb2MuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZVVSSSwgcU5hbWV8fGxvY2FsTmFtZSk7XG5cdCAgICB2YXIgbGVuID0gYXR0cnMubGVuZ3RoO1xuXHQgICAgYXBwZW5kRWxlbWVudCh0aGlzLCBlbCk7XG5cdCAgICB0aGlzLmN1cnJlbnRFbGVtZW50ID0gZWw7XG5cblx0XHR0aGlzLmxvY2F0b3IgJiYgcG9zaXRpb24odGhpcy5sb2NhdG9yLGVsKVxuXHQgICAgZm9yICh2YXIgaSA9IDAgOyBpIDwgbGVuOyBpKyspIHtcblx0ICAgICAgICB2YXIgbmFtZXNwYWNlVVJJID0gYXR0cnMuZ2V0VVJJKGkpO1xuXHQgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJzLmdldFZhbHVlKGkpO1xuXHQgICAgICAgIHZhciBxTmFtZSA9IGF0dHJzLmdldFFOYW1lKGkpO1xuXHRcdFx0dmFyIGF0dHIgPSBkb2MuY3JlYXRlQXR0cmlidXRlTlMobmFtZXNwYWNlVVJJLCBxTmFtZSk7XG5cdFx0XHR0aGlzLmxvY2F0b3IgJiZwb3NpdGlvbihhdHRycy5nZXRMb2NhdG9yKGkpLGF0dHIpO1xuXHRcdFx0YXR0ci52YWx1ZSA9IGF0dHIubm9kZVZhbHVlID0gdmFsdWU7XG5cdFx0XHRlbC5zZXRBdHRyaWJ1dGVOb2RlKGF0dHIpXG5cdCAgICB9XG5cdH0sXG5cdGVuZEVsZW1lbnQ6ZnVuY3Rpb24obmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUsIHFOYW1lKSB7XG5cdFx0dmFyIGN1cnJlbnQgPSB0aGlzLmN1cnJlbnRFbGVtZW50XG5cdFx0dmFyIHRhZ05hbWUgPSBjdXJyZW50LnRhZ05hbWU7XG5cdFx0dGhpcy5jdXJyZW50RWxlbWVudCA9IGN1cnJlbnQucGFyZW50Tm9kZTtcblx0fSxcblx0c3RhcnRQcmVmaXhNYXBwaW5nOmZ1bmN0aW9uKHByZWZpeCwgdXJpKSB7XG5cdH0sXG5cdGVuZFByZWZpeE1hcHBpbmc6ZnVuY3Rpb24ocHJlZml4KSB7XG5cdH0sXG5cdHByb2Nlc3NpbmdJbnN0cnVjdGlvbjpmdW5jdGlvbih0YXJnZXQsIGRhdGEpIHtcblx0ICAgIHZhciBpbnMgPSB0aGlzLmRvYy5jcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24odGFyZ2V0LCBkYXRhKTtcblx0ICAgIHRoaXMubG9jYXRvciAmJiBwb3NpdGlvbih0aGlzLmxvY2F0b3IsaW5zKVxuXHQgICAgYXBwZW5kRWxlbWVudCh0aGlzLCBpbnMpO1xuXHR9LFxuXHRpZ25vcmFibGVXaGl0ZXNwYWNlOmZ1bmN0aW9uKGNoLCBzdGFydCwgbGVuZ3RoKSB7XG5cdH0sXG5cdGNoYXJhY3RlcnM6ZnVuY3Rpb24oY2hhcnMsIHN0YXJ0LCBsZW5ndGgpIHtcblx0XHRjaGFycyA9IF90b1N0cmluZy5hcHBseSh0aGlzLGFyZ3VtZW50cylcblx0XHQvL2NvbnNvbGUubG9nKGNoYXJzKVxuXHRcdGlmKGNoYXJzKXtcblx0XHRcdGlmICh0aGlzLmNkYXRhKSB7XG5cdFx0XHRcdHZhciBjaGFyTm9kZSA9IHRoaXMuZG9jLmNyZWF0ZUNEQVRBU2VjdGlvbihjaGFycyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YXIgY2hhck5vZGUgPSB0aGlzLmRvYy5jcmVhdGVUZXh0Tm9kZShjaGFycyk7XG5cdFx0XHR9XG5cdFx0XHRpZih0aGlzLmN1cnJlbnRFbGVtZW50KXtcblx0XHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudC5hcHBlbmRDaGlsZChjaGFyTm9kZSk7XG5cdFx0XHR9ZWxzZSBpZigvXlxccyokLy50ZXN0KGNoYXJzKSl7XG5cdFx0XHRcdHRoaXMuZG9jLmFwcGVuZENoaWxkKGNoYXJOb2RlKTtcblx0XHRcdFx0Ly9wcm9jZXNzIHhtbFxuXHRcdFx0fVxuXHRcdFx0dGhpcy5sb2NhdG9yICYmIHBvc2l0aW9uKHRoaXMubG9jYXRvcixjaGFyTm9kZSlcblx0XHR9XG5cdH0sXG5cdHNraXBwZWRFbnRpdHk6ZnVuY3Rpb24obmFtZSkge1xuXHR9LFxuXHRlbmREb2N1bWVudDpmdW5jdGlvbigpIHtcblx0XHR0aGlzLmRvYy5ub3JtYWxpemUoKTtcblx0fSxcblx0c2V0RG9jdW1lbnRMb2NhdG9yOmZ1bmN0aW9uIChsb2NhdG9yKSB7XG5cdCAgICBpZih0aGlzLmxvY2F0b3IgPSBsb2NhdG9yKXsvLyAmJiAhKCdsaW5lTnVtYmVyJyBpbiBsb2NhdG9yKSl7XG5cdCAgICBcdGxvY2F0b3IubGluZU51bWJlciA9IDA7XG5cdCAgICB9XG5cdH0sXG5cdC8vTGV4aWNhbEhhbmRsZXJcblx0Y29tbWVudDpmdW5jdGlvbihjaGFycywgc3RhcnQsIGxlbmd0aCkge1xuXHRcdGNoYXJzID0gX3RvU3RyaW5nLmFwcGx5KHRoaXMsYXJndW1lbnRzKVxuXHQgICAgdmFyIGNvbW0gPSB0aGlzLmRvYy5jcmVhdGVDb21tZW50KGNoYXJzKTtcblx0ICAgIHRoaXMubG9jYXRvciAmJiBwb3NpdGlvbih0aGlzLmxvY2F0b3IsY29tbSlcblx0ICAgIGFwcGVuZEVsZW1lbnQodGhpcywgY29tbSk7XG5cdH0sXG5cblx0c3RhcnRDREFUQTpmdW5jdGlvbigpIHtcblx0ICAgIC8vdXNlZCBpbiBjaGFyYWN0ZXJzKCkgbWV0aG9kc1xuXHQgICAgdGhpcy5jZGF0YSA9IHRydWU7XG5cdH0sXG5cdGVuZENEQVRBOmZ1bmN0aW9uKCkge1xuXHQgICAgdGhpcy5jZGF0YSA9IGZhbHNlO1xuXHR9LFxuXG5cdHN0YXJ0RFREOmZ1bmN0aW9uKG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkge1xuXHRcdHZhciBpbXBsID0gdGhpcy5kb2MuaW1wbGVtZW50YXRpb247XG5cdCAgICBpZiAoaW1wbCAmJiBpbXBsLmNyZWF0ZURvY3VtZW50VHlwZSkge1xuXHQgICAgICAgIHZhciBkdCA9IGltcGwuY3JlYXRlRG9jdW1lbnRUeXBlKG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCk7XG5cdCAgICAgICAgdGhpcy5sb2NhdG9yICYmIHBvc2l0aW9uKHRoaXMubG9jYXRvcixkdClcblx0ICAgICAgICBhcHBlbmRFbGVtZW50KHRoaXMsIGR0KTtcblx0XHRcdFx0XHR0aGlzLmRvYy5kb2N0eXBlID0gZHQ7XG5cdCAgICB9XG5cdH0sXG5cdC8qKlxuXHQgKiBAc2VlIG9yZy54bWwuc2F4LkVycm9ySGFuZGxlclxuXHQgKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9FcnJvckhhbmRsZXIuaHRtbFxuXHQgKi9cblx0d2FybmluZzpmdW5jdGlvbihlcnJvcikge1xuXHRcdGNvbnNvbGUud2FybignW3htbGRvbSB3YXJuaW5nXVxcdCcrZXJyb3IsX2xvY2F0b3IodGhpcy5sb2NhdG9yKSk7XG5cdH0sXG5cdGVycm9yOmZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcignW3htbGRvbSBlcnJvcl1cXHQnK2Vycm9yLF9sb2NhdG9yKHRoaXMubG9jYXRvcikpO1xuXHR9LFxuXHRmYXRhbEVycm9yOmZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0dGhyb3cgbmV3IFBhcnNlRXJyb3IoZXJyb3IsIHRoaXMubG9jYXRvcik7XG5cdH1cbn1cbmZ1bmN0aW9uIF9sb2NhdG9yKGwpe1xuXHRpZihsKXtcblx0XHRyZXR1cm4gJ1xcbkAnKyhsLnN5c3RlbUlkIHx8JycpKycjW2xpbmU6JytsLmxpbmVOdW1iZXIrJyxjb2w6JytsLmNvbHVtbk51bWJlcisnXSdcblx0fVxufVxuZnVuY3Rpb24gX3RvU3RyaW5nKGNoYXJzLHN0YXJ0LGxlbmd0aCl7XG5cdGlmKHR5cGVvZiBjaGFycyA9PSAnc3RyaW5nJyl7XG5cdFx0cmV0dXJuIGNoYXJzLnN1YnN0cihzdGFydCxsZW5ndGgpXG5cdH1lbHNley8vamF2YSBzYXggY29ubmVjdCB3aWR0aCB4bWxkb20gb24gcmhpbm8od2hhdCBhYm91dDogXCI/ICYmICEoY2hhcnMgaW5zdGFuY2VvZiBTdHJpbmcpXCIpXG5cdFx0aWYoY2hhcnMubGVuZ3RoID49IHN0YXJ0K2xlbmd0aCB8fCBzdGFydCl7XG5cdFx0XHRyZXR1cm4gbmV3IGphdmEubGFuZy5TdHJpbmcoY2hhcnMsc3RhcnQsbGVuZ3RoKSsnJztcblx0XHR9XG5cdFx0cmV0dXJuIGNoYXJzO1xuXHR9XG59XG5cbi8qXG4gKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9leHQvTGV4aWNhbEhhbmRsZXIuaHRtbFxuICogdXNlZCBtZXRob2Qgb2Ygb3JnLnhtbC5zYXguZXh0LkxleGljYWxIYW5kbGVyOlxuICogICNjb21tZW50KGNoYXJzLCBzdGFydCwgbGVuZ3RoKVxuICogICNzdGFydENEQVRBKClcbiAqICAjZW5kQ0RBVEEoKVxuICogICNzdGFydERURChuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpXG4gKlxuICpcbiAqIElHTk9SRUQgbWV0aG9kIG9mIG9yZy54bWwuc2F4LmV4dC5MZXhpY2FsSGFuZGxlcjpcbiAqICAjZW5kRFREKClcbiAqICAjc3RhcnRFbnRpdHkobmFtZSlcbiAqICAjZW5kRW50aXR5KG5hbWUpXG4gKlxuICpcbiAqIEBsaW5rIGh0dHA6Ly93d3cuc2F4cHJvamVjdC5vcmcvYXBpZG9jL29yZy94bWwvc2F4L2V4dC9EZWNsSGFuZGxlci5odG1sXG4gKiBJR05PUkVEIG1ldGhvZCBvZiBvcmcueG1sLnNheC5leHQuRGVjbEhhbmRsZXJcbiAqIFx0I2F0dHJpYnV0ZURlY2woZU5hbWUsIGFOYW1lLCB0eXBlLCBtb2RlLCB2YWx1ZSlcbiAqICAjZWxlbWVudERlY2wobmFtZSwgbW9kZWwpXG4gKiAgI2V4dGVybmFsRW50aXR5RGVjbChuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpXG4gKiAgI2ludGVybmFsRW50aXR5RGVjbChuYW1lLCB2YWx1ZSlcbiAqIEBsaW5rIGh0dHA6Ly93d3cuc2F4cHJvamVjdC5vcmcvYXBpZG9jL29yZy94bWwvc2F4L2V4dC9FbnRpdHlSZXNvbHZlcjIuaHRtbFxuICogSUdOT1JFRCBtZXRob2Qgb2Ygb3JnLnhtbC5zYXguRW50aXR5UmVzb2x2ZXIyXG4gKiAgI3Jlc29sdmVFbnRpdHkoU3RyaW5nIG5hbWUsU3RyaW5nIHB1YmxpY0lkLFN0cmluZyBiYXNlVVJJLFN0cmluZyBzeXN0ZW1JZClcbiAqICAjcmVzb2x2ZUVudGl0eShwdWJsaWNJZCwgc3lzdGVtSWQpXG4gKiAgI2dldEV4dGVybmFsU3Vic2V0KG5hbWUsIGJhc2VVUkkpXG4gKiBAbGluayBodHRwOi8vd3d3LnNheHByb2plY3Qub3JnL2FwaWRvYy9vcmcveG1sL3NheC9EVERIYW5kbGVyLmh0bWxcbiAqIElHTk9SRUQgbWV0aG9kIG9mIG9yZy54bWwuc2F4LkRUREhhbmRsZXJcbiAqICAjbm90YXRpb25EZWNsKG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkge307XG4gKiAgI3VucGFyc2VkRW50aXR5RGVjbChuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQsIG5vdGF0aW9uTmFtZSkge307XG4gKi9cblwiZW5kRFRELHN0YXJ0RW50aXR5LGVuZEVudGl0eSxhdHRyaWJ1dGVEZWNsLGVsZW1lbnREZWNsLGV4dGVybmFsRW50aXR5RGVjbCxpbnRlcm5hbEVudGl0eURlY2wscmVzb2x2ZUVudGl0eSxnZXRFeHRlcm5hbFN1YnNldCxub3RhdGlvbkRlY2wsdW5wYXJzZWRFbnRpdHlEZWNsXCIucmVwbGFjZSgvXFx3Ky9nLGZ1bmN0aW9uKGtleSl7XG5cdERPTUhhbmRsZXIucHJvdG90eXBlW2tleV0gPSBmdW5jdGlvbigpe3JldHVybiBudWxsfVxufSlcblxuLyogUHJpdmF0ZSBzdGF0aWMgaGVscGVycyB0cmVhdGVkIGJlbG93IGFzIHByaXZhdGUgaW5zdGFuY2UgbWV0aG9kcywgc28gZG9uJ3QgbmVlZCB0byBhZGQgdGhlc2UgdG8gdGhlIHB1YmxpYyBBUEk7IHdlIG1pZ2h0IHVzZSBhIFJlbGF0b3IgdG8gYWxzbyBnZXQgcmlkIG9mIG5vbi1zdGFuZGFyZCBwdWJsaWMgcHJvcGVydGllcyAqL1xuZnVuY3Rpb24gYXBwZW5kRWxlbWVudCAoaGFuZGVyLG5vZGUpIHtcbiAgICBpZiAoIWhhbmRlci5jdXJyZW50RWxlbWVudCkge1xuICAgICAgICBoYW5kZXIuZG9jLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGhhbmRlci5jdXJyZW50RWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICB9XG59Ly9hcHBlbmRDaGlsZCBhbmQgc2V0QXR0cmlidXRlTlMgYXJlIHByZWZvcm1hbmNlIGtleVxuXG5leHBvcnRzLl9fRE9NSGFuZGxlciA9IERPTUhhbmRsZXI7XG5leHBvcnRzLm5vcm1hbGl6ZUxpbmVFbmRpbmdzID0gbm9ybWFsaXplTGluZUVuZGluZ3M7XG5leHBvcnRzLkRPTVBhcnNlciA9IERPTVBhcnNlcjtcblxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvZG9tLmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2RvbS5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbnZhciBjb252ZW50aW9ucyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vY29udmVudGlvbnMgKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvY29udmVudGlvbnMuanNcIik7XG5cbnZhciBOQU1FU1BBQ0UgPSBjb252ZW50aW9ucy5OQU1FU1BBQ0U7XG5cbi8qKlxuICogQSBwcmVyZXF1aXNpdGUgZm9yIGBbXS5maWx0ZXJgLCB0byBkcm9wIGVsZW1lbnRzIHRoYXQgYXJlIGVtcHR5XG4gKiBAcGFyYW0ge3N0cmluZ30gaW5wdXRcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5mdW5jdGlvbiBub3RFbXB0eVN0cmluZyAoaW5wdXQpIHtcblx0cmV0dXJuIGlucHV0ICE9PSAnJ1xufVxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vaW5mcmEuc3BlYy53aGF0d2cub3JnLyNzcGxpdC1vbi1hc2NpaS13aGl0ZXNwYWNlXG4gKiBAc2VlIGh0dHBzOi8vaW5mcmEuc3BlYy53aGF0d2cub3JnLyNhc2NpaS13aGl0ZXNwYWNlXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0XG4gKiBAcmV0dXJucyB7c3RyaW5nW119IChjYW4gYmUgZW1wdHkpXG4gKi9cbmZ1bmN0aW9uIHNwbGl0T25BU0NJSVdoaXRlc3BhY2UoaW5wdXQpIHtcblx0Ly8gVSswMDA5IFRBQiwgVSswMDBBIExGLCBVKzAwMEMgRkYsIFUrMDAwRCBDUiwgVSswMDIwIFNQQUNFXG5cdHJldHVybiBpbnB1dCA/IGlucHV0LnNwbGl0KC9bXFx0XFxuXFxmXFxyIF0rLykuZmlsdGVyKG5vdEVtcHR5U3RyaW5nKSA6IFtdXG59XG5cbi8qKlxuICogQWRkcyBlbGVtZW50IGFzIGEga2V5IHRvIGN1cnJlbnQgaWYgaXQgaXMgbm90IGFscmVhZHkgcHJlc2VudC5cbiAqXG4gKiBAcGFyYW0ge1JlY29yZDxzdHJpbmcsIGJvb2xlYW4gfCB1bmRlZmluZWQ+fSBjdXJyZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudFxuICogQHJldHVybnMge1JlY29yZDxzdHJpbmcsIGJvb2xlYW4gfCB1bmRlZmluZWQ+fVxuICovXG5mdW5jdGlvbiBvcmRlcmVkU2V0UmVkdWNlciAoY3VycmVudCwgZWxlbWVudCkge1xuXHRpZiAoIWN1cnJlbnQuaGFzT3duUHJvcGVydHkoZWxlbWVudCkpIHtcblx0XHRjdXJyZW50W2VsZW1lbnRdID0gdHJ1ZTtcblx0fVxuXHRyZXR1cm4gY3VycmVudDtcbn1cblxuLyoqXG4gKiBAc2VlIGh0dHBzOi8vaW5mcmEuc3BlYy53aGF0d2cub3JnLyNvcmRlcmVkLXNldFxuICogQHBhcmFtIHtzdHJpbmd9IGlucHV0XG4gKiBAcmV0dXJucyB7c3RyaW5nW119XG4gKi9cbmZ1bmN0aW9uIHRvT3JkZXJlZFNldChpbnB1dCkge1xuXHRpZiAoIWlucHV0KSByZXR1cm4gW107XG5cdHZhciBsaXN0ID0gc3BsaXRPbkFTQ0lJV2hpdGVzcGFjZShpbnB1dCk7XG5cdHJldHVybiBPYmplY3Qua2V5cyhsaXN0LnJlZHVjZShvcmRlcmVkU2V0UmVkdWNlciwge30pKVxufVxuXG4vKipcbiAqIFVzZXMgYGxpc3QuaW5kZXhPZmAgdG8gaW1wbGVtZW50IHNvbWV0aGluZyBsaWtlIGBBcnJheS5wcm90b3R5cGUuaW5jbHVkZXNgLFxuICogd2hpY2ggd2UgY2FuIG5vdCByZWx5IG9uIGJlaW5nIGF2YWlsYWJsZS5cbiAqXG4gKiBAcGFyYW0ge2FueVtdfSBsaXN0XG4gKiBAcmV0dXJucyB7ZnVuY3Rpb24oYW55KTogYm9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gYXJyYXlJbmNsdWRlcyAobGlzdCkge1xuXHRyZXR1cm4gZnVuY3Rpb24oZWxlbWVudCkge1xuXHRcdHJldHVybiBsaXN0ICYmIGxpc3QuaW5kZXhPZihlbGVtZW50KSAhPT0gLTE7XG5cdH1cbn1cblxuZnVuY3Rpb24gY29weShzcmMsZGVzdCl7XG5cdGZvcih2YXIgcCBpbiBzcmMpe1xuXHRcdGRlc3RbcF0gPSBzcmNbcF07XG5cdH1cbn1cblxuLyoqXG5eXFx3K1xcLnByb3RvdHlwZVxcLihbX1xcd10rKVxccyo9XFxzKigoPzouKlxce1xccyo/W1xcclxcbl1bXFxzXFxTXSo/Xn0pfFxcUy4qPyg/PVs7XFxyXFxuXSkpOz9cbl5cXHcrXFwucHJvdG90eXBlXFwuKFtfXFx3XSspXFxzKj1cXHMqKFxcUy4qPyg/PVs7XFxyXFxuXSkpOz9cbiAqL1xuZnVuY3Rpb24gX2V4dGVuZHMoQ2xhc3MsU3VwZXIpe1xuXHR2YXIgcHQgPSBDbGFzcy5wcm90b3R5cGU7XG5cdGlmKCEocHQgaW5zdGFuY2VvZiBTdXBlcikpe1xuXHRcdGZ1bmN0aW9uIHQoKXt9O1xuXHRcdHQucHJvdG90eXBlID0gU3VwZXIucHJvdG90eXBlO1xuXHRcdHQgPSBuZXcgdCgpO1xuXHRcdGNvcHkocHQsdCk7XG5cdFx0Q2xhc3MucHJvdG90eXBlID0gcHQgPSB0O1xuXHR9XG5cdGlmKHB0LmNvbnN0cnVjdG9yICE9IENsYXNzKXtcblx0XHRpZih0eXBlb2YgQ2xhc3MgIT0gJ2Z1bmN0aW9uJyl7XG5cdFx0XHRjb25zb2xlLmVycm9yKFwidW5rbm93biBDbGFzczpcIitDbGFzcylcblx0XHR9XG5cdFx0cHQuY29uc3RydWN0b3IgPSBDbGFzc1xuXHR9XG59XG5cbi8vIE5vZGUgVHlwZXNcbnZhciBOb2RlVHlwZSA9IHt9XG52YXIgRUxFTUVOVF9OT0RFICAgICAgICAgICAgICAgID0gTm9kZVR5cGUuRUxFTUVOVF9OT0RFICAgICAgICAgICAgICAgID0gMTtcbnZhciBBVFRSSUJVVEVfTk9ERSAgICAgICAgICAgICAgPSBOb2RlVHlwZS5BVFRSSUJVVEVfTk9ERSAgICAgICAgICAgICAgPSAyO1xudmFyIFRFWFRfTk9ERSAgICAgICAgICAgICAgICAgICA9IE5vZGVUeXBlLlRFWFRfTk9ERSAgICAgICAgICAgICAgICAgICA9IDM7XG52YXIgQ0RBVEFfU0VDVElPTl9OT0RFICAgICAgICAgID0gTm9kZVR5cGUuQ0RBVEFfU0VDVElPTl9OT0RFICAgICAgICAgID0gNDtcbnZhciBFTlRJVFlfUkVGRVJFTkNFX05PREUgICAgICAgPSBOb2RlVHlwZS5FTlRJVFlfUkVGRVJFTkNFX05PREUgICAgICAgPSA1O1xudmFyIEVOVElUWV9OT0RFICAgICAgICAgICAgICAgICA9IE5vZGVUeXBlLkVOVElUWV9OT0RFICAgICAgICAgICAgICAgICA9IDY7XG52YXIgUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFID0gTm9kZVR5cGUuUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFID0gNztcbnZhciBDT01NRU5UX05PREUgICAgICAgICAgICAgICAgPSBOb2RlVHlwZS5DT01NRU5UX05PREUgICAgICAgICAgICAgICAgPSA4O1xudmFyIERPQ1VNRU5UX05PREUgICAgICAgICAgICAgICA9IE5vZGVUeXBlLkRPQ1VNRU5UX05PREUgICAgICAgICAgICAgICA9IDk7XG52YXIgRE9DVU1FTlRfVFlQRV9OT0RFICAgICAgICAgID0gTm9kZVR5cGUuRE9DVU1FTlRfVFlQRV9OT0RFICAgICAgICAgID0gMTA7XG52YXIgRE9DVU1FTlRfRlJBR01FTlRfTk9ERSAgICAgID0gTm9kZVR5cGUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERSAgICAgID0gMTE7XG52YXIgTk9UQVRJT05fTk9ERSAgICAgICAgICAgICAgID0gTm9kZVR5cGUuTk9UQVRJT05fTk9ERSAgICAgICAgICAgICAgID0gMTI7XG5cbi8vIEV4Y2VwdGlvbkNvZGVcbnZhciBFeGNlcHRpb25Db2RlID0ge31cbnZhciBFeGNlcHRpb25NZXNzYWdlID0ge307XG52YXIgSU5ERVhfU0laRV9FUlIgICAgICAgICAgICAgID0gRXhjZXB0aW9uQ29kZS5JTkRFWF9TSVpFX0VSUiAgICAgICAgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMV09XCJJbmRleCBzaXplIGVycm9yXCIpLDEpO1xudmFyIERPTVNUUklOR19TSVpFX0VSUiAgICAgICAgICA9IEV4Y2VwdGlvbkNvZGUuRE9NU1RSSU5HX1NJWkVfRVJSICAgICAgICAgID0gKChFeGNlcHRpb25NZXNzYWdlWzJdPVwiRE9NU3RyaW5nIHNpemUgZXJyb3JcIiksMik7XG52YXIgSElFUkFSQ0hZX1JFUVVFU1RfRVJSICAgICAgID0gRXhjZXB0aW9uQ29kZS5ISUVSQVJDSFlfUkVRVUVTVF9FUlIgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbM109XCJIaWVyYXJjaHkgcmVxdWVzdCBlcnJvclwiKSwzKTtcbnZhciBXUk9OR19ET0NVTUVOVF9FUlIgICAgICAgICAgPSBFeGNlcHRpb25Db2RlLldST05HX0RPQ1VNRU5UX0VSUiAgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVs0XT1cIldyb25nIGRvY3VtZW50XCIpLDQpO1xudmFyIElOVkFMSURfQ0hBUkFDVEVSX0VSUiAgICAgICA9IEV4Y2VwdGlvbkNvZGUuSU5WQUxJRF9DSEFSQUNURVJfRVJSICAgICAgID0gKChFeGNlcHRpb25NZXNzYWdlWzVdPVwiSW52YWxpZCBjaGFyYWN0ZXJcIiksNSk7XG52YXIgTk9fREFUQV9BTExPV0VEX0VSUiAgICAgICAgID0gRXhjZXB0aW9uQ29kZS5OT19EQVRBX0FMTE9XRURfRVJSICAgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbNl09XCJObyBkYXRhIGFsbG93ZWRcIiksNik7XG52YXIgTk9fTU9ESUZJQ0FUSU9OX0FMTE9XRURfRVJSID0gRXhjZXB0aW9uQ29kZS5OT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlIgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbN109XCJObyBtb2RpZmljYXRpb24gYWxsb3dlZFwiKSw3KTtcbnZhciBOT1RfRk9VTkRfRVJSICAgICAgICAgICAgICAgPSBFeGNlcHRpb25Db2RlLk5PVF9GT1VORF9FUlIgICAgICAgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVs4XT1cIk5vdCBmb3VuZFwiKSw4KTtcbnZhciBOT1RfU1VQUE9SVEVEX0VSUiAgICAgICAgICAgPSBFeGNlcHRpb25Db2RlLk5PVF9TVVBQT1JURURfRVJSICAgICAgICAgICA9ICgoRXhjZXB0aW9uTWVzc2FnZVs5XT1cIk5vdCBzdXBwb3J0ZWRcIiksOSk7XG52YXIgSU5VU0VfQVRUUklCVVRFX0VSUiAgICAgICAgID0gRXhjZXB0aW9uQ29kZS5JTlVTRV9BVFRSSUJVVEVfRVJSICAgICAgICAgPSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMTBdPVwiQXR0cmlidXRlIGluIHVzZVwiKSwxMCk7XG4vL2xldmVsMlxudmFyIElOVkFMSURfU1RBVEVfRVJSICAgICAgICBcdD0gRXhjZXB0aW9uQ29kZS5JTlZBTElEX1NUQVRFX0VSUiAgICAgICAgXHQ9ICgoRXhjZXB0aW9uTWVzc2FnZVsxMV09XCJJbnZhbGlkIHN0YXRlXCIpLDExKTtcbnZhciBTWU5UQVhfRVJSICAgICAgICAgICAgICAgXHQ9IEV4Y2VwdGlvbkNvZGUuU1lOVEFYX0VSUiAgICAgICAgICAgICAgIFx0PSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMTJdPVwiU3ludGF4IGVycm9yXCIpLDEyKTtcbnZhciBJTlZBTElEX01PRElGSUNBVElPTl9FUlIgXHQ9IEV4Y2VwdGlvbkNvZGUuSU5WQUxJRF9NT0RJRklDQVRJT05fRVJSIFx0PSAoKEV4Y2VwdGlvbk1lc3NhZ2VbMTNdPVwiSW52YWxpZCBtb2RpZmljYXRpb25cIiksMTMpO1xudmFyIE5BTUVTUEFDRV9FUlIgICAgICAgICAgICBcdD0gRXhjZXB0aW9uQ29kZS5OQU1FU1BBQ0VfRVJSICAgICAgICAgICBcdD0gKChFeGNlcHRpb25NZXNzYWdlWzE0XT1cIkludmFsaWQgbmFtZXNwYWNlXCIpLDE0KTtcbnZhciBJTlZBTElEX0FDQ0VTU19FUlIgICAgICAgXHQ9IEV4Y2VwdGlvbkNvZGUuSU5WQUxJRF9BQ0NFU1NfRVJSICAgICAgXHQ9ICgoRXhjZXB0aW9uTWVzc2FnZVsxNV09XCJJbnZhbGlkIGFjY2Vzc1wiKSwxNSk7XG5cbi8qKlxuICogRE9NIExldmVsIDJcbiAqIE9iamVjdCBET01FeGNlcHRpb25cbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvMjAwMC9SRUMtRE9NLUxldmVsLTItQ29yZS0yMDAwMTExMy9lY21hLXNjcmlwdC1iaW5kaW5nLmh0bWxcbiAqIEBzZWUgaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLURPTS1MZXZlbC0xL2VjbWEtc2NyaXB0LWxhbmd1YWdlLWJpbmRpbmcuaHRtbFxuICovXG5mdW5jdGlvbiBET01FeGNlcHRpb24oY29kZSwgbWVzc2FnZSkge1xuXHRpZihtZXNzYWdlIGluc3RhbmNlb2YgRXJyb3Ipe1xuXHRcdHZhciBlcnJvciA9IG1lc3NhZ2U7XG5cdH1lbHNle1xuXHRcdGVycm9yID0gdGhpcztcblx0XHRFcnJvci5jYWxsKHRoaXMsIEV4Y2VwdGlvbk1lc3NhZ2VbY29kZV0pO1xuXHRcdHRoaXMubWVzc2FnZSA9IEV4Y2VwdGlvbk1lc3NhZ2VbY29kZV07XG5cdFx0aWYoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIERPTUV4Y2VwdGlvbik7XG5cdH1cblx0ZXJyb3IuY29kZSA9IGNvZGU7XG5cdGlmKG1lc3NhZ2UpIHRoaXMubWVzc2FnZSA9IHRoaXMubWVzc2FnZSArIFwiOiBcIiArIG1lc3NhZ2U7XG5cdHJldHVybiBlcnJvcjtcbn07XG5ET01FeGNlcHRpb24ucHJvdG90eXBlID0gRXJyb3IucHJvdG90eXBlO1xuY29weShFeGNlcHRpb25Db2RlLERPTUV4Y2VwdGlvbilcblxuLyoqXG4gKiBAc2VlIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDAvUkVDLURPTS1MZXZlbC0yLUNvcmUtMjAwMDExMTMvY29yZS5odG1sI0lELTUzNjI5NzE3N1xuICogVGhlIE5vZGVMaXN0IGludGVyZmFjZSBwcm92aWRlcyB0aGUgYWJzdHJhY3Rpb24gb2YgYW4gb3JkZXJlZCBjb2xsZWN0aW9uIG9mIG5vZGVzLCB3aXRob3V0IGRlZmluaW5nIG9yIGNvbnN0cmFpbmluZyBob3cgdGhpcyBjb2xsZWN0aW9uIGlzIGltcGxlbWVudGVkLiBOb2RlTGlzdCBvYmplY3RzIGluIHRoZSBET00gYXJlIGxpdmUuXG4gKiBUaGUgaXRlbXMgaW4gdGhlIE5vZGVMaXN0IGFyZSBhY2Nlc3NpYmxlIHZpYSBhbiBpbnRlZ3JhbCBpbmRleCwgc3RhcnRpbmcgZnJvbSAwLlxuICovXG5mdW5jdGlvbiBOb2RlTGlzdCgpIHtcbn07XG5Ob2RlTGlzdC5wcm90b3R5cGUgPSB7XG5cdC8qKlxuXHQgKiBUaGUgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBsaXN0LiBUaGUgcmFuZ2Ugb2YgdmFsaWQgY2hpbGQgbm9kZSBpbmRpY2VzIGlzIDAgdG8gbGVuZ3RoLTEgaW5jbHVzaXZlLlxuXHQgKiBAc3RhbmRhcmQgbGV2ZWwxXG5cdCAqL1xuXHRsZW5ndGg6MCwgXG5cdC8qKlxuXHQgKiBSZXR1cm5zIHRoZSBpbmRleHRoIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb24uIElmIGluZGV4IGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBsaXN0LCB0aGlzIHJldHVybnMgbnVsbC5cblx0ICogQHN0YW5kYXJkIGxldmVsMVxuXHQgKiBAcGFyYW0gaW5kZXggIHVuc2lnbmVkIGxvbmcgXG5cdCAqICAgSW5kZXggaW50byB0aGUgY29sbGVjdGlvbi5cblx0ICogQHJldHVybiBOb2RlXG5cdCAqIFx0VGhlIG5vZGUgYXQgdGhlIGluZGV4dGggcG9zaXRpb24gaW4gdGhlIE5vZGVMaXN0LCBvciBudWxsIGlmIHRoYXQgaXMgbm90IGEgdmFsaWQgaW5kZXguIFxuXHQgKi9cblx0aXRlbTogZnVuY3Rpb24oaW5kZXgpIHtcblx0XHRyZXR1cm4gdGhpc1tpbmRleF0gfHwgbnVsbDtcblx0fSxcblx0dG9TdHJpbmc6ZnVuY3Rpb24oaXNIVE1MLG5vZGVGaWx0ZXIpe1xuXHRcdGZvcih2YXIgYnVmID0gW10sIGkgPSAwO2k8dGhpcy5sZW5ndGg7aSsrKXtcblx0XHRcdHNlcmlhbGl6ZVRvU3RyaW5nKHRoaXNbaV0sYnVmLGlzSFRNTCxub2RlRmlsdGVyKTtcblx0XHR9XG5cdFx0cmV0dXJuIGJ1Zi5qb2luKCcnKTtcblx0fVxufTtcblxuZnVuY3Rpb24gTGl2ZU5vZGVMaXN0KG5vZGUscmVmcmVzaCl7XG5cdHRoaXMuX25vZGUgPSBub2RlO1xuXHR0aGlzLl9yZWZyZXNoID0gcmVmcmVzaFxuXHRfdXBkYXRlTGl2ZUxpc3QodGhpcyk7XG59XG5mdW5jdGlvbiBfdXBkYXRlTGl2ZUxpc3QobGlzdCl7XG5cdHZhciBpbmMgPSBsaXN0Ll9ub2RlLl9pbmMgfHwgbGlzdC5fbm9kZS5vd25lckRvY3VtZW50Ll9pbmM7XG5cdGlmKGxpc3QuX2luYyAhPSBpbmMpe1xuXHRcdHZhciBscyA9IGxpc3QuX3JlZnJlc2gobGlzdC5fbm9kZSk7XG5cdFx0Ly9jb25zb2xlLmxvZyhscy5sZW5ndGgpXG5cdFx0X19zZXRfXyhsaXN0LCdsZW5ndGgnLGxzLmxlbmd0aCk7XG5cdFx0Y29weShscyxsaXN0KTtcblx0XHRsaXN0Ll9pbmMgPSBpbmM7XG5cdH1cbn1cbkxpdmVOb2RlTGlzdC5wcm90b3R5cGUuaXRlbSA9IGZ1bmN0aW9uKGkpe1xuXHRfdXBkYXRlTGl2ZUxpc3QodGhpcyk7XG5cdHJldHVybiB0aGlzW2ldO1xufVxuXG5fZXh0ZW5kcyhMaXZlTm9kZUxpc3QsTm9kZUxpc3QpO1xuXG4vKipcbiAqIE9iamVjdHMgaW1wbGVtZW50aW5nIHRoZSBOYW1lZE5vZGVNYXAgaW50ZXJmYWNlIGFyZSB1c2VkXG4gKiB0byByZXByZXNlbnQgY29sbGVjdGlvbnMgb2Ygbm9kZXMgdGhhdCBjYW4gYmUgYWNjZXNzZWQgYnkgbmFtZS5cbiAqIE5vdGUgdGhhdCBOYW1lZE5vZGVNYXAgZG9lcyBub3QgaW5oZXJpdCBmcm9tIE5vZGVMaXN0O1xuICogTmFtZWROb2RlTWFwcyBhcmUgbm90IG1haW50YWluZWQgaW4gYW55IHBhcnRpY3VsYXIgb3JkZXIuXG4gKiBPYmplY3RzIGNvbnRhaW5lZCBpbiBhbiBvYmplY3QgaW1wbGVtZW50aW5nIE5hbWVkTm9kZU1hcCBtYXkgYWxzbyBiZSBhY2Nlc3NlZCBieSBhbiBvcmRpbmFsIGluZGV4LFxuICogYnV0IHRoaXMgaXMgc2ltcGx5IHRvIGFsbG93IGNvbnZlbmllbnQgZW51bWVyYXRpb24gb2YgdGhlIGNvbnRlbnRzIG9mIGEgTmFtZWROb2RlTWFwLFxuICogYW5kIGRvZXMgbm90IGltcGx5IHRoYXQgdGhlIERPTSBzcGVjaWZpZXMgYW4gb3JkZXIgdG8gdGhlc2UgTm9kZXMuXG4gKiBOYW1lZE5vZGVNYXAgb2JqZWN0cyBpbiB0aGUgRE9NIGFyZSBsaXZlLlxuICogdXNlZCBmb3IgYXR0cmlidXRlcyBvciBEb2N1bWVudFR5cGUgZW50aXRpZXMgXG4gKi9cbmZ1bmN0aW9uIE5hbWVkTm9kZU1hcCgpIHtcbn07XG5cbmZ1bmN0aW9uIF9maW5kTm9kZUluZGV4KGxpc3Qsbm9kZSl7XG5cdHZhciBpID0gbGlzdC5sZW5ndGg7XG5cdHdoaWxlKGktLSl7XG5cdFx0aWYobGlzdFtpXSA9PT0gbm9kZSl7cmV0dXJuIGl9XG5cdH1cbn1cblxuZnVuY3Rpb24gX2FkZE5hbWVkTm9kZShlbCxsaXN0LG5ld0F0dHIsb2xkQXR0cil7XG5cdGlmKG9sZEF0dHIpe1xuXHRcdGxpc3RbX2ZpbmROb2RlSW5kZXgobGlzdCxvbGRBdHRyKV0gPSBuZXdBdHRyO1xuXHR9ZWxzZXtcblx0XHRsaXN0W2xpc3QubGVuZ3RoKytdID0gbmV3QXR0cjtcblx0fVxuXHRpZihlbCl7XG5cdFx0bmV3QXR0ci5vd25lckVsZW1lbnQgPSBlbDtcblx0XHR2YXIgZG9jID0gZWwub3duZXJEb2N1bWVudDtcblx0XHRpZihkb2Mpe1xuXHRcdFx0b2xkQXR0ciAmJiBfb25SZW1vdmVBdHRyaWJ1dGUoZG9jLGVsLG9sZEF0dHIpO1xuXHRcdFx0X29uQWRkQXR0cmlidXRlKGRvYyxlbCxuZXdBdHRyKTtcblx0XHR9XG5cdH1cbn1cbmZ1bmN0aW9uIF9yZW1vdmVOYW1lZE5vZGUoZWwsbGlzdCxhdHRyKXtcblx0Ly9jb25zb2xlLmxvZygncmVtb3ZlIGF0dHI6JythdHRyKVxuXHR2YXIgaSA9IF9maW5kTm9kZUluZGV4KGxpc3QsYXR0cik7XG5cdGlmKGk+PTApe1xuXHRcdHZhciBsYXN0SW5kZXggPSBsaXN0Lmxlbmd0aC0xXG5cdFx0d2hpbGUoaTxsYXN0SW5kZXgpe1xuXHRcdFx0bGlzdFtpXSA9IGxpc3RbKytpXVxuXHRcdH1cblx0XHRsaXN0Lmxlbmd0aCA9IGxhc3RJbmRleDtcblx0XHRpZihlbCl7XG5cdFx0XHR2YXIgZG9jID0gZWwub3duZXJEb2N1bWVudDtcblx0XHRcdGlmKGRvYyl7XG5cdFx0XHRcdF9vblJlbW92ZUF0dHJpYnV0ZShkb2MsZWwsYXR0cik7XG5cdFx0XHRcdGF0dHIub3duZXJFbGVtZW50ID0gbnVsbDtcblx0XHRcdH1cblx0XHR9XG5cdH1lbHNle1xuXHRcdHRocm93IERPTUV4Y2VwdGlvbihOT1RfRk9VTkRfRVJSLG5ldyBFcnJvcihlbC50YWdOYW1lKydAJythdHRyKSlcblx0fVxufVxuTmFtZWROb2RlTWFwLnByb3RvdHlwZSA9IHtcblx0bGVuZ3RoOjAsXG5cdGl0ZW06Tm9kZUxpc3QucHJvdG90eXBlLml0ZW0sXG5cdGdldE5hbWVkSXRlbTogZnVuY3Rpb24oa2V5KSB7XG4vL1x0XHRpZihrZXkuaW5kZXhPZignOicpPjAgfHwga2V5ID09ICd4bWxucycpe1xuLy9cdFx0XHRyZXR1cm4gbnVsbDtcbi8vXHRcdH1cblx0XHQvL2NvbnNvbGUubG9nKClcblx0XHR2YXIgaSA9IHRoaXMubGVuZ3RoO1xuXHRcdHdoaWxlKGktLSl7XG5cdFx0XHR2YXIgYXR0ciA9IHRoaXNbaV07XG5cdFx0XHQvL2NvbnNvbGUubG9nKGF0dHIubm9kZU5hbWUsa2V5KVxuXHRcdFx0aWYoYXR0ci5ub2RlTmFtZSA9PSBrZXkpe1xuXHRcdFx0XHRyZXR1cm4gYXR0cjtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cdHNldE5hbWVkSXRlbTogZnVuY3Rpb24oYXR0cikge1xuXHRcdHZhciBlbCA9IGF0dHIub3duZXJFbGVtZW50O1xuXHRcdGlmKGVsICYmIGVsIT10aGlzLl9vd25lckVsZW1lbnQpe1xuXHRcdFx0dGhyb3cgbmV3IERPTUV4Y2VwdGlvbihJTlVTRV9BVFRSSUJVVEVfRVJSKTtcblx0XHR9XG5cdFx0dmFyIG9sZEF0dHIgPSB0aGlzLmdldE5hbWVkSXRlbShhdHRyLm5vZGVOYW1lKTtcblx0XHRfYWRkTmFtZWROb2RlKHRoaXMuX293bmVyRWxlbWVudCx0aGlzLGF0dHIsb2xkQXR0cik7XG5cdFx0cmV0dXJuIG9sZEF0dHI7XG5cdH0sXG5cdC8qIHJldHVybnMgTm9kZSAqL1xuXHRzZXROYW1lZEl0ZW1OUzogZnVuY3Rpb24oYXR0cikgey8vIHJhaXNlczogV1JPTkdfRE9DVU1FTlRfRVJSLE5PX01PRElGSUNBVElPTl9BTExPV0VEX0VSUixJTlVTRV9BVFRSSUJVVEVfRVJSXG5cdFx0dmFyIGVsID0gYXR0ci5vd25lckVsZW1lbnQsIG9sZEF0dHI7XG5cdFx0aWYoZWwgJiYgZWwhPXRoaXMuX293bmVyRWxlbWVudCl7XG5cdFx0XHR0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKElOVVNFX0FUVFJJQlVURV9FUlIpO1xuXHRcdH1cblx0XHRvbGRBdHRyID0gdGhpcy5nZXROYW1lZEl0ZW1OUyhhdHRyLm5hbWVzcGFjZVVSSSxhdHRyLmxvY2FsTmFtZSk7XG5cdFx0X2FkZE5hbWVkTm9kZSh0aGlzLl9vd25lckVsZW1lbnQsdGhpcyxhdHRyLG9sZEF0dHIpO1xuXHRcdHJldHVybiBvbGRBdHRyO1xuXHR9LFxuXG5cdC8qIHJldHVybnMgTm9kZSAqL1xuXHRyZW1vdmVOYW1lZEl0ZW06IGZ1bmN0aW9uKGtleSkge1xuXHRcdHZhciBhdHRyID0gdGhpcy5nZXROYW1lZEl0ZW0oa2V5KTtcblx0XHRfcmVtb3ZlTmFtZWROb2RlKHRoaXMuX293bmVyRWxlbWVudCx0aGlzLGF0dHIpO1xuXHRcdHJldHVybiBhdHRyO1xuXHRcdFxuXHRcdFxuXHR9LC8vIHJhaXNlczogTk9UX0ZPVU5EX0VSUixOT19NT0RJRklDQVRJT05fQUxMT1dFRF9FUlJcblx0XG5cdC8vZm9yIGxldmVsMlxuXHRyZW1vdmVOYW1lZEl0ZW1OUzpmdW5jdGlvbihuYW1lc3BhY2VVUkksbG9jYWxOYW1lKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMuZ2V0TmFtZWRJdGVtTlMobmFtZXNwYWNlVVJJLGxvY2FsTmFtZSk7XG5cdFx0X3JlbW92ZU5hbWVkTm9kZSh0aGlzLl9vd25lckVsZW1lbnQsdGhpcyxhdHRyKTtcblx0XHRyZXR1cm4gYXR0cjtcblx0fSxcblx0Z2V0TmFtZWRJdGVtTlM6IGZ1bmN0aW9uKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKSB7XG5cdFx0dmFyIGkgPSB0aGlzLmxlbmd0aDtcblx0XHR3aGlsZShpLS0pe1xuXHRcdFx0dmFyIG5vZGUgPSB0aGlzW2ldO1xuXHRcdFx0aWYobm9kZS5sb2NhbE5hbWUgPT0gbG9jYWxOYW1lICYmIG5vZGUubmFtZXNwYWNlVVJJID09IG5hbWVzcGFjZVVSSSl7XG5cdFx0XHRcdHJldHVybiBub2RlO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxufTtcblxuLyoqXG4gKiBUaGUgRE9NSW1wbGVtZW50YXRpb24gaW50ZXJmYWNlIHJlcHJlc2VudHMgYW4gb2JqZWN0IHByb3ZpZGluZyBtZXRob2RzXG4gKiB3aGljaCBhcmUgbm90IGRlcGVuZGVudCBvbiBhbnkgcGFydGljdWxhciBkb2N1bWVudC5cbiAqIFN1Y2ggYW4gb2JqZWN0IGlzIHJldHVybmVkIGJ5IHRoZSBgRG9jdW1lbnQuaW1wbGVtZW50YXRpb25gIHByb3BlcnR5LlxuICpcbiAqIF9fVGhlIGluZGl2aWR1YWwgbWV0aG9kcyBkZXNjcmliZSB0aGUgZGlmZmVyZW5jZXMgY29tcGFyZWQgdG8gdGhlIHNwZWNzLl9fXG4gKlxuICogQGNvbnN0cnVjdG9yXG4gKlxuICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NSW1wbGVtZW50YXRpb24gTUROXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9SRUMtRE9NLUxldmVsLTEvbGV2ZWwtb25lLWNvcmUuaHRtbCNJRC0xMDIxNjE0OTAgRE9NIExldmVsIDEgQ29yZSAoSW5pdGlhbClcbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0yLUNvcmUvY29yZS5odG1sI0lELTEwMjE2MTQ5MCBET00gTGV2ZWwgMiBDb3JlXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1Db3JlL2NvcmUuaHRtbCNJRC0xMDIxNjE0OTAgRE9NIExldmVsIDMgQ29yZVxuICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2RvbWltcGxlbWVudGF0aW9uIERPTSBMaXZpbmcgU3RhbmRhcmRcbiAqL1xuZnVuY3Rpb24gRE9NSW1wbGVtZW50YXRpb24oKSB7XG59XG5cbkRPTUltcGxlbWVudGF0aW9uLnByb3RvdHlwZSA9IHtcblx0LyoqXG5cdCAqIFRoZSBET01JbXBsZW1lbnRhdGlvbi5oYXNGZWF0dXJlKCkgbWV0aG9kIHJldHVybnMgYSBCb29sZWFuIGZsYWcgaW5kaWNhdGluZyBpZiBhIGdpdmVuIGZlYXR1cmUgaXMgc3VwcG9ydGVkLlxuXHQgKiBUaGUgZGlmZmVyZW50IGltcGxlbWVudGF0aW9ucyBmYWlybHkgZGl2ZXJnZWQgaW4gd2hhdCBraW5kIG9mIGZlYXR1cmVzIHdlcmUgcmVwb3J0ZWQuXG5cdCAqIFRoZSBsYXRlc3QgdmVyc2lvbiBvZiB0aGUgc3BlYyBzZXR0bGVkIHRvIGZvcmNlIHRoaXMgbWV0aG9kIHRvIGFsd2F5cyByZXR1cm4gdHJ1ZSwgd2hlcmUgdGhlIGZ1bmN0aW9uYWxpdHkgd2FzIGFjY3VyYXRlIGFuZCBpbiB1c2UuXG5cdCAqXG5cdCAqIEBkZXByZWNhdGVkIEl0IGlzIGRlcHJlY2F0ZWQgYW5kIG1vZGVybiBicm93c2VycyByZXR1cm4gdHJ1ZSBpbiBhbGwgY2FzZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBmZWF0dXJlXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBbdmVyc2lvbl1cblx0ICogQHJldHVybnMge2Jvb2xlYW59IGFsd2F5cyB0cnVlXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0RPTUltcGxlbWVudGF0aW9uL2hhc0ZlYXR1cmUgTUROXG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL1JFQy1ET00tTGV2ZWwtMS9sZXZlbC1vbmUtY29yZS5odG1sI0lELTVDRUQ5NEQ3IERPTSBMZXZlbCAxIENvcmVcblx0ICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2RvbS1kb21pbXBsZW1lbnRhdGlvbi1oYXNmZWF0dXJlIERPTSBMaXZpbmcgU3RhbmRhcmRcblx0ICovXG5cdGhhc0ZlYXR1cmU6IGZ1bmN0aW9uKGZlYXR1cmUsIHZlcnNpb24pIHtcblx0XHRcdHJldHVybiB0cnVlO1xuXHR9LFxuXHQvKipcblx0ICogQ3JlYXRlcyBhbiBYTUwgRG9jdW1lbnQgb2JqZWN0IG9mIHRoZSBzcGVjaWZpZWQgdHlwZSB3aXRoIGl0cyBkb2N1bWVudCBlbGVtZW50LlxuXHQgKlxuXHQgKiBfX0l0IGJlaGF2ZXMgc2xpZ2h0bHkgZGlmZmVyZW50IGZyb20gdGhlIGRlc2NyaXB0aW9uIGluIHRoZSBsaXZpbmcgc3RhbmRhcmRfXzpcblx0ICogLSBUaGVyZSBpcyBubyBpbnRlcmZhY2UvY2xhc3MgYFhNTERvY3VtZW50YCwgaXQgcmV0dXJucyBhIGBEb2N1bWVudGAgaW5zdGFuY2UuXG5cdCAqIC0gYGNvbnRlbnRUeXBlYCwgYGVuY29kaW5nYCwgYG1vZGVgLCBgb3JpZ2luYCwgYHVybGAgZmllbGRzIGFyZSBjdXJyZW50bHkgbm90IGRlY2xhcmVkLlxuXHQgKiAtIHRoaXMgaW1wbGVtZW50YXRpb24gaXMgbm90IHZhbGlkYXRpbmcgbmFtZXMgb3IgcXVhbGlmaWVkIG5hbWVzXG5cdCAqICAgKHdoZW4gcGFyc2luZyBYTUwgc3RyaW5ncywgdGhlIFNBWCBwYXJzZXIgdGFrZXMgY2FyZSBvZiB0aGF0KVxuXHQgKlxuXHQgKiBAcGFyYW0ge3N0cmluZ3xudWxsfSBuYW1lc3BhY2VVUklcblx0ICogQHBhcmFtIHtzdHJpbmd9IHF1YWxpZmllZE5hbWVcblx0ICogQHBhcmFtIHtEb2N1bWVudFR5cGU9bnVsbH0gZG9jdHlwZVxuXHQgKiBAcmV0dXJucyB7RG9jdW1lbnR9XG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0RPTUltcGxlbWVudGF0aW9uL2NyZWF0ZURvY3VtZW50IE1ETlxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1Db3JlL2NvcmUuaHRtbCNMZXZlbC0yLUNvcmUtRE9NLWNyZWF0ZURvY3VtZW50IERPTSBMZXZlbCAyIENvcmUgKGluaXRpYWwpXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNkb20tZG9taW1wbGVtZW50YXRpb24tY3JlYXRlZG9jdW1lbnQgIERPTSBMZXZlbCAyIENvcmVcblx0ICpcblx0ICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI3ZhbGlkYXRlLWFuZC1leHRyYWN0IERPTTogVmFsaWRhdGUgYW5kIGV4dHJhY3Rcblx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sLyNOVC1OYW1lU3RhcnRDaGFyIFhNTCBTcGVjOiBOYW1lc1xuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwtbmFtZXMvI25zLXF1YWxuYW1lcyBYTUwgTmFtZXNwYWNlczogUXVhbGlmaWVkIG5hbWVzXG5cdCAqL1xuXHRjcmVhdGVEb2N1bWVudDogZnVuY3Rpb24obmFtZXNwYWNlVVJJLCAgcXVhbGlmaWVkTmFtZSwgZG9jdHlwZSl7XG5cdFx0dmFyIGRvYyA9IG5ldyBEb2N1bWVudCgpO1xuXHRcdGRvYy5pbXBsZW1lbnRhdGlvbiA9IHRoaXM7XG5cdFx0ZG9jLmNoaWxkTm9kZXMgPSBuZXcgTm9kZUxpc3QoKTtcblx0XHRkb2MuZG9jdHlwZSA9IGRvY3R5cGUgfHwgbnVsbDtcblx0XHRpZiAoZG9jdHlwZSl7XG5cdFx0XHRkb2MuYXBwZW5kQ2hpbGQoZG9jdHlwZSk7XG5cdFx0fVxuXHRcdGlmIChxdWFsaWZpZWROYW1lKXtcblx0XHRcdHZhciByb290ID0gZG9jLmNyZWF0ZUVsZW1lbnROUyhuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUpO1xuXHRcdFx0ZG9jLmFwcGVuZENoaWxkKHJvb3QpO1xuXHRcdH1cblx0XHRyZXR1cm4gZG9jO1xuXHR9LFxuXHQvKipcblx0ICogUmV0dXJucyBhIGRvY3R5cGUsIHdpdGggdGhlIGdpdmVuIGBxdWFsaWZpZWROYW1lYCwgYHB1YmxpY0lkYCwgYW5kIGBzeXN0ZW1JZGAuXG5cdCAqXG5cdCAqIF9fVGhpcyBiZWhhdmlvciBpcyBzbGlnaHRseSBkaWZmZXJlbnQgZnJvbSB0aGUgaW4gdGhlIHNwZWNzX186XG5cdCAqIC0gdGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBub3QgdmFsaWRhdGluZyBuYW1lcyBvciBxdWFsaWZpZWQgbmFtZXNcblx0ICogICAod2hlbiBwYXJzaW5nIFhNTCBzdHJpbmdzLCB0aGUgU0FYIHBhcnNlciB0YWtlcyBjYXJlIG9mIHRoYXQpXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBxdWFsaWZpZWROYW1lXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBbcHVibGljSWRdXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBbc3lzdGVtSWRdXG5cdCAqIEByZXR1cm5zIHtEb2N1bWVudFR5cGV9IHdoaWNoIGNhbiBlaXRoZXIgYmUgdXNlZCB3aXRoIGBET01JbXBsZW1lbnRhdGlvbi5jcmVhdGVEb2N1bWVudGAgdXBvbiBkb2N1bWVudCBjcmVhdGlvblxuXHQgKiBcdFx0XHRcdCAgb3IgY2FuIGJlIHB1dCBpbnRvIHRoZSBkb2N1bWVudCB2aWEgbWV0aG9kcyBsaWtlIGBOb2RlLmluc2VydEJlZm9yZSgpYCBvciBgTm9kZS5yZXBsYWNlQ2hpbGQoKWBcblx0ICpcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRE9NSW1wbGVtZW50YXRpb24vY3JlYXRlRG9jdW1lbnRUeXBlIE1ETlxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMi1Db3JlL2NvcmUuaHRtbCNMZXZlbC0yLUNvcmUtRE9NLWNyZWF0ZURvY1R5cGUgRE9NIExldmVsIDIgQ29yZVxuXHQgKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jZG9tLWRvbWltcGxlbWVudGF0aW9uLWNyZWF0ZWRvY3VtZW50dHlwZSBET00gTGl2aW5nIFN0YW5kYXJkXG5cdCAqXG5cdCAqIEBzZWUgaHR0cHM6Ly9kb20uc3BlYy53aGF0d2cub3JnLyN2YWxpZGF0ZS1hbmQtZXh0cmFjdCBET006IFZhbGlkYXRlIGFuZCBleHRyYWN0XG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC8jTlQtTmFtZVN0YXJ0Q2hhciBYTUwgU3BlYzogTmFtZXNcblx0ICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sLW5hbWVzLyNucy1xdWFsbmFtZXMgWE1MIE5hbWVzcGFjZXM6IFF1YWxpZmllZCBuYW1lc1xuXHQgKi9cblx0Y3JlYXRlRG9jdW1lbnRUeXBlOiBmdW5jdGlvbihxdWFsaWZpZWROYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpe1xuXHRcdHZhciBub2RlID0gbmV3IERvY3VtZW50VHlwZSgpO1xuXHRcdG5vZGUubmFtZSA9IHF1YWxpZmllZE5hbWU7XG5cdFx0bm9kZS5ub2RlTmFtZSA9IHF1YWxpZmllZE5hbWU7XG5cdFx0bm9kZS5wdWJsaWNJZCA9IHB1YmxpY0lkIHx8ICcnO1xuXHRcdG5vZGUuc3lzdGVtSWQgPSBzeXN0ZW1JZCB8fCAnJztcblxuXHRcdHJldHVybiBub2RlO1xuXHR9XG59O1xuXG5cbi8qKlxuICogQHNlZSBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAwL1JFQy1ET00tTGV2ZWwtMi1Db3JlLTIwMDAxMTEzL2NvcmUuaHRtbCNJRC0xOTUwNjQxMjQ3XG4gKi9cblxuZnVuY3Rpb24gTm9kZSgpIHtcbn07XG5cbk5vZGUucHJvdG90eXBlID0ge1xuXHRmaXJzdENoaWxkIDogbnVsbCxcblx0bGFzdENoaWxkIDogbnVsbCxcblx0cHJldmlvdXNTaWJsaW5nIDogbnVsbCxcblx0bmV4dFNpYmxpbmcgOiBudWxsLFxuXHRhdHRyaWJ1dGVzIDogbnVsbCxcblx0cGFyZW50Tm9kZSA6IG51bGwsXG5cdGNoaWxkTm9kZXMgOiBudWxsLFxuXHRvd25lckRvY3VtZW50IDogbnVsbCxcblx0bm9kZVZhbHVlIDogbnVsbCxcblx0bmFtZXNwYWNlVVJJIDogbnVsbCxcblx0cHJlZml4IDogbnVsbCxcblx0bG9jYWxOYW1lIDogbnVsbCxcblx0Ly8gTW9kaWZpZWQgaW4gRE9NIExldmVsIDI6XG5cdGluc2VydEJlZm9yZTpmdW5jdGlvbihuZXdDaGlsZCwgcmVmQ2hpbGQpey8vcmFpc2VzIFxuXHRcdHJldHVybiBfaW5zZXJ0QmVmb3JlKHRoaXMsbmV3Q2hpbGQscmVmQ2hpbGQpO1xuXHR9LFxuXHRyZXBsYWNlQ2hpbGQ6ZnVuY3Rpb24obmV3Q2hpbGQsIG9sZENoaWxkKXsvL3JhaXNlcyBcblx0XHR0aGlzLmluc2VydEJlZm9yZShuZXdDaGlsZCxvbGRDaGlsZCk7XG5cdFx0aWYob2xkQ2hpbGQpe1xuXHRcdFx0dGhpcy5yZW1vdmVDaGlsZChvbGRDaGlsZCk7XG5cdFx0fVxuXHR9LFxuXHRyZW1vdmVDaGlsZDpmdW5jdGlvbihvbGRDaGlsZCl7XG5cdFx0cmV0dXJuIF9yZW1vdmVDaGlsZCh0aGlzLG9sZENoaWxkKTtcblx0fSxcblx0YXBwZW5kQ2hpbGQ6ZnVuY3Rpb24obmV3Q2hpbGQpe1xuXHRcdHJldHVybiB0aGlzLmluc2VydEJlZm9yZShuZXdDaGlsZCxudWxsKTtcblx0fSxcblx0aGFzQ2hpbGROb2RlczpmdW5jdGlvbigpe1xuXHRcdHJldHVybiB0aGlzLmZpcnN0Q2hpbGQgIT0gbnVsbDtcblx0fSxcblx0Y2xvbmVOb2RlOmZ1bmN0aW9uKGRlZXApe1xuXHRcdHJldHVybiBjbG9uZU5vZGUodGhpcy5vd25lckRvY3VtZW50fHx0aGlzLHRoaXMsZGVlcCk7XG5cdH0sXG5cdC8vIE1vZGlmaWVkIGluIERPTSBMZXZlbCAyOlxuXHRub3JtYWxpemU6ZnVuY3Rpb24oKXtcblx0XHR2YXIgY2hpbGQgPSB0aGlzLmZpcnN0Q2hpbGQ7XG5cdFx0d2hpbGUoY2hpbGQpe1xuXHRcdFx0dmFyIG5leHQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdGlmKG5leHQgJiYgbmV4dC5ub2RlVHlwZSA9PSBURVhUX05PREUgJiYgY2hpbGQubm9kZVR5cGUgPT0gVEVYVF9OT0RFKXtcblx0XHRcdFx0dGhpcy5yZW1vdmVDaGlsZChuZXh0KTtcblx0XHRcdFx0Y2hpbGQuYXBwZW5kRGF0YShuZXh0LmRhdGEpO1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdGNoaWxkLm5vcm1hbGl6ZSgpO1xuXHRcdFx0XHRjaGlsZCA9IG5leHQ7XG5cdFx0XHR9XG5cdFx0fVxuXHR9LFxuICBcdC8vIEludHJvZHVjZWQgaW4gRE9NIExldmVsIDI6XG5cdGlzU3VwcG9ydGVkOmZ1bmN0aW9uKGZlYXR1cmUsIHZlcnNpb24pe1xuXHRcdHJldHVybiB0aGlzLm93bmVyRG9jdW1lbnQuaW1wbGVtZW50YXRpb24uaGFzRmVhdHVyZShmZWF0dXJlLHZlcnNpb24pO1xuXHR9LFxuICAgIC8vIEludHJvZHVjZWQgaW4gRE9NIExldmVsIDI6XG4gICAgaGFzQXR0cmlidXRlczpmdW5jdGlvbigpe1xuICAgIFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5sZW5ndGg+MDtcbiAgICB9LFxuXHQvKipcblx0ICogTG9vayB1cCB0aGUgcHJlZml4IGFzc29jaWF0ZWQgdG8gdGhlIGdpdmVuIG5hbWVzcGFjZSBVUkksIHN0YXJ0aW5nIGZyb20gdGhpcyBub2RlLlxuXHQgKiAqKlRoZSBkZWZhdWx0IG5hbWVzcGFjZSBkZWNsYXJhdGlvbnMgYXJlIGlnbm9yZWQgYnkgdGhpcyBtZXRob2QuKipcblx0ICogU2VlIE5hbWVzcGFjZSBQcmVmaXggTG9va3VwIGZvciBkZXRhaWxzIG9uIHRoZSBhbGdvcml0aG0gdXNlZCBieSB0aGlzIG1ldGhvZC5cblx0ICpcblx0ICogX05vdGU6IFRoZSBpbXBsZW1lbnRhdGlvbiBzZWVtcyB0byBiZSBpbmNvbXBsZXRlIHdoZW4gY29tcGFyZWQgdG8gdGhlIGFsZ29yaXRobSBkZXNjcmliZWQgaW4gdGhlIHNwZWNzLl9cblx0ICpcblx0ICogQHBhcmFtIHtzdHJpbmcgfCBudWxsfSBuYW1lc3BhY2VVUklcblx0ICogQHJldHVybnMge3N0cmluZyB8IG51bGx9XG5cdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL0RPTS1MZXZlbC0zLUNvcmUvY29yZS5odG1sI05vZGUzLWxvb2t1cE5hbWVzcGFjZVByZWZpeFxuXHQgKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9ET00tTGV2ZWwtMy1Db3JlL25hbWVzcGFjZXMtYWxnb3JpdGhtcy5odG1sI2xvb2t1cE5hbWVzcGFjZVByZWZpeEFsZ29cblx0ICogQHNlZSBodHRwczovL2RvbS5zcGVjLndoYXR3Zy5vcmcvI2RvbS1ub2RlLWxvb2t1cHByZWZpeFxuXHQgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS94bWxkb20veG1sZG9tL2lzc3Vlcy8zMjJcblx0ICovXG4gICAgbG9va3VwUHJlZml4OmZ1bmN0aW9uKG5hbWVzcGFjZVVSSSl7XG4gICAgXHR2YXIgZWwgPSB0aGlzO1xuICAgIFx0d2hpbGUoZWwpe1xuICAgIFx0XHR2YXIgbWFwID0gZWwuX25zTWFwO1xuICAgIFx0XHQvL2NvbnNvbGUuZGlyKG1hcClcbiAgICBcdFx0aWYobWFwKXtcbiAgICBcdFx0XHRmb3IodmFyIG4gaW4gbWFwKXtcbiAgICBcdFx0XHRcdGlmKG1hcFtuXSA9PSBuYW1lc3BhY2VVUkkpe1xuICAgIFx0XHRcdFx0XHRyZXR1cm4gbjtcbiAgICBcdFx0XHRcdH1cbiAgICBcdFx0XHR9XG4gICAgXHRcdH1cbiAgICBcdFx0ZWwgPSBlbC5ub2RlVHlwZSA9PSBBVFRSSUJVVEVfTk9ERT9lbC5vd25lckRvY3VtZW50IDogZWwucGFyZW50Tm9kZTtcbiAgICBcdH1cbiAgICBcdHJldHVybiBudWxsO1xuICAgIH0sXG4gICAgLy8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMzpcbiAgICBsb29rdXBOYW1lc3BhY2VVUkk6ZnVuY3Rpb24ocHJlZml4KXtcbiAgICBcdHZhciBlbCA9IHRoaXM7XG4gICAgXHR3aGlsZShlbCl7XG4gICAgXHRcdHZhciBtYXAgPSBlbC5fbnNNYXA7XG4gICAgXHRcdC8vY29uc29sZS5kaXIobWFwKVxuICAgIFx0XHRpZihtYXApe1xuICAgIFx0XHRcdGlmKHByZWZpeCBpbiBtYXApe1xuICAgIFx0XHRcdFx0cmV0dXJuIG1hcFtwcmVmaXhdIDtcbiAgICBcdFx0XHR9XG4gICAgXHRcdH1cbiAgICBcdFx0ZWwgPSBlbC5ub2RlVHlwZSA9PSBBVFRSSUJVVEVfTk9ERT9lbC5vd25lckRvY3VtZW50IDogZWwucGFyZW50Tm9kZTtcbiAgICBcdH1cbiAgICBcdHJldHVybiBudWxsO1xuICAgIH0sXG4gICAgLy8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMzpcbiAgICBpc0RlZmF1bHROYW1lc3BhY2U6ZnVuY3Rpb24obmFtZXNwYWNlVVJJKXtcbiAgICBcdHZhciBwcmVmaXggPSB0aGlzLmxvb2t1cFByZWZpeChuYW1lc3BhY2VVUkkpO1xuICAgIFx0cmV0dXJuIHByZWZpeCA9PSBudWxsO1xuICAgIH1cbn07XG5cblxuZnVuY3Rpb24gX3htbEVuY29kZXIoYyl7XG5cdHJldHVybiBjID09ICc8JyAmJiAnJmx0OycgfHxcbiAgICAgICAgIGMgPT0gJz4nICYmICcmZ3Q7JyB8fFxuICAgICAgICAgYyA9PSAnJicgJiYgJyZhbXA7JyB8fFxuICAgICAgICAgYyA9PSAnXCInICYmICcmcXVvdDsnIHx8XG4gICAgICAgICAnJiMnK2MuY2hhckNvZGVBdCgpKyc7J1xufVxuXG5cbmNvcHkoTm9kZVR5cGUsTm9kZSk7XG5jb3B5KE5vZGVUeXBlLE5vZGUucHJvdG90eXBlKTtcblxuLyoqXG4gKiBAcGFyYW0gY2FsbGJhY2sgcmV0dXJuIHRydWUgZm9yIGNvbnRpbnVlLGZhbHNlIGZvciBicmVha1xuICogQHJldHVybiBib29sZWFuIHRydWU6IGJyZWFrIHZpc2l0O1xuICovXG5mdW5jdGlvbiBfdmlzaXROb2RlKG5vZGUsY2FsbGJhY2spe1xuXHRpZihjYWxsYmFjayhub2RlKSl7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblx0aWYobm9kZSA9IG5vZGUuZmlyc3RDaGlsZCl7XG5cdFx0ZG97XG5cdFx0XHRpZihfdmlzaXROb2RlKG5vZGUsY2FsbGJhY2spKXtyZXR1cm4gdHJ1ZX1cbiAgICAgICAgfXdoaWxlKG5vZGU9bm9kZS5uZXh0U2libGluZylcbiAgICB9XG59XG5cblxuXG5mdW5jdGlvbiBEb2N1bWVudCgpe1xufVxuXG5mdW5jdGlvbiBfb25BZGRBdHRyaWJ1dGUoZG9jLGVsLG5ld0F0dHIpe1xuXHRkb2MgJiYgZG9jLl9pbmMrKztcblx0dmFyIG5zID0gbmV3QXR0ci5uYW1lc3BhY2VVUkkgO1xuXHRpZihucyA9PT0gTkFNRVNQQUNFLlhNTE5TKXtcblx0XHQvL3VwZGF0ZSBuYW1lc3BhY2Vcblx0XHRlbC5fbnNNYXBbbmV3QXR0ci5wcmVmaXg/bmV3QXR0ci5sb2NhbE5hbWU6JyddID0gbmV3QXR0ci52YWx1ZVxuXHR9XG59XG5cbmZ1bmN0aW9uIF9vblJlbW92ZUF0dHJpYnV0ZShkb2MsZWwsbmV3QXR0cixyZW1vdmUpe1xuXHRkb2MgJiYgZG9jLl9pbmMrKztcblx0dmFyIG5zID0gbmV3QXR0ci5uYW1lc3BhY2VVUkkgO1xuXHRpZihucyA9PT0gTkFNRVNQQUNFLlhNTE5TKXtcblx0XHQvL3VwZGF0ZSBuYW1lc3BhY2Vcblx0XHRkZWxldGUgZWwuX25zTWFwW25ld0F0dHIucHJlZml4P25ld0F0dHIubG9jYWxOYW1lOicnXVxuXHR9XG59XG5cbi8qKlxuICogVXBkYXRlcyBgZWwuY2hpbGROb2Rlc2AsIHVwZGF0aW5nIHRoZSBpbmRleGVkIGl0ZW1zIGFuZCBpdCdzIGBsZW5ndGhgLlxuICogUGFzc2luZyBgbmV3Q2hpbGRgIG1lYW5zIGl0IHdpbGwgYmUgYXBwZW5kZWQuXG4gKiBPdGhlcndpc2UgaXQncyBhc3N1bWVkIHRoYXQgYW4gaXRlbSBoYXMgYmVlbiByZW1vdmVkLFxuICogYW5kIGBlbC5maXJzdE5vZGVgIGFuZCBpdCdzIGAubmV4dFNpYmxpbmdgIGFyZSB1c2VkXG4gKiB0byB3YWxrIHRoZSBjdXJyZW50IGxpc3Qgb2YgY2hpbGQgbm9kZXMuXG4gKlxuICogQHBhcmFtIHtEb2N1bWVudH0gZG9jXG4gKiBAcGFyYW0ge05vZGV9IGVsXG4gKiBAcGFyYW0ge05vZGV9IFtuZXdDaGlsZF1cbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIF9vblVwZGF0ZUNoaWxkIChkb2MsIGVsLCBuZXdDaGlsZCkge1xuXHRpZihkb2MgJiYgZG9jLl9pbmMpe1xuXHRcdGRvYy5faW5jKys7XG5cdFx0Ly91cGRhdGUgY2hpbGROb2Rlc1xuXHRcdHZhciBjcyA9IGVsLmNoaWxkTm9kZXM7XG5cdFx0aWYgKG5ld0NoaWxkKSB7XG5cdFx0XHRjc1tjcy5sZW5ndGgrK10gPSBuZXdDaGlsZDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmFyIGNoaWxkID0gZWwuZmlyc3RDaGlsZDtcblx0XHRcdHZhciBpID0gMDtcblx0XHRcdHdoaWxlIChjaGlsZCkge1xuXHRcdFx0XHRjc1tpKytdID0gY2hpbGQ7XG5cdFx0XHRcdGNoaWxkID0gY2hpbGQubmV4dFNpYmxpbmc7XG5cdFx0XHR9XG5cdFx0XHRjcy5sZW5ndGggPSBpO1xuXHRcdFx0ZGVsZXRlIGNzW2NzLmxlbmd0aF07XG5cdFx0fVxuXHR9XG59XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgY29ubmVjdGlvbnMgYmV0d2VlbiBgcGFyZW50Tm9kZWAgYW5kIGBjaGlsZGBcbiAqIGFuZCBhbnkgZXhpc3RpbmcgYGNoaWxkLnByZXZpb3VzU2libGluZ2Agb3IgYGNoaWxkLm5leHRTaWJsaW5nYC5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS94bWxkb20veG1sZG9tL2lzc3Vlcy8xMzVcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3htbGRvbS94bWxkb20vaXNzdWVzLzE0NVxuICpcbiAqIEBwYXJhbSB7Tm9kZX0gcGFyZW50Tm9kZVxuICogQHBhcmFtIHtOb2RlfSBjaGlsZFxuICogQHJldHVybnMge05vZGV9IHRoZSBjaGlsZCB0aGF0IHdhcyByZW1vdmVkLlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24gX3JlbW92ZUNoaWxkIChwYXJlbnROb2RlLCBjaGlsZCkge1xuXHR2YXIgcHJldmlvdXMgPSBjaGlsZC5wcmV2aW91c1NpYmxpbmc7XG5cdHZhciBuZXh0ID0gY2hpbGQubmV4dFNpYmxpbmc7XG5cdGlmIChwcmV2aW91cykge1xuXHRcdHByZXZpb3VzLm5leHRTaWJsaW5nID0gbmV4dDtcblx0fSBlbHNlIHtcblx0XHRwYXJlbnROb2RlLmZpcnN0Q2hpbGQgPSBuZXh0O1xuXHR9XG5cdGlmIChuZXh0KSB7XG5cdFx0bmV4dC5wcmV2aW91c1NpYmxpbmcgPSBwcmV2aW91cztcblx0fSBlbHNlIHtcblx0XHRwYXJlbnROb2RlLmxhc3RDaGlsZCA9IHByZXZpb3VzO1xuXHR9XG5cdGNoaWxkLnBhcmVudE5vZGUgPSBudWxsO1xuXHRjaGlsZC5wcmV2aW91c1NpYmxpbmcgPSBudWxsO1xuXHRjaGlsZC5uZXh0U2libGluZyA9IG51bGw7XG5cdF9vblVwZGF0ZUNoaWxkKHBhcmVudE5vZGUub3duZXJEb2N1bWVudCwgcGFyZW50Tm9kZSk7XG5cdHJldHVybiBjaGlsZDtcbn1cbi8qKlxuICogcHJlZm9ybWFuY2Uga2V5KHJlZkNoaWxkID09IG51bGwpXG4gKi9cbmZ1bmN0aW9uIF9pbnNlcnRCZWZvcmUocGFyZW50Tm9kZSxuZXdDaGlsZCxuZXh0Q2hpbGQpe1xuXHR2YXIgY3AgPSBuZXdDaGlsZC5wYXJlbnROb2RlO1xuXHRpZihjcCl7XG5cdFx0Y3AucmVtb3ZlQ2hpbGQobmV3Q2hpbGQpOy8vcmVtb3ZlIGFuZCB1cGRhdGVcblx0fVxuXHRpZihuZXdDaGlsZC5ub2RlVHlwZSA9PT0gRE9DVU1FTlRfRlJBR01FTlRfTk9ERSl7XG5cdFx0dmFyIG5ld0ZpcnN0ID0gbmV3Q2hpbGQuZmlyc3RDaGlsZDtcblx0XHRpZiAobmV3Rmlyc3QgPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIG5ld0NoaWxkO1xuXHRcdH1cblx0XHR2YXIgbmV3TGFzdCA9IG5ld0NoaWxkLmxhc3RDaGlsZDtcblx0fWVsc2V7XG5cdFx0bmV3Rmlyc3QgPSBuZXdMYXN0ID0gbmV3Q2hpbGQ7XG5cdH1cblx0dmFyIHByZSA9IG5leHRDaGlsZCA/IG5leHRDaGlsZC5wcmV2aW91c1NpYmxpbmcgOiBwYXJlbnROb2RlLmxhc3RDaGlsZDtcblxuXHRuZXdGaXJzdC5wcmV2aW91c1NpYmxpbmcgPSBwcmU7XG5cdG5ld0xhc3QubmV4dFNpYmxpbmcgPSBuZXh0Q2hpbGQ7XG5cdFxuXHRcblx0aWYocHJlKXtcblx0XHRwcmUubmV4dFNpYmxpbmcgPSBuZXdGaXJzdDtcblx0fWVsc2V7XG5cdFx0cGFyZW50Tm9kZS5maXJzdENoaWxkID0gbmV3Rmlyc3Q7XG5cdH1cblx0aWYobmV4dENoaWxkID09IG51bGwpe1xuXHRcdHBhcmVudE5vZGUubGFzdENoaWxkID0gbmV3TGFzdDtcblx0fWVsc2V7XG5cdFx0bmV4dENoaWxkLnByZXZpb3VzU2libGluZyA9IG5ld0xhc3Q7XG5cdH1cblx0ZG97XG5cdFx0bmV3Rmlyc3QucGFyZW50Tm9kZSA9IHBhcmVudE5vZGU7XG5cdH13aGlsZShuZXdGaXJzdCAhPT0gbmV3TGFzdCAmJiAobmV3Rmlyc3Q9IG5ld0ZpcnN0Lm5leHRTaWJsaW5nKSlcblx0X29uVXBkYXRlQ2hpbGQocGFyZW50Tm9kZS5vd25lckRvY3VtZW50fHxwYXJlbnROb2RlLHBhcmVudE5vZGUpO1xuXHQvL2NvbnNvbGUubG9nKHBhcmVudE5vZGUubGFzdENoaWxkLm5leHRTaWJsaW5nID09IG51bGwpXG5cdGlmIChuZXdDaGlsZC5ub2RlVHlwZSA9PSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFKSB7XG5cdFx0bmV3Q2hpbGQuZmlyc3RDaGlsZCA9IG5ld0NoaWxkLmxhc3RDaGlsZCA9IG51bGw7XG5cdH1cblx0cmV0dXJuIG5ld0NoaWxkO1xufVxuXG4vKipcbiAqIEFwcGVuZHMgYG5ld0NoaWxkYCB0byBgcGFyZW50Tm9kZWAuXG4gKiBJZiBgbmV3Q2hpbGRgIGlzIGFscmVhZHkgY29ubmVjdGVkIHRvIGEgYHBhcmVudE5vZGVgIGl0IGlzIGZpcnN0IHJlbW92ZWQgZnJvbSBpdC5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS94bWxkb20veG1sZG9tL2lzc3Vlcy8xMzVcbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3htbGRvbS94bWxkb20vaXNzdWVzLzE0NVxuICogQHBhcmFtIHtOb2RlfSBwYXJlbnROb2RlXG4gKiBAcGFyYW0ge05vZGV9IG5ld0NoaWxkXG4gKiBAcmV0dXJucyB7Tm9kZX1cbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIF9hcHBlbmRTaW5nbGVDaGlsZCAocGFyZW50Tm9kZSwgbmV3Q2hpbGQpIHtcblx0aWYgKG5ld0NoaWxkLnBhcmVudE5vZGUpIHtcblx0XHRuZXdDaGlsZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5ld0NoaWxkKTtcblx0fVxuXHRuZXdDaGlsZC5wYXJlbnROb2RlID0gcGFyZW50Tm9kZTtcblx0bmV3Q2hpbGQucHJldmlvdXNTaWJsaW5nID0gcGFyZW50Tm9kZS5sYXN0Q2hpbGQ7XG5cdG5ld0NoaWxkLm5leHRTaWJsaW5nID0gbnVsbDtcblx0aWYgKG5ld0NoaWxkLnByZXZpb3VzU2libGluZykge1xuXHRcdG5ld0NoaWxkLnByZXZpb3VzU2libGluZy5uZXh0U2libGluZyA9IG5ld0NoaWxkO1xuXHR9IGVsc2Uge1xuXHRcdHBhcmVudE5vZGUuZmlyc3RDaGlsZCA9IG5ld0NoaWxkO1xuXHR9XG5cdHBhcmVudE5vZGUubGFzdENoaWxkID0gbmV3Q2hpbGQ7XG5cdF9vblVwZGF0ZUNoaWxkKHBhcmVudE5vZGUub3duZXJEb2N1bWVudCwgcGFyZW50Tm9kZSwgbmV3Q2hpbGQpO1xuXHRyZXR1cm4gbmV3Q2hpbGQ7XG59XG5cbkRvY3VtZW50LnByb3RvdHlwZSA9IHtcblx0Ly9pbXBsZW1lbnRhdGlvbiA6IG51bGwsXG5cdG5vZGVOYW1lIDogICcjZG9jdW1lbnQnLFxuXHRub2RlVHlwZSA6ICBET0NVTUVOVF9OT0RFLFxuXHQvKipcblx0ICogVGhlIERvY3VtZW50VHlwZSBub2RlIG9mIHRoZSBkb2N1bWVudC5cblx0ICpcblx0ICogQHJlYWRvbmx5XG5cdCAqIEB0eXBlIERvY3VtZW50VHlwZVxuXHQgKi9cblx0ZG9jdHlwZSA6ICBudWxsLFxuXHRkb2N1bWVudEVsZW1lbnQgOiAgbnVsbCxcblx0X2luYyA6IDEsXG5cblx0aW5zZXJ0QmVmb3JlIDogIGZ1bmN0aW9uKG5ld0NoaWxkLCByZWZDaGlsZCl7Ly9yYWlzZXNcblx0XHRpZihuZXdDaGlsZC5ub2RlVHlwZSA9PSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFKXtcblx0XHRcdHZhciBjaGlsZCA9IG5ld0NoaWxkLmZpcnN0Q2hpbGQ7XG5cdFx0XHR3aGlsZShjaGlsZCl7XG5cdFx0XHRcdHZhciBuZXh0ID0gY2hpbGQubmV4dFNpYmxpbmc7XG5cdFx0XHRcdHRoaXMuaW5zZXJ0QmVmb3JlKGNoaWxkLHJlZkNoaWxkKTtcblx0XHRcdFx0Y2hpbGQgPSBuZXh0O1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG5ld0NoaWxkO1xuXHRcdH1cblx0XHRpZih0aGlzLmRvY3VtZW50RWxlbWVudCA9PSBudWxsICYmIG5ld0NoaWxkLm5vZGVUeXBlID09IEVMRU1FTlRfTk9ERSl7XG5cdFx0XHR0aGlzLmRvY3VtZW50RWxlbWVudCA9IG5ld0NoaWxkO1xuXHRcdH1cblxuXHRcdHJldHVybiBfaW5zZXJ0QmVmb3JlKHRoaXMsbmV3Q2hpbGQscmVmQ2hpbGQpLChuZXdDaGlsZC5vd25lckRvY3VtZW50ID0gdGhpcyksbmV3Q2hpbGQ7XG5cdH0sXG5cdHJlbW92ZUNoaWxkIDogIGZ1bmN0aW9uKG9sZENoaWxkKXtcblx0XHRpZih0aGlzLmRvY3VtZW50RWxlbWVudCA9PSBvbGRDaGlsZCl7XG5cdFx0XHR0aGlzLmRvY3VtZW50RWxlbWVudCA9IG51bGw7XG5cdFx0fVxuXHRcdHJldHVybiBfcmVtb3ZlQ2hpbGQodGhpcyxvbGRDaGlsZCk7XG5cdH0sXG5cdC8vIEludHJvZHVjZWQgaW4gRE9NIExldmVsIDI6XG5cdGltcG9ydE5vZGUgOiBmdW5jdGlvbihpbXBvcnRlZE5vZGUsZGVlcCl7XG5cdFx0cmV0dXJuIGltcG9ydE5vZGUodGhpcyxpbXBvcnRlZE5vZGUsZGVlcCk7XG5cdH0sXG5cdC8vIEludHJvZHVjZWQgaW4gRE9NIExldmVsIDI6XG5cdGdldEVsZW1lbnRCeUlkIDpcdGZ1bmN0aW9uKGlkKXtcblx0XHR2YXIgcnR2ID0gbnVsbDtcblx0XHRfdmlzaXROb2RlKHRoaXMuZG9jdW1lbnRFbGVtZW50LGZ1bmN0aW9uKG5vZGUpe1xuXHRcdFx0aWYobm9kZS5ub2RlVHlwZSA9PSBFTEVNRU5UX05PREUpe1xuXHRcdFx0XHRpZihub2RlLmdldEF0dHJpYnV0ZSgnaWQnKSA9PSBpZCl7XG5cdFx0XHRcdFx0cnR2ID0gbm9kZTtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pXG5cdFx0cmV0dXJuIHJ0djtcblx0fSxcblxuXHQvKipcblx0ICogVGhlIGBnZXRFbGVtZW50c0J5Q2xhc3NOYW1lYCBtZXRob2Qgb2YgYERvY3VtZW50YCBpbnRlcmZhY2UgcmV0dXJucyBhbiBhcnJheS1saWtlIG9iamVjdFxuXHQgKiBvZiBhbGwgY2hpbGQgZWxlbWVudHMgd2hpY2ggaGF2ZSAqKmFsbCoqIG9mIHRoZSBnaXZlbiBjbGFzcyBuYW1lKHMpLlxuXHQgKlxuXHQgKiBSZXR1cm5zIGFuIGVtcHR5IGxpc3QgaWYgYGNsYXNzZU5hbWVzYCBpcyBhbiBlbXB0eSBzdHJpbmcgb3Igb25seSBjb250YWlucyBIVE1MIHdoaXRlIHNwYWNlIGNoYXJhY3RlcnMuXG5cdCAqXG5cdCAqXG5cdCAqIFdhcm5pbmc6IFRoaXMgaXMgYSBsaXZlIExpdmVOb2RlTGlzdC5cblx0ICogQ2hhbmdlcyBpbiB0aGUgRE9NIHdpbGwgcmVmbGVjdCBpbiB0aGUgYXJyYXkgYXMgdGhlIGNoYW5nZXMgb2NjdXIuXG5cdCAqIElmIGFuIGVsZW1lbnQgc2VsZWN0ZWQgYnkgdGhpcyBhcnJheSBubyBsb25nZXIgcXVhbGlmaWVzIGZvciB0aGUgc2VsZWN0b3IsXG5cdCAqIGl0IHdpbGwgYXV0b21hdGljYWxseSBiZSByZW1vdmVkLiBCZSBhd2FyZSBvZiB0aGlzIGZvciBpdGVyYXRpb24gcHVycG9zZXMuXG5cdCAqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBjbGFzc05hbWVzIGlzIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY2xhc3MgbmFtZShzKSB0byBtYXRjaDsgbXVsdGlwbGUgY2xhc3MgbmFtZXMgYXJlIHNlcGFyYXRlZCBieSAoQVNDSUktKXdoaXRlc3BhY2Vcblx0ICpcblx0ICogQHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvRG9jdW1lbnQvZ2V0RWxlbWVudHNCeUNsYXNzTmFtZVxuXHQgKiBAc2VlIGh0dHBzOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jY29uY2VwdC1nZXRlbGVtZW50c2J5Y2xhc3NuYW1lXG5cdCAqL1xuXHRnZXRFbGVtZW50c0J5Q2xhc3NOYW1lOiBmdW5jdGlvbihjbGFzc05hbWVzKSB7XG5cdFx0dmFyIGNsYXNzTmFtZXNTZXQgPSB0b09yZGVyZWRTZXQoY2xhc3NOYW1lcylcblx0XHRyZXR1cm4gbmV3IExpdmVOb2RlTGlzdCh0aGlzLCBmdW5jdGlvbihiYXNlKSB7XG5cdFx0XHR2YXIgbHMgPSBbXTtcblx0XHRcdGlmIChjbGFzc05hbWVzU2V0Lmxlbmd0aCA+IDApIHtcblx0XHRcdFx0X3Zpc2l0Tm9kZShiYXNlLmRvY3VtZW50RWxlbWVudCwgZnVuY3Rpb24obm9kZSkge1xuXHRcdFx0XHRcdGlmKG5vZGUgIT09IGJhc2UgJiYgbm9kZS5ub2RlVHlwZSA9PT0gRUxFTUVOVF9OT0RFKSB7XG5cdFx0XHRcdFx0XHR2YXIgbm9kZUNsYXNzTmFtZXMgPSBub2RlLmdldEF0dHJpYnV0ZSgnY2xhc3MnKVxuXHRcdFx0XHRcdFx0Ly8gY2FuIGJlIG51bGwgaWYgdGhlIGF0dHJpYnV0ZSBkb2VzIG5vdCBleGlzdFxuXHRcdFx0XHRcdFx0aWYgKG5vZGVDbGFzc05hbWVzKSB7XG5cdFx0XHRcdFx0XHRcdC8vIGJlZm9yZSBzcGxpdHRpbmcgYW5kIGl0ZXJhdGluZyBqdXN0IGNvbXBhcmUgdGhlbSBmb3IgdGhlIG1vc3QgY29tbW9uIGNhc2Vcblx0XHRcdFx0XHRcdFx0dmFyIG1hdGNoZXMgPSBjbGFzc05hbWVzID09PSBub2RlQ2xhc3NOYW1lcztcblx0XHRcdFx0XHRcdFx0aWYgKCFtYXRjaGVzKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIG5vZGVDbGFzc05hbWVzU2V0ID0gdG9PcmRlcmVkU2V0KG5vZGVDbGFzc05hbWVzKVxuXHRcdFx0XHRcdFx0XHRcdG1hdGNoZXMgPSBjbGFzc05hbWVzU2V0LmV2ZXJ5KGFycmF5SW5jbHVkZXMobm9kZUNsYXNzTmFtZXNTZXQpKVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGlmKG1hdGNoZXMpIHtcblx0XHRcdFx0XHRcdFx0XHRscy5wdXNoKG5vZGUpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiBscztcblx0XHR9KTtcblx0fSxcblxuXHQvL2RvY3VtZW50IGZhY3RvcnkgbWV0aG9kOlxuXHRjcmVhdGVFbGVtZW50IDpcdGZ1bmN0aW9uKHRhZ05hbWUpe1xuXHRcdHZhciBub2RlID0gbmV3IEVsZW1lbnQoKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnQgPSB0aGlzO1xuXHRcdG5vZGUubm9kZU5hbWUgPSB0YWdOYW1lO1xuXHRcdG5vZGUudGFnTmFtZSA9IHRhZ05hbWU7XG5cdFx0bm9kZS5sb2NhbE5hbWUgPSB0YWdOYW1lO1xuXHRcdG5vZGUuY2hpbGROb2RlcyA9IG5ldyBOb2RlTGlzdCgpO1xuXHRcdHZhciBhdHRyc1x0PSBub2RlLmF0dHJpYnV0ZXMgPSBuZXcgTmFtZWROb2RlTWFwKCk7XG5cdFx0YXR0cnMuX293bmVyRWxlbWVudCA9IG5vZGU7XG5cdFx0cmV0dXJuIG5vZGU7XG5cdH0sXG5cdGNyZWF0ZURvY3VtZW50RnJhZ21lbnQgOlx0ZnVuY3Rpb24oKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBEb2N1bWVudEZyYWdtZW50KCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLmNoaWxkTm9kZXMgPSBuZXcgTm9kZUxpc3QoKTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlVGV4dE5vZGUgOlx0ZnVuY3Rpb24oZGF0YSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgVGV4dCgpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudCA9IHRoaXM7XG5cdFx0bm9kZS5hcHBlbmREYXRhKGRhdGEpXG5cdFx0cmV0dXJuIG5vZGU7XG5cdH0sXG5cdGNyZWF0ZUNvbW1lbnQgOlx0ZnVuY3Rpb24oZGF0YSl7XG5cdFx0dmFyIG5vZGUgPSBuZXcgQ29tbWVudCgpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudCA9IHRoaXM7XG5cdFx0bm9kZS5hcHBlbmREYXRhKGRhdGEpXG5cdFx0cmV0dXJuIG5vZGU7XG5cdH0sXG5cdGNyZWF0ZUNEQVRBU2VjdGlvbiA6XHRmdW5jdGlvbihkYXRhKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBDREFUQVNlY3Rpb24oKTtcblx0XHRub2RlLm93bmVyRG9jdW1lbnQgPSB0aGlzO1xuXHRcdG5vZGUuYXBwZW5kRGF0YShkYXRhKVxuXHRcdHJldHVybiBub2RlO1xuXHR9LFxuXHRjcmVhdGVQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24gOlx0ZnVuY3Rpb24odGFyZ2V0LGRhdGEpe1xuXHRcdHZhciBub2RlID0gbmV3IFByb2Nlc3NpbmdJbnN0cnVjdGlvbigpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudCA9IHRoaXM7XG5cdFx0bm9kZS50YWdOYW1lID0gbm9kZS50YXJnZXQgPSB0YXJnZXQ7XG5cdFx0bm9kZS5ub2RlVmFsdWU9IG5vZGUuZGF0YSA9IGRhdGE7XG5cdFx0cmV0dXJuIG5vZGU7XG5cdH0sXG5cdGNyZWF0ZUF0dHJpYnV0ZSA6XHRmdW5jdGlvbihuYW1lKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBBdHRyKCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50XHQ9IHRoaXM7XG5cdFx0bm9kZS5uYW1lID0gbmFtZTtcblx0XHRub2RlLm5vZGVOYW1lXHQ9IG5hbWU7XG5cdFx0bm9kZS5sb2NhbE5hbWUgPSBuYW1lO1xuXHRcdG5vZGUuc3BlY2lmaWVkID0gdHJ1ZTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Y3JlYXRlRW50aXR5UmVmZXJlbmNlIDpcdGZ1bmN0aW9uKG5hbWUpe1xuXHRcdHZhciBub2RlID0gbmV3IEVudGl0eVJlZmVyZW5jZSgpO1xuXHRcdG5vZGUub3duZXJEb2N1bWVudFx0PSB0aGlzO1xuXHRcdG5vZGUubm9kZU5hbWVcdD0gbmFtZTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Ly8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcblx0Y3JlYXRlRWxlbWVudE5TIDpcdGZ1bmN0aW9uKG5hbWVzcGFjZVVSSSxxdWFsaWZpZWROYW1lKXtcblx0XHR2YXIgbm9kZSA9IG5ldyBFbGVtZW50KCk7XG5cdFx0dmFyIHBsID0gcXVhbGlmaWVkTmFtZS5zcGxpdCgnOicpO1xuXHRcdHZhciBhdHRyc1x0PSBub2RlLmF0dHJpYnV0ZXMgPSBuZXcgTmFtZWROb2RlTWFwKCk7XG5cdFx0bm9kZS5jaGlsZE5vZGVzID0gbmV3IE5vZGVMaXN0KCk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLm5vZGVOYW1lID0gcXVhbGlmaWVkTmFtZTtcblx0XHRub2RlLnRhZ05hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdG5vZGUubmFtZXNwYWNlVVJJID0gbmFtZXNwYWNlVVJJO1xuXHRcdGlmKHBsLmxlbmd0aCA9PSAyKXtcblx0XHRcdG5vZGUucHJlZml4ID0gcGxbMF07XG5cdFx0XHRub2RlLmxvY2FsTmFtZSA9IHBsWzFdO1xuXHRcdH1lbHNle1xuXHRcdFx0Ly9lbC5wcmVmaXggPSBudWxsO1xuXHRcdFx0bm9kZS5sb2NhbE5hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdH1cblx0XHRhdHRycy5fb3duZXJFbGVtZW50ID0gbm9kZTtcblx0XHRyZXR1cm4gbm9kZTtcblx0fSxcblx0Ly8gSW50cm9kdWNlZCBpbiBET00gTGV2ZWwgMjpcblx0Y3JlYXRlQXR0cmlidXRlTlMgOlx0ZnVuY3Rpb24obmFtZXNwYWNlVVJJLHF1YWxpZmllZE5hbWUpe1xuXHRcdHZhciBub2RlID0gbmV3IEF0dHIoKTtcblx0XHR2YXIgcGwgPSBxdWFsaWZpZWROYW1lLnNwbGl0KCc6Jyk7XG5cdFx0bm9kZS5vd25lckRvY3VtZW50ID0gdGhpcztcblx0XHRub2RlLm5vZGVOYW1lID0gcXVhbGlmaWVkTmFtZTtcblx0XHRub2RlLm5hbWUgPSBxdWFsaWZpZWROYW1lO1xuXHRcdG5vZGUubmFtZXNwYWNlVVJJID0gbmFtZXNwYWNlVVJJO1xuXHRcdG5vZGUuc3BlY2lmaWVkID0gdHJ1ZTtcblx0XHRpZihwbC5sZW5ndGggPT0gMil7XG5cdFx0XHRub2RlLnByZWZpeCA9IHBsWzBdO1xuXHRcdFx0bm9kZS5sb2NhbE5hbWUgPSBwbFsxXTtcblx0XHR9ZWxzZXtcblx0XHRcdC8vZWwucHJlZml4ID0gbnVsbDtcblx0XHRcdG5vZGUubG9jYWxOYW1lID0gcXVhbGlmaWVkTmFtZTtcblx0XHR9XG5cdFx0cmV0dXJuIG5vZGU7XG5cdH1cbn07XG5fZXh0ZW5kcyhEb2N1bWVudCxOb2RlKTtcblxuXG5mdW5jdGlvbiBFbGVtZW50KCkge1xuXHR0aGlzLl9uc01hcCA9IHt9O1xufTtcbkVsZW1lbnQucHJvdG90eXBlID0ge1xuXHRub2RlVHlwZSA6IEVMRU1FTlRfTk9ERSxcblx0aGFzQXR0cmlidXRlIDogZnVuY3Rpb24obmFtZSl7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlTm9kZShuYW1lKSE9bnVsbDtcblx0fSxcblx0Z2V0QXR0cmlidXRlIDogZnVuY3Rpb24obmFtZSl7XG5cdFx0dmFyIGF0dHIgPSB0aGlzLmdldEF0dHJpYnV0ZU5vZGUobmFtZSk7XG5cdFx0cmV0dXJuIGF0dHIgJiYgYXR0ci52YWx1ZSB8fCAnJztcblx0fSxcblx0Z2V0QXR0cmlidXRlTm9kZSA6IGZ1bmN0aW9uKG5hbWUpe1xuXHRcdHJldHVybiB0aGlzLmF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtKG5hbWUpO1xuXHR9LFxuXHRzZXRBdHRyaWJ1dGUgOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSl7XG5cdFx0dmFyIGF0dHIgPSB0aGlzLm93bmVyRG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKG5hbWUpO1xuXHRcdGF0dHIudmFsdWUgPSBhdHRyLm5vZGVWYWx1ZSA9IFwiXCIgKyB2YWx1ZTtcblx0XHR0aGlzLnNldEF0dHJpYnV0ZU5vZGUoYXR0cilcblx0fSxcblx0cmVtb3ZlQXR0cmlidXRlIDogZnVuY3Rpb24obmFtZSl7XG5cdFx0dmFyIGF0dHIgPSB0aGlzLmdldEF0dHJpYnV0ZU5vZGUobmFtZSlcblx0XHRhdHRyICYmIHRoaXMucmVtb3ZlQXR0cmlidXRlTm9kZShhdHRyKTtcblx0fSxcblx0XG5cdC8vZm91ciByZWFsIG9wZWFydGlvbiBtZXRob2Rcblx0YXBwZW5kQ2hpbGQ6ZnVuY3Rpb24obmV3Q2hpbGQpe1xuXHRcdGlmKG5ld0NoaWxkLm5vZGVUeXBlID09PSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFKXtcblx0XHRcdHJldHVybiB0aGlzLmluc2VydEJlZm9yZShuZXdDaGlsZCxudWxsKTtcblx0XHR9ZWxzZXtcblx0XHRcdHJldHVybiBfYXBwZW5kU2luZ2xlQ2hpbGQodGhpcyxuZXdDaGlsZCk7XG5cdFx0fVxuXHR9LFxuXHRzZXRBdHRyaWJ1dGVOb2RlIDogZnVuY3Rpb24obmV3QXR0cil7XG5cdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5zZXROYW1lZEl0ZW0obmV3QXR0cik7XG5cdH0sXG5cdHNldEF0dHJpYnV0ZU5vZGVOUyA6IGZ1bmN0aW9uKG5ld0F0dHIpe1xuXHRcdHJldHVybiB0aGlzLmF0dHJpYnV0ZXMuc2V0TmFtZWRJdGVtTlMobmV3QXR0cik7XG5cdH0sXG5cdHJlbW92ZUF0dHJpYnV0ZU5vZGUgOiBmdW5jdGlvbihvbGRBdHRyKXtcblx0XHQvL2NvbnNvbGUubG9nKHRoaXMgPT0gb2xkQXR0ci5vd25lckVsZW1lbnQpXG5cdFx0cmV0dXJuIHRoaXMuYXR0cmlidXRlcy5yZW1vdmVOYW1lZEl0ZW0ob2xkQXR0ci5ub2RlTmFtZSk7XG5cdH0sXG5cdC8vZ2V0IHJlYWwgYXR0cmlidXRlIG5hbWUsYW5kIHJlbW92ZSBpdCBieSByZW1vdmVBdHRyaWJ1dGVOb2RlXG5cdHJlbW92ZUF0dHJpYnV0ZU5TIDogZnVuY3Rpb24obmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpe1xuXHRcdHZhciBvbGQgPSB0aGlzLmdldEF0dHJpYnV0ZU5vZGVOUyhuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSk7XG5cdFx0b2xkICYmIHRoaXMucmVtb3ZlQXR0cmlidXRlTm9kZShvbGQpO1xuXHR9LFxuXHRcblx0aGFzQXR0cmlidXRlTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSl7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlTm9kZU5TKG5hbWVzcGFjZVVSSSwgbG9jYWxOYW1lKSE9bnVsbDtcblx0fSxcblx0Z2V0QXR0cmlidXRlTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSl7XG5cdFx0dmFyIGF0dHIgPSB0aGlzLmdldEF0dHJpYnV0ZU5vZGVOUyhuYW1lc3BhY2VVUkksIGxvY2FsTmFtZSk7XG5cdFx0cmV0dXJuIGF0dHIgJiYgYXR0ci52YWx1ZSB8fCAnJztcblx0fSxcblx0c2V0QXR0cmlidXRlTlMgOiBmdW5jdGlvbihuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUsIHZhbHVlKXtcblx0XHR2YXIgYXR0ciA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGVOUyhuYW1lc3BhY2VVUkksIHF1YWxpZmllZE5hbWUpO1xuXHRcdGF0dHIudmFsdWUgPSBhdHRyLm5vZGVWYWx1ZSA9IFwiXCIgKyB2YWx1ZTtcblx0XHR0aGlzLnNldEF0dHJpYnV0ZU5vZGUoYXR0cilcblx0fSxcblx0Z2V0QXR0cmlidXRlTm9kZU5TIDogZnVuY3Rpb24obmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpe1xuXHRcdHJldHVybiB0aGlzLmF0dHJpYnV0ZXMuZ2V0TmFtZWRJdGVtTlMobmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpO1xuXHR9LFxuXHRcblx0Z2V0RWxlbWVudHNCeVRhZ05hbWUgOiBmdW5jdGlvbih0YWdOYW1lKXtcblx0XHRyZXR1cm4gbmV3IExpdmVOb2RlTGlzdCh0aGlzLGZ1bmN0aW9uKGJhc2Upe1xuXHRcdFx0dmFyIGxzID0gW107XG5cdFx0XHRfdmlzaXROb2RlKGJhc2UsZnVuY3Rpb24obm9kZSl7XG5cdFx0XHRcdGlmKG5vZGUgIT09IGJhc2UgJiYgbm9kZS5ub2RlVHlwZSA9PSBFTEVNRU5UX05PREUgJiYgKHRhZ05hbWUgPT09ICcqJyB8fCBub2RlLnRhZ05hbWUgPT0gdGFnTmFtZSkpe1xuXHRcdFx0XHRcdGxzLnB1c2gobm9kZSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIGxzO1xuXHRcdH0pO1xuXHR9LFxuXHRnZXRFbGVtZW50c0J5VGFnTmFtZU5TIDogZnVuY3Rpb24obmFtZXNwYWNlVVJJLCBsb2NhbE5hbWUpe1xuXHRcdHJldHVybiBuZXcgTGl2ZU5vZGVMaXN0KHRoaXMsZnVuY3Rpb24oYmFzZSl7XG5cdFx0XHR2YXIgbHMgPSBbXTtcblx0XHRcdF92aXNpdE5vZGUoYmFzZSxmdW5jdGlvbihub2RlKXtcblx0XHRcdFx0aWYobm9kZSAhPT0gYmFzZSAmJiBub2RlLm5vZGVUeXBlID09PSBFTEVNRU5UX05PREUgJiYgKG5hbWVzcGFjZVVSSSA9PT0gJyonIHx8IG5vZGUubmFtZXNwYWNlVVJJID09PSBuYW1lc3BhY2VVUkkpICYmIChsb2NhbE5hbWUgPT09ICcqJyB8fCBub2RlLmxvY2FsTmFtZSA9PSBsb2NhbE5hbWUpKXtcblx0XHRcdFx0XHRscy5wdXNoKG5vZGUpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdHJldHVybiBscztcblx0XHRcdFxuXHRcdH0pO1xuXHR9XG59O1xuRG9jdW1lbnQucHJvdG90eXBlLmdldEVsZW1lbnRzQnlUYWdOYW1lID0gRWxlbWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeVRhZ05hbWU7XG5Eb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeVRhZ05hbWVOUyA9IEVsZW1lbnQucHJvdG90eXBlLmdldEVsZW1lbnRzQnlUYWdOYW1lTlM7XG5cblxuX2V4dGVuZHMoRWxlbWVudCxOb2RlKTtcbmZ1bmN0aW9uIEF0dHIoKSB7XG59O1xuQXR0ci5wcm90b3R5cGUubm9kZVR5cGUgPSBBVFRSSUJVVEVfTk9ERTtcbl9leHRlbmRzKEF0dHIsTm9kZSk7XG5cblxuZnVuY3Rpb24gQ2hhcmFjdGVyRGF0YSgpIHtcbn07XG5DaGFyYWN0ZXJEYXRhLnByb3RvdHlwZSA9IHtcblx0ZGF0YSA6ICcnLFxuXHRzdWJzdHJpbmdEYXRhIDogZnVuY3Rpb24ob2Zmc2V0LCBjb3VudCkge1xuXHRcdHJldHVybiB0aGlzLmRhdGEuc3Vic3RyaW5nKG9mZnNldCwgb2Zmc2V0K2NvdW50KTtcblx0fSxcblx0YXBwZW5kRGF0YTogZnVuY3Rpb24odGV4dCkge1xuXHRcdHRleHQgPSB0aGlzLmRhdGErdGV4dDtcblx0XHR0aGlzLm5vZGVWYWx1ZSA9IHRoaXMuZGF0YSA9IHRleHQ7XG5cdFx0dGhpcy5sZW5ndGggPSB0ZXh0Lmxlbmd0aDtcblx0fSxcblx0aW5zZXJ0RGF0YTogZnVuY3Rpb24ob2Zmc2V0LHRleHQpIHtcblx0XHR0aGlzLnJlcGxhY2VEYXRhKG9mZnNldCwwLHRleHQpO1xuXHRcblx0fSxcblx0YXBwZW5kQ2hpbGQ6ZnVuY3Rpb24obmV3Q2hpbGQpe1xuXHRcdHRocm93IG5ldyBFcnJvcihFeGNlcHRpb25NZXNzYWdlW0hJRVJBUkNIWV9SRVFVRVNUX0VSUl0pXG5cdH0sXG5cdGRlbGV0ZURhdGE6IGZ1bmN0aW9uKG9mZnNldCwgY291bnQpIHtcblx0XHR0aGlzLnJlcGxhY2VEYXRhKG9mZnNldCxjb3VudCxcIlwiKTtcblx0fSxcblx0cmVwbGFjZURhdGE6IGZ1bmN0aW9uKG9mZnNldCwgY291bnQsIHRleHQpIHtcblx0XHR2YXIgc3RhcnQgPSB0aGlzLmRhdGEuc3Vic3RyaW5nKDAsb2Zmc2V0KTtcblx0XHR2YXIgZW5kID0gdGhpcy5kYXRhLnN1YnN0cmluZyhvZmZzZXQrY291bnQpO1xuXHRcdHRleHQgPSBzdGFydCArIHRleHQgKyBlbmQ7XG5cdFx0dGhpcy5ub2RlVmFsdWUgPSB0aGlzLmRhdGEgPSB0ZXh0O1xuXHRcdHRoaXMubGVuZ3RoID0gdGV4dC5sZW5ndGg7XG5cdH1cbn1cbl9leHRlbmRzKENoYXJhY3RlckRhdGEsTm9kZSk7XG5mdW5jdGlvbiBUZXh0KCkge1xufTtcblRleHQucHJvdG90eXBlID0ge1xuXHRub2RlTmFtZSA6IFwiI3RleHRcIixcblx0bm9kZVR5cGUgOiBURVhUX05PREUsXG5cdHNwbGl0VGV4dCA6IGZ1bmN0aW9uKG9mZnNldCkge1xuXHRcdHZhciB0ZXh0ID0gdGhpcy5kYXRhO1xuXHRcdHZhciBuZXdUZXh0ID0gdGV4dC5zdWJzdHJpbmcob2Zmc2V0KTtcblx0XHR0ZXh0ID0gdGV4dC5zdWJzdHJpbmcoMCwgb2Zmc2V0KTtcblx0XHR0aGlzLmRhdGEgPSB0aGlzLm5vZGVWYWx1ZSA9IHRleHQ7XG5cdFx0dGhpcy5sZW5ndGggPSB0ZXh0Lmxlbmd0aDtcblx0XHR2YXIgbmV3Tm9kZSA9IHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShuZXdUZXh0KTtcblx0XHRpZih0aGlzLnBhcmVudE5vZGUpe1xuXHRcdFx0dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdOb2RlLCB0aGlzLm5leHRTaWJsaW5nKTtcblx0XHR9XG5cdFx0cmV0dXJuIG5ld05vZGU7XG5cdH1cbn1cbl9leHRlbmRzKFRleHQsQ2hhcmFjdGVyRGF0YSk7XG5mdW5jdGlvbiBDb21tZW50KCkge1xufTtcbkNvbW1lbnQucHJvdG90eXBlID0ge1xuXHRub2RlTmFtZSA6IFwiI2NvbW1lbnRcIixcblx0bm9kZVR5cGUgOiBDT01NRU5UX05PREVcbn1cbl9leHRlbmRzKENvbW1lbnQsQ2hhcmFjdGVyRGF0YSk7XG5cbmZ1bmN0aW9uIENEQVRBU2VjdGlvbigpIHtcbn07XG5DREFUQVNlY3Rpb24ucHJvdG90eXBlID0ge1xuXHRub2RlTmFtZSA6IFwiI2NkYXRhLXNlY3Rpb25cIixcblx0bm9kZVR5cGUgOiBDREFUQV9TRUNUSU9OX05PREVcbn1cbl9leHRlbmRzKENEQVRBU2VjdGlvbixDaGFyYWN0ZXJEYXRhKTtcblxuXG5mdW5jdGlvbiBEb2N1bWVudFR5cGUoKSB7XG59O1xuRG9jdW1lbnRUeXBlLnByb3RvdHlwZS5ub2RlVHlwZSA9IERPQ1VNRU5UX1RZUEVfTk9ERTtcbl9leHRlbmRzKERvY3VtZW50VHlwZSxOb2RlKTtcblxuZnVuY3Rpb24gTm90YXRpb24oKSB7XG59O1xuTm90YXRpb24ucHJvdG90eXBlLm5vZGVUeXBlID0gTk9UQVRJT05fTk9ERTtcbl9leHRlbmRzKE5vdGF0aW9uLE5vZGUpO1xuXG5mdW5jdGlvbiBFbnRpdHkoKSB7XG59O1xuRW50aXR5LnByb3RvdHlwZS5ub2RlVHlwZSA9IEVOVElUWV9OT0RFO1xuX2V4dGVuZHMoRW50aXR5LE5vZGUpO1xuXG5mdW5jdGlvbiBFbnRpdHlSZWZlcmVuY2UoKSB7XG59O1xuRW50aXR5UmVmZXJlbmNlLnByb3RvdHlwZS5ub2RlVHlwZSA9IEVOVElUWV9SRUZFUkVOQ0VfTk9ERTtcbl9leHRlbmRzKEVudGl0eVJlZmVyZW5jZSxOb2RlKTtcblxuZnVuY3Rpb24gRG9jdW1lbnRGcmFnbWVudCgpIHtcbn07XG5Eb2N1bWVudEZyYWdtZW50LnByb3RvdHlwZS5ub2RlTmFtZSA9XHRcIiNkb2N1bWVudC1mcmFnbWVudFwiO1xuRG9jdW1lbnRGcmFnbWVudC5wcm90b3R5cGUubm9kZVR5cGUgPVx0RE9DVU1FTlRfRlJBR01FTlRfTk9ERTtcbl9leHRlbmRzKERvY3VtZW50RnJhZ21lbnQsTm9kZSk7XG5cblxuZnVuY3Rpb24gUHJvY2Vzc2luZ0luc3RydWN0aW9uKCkge1xufVxuUHJvY2Vzc2luZ0luc3RydWN0aW9uLnByb3RvdHlwZS5ub2RlVHlwZSA9IFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERTtcbl9leHRlbmRzKFByb2Nlc3NpbmdJbnN0cnVjdGlvbixOb2RlKTtcbmZ1bmN0aW9uIFhNTFNlcmlhbGl6ZXIoKXt9XG5YTUxTZXJpYWxpemVyLnByb3RvdHlwZS5zZXJpYWxpemVUb1N0cmluZyA9IGZ1bmN0aW9uKG5vZGUsaXNIdG1sLG5vZGVGaWx0ZXIpe1xuXHRyZXR1cm4gbm9kZVNlcmlhbGl6ZVRvU3RyaW5nLmNhbGwobm9kZSxpc0h0bWwsbm9kZUZpbHRlcik7XG59XG5Ob2RlLnByb3RvdHlwZS50b1N0cmluZyA9IG5vZGVTZXJpYWxpemVUb1N0cmluZztcbmZ1bmN0aW9uIG5vZGVTZXJpYWxpemVUb1N0cmluZyhpc0h0bWwsbm9kZUZpbHRlcil7XG5cdHZhciBidWYgPSBbXTtcblx0dmFyIHJlZk5vZGUgPSB0aGlzLm5vZGVUeXBlID09IDkgJiYgdGhpcy5kb2N1bWVudEVsZW1lbnQgfHwgdGhpcztcblx0dmFyIHByZWZpeCA9IHJlZk5vZGUucHJlZml4O1xuXHR2YXIgdXJpID0gcmVmTm9kZS5uYW1lc3BhY2VVUkk7XG5cdFxuXHRpZih1cmkgJiYgcHJlZml4ID09IG51bGwpe1xuXHRcdC8vY29uc29sZS5sb2cocHJlZml4KVxuXHRcdHZhciBwcmVmaXggPSByZWZOb2RlLmxvb2t1cFByZWZpeCh1cmkpO1xuXHRcdGlmKHByZWZpeCA9PSBudWxsKXtcblx0XHRcdC8vaXNIVE1MID0gdHJ1ZTtcblx0XHRcdHZhciB2aXNpYmxlTmFtZXNwYWNlcz1bXG5cdFx0XHR7bmFtZXNwYWNlOnVyaSxwcmVmaXg6bnVsbH1cblx0XHRcdC8ve25hbWVzcGFjZTp1cmkscHJlZml4OicnfVxuXHRcdFx0XVxuXHRcdH1cblx0fVxuXHRzZXJpYWxpemVUb1N0cmluZyh0aGlzLGJ1Zixpc0h0bWwsbm9kZUZpbHRlcix2aXNpYmxlTmFtZXNwYWNlcyk7XG5cdC8vY29uc29sZS5sb2coJyMjIycsdGhpcy5ub2RlVHlwZSx1cmkscHJlZml4LGJ1Zi5qb2luKCcnKSlcblx0cmV0dXJuIGJ1Zi5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gbmVlZE5hbWVzcGFjZURlZmluZShub2RlLCBpc0hUTUwsIHZpc2libGVOYW1lc3BhY2VzKSB7XG5cdHZhciBwcmVmaXggPSBub2RlLnByZWZpeCB8fCAnJztcblx0dmFyIHVyaSA9IG5vZGUubmFtZXNwYWNlVVJJO1xuXHQvLyBBY2NvcmRpbmcgdG8gW05hbWVzcGFjZXMgaW4gWE1MIDEuMF0oaHR0cHM6Ly93d3cudzMub3JnL1RSL1JFQy14bWwtbmFtZXMvI25zLXVzaW5nKSAsXG5cdC8vIGFuZCBtb3JlIHNwZWNpZmljYWxseSBodHRwczovL3d3dy53My5vcmcvVFIvUkVDLXhtbC1uYW1lcy8jbnNjLU5vUHJlZml4VW5kZWNsIDpcblx0Ly8gPiBJbiBhIG5hbWVzcGFjZSBkZWNsYXJhdGlvbiBmb3IgYSBwcmVmaXggWy4uLl0sIHRoZSBhdHRyaWJ1dGUgdmFsdWUgTVVTVCBOT1QgYmUgZW1wdHkuXG5cdC8vIGluIGEgc2ltaWxhciBtYW5uZXIgW05hbWVzcGFjZXMgaW4gWE1MIDEuMV0oaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC1uYW1lczExLyNucy11c2luZylcblx0Ly8gYW5kIG1vcmUgc3BlY2lmaWNhbGx5IGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwtbmFtZXMxMS8jbnNjLU5TRGVjbGFyZWQgOlxuXHQvLyA+IFsuLi5dIEZ1cnRoZXJtb3JlLCB0aGUgYXR0cmlidXRlIHZhbHVlIFsuLi5dIG11c3Qgbm90IGJlIGFuIGVtcHR5IHN0cmluZy5cblx0Ly8gc28gc2VyaWFsaXppbmcgZW1wdHkgbmFtZXNwYWNlIHZhbHVlIGxpa2UgeG1sbnM6ZHM9XCJcIiB3b3VsZCBwcm9kdWNlIGFuIGludmFsaWQgWE1MIGRvY3VtZW50LlxuXHRpZiAoIXVyaSkge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRpZiAocHJlZml4ID09PSBcInhtbFwiICYmIHVyaSA9PT0gTkFNRVNQQUNFLlhNTCB8fCB1cmkgPT09IE5BTUVTUEFDRS5YTUxOUykge1xuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXHRcblx0dmFyIGkgPSB2aXNpYmxlTmFtZXNwYWNlcy5sZW5ndGggXG5cdHdoaWxlIChpLS0pIHtcblx0XHR2YXIgbnMgPSB2aXNpYmxlTmFtZXNwYWNlc1tpXTtcblx0XHQvLyBnZXQgbmFtZXNwYWNlIHByZWZpeFxuXHRcdGlmIChucy5wcmVmaXggPT09IHByZWZpeCkge1xuXHRcdFx0cmV0dXJuIG5zLm5hbWVzcGFjZSAhPT0gdXJpO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICogV2VsbC1mb3JtZWQgY29uc3RyYWludDogTm8gPCBpbiBBdHRyaWJ1dGUgVmFsdWVzXG4gKiA+IFRoZSByZXBsYWNlbWVudCB0ZXh0IG9mIGFueSBlbnRpdHkgcmVmZXJyZWQgdG8gZGlyZWN0bHkgb3IgaW5kaXJlY3RseVxuICogPiBpbiBhbiBhdHRyaWJ1dGUgdmFsdWUgbXVzdCBub3QgY29udGFpbiBhIDwuXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwxMS8jQ2xlYW5BdHRyVmFsc1xuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sMTEvI05ULUF0dFZhbHVlXG4gKlxuICogTGl0ZXJhbCB3aGl0ZXNwYWNlIG90aGVyIHRoYW4gc3BhY2UgdGhhdCBhcHBlYXIgaW4gYXR0cmlidXRlIHZhbHVlc1xuICogYXJlIHNlcmlhbGl6ZWQgYXMgdGhlaXIgZW50aXR5IHJlZmVyZW5jZXMsIHNvIHRoZXkgd2lsbCBiZSBwcmVzZXJ2ZWQuXG4gKiAoSW4gY29udHJhc3QgdG8gd2hpdGVzcGFjZSBsaXRlcmFscyBpbiB0aGUgaW5wdXQgd2hpY2ggYXJlIG5vcm1hbGl6ZWQgdG8gc3BhY2VzKVxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIveG1sMTEvI0FWTm9ybWFsaXplXG4gKiBAc2VlIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby9ET00tUGFyc2luZy8jc2VyaWFsaXppbmctYW4tZWxlbWVudC1zLWF0dHJpYnV0ZXNcbiAqL1xuZnVuY3Rpb24gYWRkU2VyaWFsaXplZEF0dHJpYnV0ZShidWYsIHF1YWxpZmllZE5hbWUsIHZhbHVlKSB7XG5cdGJ1Zi5wdXNoKCcgJywgcXVhbGlmaWVkTmFtZSwgJz1cIicsIHZhbHVlLnJlcGxhY2UoL1s8PiZcIlxcdFxcblxccl0vZywgX3htbEVuY29kZXIpLCAnXCInKVxufVxuXG5mdW5jdGlvbiBzZXJpYWxpemVUb1N0cmluZyhub2RlLGJ1Zixpc0hUTUwsbm9kZUZpbHRlcix2aXNpYmxlTmFtZXNwYWNlcyl7XG5cdGlmICghdmlzaWJsZU5hbWVzcGFjZXMpIHtcblx0XHR2aXNpYmxlTmFtZXNwYWNlcyA9IFtdO1xuXHR9XG5cblx0aWYobm9kZUZpbHRlcil7XG5cdFx0bm9kZSA9IG5vZGVGaWx0ZXIobm9kZSk7XG5cdFx0aWYobm9kZSl7XG5cdFx0XHRpZih0eXBlb2Ygbm9kZSA9PSAnc3RyaW5nJyl7XG5cdFx0XHRcdGJ1Zi5wdXNoKG5vZGUpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0fWVsc2V7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdC8vYnVmLnNvcnQuYXBwbHkoYXR0cnMsIGF0dHJpYnV0ZVNvcnRlcik7XG5cdH1cblxuXHRzd2l0Y2gobm9kZS5ub2RlVHlwZSl7XG5cdGNhc2UgRUxFTUVOVF9OT0RFOlxuXHRcdHZhciBhdHRycyA9IG5vZGUuYXR0cmlidXRlcztcblx0XHR2YXIgbGVuID0gYXR0cnMubGVuZ3RoO1xuXHRcdHZhciBjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHR2YXIgbm9kZU5hbWUgPSBub2RlLnRhZ05hbWU7XG5cdFx0XG5cdFx0aXNIVE1MID0gTkFNRVNQQUNFLmlzSFRNTChub2RlLm5hbWVzcGFjZVVSSSkgfHwgaXNIVE1MXG5cblx0XHR2YXIgcHJlZml4ZWROb2RlTmFtZSA9IG5vZGVOYW1lXG5cdFx0aWYgKCFpc0hUTUwgJiYgIW5vZGUucHJlZml4ICYmIG5vZGUubmFtZXNwYWNlVVJJKSB7XG5cdFx0XHR2YXIgZGVmYXVsdE5TXG5cdFx0XHQvLyBsb29rdXAgY3VycmVudCBkZWZhdWx0IG5zIGZyb20gYHhtbG5zYCBhdHRyaWJ1dGVcblx0XHRcdGZvciAodmFyIGFpID0gMDsgYWkgPCBhdHRycy5sZW5ndGg7IGFpKyspIHtcblx0XHRcdFx0aWYgKGF0dHJzLml0ZW0oYWkpLm5hbWUgPT09ICd4bWxucycpIHtcblx0XHRcdFx0XHRkZWZhdWx0TlMgPSBhdHRycy5pdGVtKGFpKS52YWx1ZVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmICghZGVmYXVsdE5TKSB7XG5cdFx0XHRcdC8vIGxvb2t1cCBjdXJyZW50IGRlZmF1bHQgbnMgaW4gdmlzaWJsZU5hbWVzcGFjZXNcblx0XHRcdFx0Zm9yICh2YXIgbnNpID0gdmlzaWJsZU5hbWVzcGFjZXMubGVuZ3RoIC0gMTsgbnNpID49IDA7IG5zaS0tKSB7XG5cdFx0XHRcdFx0dmFyIG5hbWVzcGFjZSA9IHZpc2libGVOYW1lc3BhY2VzW25zaV1cblx0XHRcdFx0XHRpZiAobmFtZXNwYWNlLnByZWZpeCA9PT0gJycgJiYgbmFtZXNwYWNlLm5hbWVzcGFjZSA9PT0gbm9kZS5uYW1lc3BhY2VVUkkpIHtcblx0XHRcdFx0XHRcdGRlZmF1bHROUyA9IG5hbWVzcGFjZS5uYW1lc3BhY2Vcblx0XHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRpZiAoZGVmYXVsdE5TICE9PSBub2RlLm5hbWVzcGFjZVVSSSkge1xuXHRcdFx0XHRmb3IgKHZhciBuc2kgPSB2aXNpYmxlTmFtZXNwYWNlcy5sZW5ndGggLSAxOyBuc2kgPj0gMDsgbnNpLS0pIHtcblx0XHRcdFx0XHR2YXIgbmFtZXNwYWNlID0gdmlzaWJsZU5hbWVzcGFjZXNbbnNpXVxuXHRcdFx0XHRcdGlmIChuYW1lc3BhY2UubmFtZXNwYWNlID09PSBub2RlLm5hbWVzcGFjZVVSSSkge1xuXHRcdFx0XHRcdFx0aWYgKG5hbWVzcGFjZS5wcmVmaXgpIHtcblx0XHRcdFx0XHRcdFx0cHJlZml4ZWROb2RlTmFtZSA9IG5hbWVzcGFjZS5wcmVmaXggKyAnOicgKyBub2RlTmFtZVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRidWYucHVzaCgnPCcsIHByZWZpeGVkTm9kZU5hbWUpO1xuXG5cdFx0Zm9yKHZhciBpPTA7aTxsZW47aSsrKXtcblx0XHRcdC8vIGFkZCBuYW1lc3BhY2VzIGZvciBhdHRyaWJ1dGVzXG5cdFx0XHR2YXIgYXR0ciA9IGF0dHJzLml0ZW0oaSk7XG5cdFx0XHRpZiAoYXR0ci5wcmVmaXggPT0gJ3htbG5zJykge1xuXHRcdFx0XHR2aXNpYmxlTmFtZXNwYWNlcy5wdXNoKHsgcHJlZml4OiBhdHRyLmxvY2FsTmFtZSwgbmFtZXNwYWNlOiBhdHRyLnZhbHVlIH0pO1xuXHRcdFx0fWVsc2UgaWYoYXR0ci5ub2RlTmFtZSA9PSAneG1sbnMnKXtcblx0XHRcdFx0dmlzaWJsZU5hbWVzcGFjZXMucHVzaCh7IHByZWZpeDogJycsIG5hbWVzcGFjZTogYXR0ci52YWx1ZSB9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmb3IodmFyIGk9MDtpPGxlbjtpKyspe1xuXHRcdFx0dmFyIGF0dHIgPSBhdHRycy5pdGVtKGkpO1xuXHRcdFx0aWYgKG5lZWROYW1lc3BhY2VEZWZpbmUoYXR0cixpc0hUTUwsIHZpc2libGVOYW1lc3BhY2VzKSkge1xuXHRcdFx0XHR2YXIgcHJlZml4ID0gYXR0ci5wcmVmaXh8fCcnO1xuXHRcdFx0XHR2YXIgdXJpID0gYXR0ci5uYW1lc3BhY2VVUkk7XG5cdFx0XHRcdGFkZFNlcmlhbGl6ZWRBdHRyaWJ1dGUoYnVmLCBwcmVmaXggPyAneG1sbnM6JyArIHByZWZpeCA6IFwieG1sbnNcIiwgdXJpKTtcblx0XHRcdFx0dmlzaWJsZU5hbWVzcGFjZXMucHVzaCh7IHByZWZpeDogcHJlZml4LCBuYW1lc3BhY2U6dXJpIH0pO1xuXHRcdFx0fVxuXHRcdFx0c2VyaWFsaXplVG9TdHJpbmcoYXR0cixidWYsaXNIVE1MLG5vZGVGaWx0ZXIsdmlzaWJsZU5hbWVzcGFjZXMpO1xuXHRcdH1cblxuXHRcdC8vIGFkZCBuYW1lc3BhY2UgZm9yIGN1cnJlbnQgbm9kZVx0XHRcblx0XHRpZiAobm9kZU5hbWUgPT09IHByZWZpeGVkTm9kZU5hbWUgJiYgbmVlZE5hbWVzcGFjZURlZmluZShub2RlLCBpc0hUTUwsIHZpc2libGVOYW1lc3BhY2VzKSkge1xuXHRcdFx0dmFyIHByZWZpeCA9IG5vZGUucHJlZml4fHwnJztcblx0XHRcdHZhciB1cmkgPSBub2RlLm5hbWVzcGFjZVVSSTtcblx0XHRcdGFkZFNlcmlhbGl6ZWRBdHRyaWJ1dGUoYnVmLCBwcmVmaXggPyAneG1sbnM6JyArIHByZWZpeCA6IFwieG1sbnNcIiwgdXJpKTtcblx0XHRcdHZpc2libGVOYW1lc3BhY2VzLnB1c2goeyBwcmVmaXg6IHByZWZpeCwgbmFtZXNwYWNlOnVyaSB9KTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoY2hpbGQgfHwgaXNIVE1MICYmICEvXig/Om1ldGF8bGlua3xpbWd8YnJ8aHJ8aW5wdXQpJC9pLnRlc3Qobm9kZU5hbWUpKXtcblx0XHRcdGJ1Zi5wdXNoKCc+Jyk7XG5cdFx0XHQvL2lmIGlzIGNkYXRhIGNoaWxkIG5vZGVcblx0XHRcdGlmKGlzSFRNTCAmJiAvXnNjcmlwdCQvaS50ZXN0KG5vZGVOYW1lKSl7XG5cdFx0XHRcdHdoaWxlKGNoaWxkKXtcblx0XHRcdFx0XHRpZihjaGlsZC5kYXRhKXtcblx0XHRcdFx0XHRcdGJ1Zi5wdXNoKGNoaWxkLmRhdGEpO1xuXHRcdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdFx0c2VyaWFsaXplVG9TdHJpbmcoY2hpbGQsIGJ1ZiwgaXNIVE1MLCBub2RlRmlsdGVyLCB2aXNpYmxlTmFtZXNwYWNlcy5zbGljZSgpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2Vcblx0XHRcdHtcblx0XHRcdFx0d2hpbGUoY2hpbGQpe1xuXHRcdFx0XHRcdHNlcmlhbGl6ZVRvU3RyaW5nKGNoaWxkLCBidWYsIGlzSFRNTCwgbm9kZUZpbHRlciwgdmlzaWJsZU5hbWVzcGFjZXMuc2xpY2UoKSk7XG5cdFx0XHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0YnVmLnB1c2goJzwvJyxwcmVmaXhlZE5vZGVOYW1lLCc+Jyk7XG5cdFx0fWVsc2V7XG5cdFx0XHRidWYucHVzaCgnLz4nKTtcblx0XHR9XG5cdFx0Ly8gcmVtb3ZlIGFkZGVkIHZpc2libGUgbmFtZXNwYWNlc1xuXHRcdC8vdmlzaWJsZU5hbWVzcGFjZXMubGVuZ3RoID0gc3RhcnRWaXNpYmxlTmFtZXNwYWNlcztcblx0XHRyZXR1cm47XG5cdGNhc2UgRE9DVU1FTlRfTk9ERTpcblx0Y2FzZSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFOlxuXHRcdHZhciBjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHR3aGlsZShjaGlsZCl7XG5cdFx0XHRzZXJpYWxpemVUb1N0cmluZyhjaGlsZCwgYnVmLCBpc0hUTUwsIG5vZGVGaWx0ZXIsIHZpc2libGVOYW1lc3BhY2VzLnNsaWNlKCkpO1xuXHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHR9XG5cdFx0cmV0dXJuO1xuXHRjYXNlIEFUVFJJQlVURV9OT0RFOlxuXHRcdHJldHVybiBhZGRTZXJpYWxpemVkQXR0cmlidXRlKGJ1Ziwgbm9kZS5uYW1lLCBub2RlLnZhbHVlKTtcblx0Y2FzZSBURVhUX05PREU6XG5cdFx0LyoqXG5cdFx0ICogVGhlIGFtcGVyc2FuZCBjaGFyYWN0ZXIgKCYpIGFuZCB0aGUgbGVmdCBhbmdsZSBicmFja2V0ICg8KSBtdXN0IG5vdCBhcHBlYXIgaW4gdGhlaXIgbGl0ZXJhbCBmb3JtLFxuXHRcdCAqIGV4Y2VwdCB3aGVuIHVzZWQgYXMgbWFya3VwIGRlbGltaXRlcnMsIG9yIHdpdGhpbiBhIGNvbW1lbnQsIGEgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiwgb3IgYSBDREFUQSBzZWN0aW9uLlxuXHRcdCAqIElmIHRoZXkgYXJlIG5lZWRlZCBlbHNld2hlcmUsIHRoZXkgbXVzdCBiZSBlc2NhcGVkIHVzaW5nIGVpdGhlciBudW1lcmljIGNoYXJhY3RlciByZWZlcmVuY2VzIG9yIHRoZSBzdHJpbmdzXG5cdFx0ICogYCZhbXA7YCBhbmQgYCZsdDtgIHJlc3BlY3RpdmVseS5cblx0XHQgKiBUaGUgcmlnaHQgYW5nbGUgYnJhY2tldCAoPikgbWF5IGJlIHJlcHJlc2VudGVkIHVzaW5nIHRoZSBzdHJpbmcgXCIgJmd0OyBcIiwgYW5kIG11c3QsIGZvciBjb21wYXRpYmlsaXR5LFxuXHRcdCAqIGJlIGVzY2FwZWQgdXNpbmcgZWl0aGVyIGAmZ3Q7YCBvciBhIGNoYXJhY3RlciByZWZlcmVuY2Ugd2hlbiBpdCBhcHBlYXJzIGluIHRoZSBzdHJpbmcgYF1dPmAgaW4gY29udGVudCxcblx0XHQgKiB3aGVuIHRoYXQgc3RyaW5nIGlzIG5vdCBtYXJraW5nIHRoZSBlbmQgb2YgYSBDREFUQSBzZWN0aW9uLlxuXHRcdCAqXG5cdFx0ICogSW4gdGhlIGNvbnRlbnQgb2YgZWxlbWVudHMsIGNoYXJhY3RlciBkYXRhIGlzIGFueSBzdHJpbmcgb2YgY2hhcmFjdGVyc1xuXHRcdCAqIHdoaWNoIGRvZXMgbm90IGNvbnRhaW4gdGhlIHN0YXJ0LWRlbGltaXRlciBvZiBhbnkgbWFya3VwXG5cdFx0ICogYW5kIGRvZXMgbm90IGluY2x1ZGUgdGhlIENEQVRBLXNlY3Rpb24tY2xvc2UgZGVsaW1pdGVyLCBgXV0+YC5cblx0XHQgKlxuXHRcdCAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC8jTlQtQ2hhckRhdGFcblx0XHQgKiBAc2VlIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby9ET00tUGFyc2luZy8jeG1sLXNlcmlhbGl6aW5nLWEtdGV4dC1ub2RlXG5cdFx0ICovXG5cdFx0cmV0dXJuIGJ1Zi5wdXNoKG5vZGUuZGF0YVxuXHRcdFx0LnJlcGxhY2UoL1s8Jj5dL2csX3htbEVuY29kZXIpXG5cdFx0KTtcblx0Y2FzZSBDREFUQV9TRUNUSU9OX05PREU6XG5cdFx0cmV0dXJuIGJ1Zi5wdXNoKCAnPCFbQ0RBVEFbJyxub2RlLmRhdGEsJ11dPicpO1xuXHRjYXNlIENPTU1FTlRfTk9ERTpcblx0XHRyZXR1cm4gYnVmLnB1c2goIFwiPCEtLVwiLG5vZGUuZGF0YSxcIi0tPlwiKTtcblx0Y2FzZSBET0NVTUVOVF9UWVBFX05PREU6XG5cdFx0dmFyIHB1YmlkID0gbm9kZS5wdWJsaWNJZDtcblx0XHR2YXIgc3lzaWQgPSBub2RlLnN5c3RlbUlkO1xuXHRcdGJ1Zi5wdXNoKCc8IURPQ1RZUEUgJyxub2RlLm5hbWUpO1xuXHRcdGlmKHB1YmlkKXtcblx0XHRcdGJ1Zi5wdXNoKCcgUFVCTElDICcsIHB1YmlkKTtcblx0XHRcdGlmIChzeXNpZCAmJiBzeXNpZCE9Jy4nKSB7XG5cdFx0XHRcdGJ1Zi5wdXNoKCcgJywgc3lzaWQpO1xuXHRcdFx0fVxuXHRcdFx0YnVmLnB1c2goJz4nKTtcblx0XHR9ZWxzZSBpZihzeXNpZCAmJiBzeXNpZCE9Jy4nKXtcblx0XHRcdGJ1Zi5wdXNoKCcgU1lTVEVNICcsIHN5c2lkLCAnPicpO1xuXHRcdH1lbHNle1xuXHRcdFx0dmFyIHN1YiA9IG5vZGUuaW50ZXJuYWxTdWJzZXQ7XG5cdFx0XHRpZihzdWIpe1xuXHRcdFx0XHRidWYucHVzaChcIiBbXCIsc3ViLFwiXVwiKTtcblx0XHRcdH1cblx0XHRcdGJ1Zi5wdXNoKFwiPlwiKTtcblx0XHR9XG5cdFx0cmV0dXJuO1xuXHRjYXNlIFBST0NFU1NJTkdfSU5TVFJVQ1RJT05fTk9ERTpcblx0XHRyZXR1cm4gYnVmLnB1c2goIFwiPD9cIixub2RlLnRhcmdldCxcIiBcIixub2RlLmRhdGEsXCI/PlwiKTtcblx0Y2FzZSBFTlRJVFlfUkVGRVJFTkNFX05PREU6XG5cdFx0cmV0dXJuIGJ1Zi5wdXNoKCAnJicsbm9kZS5ub2RlTmFtZSwnOycpO1xuXHQvL2Nhc2UgRU5USVRZX05PREU6XG5cdC8vY2FzZSBOT1RBVElPTl9OT0RFOlxuXHRkZWZhdWx0OlxuXHRcdGJ1Zi5wdXNoKCc/Pycsbm9kZS5ub2RlTmFtZSk7XG5cdH1cbn1cbmZ1bmN0aW9uIGltcG9ydE5vZGUoZG9jLG5vZGUsZGVlcCl7XG5cdHZhciBub2RlMjtcblx0c3dpdGNoIChub2RlLm5vZGVUeXBlKSB7XG5cdGNhc2UgRUxFTUVOVF9OT0RFOlxuXHRcdG5vZGUyID0gbm9kZS5jbG9uZU5vZGUoZmFsc2UpO1xuXHRcdG5vZGUyLm93bmVyRG9jdW1lbnQgPSBkb2M7XG5cdFx0Ly92YXIgYXR0cnMgPSBub2RlMi5hdHRyaWJ1dGVzO1xuXHRcdC8vdmFyIGxlbiA9IGF0dHJzLmxlbmd0aDtcblx0XHQvL2Zvcih2YXIgaT0wO2k8bGVuO2krKyl7XG5cdFx0XHQvL25vZGUyLnNldEF0dHJpYnV0ZU5vZGVOUyhpbXBvcnROb2RlKGRvYyxhdHRycy5pdGVtKGkpLGRlZXApKTtcblx0XHQvL31cblx0Y2FzZSBET0NVTUVOVF9GUkFHTUVOVF9OT0RFOlxuXHRcdGJyZWFrO1xuXHRjYXNlIEFUVFJJQlVURV9OT0RFOlxuXHRcdGRlZXAgPSB0cnVlO1xuXHRcdGJyZWFrO1xuXHQvL2Nhc2UgRU5USVRZX1JFRkVSRU5DRV9OT0RFOlxuXHQvL2Nhc2UgUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOlxuXHQvLy8vY2FzZSBURVhUX05PREU6XG5cdC8vY2FzZSBDREFUQV9TRUNUSU9OX05PREU6XG5cdC8vY2FzZSBDT01NRU5UX05PREU6XG5cdC8vXHRkZWVwID0gZmFsc2U7XG5cdC8vXHRicmVhaztcblx0Ly9jYXNlIERPQ1VNRU5UX05PREU6XG5cdC8vY2FzZSBET0NVTUVOVF9UWVBFX05PREU6XG5cdC8vY2Fubm90IGJlIGltcG9ydGVkLlxuXHQvL2Nhc2UgRU5USVRZX05PREU6XG5cdC8vY2FzZSBOT1RBVElPTl9OT0RF77yaXG5cdC8vY2FuIG5vdCBoaXQgaW4gbGV2ZWwzXG5cdC8vZGVmYXVsdDp0aHJvdyBlO1xuXHR9XG5cdGlmKCFub2RlMil7XG5cdFx0bm9kZTIgPSBub2RlLmNsb25lTm9kZShmYWxzZSk7Ly9mYWxzZVxuXHR9XG5cdG5vZGUyLm93bmVyRG9jdW1lbnQgPSBkb2M7XG5cdG5vZGUyLnBhcmVudE5vZGUgPSBudWxsO1xuXHRpZihkZWVwKXtcblx0XHR2YXIgY2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XG5cdFx0d2hpbGUoY2hpbGQpe1xuXHRcdFx0bm9kZTIuYXBwZW5kQ2hpbGQoaW1wb3J0Tm9kZShkb2MsY2hpbGQsZGVlcCkpO1xuXHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHR9XG5cdH1cblx0cmV0dXJuIG5vZGUyO1xufVxuLy9cbi8vdmFyIF9yZWxhdGlvbk1hcCA9IHtmaXJzdENoaWxkOjEsbGFzdENoaWxkOjEscHJldmlvdXNTaWJsaW5nOjEsbmV4dFNpYmxpbmc6MSxcbi8vXHRcdFx0XHRcdGF0dHJpYnV0ZXM6MSxjaGlsZE5vZGVzOjEscGFyZW50Tm9kZToxLGRvY3VtZW50RWxlbWVudDoxLGRvY3R5cGUsfTtcbmZ1bmN0aW9uIGNsb25lTm9kZShkb2Msbm9kZSxkZWVwKXtcblx0dmFyIG5vZGUyID0gbmV3IG5vZGUuY29uc3RydWN0b3IoKTtcblx0Zm9yKHZhciBuIGluIG5vZGUpe1xuXHRcdHZhciB2ID0gbm9kZVtuXTtcblx0XHRpZih0eXBlb2YgdiAhPSAnb2JqZWN0JyApe1xuXHRcdFx0aWYodiAhPSBub2RlMltuXSl7XG5cdFx0XHRcdG5vZGUyW25dID0gdjtcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0aWYobm9kZS5jaGlsZE5vZGVzKXtcblx0XHRub2RlMi5jaGlsZE5vZGVzID0gbmV3IE5vZGVMaXN0KCk7XG5cdH1cblx0bm9kZTIub3duZXJEb2N1bWVudCA9IGRvYztcblx0c3dpdGNoIChub2RlMi5ub2RlVHlwZSkge1xuXHRjYXNlIEVMRU1FTlRfTk9ERTpcblx0XHR2YXIgYXR0cnNcdD0gbm9kZS5hdHRyaWJ1dGVzO1xuXHRcdHZhciBhdHRyczJcdD0gbm9kZTIuYXR0cmlidXRlcyA9IG5ldyBOYW1lZE5vZGVNYXAoKTtcblx0XHR2YXIgbGVuID0gYXR0cnMubGVuZ3RoXG5cdFx0YXR0cnMyLl9vd25lckVsZW1lbnQgPSBub2RlMjtcblx0XHRmb3IodmFyIGk9MDtpPGxlbjtpKyspe1xuXHRcdFx0bm9kZTIuc2V0QXR0cmlidXRlTm9kZShjbG9uZU5vZGUoZG9jLGF0dHJzLml0ZW0oaSksdHJ1ZSkpO1xuXHRcdH1cblx0XHRicmVhazs7XG5cdGNhc2UgQVRUUklCVVRFX05PREU6XG5cdFx0ZGVlcCA9IHRydWU7XG5cdH1cblx0aWYoZGVlcCl7XG5cdFx0dmFyIGNoaWxkID0gbm9kZS5maXJzdENoaWxkO1xuXHRcdHdoaWxlKGNoaWxkKXtcblx0XHRcdG5vZGUyLmFwcGVuZENoaWxkKGNsb25lTm9kZShkb2MsY2hpbGQsZGVlcCkpO1xuXHRcdFx0Y2hpbGQgPSBjaGlsZC5uZXh0U2libGluZztcblx0XHR9XG5cdH1cblx0cmV0dXJuIG5vZGUyO1xufVxuXG5mdW5jdGlvbiBfX3NldF9fKG9iamVjdCxrZXksdmFsdWUpe1xuXHRvYmplY3Rba2V5XSA9IHZhbHVlXG59XG4vL2RvIGR5bmFtaWNcbnRyeXtcblx0aWYoT2JqZWN0LmRlZmluZVByb3BlcnR5KXtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoTGl2ZU5vZGVMaXN0LnByb3RvdHlwZSwnbGVuZ3RoJyx7XG5cdFx0XHRnZXQ6ZnVuY3Rpb24oKXtcblx0XHRcdFx0X3VwZGF0ZUxpdmVMaXN0KHRoaXMpO1xuXHRcdFx0XHRyZXR1cm4gdGhpcy4kJGxlbmd0aDtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb2RlLnByb3RvdHlwZSwndGV4dENvbnRlbnQnLHtcblx0XHRcdGdldDpmdW5jdGlvbigpe1xuXHRcdFx0XHRyZXR1cm4gZ2V0VGV4dENvbnRlbnQodGhpcyk7XG5cdFx0XHR9LFxuXG5cdFx0XHRzZXQ6ZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHN3aXRjaCh0aGlzLm5vZGVUeXBlKXtcblx0XHRcdFx0Y2FzZSBFTEVNRU5UX05PREU6XG5cdFx0XHRcdGNhc2UgRE9DVU1FTlRfRlJBR01FTlRfTk9ERTpcblx0XHRcdFx0XHR3aGlsZSh0aGlzLmZpcnN0Q2hpbGQpe1xuXHRcdFx0XHRcdFx0dGhpcy5yZW1vdmVDaGlsZCh0aGlzLmZpcnN0Q2hpbGQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZihkYXRhIHx8IFN0cmluZyhkYXRhKSl7XG5cdFx0XHRcdFx0XHR0aGlzLmFwcGVuZENoaWxkKHRoaXMub3duZXJEb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0dGhpcy5kYXRhID0gZGF0YTtcblx0XHRcdFx0XHR0aGlzLnZhbHVlID0gZGF0YTtcblx0XHRcdFx0XHR0aGlzLm5vZGVWYWx1ZSA9IGRhdGE7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KVxuXHRcdFxuXHRcdGZ1bmN0aW9uIGdldFRleHRDb250ZW50KG5vZGUpe1xuXHRcdFx0c3dpdGNoKG5vZGUubm9kZVR5cGUpe1xuXHRcdFx0Y2FzZSBFTEVNRU5UX05PREU6XG5cdFx0XHRjYXNlIERPQ1VNRU5UX0ZSQUdNRU5UX05PREU6XG5cdFx0XHRcdHZhciBidWYgPSBbXTtcblx0XHRcdFx0bm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcblx0XHRcdFx0d2hpbGUobm9kZSl7XG5cdFx0XHRcdFx0aWYobm9kZS5ub2RlVHlwZSE9PTcgJiYgbm9kZS5ub2RlVHlwZSAhPT04KXtcblx0XHRcdFx0XHRcdGJ1Zi5wdXNoKGdldFRleHRDb250ZW50KG5vZGUpKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGJ1Zi5qb2luKCcnKTtcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJldHVybiBub2RlLm5vZGVWYWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRfX3NldF9fID0gZnVuY3Rpb24ob2JqZWN0LGtleSx2YWx1ZSl7XG5cdFx0XHQvL2NvbnNvbGUubG9nKHZhbHVlKVxuXHRcdFx0b2JqZWN0WyckJCcra2V5XSA9IHZhbHVlXG5cdFx0fVxuXHR9XG59Y2F0Y2goZSl7Ly9pZThcbn1cblxuLy9pZih0eXBlb2YgcmVxdWlyZSA9PSAnZnVuY3Rpb24nKXtcblx0ZXhwb3J0cy5Eb2N1bWVudFR5cGUgPSBEb2N1bWVudFR5cGU7XG5cdGV4cG9ydHMuRE9NRXhjZXB0aW9uID0gRE9NRXhjZXB0aW9uO1xuXHRleHBvcnRzLkRPTUltcGxlbWVudGF0aW9uID0gRE9NSW1wbGVtZW50YXRpb247XG5cdGV4cG9ydHMuRWxlbWVudCA9IEVsZW1lbnQ7XG5cdGV4cG9ydHMuTm9kZSA9IE5vZGU7XG5cdGV4cG9ydHMuTm9kZUxpc3QgPSBOb2RlTGlzdDtcblx0ZXhwb3J0cy5YTUxTZXJpYWxpemVyID0gWE1MU2VyaWFsaXplcjtcbi8vfVxuXG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9lbnRpdGllcy5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2VudGl0aWVzLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgZnJlZXplID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9jb252ZW50aW9ucyAqLyBcIi4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9jb252ZW50aW9ucy5qc1wiKS5mcmVlemU7XG5cbi8qKlxuICogVGhlIGVudGl0aWVzIHRoYXQgYXJlIHByZWRlZmluZWQgaW4gZXZlcnkgWE1MIGRvY3VtZW50LlxuICpcbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDYvUkVDLXhtbDExLTIwMDYwODE2LyNzZWMtcHJlZGVmaW5lZC1lbnQgVzNDIFhNTCAxLjFcbiAqIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSLzIwMDgvUkVDLXhtbC0yMDA4MTEyNi8jc2VjLXByZWRlZmluZWQtZW50IFczQyBYTUwgMS4wXG4gKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfWE1MX2FuZF9IVE1MX2NoYXJhY3Rlcl9lbnRpdHlfcmVmZXJlbmNlcyNQcmVkZWZpbmVkX2VudGl0aWVzX2luX1hNTCBXaWtpcGVkaWFcbiAqL1xuZXhwb3J0cy5YTUxfRU5USVRJRVMgPSBmcmVlemUoe2FtcDonJicsIGFwb3M6XCInXCIsIGd0Oic+JywgbHQ6JzwnLCBxdW90OidcIid9KVxuXG4vKipcbiAqIEEgbWFwIG9mIGN1cnJlbnRseSAyNDEgZW50aXRpZXMgdGhhdCBhcmUgZGV0ZWN0ZWQgaW4gYW4gSFRNTCBkb2N1bWVudC5cbiAqIFRoZXkgY29udGFpbiBhbGwgZW50cmllcyBmcm9tIGBYTUxfRU5USVRJRVNgLlxuICpcbiAqIEBzZWUgWE1MX0VOVElUSUVTXG4gKiBAc2VlIERPTVBhcnNlci5wYXJzZUZyb21TdHJpbmdcbiAqIEBzZWUgRE9NSW1wbGVtZW50YXRpb24ucHJvdG90eXBlLmNyZWF0ZUhUTUxEb2N1bWVudFxuICogQHNlZSBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnLyNuYW1lZC1jaGFyYWN0ZXItcmVmZXJlbmNlcyBXSEFUV0cgSFRNTCg1KSBTcGVjXG4gKiBAc2VlIGh0dHBzOi8vd3d3LnczLm9yZy9UUi94bWwtZW50aXR5LW5hbWVzLyBXM0MgWE1MIEVudGl0eSBOYW1lc1xuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvVFIvaHRtbDQvc2dtbC9lbnRpdGllcy5odG1sIFczQyBIVE1MNC9TR01MXG4gKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfWE1MX2FuZF9IVE1MX2NoYXJhY3Rlcl9lbnRpdHlfcmVmZXJlbmNlcyNDaGFyYWN0ZXJfZW50aXR5X3JlZmVyZW5jZXNfaW5fSFRNTCBXaWtpcGVkaWEgKEhUTUwpXG4gKiBAc2VlIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfWE1MX2FuZF9IVE1MX2NoYXJhY3Rlcl9lbnRpdHlfcmVmZXJlbmNlcyNFbnRpdGllc19yZXByZXNlbnRpbmdfc3BlY2lhbF9jaGFyYWN0ZXJzX2luX1hIVE1MIFdpa3BlZGlhIChYSFRNTClcbiAqL1xuZXhwb3J0cy5IVE1MX0VOVElUSUVTID0gZnJlZXplKHtcbiAgICAgICBsdDogJzwnLFxuICAgICAgIGd0OiAnPicsXG4gICAgICAgYW1wOiAnJicsXG4gICAgICAgcXVvdDogJ1wiJyxcbiAgICAgICBhcG9zOiBcIidcIixcbiAgICAgICBBZ3JhdmU6IFwiw4BcIixcbiAgICAgICBBYWN1dGU6IFwiw4FcIixcbiAgICAgICBBY2lyYzogXCLDglwiLFxuICAgICAgIEF0aWxkZTogXCLDg1wiLFxuICAgICAgIEF1bWw6IFwiw4RcIixcbiAgICAgICBBcmluZzogXCLDhVwiLFxuICAgICAgIEFFbGlnOiBcIsOGXCIsXG4gICAgICAgQ2NlZGlsOiBcIsOHXCIsXG4gICAgICAgRWdyYXZlOiBcIsOIXCIsXG4gICAgICAgRWFjdXRlOiBcIsOJXCIsXG4gICAgICAgRWNpcmM6IFwiw4pcIixcbiAgICAgICBFdW1sOiBcIsOLXCIsXG4gICAgICAgSWdyYXZlOiBcIsOMXCIsXG4gICAgICAgSWFjdXRlOiBcIsONXCIsXG4gICAgICAgSWNpcmM6IFwiw45cIixcbiAgICAgICBJdW1sOiBcIsOPXCIsXG4gICAgICAgRVRIOiBcIsOQXCIsXG4gICAgICAgTnRpbGRlOiBcIsORXCIsXG4gICAgICAgT2dyYXZlOiBcIsOSXCIsXG4gICAgICAgT2FjdXRlOiBcIsOTXCIsXG4gICAgICAgT2NpcmM6IFwiw5RcIixcbiAgICAgICBPdGlsZGU6IFwiw5VcIixcbiAgICAgICBPdW1sOiBcIsOWXCIsXG4gICAgICAgT3NsYXNoOiBcIsOYXCIsXG4gICAgICAgVWdyYXZlOiBcIsOZXCIsXG4gICAgICAgVWFjdXRlOiBcIsOaXCIsXG4gICAgICAgVWNpcmM6IFwiw5tcIixcbiAgICAgICBVdW1sOiBcIsOcXCIsXG4gICAgICAgWWFjdXRlOiBcIsOdXCIsXG4gICAgICAgVEhPUk46IFwiw55cIixcbiAgICAgICBzemxpZzogXCLDn1wiLFxuICAgICAgIGFncmF2ZTogXCLDoFwiLFxuICAgICAgIGFhY3V0ZTogXCLDoVwiLFxuICAgICAgIGFjaXJjOiBcIsOiXCIsXG4gICAgICAgYXRpbGRlOiBcIsOjXCIsXG4gICAgICAgYXVtbDogXCLDpFwiLFxuICAgICAgIGFyaW5nOiBcIsOlXCIsXG4gICAgICAgYWVsaWc6IFwiw6ZcIixcbiAgICAgICBjY2VkaWw6IFwiw6dcIixcbiAgICAgICBlZ3JhdmU6IFwiw6hcIixcbiAgICAgICBlYWN1dGU6IFwiw6lcIixcbiAgICAgICBlY2lyYzogXCLDqlwiLFxuICAgICAgIGV1bWw6IFwiw6tcIixcbiAgICAgICBpZ3JhdmU6IFwiw6xcIixcbiAgICAgICBpYWN1dGU6IFwiw61cIixcbiAgICAgICBpY2lyYzogXCLDrlwiLFxuICAgICAgIGl1bWw6IFwiw69cIixcbiAgICAgICBldGg6IFwiw7BcIixcbiAgICAgICBudGlsZGU6IFwiw7FcIixcbiAgICAgICBvZ3JhdmU6IFwiw7JcIixcbiAgICAgICBvYWN1dGU6IFwiw7NcIixcbiAgICAgICBvY2lyYzogXCLDtFwiLFxuICAgICAgIG90aWxkZTogXCLDtVwiLFxuICAgICAgIG91bWw6IFwiw7ZcIixcbiAgICAgICBvc2xhc2g6IFwiw7hcIixcbiAgICAgICB1Z3JhdmU6IFwiw7lcIixcbiAgICAgICB1YWN1dGU6IFwiw7pcIixcbiAgICAgICB1Y2lyYzogXCLDu1wiLFxuICAgICAgIHV1bWw6IFwiw7xcIixcbiAgICAgICB5YWN1dGU6IFwiw71cIixcbiAgICAgICB0aG9ybjogXCLDvlwiLFxuICAgICAgIHl1bWw6IFwiw79cIixcbiAgICAgICBuYnNwOiBcIlxcdTAwYTBcIixcbiAgICAgICBpZXhjbDogXCLCoVwiLFxuICAgICAgIGNlbnQ6IFwiwqJcIixcbiAgICAgICBwb3VuZDogXCLCo1wiLFxuICAgICAgIGN1cnJlbjogXCLCpFwiLFxuICAgICAgIHllbjogXCLCpVwiLFxuICAgICAgIGJydmJhcjogXCLCplwiLFxuICAgICAgIHNlY3Q6IFwiwqdcIixcbiAgICAgICB1bWw6IFwiwqhcIixcbiAgICAgICBjb3B5OiBcIsKpXCIsXG4gICAgICAgb3JkZjogXCLCqlwiLFxuICAgICAgIGxhcXVvOiBcIsKrXCIsXG4gICAgICAgbm90OiBcIsKsXCIsXG4gICAgICAgc2h5OiBcIsKtwq1cIixcbiAgICAgICByZWc6IFwiwq5cIixcbiAgICAgICBtYWNyOiBcIsKvXCIsXG4gICAgICAgZGVnOiBcIsKwXCIsXG4gICAgICAgcGx1c21uOiBcIsKxXCIsXG4gICAgICAgc3VwMjogXCLCslwiLFxuICAgICAgIHN1cDM6IFwiwrNcIixcbiAgICAgICBhY3V0ZTogXCLCtFwiLFxuICAgICAgIG1pY3JvOiBcIsK1XCIsXG4gICAgICAgcGFyYTogXCLCtlwiLFxuICAgICAgIG1pZGRvdDogXCLCt1wiLFxuICAgICAgIGNlZGlsOiBcIsK4XCIsXG4gICAgICAgc3VwMTogXCLCuVwiLFxuICAgICAgIG9yZG06IFwiwrpcIixcbiAgICAgICByYXF1bzogXCLCu1wiLFxuICAgICAgIGZyYWMxNDogXCLCvFwiLFxuICAgICAgIGZyYWMxMjogXCLCvVwiLFxuICAgICAgIGZyYWMzNDogXCLCvlwiLFxuICAgICAgIGlxdWVzdDogXCLCv1wiLFxuICAgICAgIHRpbWVzOiBcIsOXXCIsXG4gICAgICAgZGl2aWRlOiBcIsO3XCIsXG4gICAgICAgZm9yYWxsOiBcIuKIgFwiLFxuICAgICAgIHBhcnQ6IFwi4oiCXCIsXG4gICAgICAgZXhpc3Q6IFwi4oiDXCIsXG4gICAgICAgZW1wdHk6IFwi4oiFXCIsXG4gICAgICAgbmFibGE6IFwi4oiHXCIsXG4gICAgICAgaXNpbjogXCLiiIhcIixcbiAgICAgICBub3RpbjogXCLiiIlcIixcbiAgICAgICBuaTogXCLiiItcIixcbiAgICAgICBwcm9kOiBcIuKIj1wiLFxuICAgICAgIHN1bTogXCLiiJFcIixcbiAgICAgICBtaW51czogXCLiiJJcIixcbiAgICAgICBsb3dhc3Q6IFwi4oiXXCIsXG4gICAgICAgcmFkaWM6IFwi4oiaXCIsXG4gICAgICAgcHJvcDogXCLiiJ1cIixcbiAgICAgICBpbmZpbjogXCLiiJ5cIixcbiAgICAgICBhbmc6IFwi4oigXCIsXG4gICAgICAgYW5kOiBcIuKIp1wiLFxuICAgICAgIG9yOiBcIuKIqFwiLFxuICAgICAgIGNhcDogXCLiiKlcIixcbiAgICAgICBjdXA6IFwi4oiqXCIsXG4gICAgICAgJ2ludCc6IFwi4oirXCIsXG4gICAgICAgdGhlcmU0OiBcIuKItFwiLFxuICAgICAgIHNpbTogXCLiiLxcIixcbiAgICAgICBjb25nOiBcIuKJhVwiLFxuICAgICAgIGFzeW1wOiBcIuKJiFwiLFxuICAgICAgIG5lOiBcIuKJoFwiLFxuICAgICAgIGVxdWl2OiBcIuKJoVwiLFxuICAgICAgIGxlOiBcIuKJpFwiLFxuICAgICAgIGdlOiBcIuKJpVwiLFxuICAgICAgIHN1YjogXCLiioJcIixcbiAgICAgICBzdXA6IFwi4oqDXCIsXG4gICAgICAgbnN1YjogXCLiioRcIixcbiAgICAgICBzdWJlOiBcIuKKhlwiLFxuICAgICAgIHN1cGU6IFwi4oqHXCIsXG4gICAgICAgb3BsdXM6IFwi4oqVXCIsXG4gICAgICAgb3RpbWVzOiBcIuKKl1wiLFxuICAgICAgIHBlcnA6IFwi4oqlXCIsXG4gICAgICAgc2RvdDogXCLii4VcIixcbiAgICAgICBBbHBoYTogXCLOkVwiLFxuICAgICAgIEJldGE6IFwizpJcIixcbiAgICAgICBHYW1tYTogXCLOk1wiLFxuICAgICAgIERlbHRhOiBcIs6UXCIsXG4gICAgICAgRXBzaWxvbjogXCLOlVwiLFxuICAgICAgIFpldGE6IFwizpZcIixcbiAgICAgICBFdGE6IFwizpdcIixcbiAgICAgICBUaGV0YTogXCLOmFwiLFxuICAgICAgIElvdGE6IFwizplcIixcbiAgICAgICBLYXBwYTogXCLOmlwiLFxuICAgICAgIExhbWJkYTogXCLOm1wiLFxuICAgICAgIE11OiBcIs6cXCIsXG4gICAgICAgTnU6IFwizp1cIixcbiAgICAgICBYaTogXCLOnlwiLFxuICAgICAgIE9taWNyb246IFwizp9cIixcbiAgICAgICBQaTogXCLOoFwiLFxuICAgICAgIFJobzogXCLOoVwiLFxuICAgICAgIFNpZ21hOiBcIs6jXCIsXG4gICAgICAgVGF1OiBcIs6kXCIsXG4gICAgICAgVXBzaWxvbjogXCLOpVwiLFxuICAgICAgIFBoaTogXCLOplwiLFxuICAgICAgIENoaTogXCLOp1wiLFxuICAgICAgIFBzaTogXCLOqFwiLFxuICAgICAgIE9tZWdhOiBcIs6pXCIsXG4gICAgICAgYWxwaGE6IFwizrFcIixcbiAgICAgICBiZXRhOiBcIs6yXCIsXG4gICAgICAgZ2FtbWE6IFwizrNcIixcbiAgICAgICBkZWx0YTogXCLOtFwiLFxuICAgICAgIGVwc2lsb246IFwizrVcIixcbiAgICAgICB6ZXRhOiBcIs62XCIsXG4gICAgICAgZXRhOiBcIs63XCIsXG4gICAgICAgdGhldGE6IFwizrhcIixcbiAgICAgICBpb3RhOiBcIs65XCIsXG4gICAgICAga2FwcGE6IFwizrpcIixcbiAgICAgICBsYW1iZGE6IFwizrtcIixcbiAgICAgICBtdTogXCLOvFwiLFxuICAgICAgIG51OiBcIs69XCIsXG4gICAgICAgeGk6IFwizr5cIixcbiAgICAgICBvbWljcm9uOiBcIs6/XCIsXG4gICAgICAgcGk6IFwiz4BcIixcbiAgICAgICByaG86IFwiz4FcIixcbiAgICAgICBzaWdtYWY6IFwiz4JcIixcbiAgICAgICBzaWdtYTogXCLPg1wiLFxuICAgICAgIHRhdTogXCLPhFwiLFxuICAgICAgIHVwc2lsb246IFwiz4VcIixcbiAgICAgICBwaGk6IFwiz4ZcIixcbiAgICAgICBjaGk6IFwiz4dcIixcbiAgICAgICBwc2k6IFwiz4hcIixcbiAgICAgICBvbWVnYTogXCLPiVwiLFxuICAgICAgIHRoZXRhc3ltOiBcIs+RXCIsXG4gICAgICAgdXBzaWg6IFwiz5JcIixcbiAgICAgICBwaXY6IFwiz5ZcIixcbiAgICAgICBPRWxpZzogXCLFklwiLFxuICAgICAgIG9lbGlnOiBcIsWTXCIsXG4gICAgICAgU2Nhcm9uOiBcIsWgXCIsXG4gICAgICAgc2Nhcm9uOiBcIsWhXCIsXG4gICAgICAgWXVtbDogXCLFuFwiLFxuICAgICAgIGZub2Y6IFwixpJcIixcbiAgICAgICBjaXJjOiBcIsuGXCIsXG4gICAgICAgdGlsZGU6IFwiy5xcIixcbiAgICAgICBlbnNwOiBcIuKAglwiLFxuICAgICAgIGVtc3A6IFwi4oCDXCIsXG4gICAgICAgdGhpbnNwOiBcIuKAiVwiLFxuICAgICAgIHp3bmo6IFwi4oCMXCIsXG4gICAgICAgendqOiBcIuKAjVwiLFxuICAgICAgIGxybTogXCLigI5cIixcbiAgICAgICBybG06IFwi4oCPXCIsXG4gICAgICAgbmRhc2g6IFwi4oCTXCIsXG4gICAgICAgbWRhc2g6IFwi4oCUXCIsXG4gICAgICAgbHNxdW86IFwi4oCYXCIsXG4gICAgICAgcnNxdW86IFwi4oCZXCIsXG4gICAgICAgc2JxdW86IFwi4oCaXCIsXG4gICAgICAgbGRxdW86IFwi4oCcXCIsXG4gICAgICAgcmRxdW86IFwi4oCdXCIsXG4gICAgICAgYmRxdW86IFwi4oCeXCIsXG4gICAgICAgZGFnZ2VyOiBcIuKAoFwiLFxuICAgICAgIERhZ2dlcjogXCLigKFcIixcbiAgICAgICBidWxsOiBcIuKAolwiLFxuICAgICAgIGhlbGxpcDogXCLigKZcIixcbiAgICAgICBwZXJtaWw6IFwi4oCwXCIsXG4gICAgICAgcHJpbWU6IFwi4oCyXCIsXG4gICAgICAgUHJpbWU6IFwi4oCzXCIsXG4gICAgICAgbHNhcXVvOiBcIuKAuVwiLFxuICAgICAgIHJzYXF1bzogXCLigLpcIixcbiAgICAgICBvbGluZTogXCLigL5cIixcbiAgICAgICBldXJvOiBcIuKCrFwiLFxuICAgICAgIHRyYWRlOiBcIuKEolwiLFxuICAgICAgIGxhcnI6IFwi4oaQXCIsXG4gICAgICAgdWFycjogXCLihpFcIixcbiAgICAgICByYXJyOiBcIuKGklwiLFxuICAgICAgIGRhcnI6IFwi4oaTXCIsXG4gICAgICAgaGFycjogXCLihpRcIixcbiAgICAgICBjcmFycjogXCLihrVcIixcbiAgICAgICBsY2VpbDogXCLijIhcIixcbiAgICAgICByY2VpbDogXCLijIlcIixcbiAgICAgICBsZmxvb3I6IFwi4oyKXCIsXG4gICAgICAgcmZsb29yOiBcIuKMi1wiLFxuICAgICAgIGxvejogXCLil4pcIixcbiAgICAgICBzcGFkZXM6IFwi4pmgXCIsXG4gICAgICAgY2x1YnM6IFwi4pmjXCIsXG4gICAgICAgaGVhcnRzOiBcIuKZpVwiLFxuICAgICAgIGRpYW1zOiBcIuKZplwiXG59KTtcblxuLyoqXG4gKiBAZGVwcmVjYXRlZCB1c2UgYEhUTUxfRU5USVRJRVNgIGluc3RlYWRcbiAqIEBzZWUgSFRNTF9FTlRJVElFU1xuICovXG5leHBvcnRzLmVudGl0eU1hcCA9IGV4cG9ydHMuSFRNTF9FTlRJVElFU1xuXG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vbm9kZV9tb2R1bGVzL0B4bWxkb20veG1sZG9tL2xpYi9pbmRleC5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2luZGV4LmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgZG9tID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9kb20gKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvZG9tLmpzXCIpXG5leHBvcnRzLkRPTUltcGxlbWVudGF0aW9uID0gZG9tLkRPTUltcGxlbWVudGF0aW9uXG5leHBvcnRzLlhNTFNlcmlhbGl6ZXIgPSBkb20uWE1MU2VyaWFsaXplclxuZXhwb3J0cy5ET01QYXJzZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2RvbS1wYXJzZXIgKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvZG9tLXBhcnNlci5qc1wiKS5ET01QYXJzZXJcblxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL25vZGVfbW9kdWxlcy9AeG1sZG9tL3htbGRvbS9saWIvc2F4LmpzXCI6XG4vKiEqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL3NheC5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyohIG5vIHN0YXRpYyBleHBvcnRzIGZvdW5kICovXG4vKioqLyAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7XG5cbnZhciBOQU1FU1BBQ0UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL2NvbnZlbnRpb25zICovIFwiLi9ub2RlX21vZHVsZXMvQHhtbGRvbS94bWxkb20vbGliL2NvbnZlbnRpb25zLmpzXCIpLk5BTUVTUEFDRTtcblxuLy9bNF0gICBcdE5hbWVTdGFydENoYXJcdCAgIDo6PSAgIFx0XCI6XCIgfCBbQS1aXSB8IFwiX1wiIHwgW2Etel0gfCBbI3hDMC0jeEQ2XSB8IFsjeEQ4LSN4RjZdIHwgWyN4RjgtI3gyRkZdIHwgWyN4MzcwLSN4MzdEXSB8IFsjeDM3Ri0jeDFGRkZdIHwgWyN4MjAwQy0jeDIwMERdIHwgWyN4MjA3MC0jeDIxOEZdIHwgWyN4MkMwMC0jeDJGRUZdIHwgWyN4MzAwMS0jeEQ3RkZdIHwgWyN4RjkwMC0jeEZEQ0ZdIHwgWyN4RkRGMC0jeEZGRkRdIHwgWyN4MTAwMDAtI3hFRkZGRl1cbi8vWzRhXSAgIFx0TmFtZUNoYXJcdCAgIDo6PSAgIFx0TmFtZVN0YXJ0Q2hhciB8IFwiLVwiIHwgXCIuXCIgfCBbMC05XSB8ICN4QjcgfCBbI3gwMzAwLSN4MDM2Rl0gfCBbI3gyMDNGLSN4MjA0MF1cbi8vWzVdICAgXHROYW1lXHQgICA6Oj0gICBcdE5hbWVTdGFydENoYXIgKE5hbWVDaGFyKSpcbnZhciBuYW1lU3RhcnRDaGFyID0gL1tBLVpfYS16XFx4QzAtXFx4RDZcXHhEOC1cXHhGNlxcdTAwRjgtXFx1MDJGRlxcdTAzNzAtXFx1MDM3RFxcdTAzN0YtXFx1MUZGRlxcdTIwMEMtXFx1MjAwRFxcdTIwNzAtXFx1MjE4RlxcdTJDMDAtXFx1MkZFRlxcdTMwMDEtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZGRF0vLy9cXHUxMDAwMC1cXHVFRkZGRlxudmFyIG5hbWVDaGFyID0gbmV3IFJlZ0V4cChcIltcXFxcLVxcXFwuMC05XCIrbmFtZVN0YXJ0Q2hhci5zb3VyY2Uuc2xpY2UoMSwtMSkrXCJcXFxcdTAwQjdcXFxcdTAzMDAtXFxcXHUwMzZGXFxcXHUyMDNGLVxcXFx1MjA0MF1cIik7XG52YXIgdGFnTmFtZVBhdHRlcm4gPSBuZXcgUmVnRXhwKCdeJytuYW1lU3RhcnRDaGFyLnNvdXJjZStuYW1lQ2hhci5zb3VyY2UrJyooPzpcXDonK25hbWVTdGFydENoYXIuc291cmNlK25hbWVDaGFyLnNvdXJjZSsnKik/JCcpO1xuLy92YXIgdGFnTmFtZVBhdHRlcm4gPSAvXlthLXpBLVpfXVtcXHdcXC1cXC5dKig/OlxcOlthLXpBLVpfXVtcXHdcXC1cXC5dKik/JC9cbi8vdmFyIGhhbmRsZXJzID0gJ3Jlc29sdmVFbnRpdHksZ2V0RXh0ZXJuYWxTdWJzZXQsY2hhcmFjdGVycyxlbmREb2N1bWVudCxlbmRFbGVtZW50LGVuZFByZWZpeE1hcHBpbmcsaWdub3JhYmxlV2hpdGVzcGFjZSxwcm9jZXNzaW5nSW5zdHJ1Y3Rpb24sc2V0RG9jdW1lbnRMb2NhdG9yLHNraXBwZWRFbnRpdHksc3RhcnREb2N1bWVudCxzdGFydEVsZW1lbnQsc3RhcnRQcmVmaXhNYXBwaW5nLG5vdGF0aW9uRGVjbCx1bnBhcnNlZEVudGl0eURlY2wsZXJyb3IsZmF0YWxFcnJvcix3YXJuaW5nLGF0dHJpYnV0ZURlY2wsZWxlbWVudERlY2wsZXh0ZXJuYWxFbnRpdHlEZWNsLGludGVybmFsRW50aXR5RGVjbCxjb21tZW50LGVuZENEQVRBLGVuZERURCxlbmRFbnRpdHksc3RhcnRDREFUQSxzdGFydERURCxzdGFydEVudGl0eScuc3BsaXQoJywnKVxuXG4vL1NfVEFHLFx0U19BVFRSLFx0U19FUSxcdFNfQVRUUl9OT1FVT1RfVkFMVUVcbi8vU19BVFRSX1NQQUNFLFx0U19BVFRSX0VORCxcdFNfVEFHX1NQQUNFLCBTX1RBR19DTE9TRVxudmFyIFNfVEFHID0gMDsvL3RhZyBuYW1lIG9mZmVycmluZ1xudmFyIFNfQVRUUiA9IDE7Ly9hdHRyIG5hbWUgb2ZmZXJyaW5nXG52YXIgU19BVFRSX1NQQUNFPTI7Ly9hdHRyIG5hbWUgZW5kIGFuZCBzcGFjZSBvZmZlclxudmFyIFNfRVEgPSAzOy8vPXNwYWNlP1xudmFyIFNfQVRUUl9OT1FVT1RfVkFMVUUgPSA0Oy8vYXR0ciB2YWx1ZShubyBxdW90IHZhbHVlIG9ubHkpXG52YXIgU19BVFRSX0VORCA9IDU7Ly9hdHRyIHZhbHVlIGVuZCBhbmQgbm8gc3BhY2UocXVvdCBlbmQpXG52YXIgU19UQUdfU1BBQ0UgPSA2Oy8vKGF0dHIgdmFsdWUgZW5kIHx8IHRhZyBlbmQgKSAmJiAoc3BhY2Ugb2ZmZXIpXG52YXIgU19UQUdfQ0xPU0UgPSA3Oy8vY2xvc2VkIGVsPGVsIC8+XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBlcnJvciB0aGF0IHdpbGwgbm90IGJlIGNhdWdodCBieSBYTUxSZWFkZXIgYWthIHRoZSBTQVggcGFyc2VyLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlXG4gKiBAcGFyYW0ge2FueT99IGxvY2F0b3IgT3B0aW9uYWwsIGNhbiBwcm92aWRlIGRldGFpbHMgYWJvdXQgdGhlIGxvY2F0aW9uIGluIHRoZSBzb3VyY2VcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5mdW5jdGlvbiBQYXJzZUVycm9yKG1lc3NhZ2UsIGxvY2F0b3IpIHtcblx0dGhpcy5tZXNzYWdlID0gbWVzc2FnZVxuXHR0aGlzLmxvY2F0b3IgPSBsb2NhdG9yXG5cdGlmKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBQYXJzZUVycm9yKTtcbn1cblBhcnNlRXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCk7XG5QYXJzZUVycm9yLnByb3RvdHlwZS5uYW1lID0gUGFyc2VFcnJvci5uYW1lXG5cbmZ1bmN0aW9uIFhNTFJlYWRlcigpe1xuXG59XG5cblhNTFJlYWRlci5wcm90b3R5cGUgPSB7XG5cdHBhcnNlOmZ1bmN0aW9uKHNvdXJjZSxkZWZhdWx0TlNNYXAsZW50aXR5TWFwKXtcblx0XHR2YXIgZG9tQnVpbGRlciA9IHRoaXMuZG9tQnVpbGRlcjtcblx0XHRkb21CdWlsZGVyLnN0YXJ0RG9jdW1lbnQoKTtcblx0XHRfY29weShkZWZhdWx0TlNNYXAgLGRlZmF1bHROU01hcCA9IHt9KVxuXHRcdHBhcnNlKHNvdXJjZSxkZWZhdWx0TlNNYXAsZW50aXR5TWFwLFxuXHRcdFx0XHRkb21CdWlsZGVyLHRoaXMuZXJyb3JIYW5kbGVyKTtcblx0XHRkb21CdWlsZGVyLmVuZERvY3VtZW50KCk7XG5cdH1cbn1cbmZ1bmN0aW9uIHBhcnNlKHNvdXJjZSxkZWZhdWx0TlNNYXBDb3B5LGVudGl0eU1hcCxkb21CdWlsZGVyLGVycm9ySGFuZGxlcil7XG5cdGZ1bmN0aW9uIGZpeGVkRnJvbUNoYXJDb2RlKGNvZGUpIHtcblx0XHQvLyBTdHJpbmcucHJvdG90eXBlLmZyb21DaGFyQ29kZSBkb2VzIG5vdCBzdXBwb3J0c1xuXHRcdC8vID4gMiBieXRlcyB1bmljb2RlIGNoYXJzIGRpcmVjdGx5XG5cdFx0aWYgKGNvZGUgPiAweGZmZmYpIHtcblx0XHRcdGNvZGUgLT0gMHgxMDAwMDtcblx0XHRcdHZhciBzdXJyb2dhdGUxID0gMHhkODAwICsgKGNvZGUgPj4gMTApXG5cdFx0XHRcdCwgc3Vycm9nYXRlMiA9IDB4ZGMwMCArIChjb2RlICYgMHgzZmYpO1xuXG5cdFx0XHRyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShzdXJyb2dhdGUxLCBzdXJyb2dhdGUyKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSk7XG5cdFx0fVxuXHR9XG5cdGZ1bmN0aW9uIGVudGl0eVJlcGxhY2VyKGEpe1xuXHRcdHZhciBrID0gYS5zbGljZSgxLC0xKTtcblx0XHRpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZW50aXR5TWFwLCBrKSkge1xuXHRcdFx0cmV0dXJuIGVudGl0eU1hcFtrXTtcblx0XHR9ZWxzZSBpZihrLmNoYXJBdCgwKSA9PT0gJyMnKXtcblx0XHRcdHJldHVybiBmaXhlZEZyb21DaGFyQ29kZShwYXJzZUludChrLnN1YnN0cigxKS5yZXBsYWNlKCd4JywnMHgnKSkpXG5cdFx0fWVsc2V7XG5cdFx0XHRlcnJvckhhbmRsZXIuZXJyb3IoJ2VudGl0eSBub3QgZm91bmQ6JythKTtcblx0XHRcdHJldHVybiBhO1xuXHRcdH1cblx0fVxuXHRmdW5jdGlvbiBhcHBlbmRUZXh0KGVuZCl7Ly9oYXMgc29tZSBidWdzXG5cdFx0aWYoZW5kPnN0YXJ0KXtcblx0XHRcdHZhciB4dCA9IHNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsZW5kKS5yZXBsYWNlKC8mIz9cXHcrOy9nLGVudGl0eVJlcGxhY2VyKTtcblx0XHRcdGxvY2F0b3ImJnBvc2l0aW9uKHN0YXJ0KTtcblx0XHRcdGRvbUJ1aWxkZXIuY2hhcmFjdGVycyh4dCwwLGVuZC1zdGFydCk7XG5cdFx0XHRzdGFydCA9IGVuZFxuXHRcdH1cblx0fVxuXHRmdW5jdGlvbiBwb3NpdGlvbihwLG0pe1xuXHRcdHdoaWxlKHA+PWxpbmVFbmQgJiYgKG0gPSBsaW5lUGF0dGVybi5leGVjKHNvdXJjZSkpKXtcblx0XHRcdGxpbmVTdGFydCA9IG0uaW5kZXg7XG5cdFx0XHRsaW5lRW5kID0gbGluZVN0YXJ0ICsgbVswXS5sZW5ndGg7XG5cdFx0XHRsb2NhdG9yLmxpbmVOdW1iZXIrKztcblx0XHRcdC8vY29uc29sZS5sb2coJ2xpbmUrKzonLGxvY2F0b3Isc3RhcnRQb3MsZW5kUG9zKVxuXHRcdH1cblx0XHRsb2NhdG9yLmNvbHVtbk51bWJlciA9IHAtbGluZVN0YXJ0KzE7XG5cdH1cblx0dmFyIGxpbmVTdGFydCA9IDA7XG5cdHZhciBsaW5lRW5kID0gMDtcblx0dmFyIGxpbmVQYXR0ZXJuID0gLy4qKD86XFxyXFxuP3xcXG4pfC4qJC9nXG5cdHZhciBsb2NhdG9yID0gZG9tQnVpbGRlci5sb2NhdG9yO1xuXG5cdHZhciBwYXJzZVN0YWNrID0gW3tjdXJyZW50TlNNYXA6ZGVmYXVsdE5TTWFwQ29weX1dXG5cdHZhciBjbG9zZU1hcCA9IHt9O1xuXHR2YXIgc3RhcnQgPSAwO1xuXHR3aGlsZSh0cnVlKXtcblx0XHR0cnl7XG5cdFx0XHR2YXIgdGFnU3RhcnQgPSBzb3VyY2UuaW5kZXhPZignPCcsc3RhcnQpO1xuXHRcdFx0aWYodGFnU3RhcnQ8MCl7XG5cdFx0XHRcdGlmKCFzb3VyY2Uuc3Vic3RyKHN0YXJ0KS5tYXRjaCgvXlxccyokLykpe1xuXHRcdFx0XHRcdHZhciBkb2MgPSBkb21CdWlsZGVyLmRvYztcblx0ICAgIFx0XHRcdHZhciB0ZXh0ID0gZG9jLmNyZWF0ZVRleHROb2RlKHNvdXJjZS5zdWJzdHIoc3RhcnQpKTtcblx0ICAgIFx0XHRcdGRvYy5hcHBlbmRDaGlsZCh0ZXh0KTtcblx0ICAgIFx0XHRcdGRvbUJ1aWxkZXIuY3VycmVudEVsZW1lbnQgPSB0ZXh0O1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGlmKHRhZ1N0YXJ0PnN0YXJ0KXtcblx0XHRcdFx0YXBwZW5kVGV4dCh0YWdTdGFydCk7XG5cdFx0XHR9XG5cdFx0XHRzd2l0Y2goc291cmNlLmNoYXJBdCh0YWdTdGFydCsxKSl7XG5cdFx0XHRjYXNlICcvJzpcblx0XHRcdFx0dmFyIGVuZCA9IHNvdXJjZS5pbmRleE9mKCc+Jyx0YWdTdGFydCszKTtcblx0XHRcdFx0dmFyIHRhZ05hbWUgPSBzb3VyY2Uuc3Vic3RyaW5nKHRhZ1N0YXJ0ICsgMiwgZW5kKS5yZXBsYWNlKC9bIFxcdFxcblxccl0rJC9nLCAnJyk7XG5cdFx0XHRcdHZhciBjb25maWcgPSBwYXJzZVN0YWNrLnBvcCgpO1xuXHRcdFx0XHRpZihlbmQ8MCl7XG5cblx0ICAgICAgICBcdFx0dGFnTmFtZSA9IHNvdXJjZS5zdWJzdHJpbmcodGFnU3RhcnQrMikucmVwbGFjZSgvW1xcczxdLiovLCcnKTtcblx0ICAgICAgICBcdFx0ZXJyb3JIYW5kbGVyLmVycm9yKFwiZW5kIHRhZyBuYW1lOiBcIit0YWdOYW1lKycgaXMgbm90IGNvbXBsZXRlOicrY29uZmlnLnRhZ05hbWUpO1xuXHQgICAgICAgIFx0XHRlbmQgPSB0YWdTdGFydCsxK3RhZ05hbWUubGVuZ3RoO1xuXHQgICAgICAgIFx0fWVsc2UgaWYodGFnTmFtZS5tYXRjaCgvXFxzPC8pKXtcblx0ICAgICAgICBcdFx0dGFnTmFtZSA9IHRhZ05hbWUucmVwbGFjZSgvW1xcczxdLiovLCcnKTtcblx0ICAgICAgICBcdFx0ZXJyb3JIYW5kbGVyLmVycm9yKFwiZW5kIHRhZyBuYW1lOiBcIit0YWdOYW1lKycgbWF5YmUgbm90IGNvbXBsZXRlJyk7XG5cdCAgICAgICAgXHRcdGVuZCA9IHRhZ1N0YXJ0KzErdGFnTmFtZS5sZW5ndGg7XG5cdFx0XHRcdH1cblx0XHRcdFx0dmFyIGxvY2FsTlNNYXAgPSBjb25maWcubG9jYWxOU01hcDtcblx0XHRcdFx0dmFyIGVuZE1hdGNoID0gY29uZmlnLnRhZ05hbWUgPT0gdGFnTmFtZTtcblx0XHRcdFx0dmFyIGVuZElnbm9yZUNhc2VNYWNoID0gZW5kTWF0Y2ggfHwgY29uZmlnLnRhZ05hbWUmJmNvbmZpZy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpXG5cdFx0ICAgICAgICBpZihlbmRJZ25vcmVDYXNlTWFjaCl7XG5cdFx0ICAgICAgICBcdGRvbUJ1aWxkZXIuZW5kRWxlbWVudChjb25maWcudXJpLGNvbmZpZy5sb2NhbE5hbWUsdGFnTmFtZSk7XG5cdFx0XHRcdFx0aWYobG9jYWxOU01hcCl7XG5cdFx0XHRcdFx0XHRmb3IodmFyIHByZWZpeCBpbiBsb2NhbE5TTWFwKXtcblx0XHRcdFx0XHRcdFx0ZG9tQnVpbGRlci5lbmRQcmVmaXhNYXBwaW5nKHByZWZpeCkgO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZighZW5kTWF0Y2gpe1xuXHRcdCAgICAgICAgICAgIFx0ZXJyb3JIYW5kbGVyLmZhdGFsRXJyb3IoXCJlbmQgdGFnIG5hbWU6IFwiK3RhZ05hbWUrJyBpcyBub3QgbWF0Y2ggdGhlIGN1cnJlbnQgc3RhcnQgdGFnTmFtZTonK2NvbmZpZy50YWdOYW1lICk7IC8vIE5vIGtub3duIHRlc3QgY2FzZVxuXHRcdFx0XHRcdH1cblx0XHQgICAgICAgIH1lbHNle1xuXHRcdCAgICAgICAgXHRwYXJzZVN0YWNrLnB1c2goY29uZmlnKVxuXHRcdCAgICAgICAgfVxuXG5cdFx0XHRcdGVuZCsrO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdFx0Ly8gZW5kIGVsbWVudFxuXHRcdFx0Y2FzZSAnPyc6Ly8gPD8uLi4/PlxuXHRcdFx0XHRsb2NhdG9yJiZwb3NpdGlvbih0YWdTdGFydCk7XG5cdFx0XHRcdGVuZCA9IHBhcnNlSW5zdHJ1Y3Rpb24oc291cmNlLHRhZ1N0YXJ0LGRvbUJ1aWxkZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJyEnOi8vIDwhZG9jdHlwZSw8IVtDREFUQSw8IS0tXG5cdFx0XHRcdGxvY2F0b3ImJnBvc2l0aW9uKHRhZ1N0YXJ0KTtcblx0XHRcdFx0ZW5kID0gcGFyc2VEQ0Moc291cmNlLHRhZ1N0YXJ0LGRvbUJ1aWxkZXIsZXJyb3JIYW5kbGVyKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRsb2NhdG9yJiZwb3NpdGlvbih0YWdTdGFydCk7XG5cdFx0XHRcdHZhciBlbCA9IG5ldyBFbGVtZW50QXR0cmlidXRlcygpO1xuXHRcdFx0XHR2YXIgY3VycmVudE5TTWFwID0gcGFyc2VTdGFja1twYXJzZVN0YWNrLmxlbmd0aC0xXS5jdXJyZW50TlNNYXA7XG5cdFx0XHRcdC8vZWxTdGFydEVuZFxuXHRcdFx0XHR2YXIgZW5kID0gcGFyc2VFbGVtZW50U3RhcnRQYXJ0KHNvdXJjZSx0YWdTdGFydCxlbCxjdXJyZW50TlNNYXAsZW50aXR5UmVwbGFjZXIsZXJyb3JIYW5kbGVyKTtcblx0XHRcdFx0dmFyIGxlbiA9IGVsLmxlbmd0aDtcblxuXG5cdFx0XHRcdGlmKCFlbC5jbG9zZWQgJiYgZml4U2VsZkNsb3NlZChzb3VyY2UsZW5kLGVsLnRhZ05hbWUsY2xvc2VNYXApKXtcblx0XHRcdFx0XHRlbC5jbG9zZWQgPSB0cnVlO1xuXHRcdFx0XHRcdGlmKCFlbnRpdHlNYXAubmJzcCl7XG5cdFx0XHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygndW5jbG9zZWQgeG1sIGF0dHJpYnV0ZScpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRpZihsb2NhdG9yICYmIGxlbil7XG5cdFx0XHRcdFx0dmFyIGxvY2F0b3IyID0gY29weUxvY2F0b3IobG9jYXRvcix7fSk7XG5cdFx0XHRcdFx0Ly90cnl7Ly9hdHRyaWJ1dGUgcG9zaXRpb24gZml4ZWRcblx0XHRcdFx0XHRmb3IodmFyIGkgPSAwO2k8bGVuO2krKyl7XG5cdFx0XHRcdFx0XHR2YXIgYSA9IGVsW2ldO1xuXHRcdFx0XHRcdFx0cG9zaXRpb24oYS5vZmZzZXQpO1xuXHRcdFx0XHRcdFx0YS5sb2NhdG9yID0gY29weUxvY2F0b3IobG9jYXRvcix7fSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGRvbUJ1aWxkZXIubG9jYXRvciA9IGxvY2F0b3IyXG5cdFx0XHRcdFx0aWYoYXBwZW5kRWxlbWVudChlbCxkb21CdWlsZGVyLGN1cnJlbnROU01hcCkpe1xuXHRcdFx0XHRcdFx0cGFyc2VTdGFjay5wdXNoKGVsKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRkb21CdWlsZGVyLmxvY2F0b3IgPSBsb2NhdG9yO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRpZihhcHBlbmRFbGVtZW50KGVsLGRvbUJ1aWxkZXIsY3VycmVudE5TTWFwKSl7XG5cdFx0XHRcdFx0XHRwYXJzZVN0YWNrLnB1c2goZWwpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKE5BTUVTUEFDRS5pc0hUTUwoZWwudXJpKSAmJiAhZWwuY2xvc2VkKSB7XG5cdFx0XHRcdFx0ZW5kID0gcGFyc2VIdG1sU3BlY2lhbENvbnRlbnQoc291cmNlLGVuZCxlbC50YWdOYW1lLGVudGl0eVJlcGxhY2VyLGRvbUJ1aWxkZXIpXG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZW5kKys7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9Y2F0Y2goZSl7XG5cdFx0XHRpZiAoZSBpbnN0YW5jZW9mIFBhcnNlRXJyb3IpIHtcblx0XHRcdFx0dGhyb3cgZTtcblx0XHRcdH1cblx0XHRcdGVycm9ySGFuZGxlci5lcnJvcignZWxlbWVudCBwYXJzZSBlcnJvcjogJytlKVxuXHRcdFx0ZW5kID0gLTE7XG5cdFx0fVxuXHRcdGlmKGVuZD5zdGFydCl7XG5cdFx0XHRzdGFydCA9IGVuZDtcblx0XHR9ZWxzZXtcblx0XHRcdC8vVE9ETzog6L+Z6YeM5pyJ5Y+v6IO9c2F45Zue6YCA77yM5pyJ5L2N572u6ZSZ6K+v6aOO6ZmpXG5cdFx0XHRhcHBlbmRUZXh0KE1hdGgubWF4KHRhZ1N0YXJ0LHN0YXJ0KSsxKTtcblx0XHR9XG5cdH1cbn1cbmZ1bmN0aW9uIGNvcHlMb2NhdG9yKGYsdCl7XG5cdHQubGluZU51bWJlciA9IGYubGluZU51bWJlcjtcblx0dC5jb2x1bW5OdW1iZXIgPSBmLmNvbHVtbk51bWJlcjtcblx0cmV0dXJuIHQ7XG59XG5cbi8qKlxuICogQHNlZSAjYXBwZW5kRWxlbWVudChzb3VyY2UsZWxTdGFydEVuZCxlbCxzZWxmQ2xvc2VkLGVudGl0eVJlcGxhY2VyLGRvbUJ1aWxkZXIscGFyc2VTdGFjayk7XG4gKiBAcmV0dXJuIGVuZCBvZiB0aGUgZWxlbWVudFN0YXJ0UGFydChlbmQgb2YgZWxlbWVudEVuZFBhcnQgZm9yIHNlbGZDbG9zZWQgZWwpXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRWxlbWVudFN0YXJ0UGFydChzb3VyY2Usc3RhcnQsZWwsY3VycmVudE5TTWFwLGVudGl0eVJlcGxhY2VyLGVycm9ySGFuZGxlcil7XG5cblx0LyoqXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBxbmFtZVxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0SW5kZXhcblx0ICovXG5cdGZ1bmN0aW9uIGFkZEF0dHJpYnV0ZShxbmFtZSwgdmFsdWUsIHN0YXJ0SW5kZXgpIHtcblx0XHRpZiAoZWwuYXR0cmlidXRlTmFtZXMuaGFzT3duUHJvcGVydHkocW5hbWUpKSB7XG5cdFx0XHRlcnJvckhhbmRsZXIuZmF0YWxFcnJvcignQXR0cmlidXRlICcgKyBxbmFtZSArICcgcmVkZWZpbmVkJylcblx0XHR9XG5cdFx0ZWwuYWRkVmFsdWUoXG5cdFx0XHRxbmFtZSxcblx0XHRcdC8vIEBzZWUgaHR0cHM6Ly93d3cudzMub3JnL1RSL3htbC8jQVZOb3JtYWxpemVcblx0XHRcdC8vIHNpbmNlIHRoZSB4bWxkb20gc2F4IHBhcnNlciBkb2VzIG5vdCBcImludGVycHJldFwiIERURCB0aGUgZm9sbG93aW5nIGlzIG5vdCBpbXBsZW1lbnRlZDpcblx0XHRcdC8vIC0gcmVjdXJzaXZlIHJlcGxhY2VtZW50IG9mIChEVEQpIGVudGl0eSByZWZlcmVuY2VzXG5cdFx0XHQvLyAtIHRyaW1taW5nIGFuZCBjb2xsYXBzaW5nIG11bHRpcGxlIHNwYWNlcyBpbnRvIGEgc2luZ2xlIG9uZSBmb3IgYXR0cmlidXRlcyB0aGF0IGFyZSBub3Qgb2YgdHlwZSBDREFUQVxuXHRcdFx0dmFsdWUucmVwbGFjZSgvW1xcdFxcblxccl0vZywgJyAnKS5yZXBsYWNlKC8mIz9cXHcrOy9nLCBlbnRpdHlSZXBsYWNlciksXG5cdFx0XHRzdGFydEluZGV4XG5cdFx0KVxuXHR9XG5cdHZhciBhdHRyTmFtZTtcblx0dmFyIHZhbHVlO1xuXHR2YXIgcCA9ICsrc3RhcnQ7XG5cdHZhciBzID0gU19UQUc7Ly9zdGF0dXNcblx0d2hpbGUodHJ1ZSl7XG5cdFx0dmFyIGMgPSBzb3VyY2UuY2hhckF0KHApO1xuXHRcdHN3aXRjaChjKXtcblx0XHRjYXNlICc9Jzpcblx0XHRcdGlmKHMgPT09IFNfQVRUUil7Ly9hdHRyTmFtZVxuXHRcdFx0XHRhdHRyTmFtZSA9IHNvdXJjZS5zbGljZShzdGFydCxwKTtcblx0XHRcdFx0cyA9IFNfRVE7XG5cdFx0XHR9ZWxzZSBpZihzID09PSBTX0FUVFJfU1BBQ0Upe1xuXHRcdFx0XHRzID0gU19FUTtcblx0XHRcdH1lbHNle1xuXHRcdFx0XHQvL2ZhdGFsRXJyb3I6IGVxdWFsIG11c3QgYWZ0ZXIgYXR0ck5hbWUgb3Igc3BhY2UgYWZ0ZXIgYXR0ck5hbWVcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdhdHRyaWJ1dGUgZXF1YWwgbXVzdCBhZnRlciBhdHRyTmFtZScpOyAvLyBObyBrbm93biB0ZXN0IGNhc2Vcblx0XHRcdH1cblx0XHRcdGJyZWFrO1xuXHRcdGNhc2UgJ1xcJyc6XG5cdFx0Y2FzZSAnXCInOlxuXHRcdFx0aWYocyA9PT0gU19FUSB8fCBzID09PSBTX0FUVFIgLy98fCBzID09IFNfQVRUUl9TUEFDRVxuXHRcdFx0XHQpey8vZXF1YWxcblx0XHRcdFx0aWYocyA9PT0gU19BVFRSKXtcblx0XHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygnYXR0cmlidXRlIHZhbHVlIG11c3QgYWZ0ZXIgXCI9XCInKVxuXHRcdFx0XHRcdGF0dHJOYW1lID0gc291cmNlLnNsaWNlKHN0YXJ0LHApXG5cdFx0XHRcdH1cblx0XHRcdFx0c3RhcnQgPSBwKzE7XG5cdFx0XHRcdHAgPSBzb3VyY2UuaW5kZXhPZihjLHN0YXJ0KVxuXHRcdFx0XHRpZihwPjApe1xuXHRcdFx0XHRcdHZhbHVlID0gc291cmNlLnNsaWNlKHN0YXJ0LCBwKTtcblx0XHRcdFx0XHRhZGRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbHVlLCBzdGFydC0xKTtcblx0XHRcdFx0XHRzID0gU19BVFRSX0VORDtcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0Ly9mYXRhbEVycm9yOiBubyBlbmQgcXVvdCBtYXRjaFxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcignYXR0cmlidXRlIHZhbHVlIG5vIGVuZCBcXCcnK2MrJ1xcJyBtYXRjaCcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9ZWxzZSBpZihzID09IFNfQVRUUl9OT1FVT1RfVkFMVUUpe1xuXHRcdFx0XHR2YWx1ZSA9IHNvdXJjZS5zbGljZShzdGFydCwgcCk7XG5cdFx0XHRcdGFkZEF0dHJpYnV0ZShhdHRyTmFtZSwgdmFsdWUsIHN0YXJ0KTtcblx0XHRcdFx0ZXJyb3JIYW5kbGVyLndhcm5pbmcoJ2F0dHJpYnV0ZSBcIicrYXR0ck5hbWUrJ1wiIG1pc3NlZCBzdGFydCBxdW90KCcrYysnKSEhJyk7XG5cdFx0XHRcdHN0YXJ0ID0gcCsxO1xuXHRcdFx0XHRzID0gU19BVFRSX0VORFxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8vZmF0YWxFcnJvcjogbm8gZXF1YWwgYmVmb3JlXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcignYXR0cmlidXRlIHZhbHVlIG11c3QgYWZ0ZXIgXCI9XCInKTsgLy8gTm8ga25vd24gdGVzdCBjYXNlXG5cdFx0XHR9XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICcvJzpcblx0XHRcdHN3aXRjaChzKXtcblx0XHRcdGNhc2UgU19UQUc6XG5cdFx0XHRcdGVsLnNldFRhZ05hbWUoc291cmNlLnNsaWNlKHN0YXJ0LHApKTtcblx0XHRcdGNhc2UgU19BVFRSX0VORDpcblx0XHRcdGNhc2UgU19UQUdfU1BBQ0U6XG5cdFx0XHRjYXNlIFNfVEFHX0NMT1NFOlxuXHRcdFx0XHRzID1TX1RBR19DTE9TRTtcblx0XHRcdFx0ZWwuY2xvc2VkID0gdHJ1ZTtcblx0XHRcdGNhc2UgU19BVFRSX05PUVVPVF9WQUxVRTpcblx0XHRcdGNhc2UgU19BVFRSOlxuXHRcdFx0Y2FzZSBTX0FUVFJfU1BBQ0U6XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Ly9jYXNlIFNfRVE6XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJhdHRyaWJ1dGUgaW52YWxpZCBjbG9zZSBjaGFyKCcvJylcIikgLy8gTm8ga25vd24gdGVzdCBjYXNlXG5cdFx0XHR9XG5cdFx0XHRicmVhaztcblx0XHRjYXNlICcnOi8vZW5kIGRvY3VtZW50XG5cdFx0XHRlcnJvckhhbmRsZXIuZXJyb3IoJ3VuZXhwZWN0ZWQgZW5kIG9mIGlucHV0Jyk7XG5cdFx0XHRpZihzID09IFNfVEFHKXtcblx0XHRcdFx0ZWwuc2V0VGFnTmFtZShzb3VyY2Uuc2xpY2Uoc3RhcnQscCkpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHA7XG5cdFx0Y2FzZSAnPic6XG5cdFx0XHRzd2l0Y2gocyl7XG5cdFx0XHRjYXNlIFNfVEFHOlxuXHRcdFx0XHRlbC5zZXRUYWdOYW1lKHNvdXJjZS5zbGljZShzdGFydCxwKSk7XG5cdFx0XHRjYXNlIFNfQVRUUl9FTkQ6XG5cdFx0XHRjYXNlIFNfVEFHX1NQQUNFOlxuXHRcdFx0Y2FzZSBTX1RBR19DTE9TRTpcblx0XHRcdFx0YnJlYWs7Ly9ub3JtYWxcblx0XHRcdGNhc2UgU19BVFRSX05PUVVPVF9WQUxVRTovL0NvbXBhdGlibGUgc3RhdGVcblx0XHRcdGNhc2UgU19BVFRSOlxuXHRcdFx0XHR2YWx1ZSA9IHNvdXJjZS5zbGljZShzdGFydCxwKTtcblx0XHRcdFx0aWYodmFsdWUuc2xpY2UoLTEpID09PSAnLycpe1xuXHRcdFx0XHRcdGVsLmNsb3NlZCAgPSB0cnVlO1xuXHRcdFx0XHRcdHZhbHVlID0gdmFsdWUuc2xpY2UoMCwtMSlcblx0XHRcdFx0fVxuXHRcdFx0Y2FzZSBTX0FUVFJfU1BBQ0U6XG5cdFx0XHRcdGlmKHMgPT09IFNfQVRUUl9TUEFDRSl7XG5cdFx0XHRcdFx0dmFsdWUgPSBhdHRyTmFtZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZihzID09IFNfQVRUUl9OT1FVT1RfVkFMVUUpe1xuXHRcdFx0XHRcdGVycm9ySGFuZGxlci53YXJuaW5nKCdhdHRyaWJ1dGUgXCInK3ZhbHVlKydcIiBtaXNzZWQgcXVvdChcIikhJyk7XG5cdFx0XHRcdFx0YWRkQXR0cmlidXRlKGF0dHJOYW1lLCB2YWx1ZSwgc3RhcnQpXG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdGlmKCFOQU1FU1BBQ0UuaXNIVE1MKGN1cnJlbnROU01hcFsnJ10pIHx8ICF2YWx1ZS5tYXRjaCgvXig/OmRpc2FibGVkfGNoZWNrZWR8c2VsZWN0ZWQpJC9pKSl7XG5cdFx0XHRcdFx0XHRlcnJvckhhbmRsZXIud2FybmluZygnYXR0cmlidXRlIFwiJyt2YWx1ZSsnXCIgbWlzc2VkIHZhbHVlISEgXCInK3ZhbHVlKydcIiBpbnN0ZWFkISEnKVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRhZGRBdHRyaWJ1dGUodmFsdWUsIHZhbHVlLCBzdGFydClcblx0XHRcdFx0fVxuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgU19FUTpcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKCdhdHRyaWJ1dGUgdmFsdWUgbWlzc2VkISEnKTtcblx0XHRcdH1cbi8vXHRcdFx0Y29uc29sZS5sb2codGFnTmFtZSx0YWdOYW1lUGF0dGVybix0YWdOYW1lUGF0dGVybi50ZXN0KHRhZ05hbWUpKVxuXHRcdFx0cmV0dXJuIHA7XG5cdFx0Lyp4bWwgc3BhY2UgJ1xceDIwJyB8ICN4OSB8ICN4RCB8ICN4QTsgKi9cblx0XHRjYXNlICdcXHUwMDgwJzpcblx0XHRcdGMgPSAnICc7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdGlmKGM8PSAnICcpey8vc3BhY2Vcblx0XHRcdFx0c3dpdGNoKHMpe1xuXHRcdFx0XHRjYXNlIFNfVEFHOlxuXHRcdFx0XHRcdGVsLnNldFRhZ05hbWUoc291cmNlLnNsaWNlKHN0YXJ0LHApKTsvL3RhZ05hbWVcblx0XHRcdFx0XHRzID0gU19UQUdfU1BBQ0U7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgU19BVFRSOlxuXHRcdFx0XHRcdGF0dHJOYW1lID0gc291cmNlLnNsaWNlKHN0YXJ0LHApXG5cdFx0XHRcdFx0cyA9IFNfQVRUUl9TUEFDRTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBTX0FUVFJfTk9RVU9UX1ZBTFVFOlxuXHRcdFx0XHRcdHZhciB2YWx1ZSA9IHNvdXJjZS5zbGljZShzdGFydCwgcCk7XG5cdFx0XHRcdFx0ZXJyb3JIYW5kbGVyLndhcm5pbmcoJ2F0dHJpYnV0ZSBcIicrdmFsdWUrJ1wiIG1pc3NlZCBxdW90KFwiKSEhJyk7XG5cdFx0XHRcdFx0YWRkQXR0cmlidXRlKGF0dHJOYW1lLCB2YWx1ZSwgc3RhcnQpXG5cdFx0XHRcdGNhc2UgU19BVFRSX0VORDpcblx0XHRcdFx0XHRzID0gU19UQUdfU1BBQ0U7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdC8vY2FzZSBTX1RBR19TUEFDRTpcblx0XHRcdFx0Ly9jYXNlIFNfRVE6XG5cdFx0XHRcdC8vY2FzZSBTX0FUVFJfU1BBQ0U6XG5cdFx0XHRcdC8vXHR2b2lkKCk7YnJlYWs7XG5cdFx0XHRcdC8vY2FzZSBTX1RBR19DTE9TRTpcblx0XHRcdFx0XHQvL2lnbm9yZSB3YXJuaW5nXG5cdFx0XHRcdH1cblx0XHRcdH1lbHNley8vbm90IHNwYWNlXG4vL1NfVEFHLFx0U19BVFRSLFx0U19FUSxcdFNfQVRUUl9OT1FVT1RfVkFMVUVcbi8vU19BVFRSX1NQQUNFLFx0U19BVFRSX0VORCxcdFNfVEFHX1NQQUNFLCBTX1RBR19DTE9TRVxuXHRcdFx0XHRzd2l0Y2gocyl7XG5cdFx0XHRcdC8vY2FzZSBTX1RBRzp2b2lkKCk7YnJlYWs7XG5cdFx0XHRcdC8vY2FzZSBTX0FUVFI6dm9pZCgpO2JyZWFrO1xuXHRcdFx0XHQvL2Nhc2UgU19BVFRSX05PUVVPVF9WQUxVRTp2b2lkKCk7YnJlYWs7XG5cdFx0XHRcdGNhc2UgU19BVFRSX1NQQUNFOlxuXHRcdFx0XHRcdHZhciB0YWdOYW1lID0gIGVsLnRhZ05hbWU7XG5cdFx0XHRcdFx0aWYgKCFOQU1FU1BBQ0UuaXNIVE1MKGN1cnJlbnROU01hcFsnJ10pIHx8ICFhdHRyTmFtZS5tYXRjaCgvXig/OmRpc2FibGVkfGNoZWNrZWR8c2VsZWN0ZWQpJC9pKSkge1xuXHRcdFx0XHRcdFx0ZXJyb3JIYW5kbGVyLndhcm5pbmcoJ2F0dHJpYnV0ZSBcIicrYXR0ck5hbWUrJ1wiIG1pc3NlZCB2YWx1ZSEhIFwiJythdHRyTmFtZSsnXCIgaW5zdGVhZDIhIScpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGFkZEF0dHJpYnV0ZShhdHRyTmFtZSwgYXR0ck5hbWUsIHN0YXJ0KTtcblx0XHRcdFx0XHRzdGFydCA9IHA7XG5cdFx0XHRcdFx0cyA9IFNfQVRUUjtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBTX0FUVFJfRU5EOlxuXHRcdFx0XHRcdGVycm9ySGFuZGxlci53YXJuaW5nKCdhdHRyaWJ1dGUgc3BhY2UgaXMgcmVxdWlyZWRcIicrYXR0ck5hbWUrJ1wiISEnKVxuXHRcdFx0XHRjYXNlIFNfVEFHX1NQQUNFOlxuXHRcdFx0XHRcdHMgPSBTX0FUVFI7XG5cdFx0XHRcdFx0c3RhcnQgPSBwO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFNfRVE6XG5cdFx0XHRcdFx0cyA9IFNfQVRUUl9OT1FVT1RfVkFMVUU7XG5cdFx0XHRcdFx0c3RhcnQgPSBwO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFNfVEFHX0NMT1NFOlxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcImVsZW1lbnRzIGNsb3NlZCBjaGFyYWN0ZXIgJy8nIGFuZCAnPicgbXVzdCBiZSBjb25uZWN0ZWQgdG9cIik7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9Ly9lbmQgb3V0ZXIgc3dpdGNoXG5cdFx0Ly9jb25zb2xlLmxvZygncCsrJyxwKVxuXHRcdHArKztcblx0fVxufVxuLyoqXG4gKiBAcmV0dXJuIHRydWUgaWYgaGFzIG5ldyBuYW1lc3BhY2UgZGVmaW5lXG4gKi9cbmZ1bmN0aW9uIGFwcGVuZEVsZW1lbnQoZWwsZG9tQnVpbGRlcixjdXJyZW50TlNNYXApe1xuXHR2YXIgdGFnTmFtZSA9IGVsLnRhZ05hbWU7XG5cdHZhciBsb2NhbE5TTWFwID0gbnVsbDtcblx0Ly92YXIgY3VycmVudE5TTWFwID0gcGFyc2VTdGFja1twYXJzZVN0YWNrLmxlbmd0aC0xXS5jdXJyZW50TlNNYXA7XG5cdHZhciBpID0gZWwubGVuZ3RoO1xuXHR3aGlsZShpLS0pe1xuXHRcdHZhciBhID0gZWxbaV07XG5cdFx0dmFyIHFOYW1lID0gYS5xTmFtZTtcblx0XHR2YXIgdmFsdWUgPSBhLnZhbHVlO1xuXHRcdHZhciBuc3AgPSBxTmFtZS5pbmRleE9mKCc6Jyk7XG5cdFx0aWYobnNwPjApe1xuXHRcdFx0dmFyIHByZWZpeCA9IGEucHJlZml4ID0gcU5hbWUuc2xpY2UoMCxuc3ApO1xuXHRcdFx0dmFyIGxvY2FsTmFtZSA9IHFOYW1lLnNsaWNlKG5zcCsxKTtcblx0XHRcdHZhciBuc1ByZWZpeCA9IHByZWZpeCA9PT0gJ3htbG5zJyAmJiBsb2NhbE5hbWVcblx0XHR9ZWxzZXtcblx0XHRcdGxvY2FsTmFtZSA9IHFOYW1lO1xuXHRcdFx0cHJlZml4ID0gbnVsbFxuXHRcdFx0bnNQcmVmaXggPSBxTmFtZSA9PT0gJ3htbG5zJyAmJiAnJ1xuXHRcdH1cblx0XHQvL2NhbiBub3Qgc2V0IHByZWZpeCxiZWNhdXNlIHByZWZpeCAhPT0gJydcblx0XHRhLmxvY2FsTmFtZSA9IGxvY2FsTmFtZSA7XG5cdFx0Ly9wcmVmaXggPT0gbnVsbCBmb3Igbm8gbnMgcHJlZml4IGF0dHJpYnV0ZVxuXHRcdGlmKG5zUHJlZml4ICE9PSBmYWxzZSl7Ly9oYWNrISFcblx0XHRcdGlmKGxvY2FsTlNNYXAgPT0gbnVsbCl7XG5cdFx0XHRcdGxvY2FsTlNNYXAgPSB7fVxuXHRcdFx0XHQvL2NvbnNvbGUubG9nKGN1cnJlbnROU01hcCwwKVxuXHRcdFx0XHRfY29weShjdXJyZW50TlNNYXAsY3VycmVudE5TTWFwPXt9KVxuXHRcdFx0XHQvL2NvbnNvbGUubG9nKGN1cnJlbnROU01hcCwxKVxuXHRcdFx0fVxuXHRcdFx0Y3VycmVudE5TTWFwW25zUHJlZml4XSA9IGxvY2FsTlNNYXBbbnNQcmVmaXhdID0gdmFsdWU7XG5cdFx0XHRhLnVyaSA9IE5BTUVTUEFDRS5YTUxOU1xuXHRcdFx0ZG9tQnVpbGRlci5zdGFydFByZWZpeE1hcHBpbmcobnNQcmVmaXgsIHZhbHVlKVxuXHRcdH1cblx0fVxuXHR2YXIgaSA9IGVsLmxlbmd0aDtcblx0d2hpbGUoaS0tKXtcblx0XHRhID0gZWxbaV07XG5cdFx0dmFyIHByZWZpeCA9IGEucHJlZml4O1xuXHRcdGlmKHByZWZpeCl7Ly9ubyBwcmVmaXggYXR0cmlidXRlIGhhcyBubyBuYW1lc3BhY2Vcblx0XHRcdGlmKHByZWZpeCA9PT0gJ3htbCcpe1xuXHRcdFx0XHRhLnVyaSA9IE5BTUVTUEFDRS5YTUw7XG5cdFx0XHR9aWYocHJlZml4ICE9PSAneG1sbnMnKXtcblx0XHRcdFx0YS51cmkgPSBjdXJyZW50TlNNYXBbcHJlZml4IHx8ICcnXVxuXG5cdFx0XHRcdC8ve2NvbnNvbGUubG9nKCcjIyMnK2EucU5hbWUsZG9tQnVpbGRlci5sb2NhdG9yLnN5c3RlbUlkKycnLGN1cnJlbnROU01hcCxhLnVyaSl9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cdHZhciBuc3AgPSB0YWdOYW1lLmluZGV4T2YoJzonKTtcblx0aWYobnNwPjApe1xuXHRcdHByZWZpeCA9IGVsLnByZWZpeCA9IHRhZ05hbWUuc2xpY2UoMCxuc3ApO1xuXHRcdGxvY2FsTmFtZSA9IGVsLmxvY2FsTmFtZSA9IHRhZ05hbWUuc2xpY2UobnNwKzEpO1xuXHR9ZWxzZXtcblx0XHRwcmVmaXggPSBudWxsOy8vaW1wb3J0YW50ISFcblx0XHRsb2NhbE5hbWUgPSBlbC5sb2NhbE5hbWUgPSB0YWdOYW1lO1xuXHR9XG5cdC8vbm8gcHJlZml4IGVsZW1lbnQgaGFzIGRlZmF1bHQgbmFtZXNwYWNlXG5cdHZhciBucyA9IGVsLnVyaSA9IGN1cnJlbnROU01hcFtwcmVmaXggfHwgJyddO1xuXHRkb21CdWlsZGVyLnN0YXJ0RWxlbWVudChucyxsb2NhbE5hbWUsdGFnTmFtZSxlbCk7XG5cdC8vZW5kUHJlZml4TWFwcGluZyBhbmQgc3RhcnRQcmVmaXhNYXBwaW5nIGhhdmUgbm90IGFueSBoZWxwIGZvciBkb20gYnVpbGRlclxuXHQvL2xvY2FsTlNNYXAgPSBudWxsXG5cdGlmKGVsLmNsb3NlZCl7XG5cdFx0ZG9tQnVpbGRlci5lbmRFbGVtZW50KG5zLGxvY2FsTmFtZSx0YWdOYW1lKTtcblx0XHRpZihsb2NhbE5TTWFwKXtcblx0XHRcdGZvcihwcmVmaXggaW4gbG9jYWxOU01hcCl7XG5cdFx0XHRcdGRvbUJ1aWxkZXIuZW5kUHJlZml4TWFwcGluZyhwcmVmaXgpXG5cdFx0XHR9XG5cdFx0fVxuXHR9ZWxzZXtcblx0XHRlbC5jdXJyZW50TlNNYXAgPSBjdXJyZW50TlNNYXA7XG5cdFx0ZWwubG9jYWxOU01hcCA9IGxvY2FsTlNNYXA7XG5cdFx0Ly9wYXJzZVN0YWNrLnB1c2goZWwpO1xuXHRcdHJldHVybiB0cnVlO1xuXHR9XG59XG5mdW5jdGlvbiBwYXJzZUh0bWxTcGVjaWFsQ29udGVudChzb3VyY2UsZWxTdGFydEVuZCx0YWdOYW1lLGVudGl0eVJlcGxhY2VyLGRvbUJ1aWxkZXIpe1xuXHRpZigvXig/OnNjcmlwdHx0ZXh0YXJlYSkkL2kudGVzdCh0YWdOYW1lKSl7XG5cdFx0dmFyIGVsRW5kU3RhcnQgPSAgc291cmNlLmluZGV4T2YoJzwvJyt0YWdOYW1lKyc+JyxlbFN0YXJ0RW5kKTtcblx0XHR2YXIgdGV4dCA9IHNvdXJjZS5zdWJzdHJpbmcoZWxTdGFydEVuZCsxLGVsRW5kU3RhcnQpO1xuXHRcdGlmKC9bJjxdLy50ZXN0KHRleHQpKXtcblx0XHRcdGlmKC9ec2NyaXB0JC9pLnRlc3QodGFnTmFtZSkpe1xuXHRcdFx0XHQvL2lmKCEvXFxdXFxdPi8udGVzdCh0ZXh0KSl7XG5cdFx0XHRcdFx0Ly9sZXhIYW5kbGVyLnN0YXJ0Q0RBVEEoKTtcblx0XHRcdFx0XHRkb21CdWlsZGVyLmNoYXJhY3RlcnModGV4dCwwLHRleHQubGVuZ3RoKTtcblx0XHRcdFx0XHQvL2xleEhhbmRsZXIuZW5kQ0RBVEEoKTtcblx0XHRcdFx0XHRyZXR1cm4gZWxFbmRTdGFydDtcblx0XHRcdFx0Ly99XG5cdFx0XHR9Ly99ZWxzZXsvL3RleHQgYXJlYVxuXHRcdFx0XHR0ZXh0ID0gdGV4dC5yZXBsYWNlKC8mIz9cXHcrOy9nLGVudGl0eVJlcGxhY2VyKTtcblx0XHRcdFx0ZG9tQnVpbGRlci5jaGFyYWN0ZXJzKHRleHQsMCx0ZXh0Lmxlbmd0aCk7XG5cdFx0XHRcdHJldHVybiBlbEVuZFN0YXJ0O1xuXHRcdFx0Ly99XG5cblx0XHR9XG5cdH1cblx0cmV0dXJuIGVsU3RhcnRFbmQrMTtcbn1cbmZ1bmN0aW9uIGZpeFNlbGZDbG9zZWQoc291cmNlLGVsU3RhcnRFbmQsdGFnTmFtZSxjbG9zZU1hcCl7XG5cdC8vaWYodGFnTmFtZSBpbiBjbG9zZU1hcCl7XG5cdHZhciBwb3MgPSBjbG9zZU1hcFt0YWdOYW1lXTtcblx0aWYocG9zID09IG51bGwpe1xuXHRcdC8vY29uc29sZS5sb2codGFnTmFtZSlcblx0XHRwb3MgPSAgc291cmNlLmxhc3RJbmRleE9mKCc8LycrdGFnTmFtZSsnPicpXG5cdFx0aWYocG9zPGVsU3RhcnRFbmQpey8v5b+Y6K6w6Zet5ZCIXG5cdFx0XHRwb3MgPSBzb3VyY2UubGFzdEluZGV4T2YoJzwvJyt0YWdOYW1lKVxuXHRcdH1cblx0XHRjbG9zZU1hcFt0YWdOYW1lXSA9cG9zXG5cdH1cblx0cmV0dXJuIHBvczxlbFN0YXJ0RW5kO1xuXHQvL31cbn1cbmZ1bmN0aW9uIF9jb3B5KHNvdXJjZSx0YXJnZXQpe1xuXHRmb3IodmFyIG4gaW4gc291cmNlKXt0YXJnZXRbbl0gPSBzb3VyY2Vbbl19XG59XG5mdW5jdGlvbiBwYXJzZURDQyhzb3VyY2Usc3RhcnQsZG9tQnVpbGRlcixlcnJvckhhbmRsZXIpey8vc3VyZSBzdGFydCB3aXRoICc8ISdcblx0dmFyIG5leHQ9IHNvdXJjZS5jaGFyQXQoc3RhcnQrMilcblx0c3dpdGNoKG5leHQpe1xuXHRjYXNlICctJzpcblx0XHRpZihzb3VyY2UuY2hhckF0KHN0YXJ0ICsgMykgPT09ICctJyl7XG5cdFx0XHR2YXIgZW5kID0gc291cmNlLmluZGV4T2YoJy0tPicsc3RhcnQrNCk7XG5cdFx0XHQvL2FwcGVuZCBjb21tZW50IHNvdXJjZS5zdWJzdHJpbmcoNCxlbmQpLy88IS0tXG5cdFx0XHRpZihlbmQ+c3RhcnQpe1xuXHRcdFx0XHRkb21CdWlsZGVyLmNvbW1lbnQoc291cmNlLHN0YXJ0KzQsZW5kLXN0YXJ0LTQpO1xuXHRcdFx0XHRyZXR1cm4gZW5kKzM7XG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0ZXJyb3JIYW5kbGVyLmVycm9yKFwiVW5jbG9zZWQgY29tbWVudFwiKTtcblx0XHRcdFx0cmV0dXJuIC0xO1xuXHRcdFx0fVxuXHRcdH1lbHNle1xuXHRcdFx0Ly9lcnJvclxuXHRcdFx0cmV0dXJuIC0xO1xuXHRcdH1cblx0ZGVmYXVsdDpcblx0XHRpZihzb3VyY2Uuc3Vic3RyKHN0YXJ0KzMsNikgPT0gJ0NEQVRBWycpe1xuXHRcdFx0dmFyIGVuZCA9IHNvdXJjZS5pbmRleE9mKCddXT4nLHN0YXJ0KzkpO1xuXHRcdFx0ZG9tQnVpbGRlci5zdGFydENEQVRBKCk7XG5cdFx0XHRkb21CdWlsZGVyLmNoYXJhY3RlcnMoc291cmNlLHN0YXJ0KzksZW5kLXN0YXJ0LTkpO1xuXHRcdFx0ZG9tQnVpbGRlci5lbmRDREFUQSgpXG5cdFx0XHRyZXR1cm4gZW5kKzM7XG5cdFx0fVxuXHRcdC8vPCFET0NUWVBFXG5cdFx0Ly9zdGFydERURChqYXZhLmxhbmcuU3RyaW5nIG5hbWUsIGphdmEubGFuZy5TdHJpbmcgcHVibGljSWQsIGphdmEubGFuZy5TdHJpbmcgc3lzdGVtSWQpXG5cdFx0dmFyIG1hdGNocyA9IHNwbGl0KHNvdXJjZSxzdGFydCk7XG5cdFx0dmFyIGxlbiA9IG1hdGNocy5sZW5ndGg7XG5cdFx0aWYobGVuPjEgJiYgLyFkb2N0eXBlL2kudGVzdChtYXRjaHNbMF1bMF0pKXtcblx0XHRcdHZhciBuYW1lID0gbWF0Y2hzWzFdWzBdO1xuXHRcdFx0dmFyIHB1YmlkID0gZmFsc2U7XG5cdFx0XHR2YXIgc3lzaWQgPSBmYWxzZTtcblx0XHRcdGlmKGxlbj4zKXtcblx0XHRcdFx0aWYoL15wdWJsaWMkL2kudGVzdChtYXRjaHNbMl1bMF0pKXtcblx0XHRcdFx0XHRwdWJpZCA9IG1hdGNoc1szXVswXTtcblx0XHRcdFx0XHRzeXNpZCA9IGxlbj40ICYmIG1hdGNoc1s0XVswXTtcblx0XHRcdFx0fWVsc2UgaWYoL15zeXN0ZW0kL2kudGVzdChtYXRjaHNbMl1bMF0pKXtcblx0XHRcdFx0XHRzeXNpZCA9IG1hdGNoc1szXVswXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0dmFyIGxhc3RNYXRjaCA9IG1hdGNoc1tsZW4tMV1cblx0XHRcdGRvbUJ1aWxkZXIuc3RhcnREVEQobmFtZSwgcHViaWQsIHN5c2lkKTtcblx0XHRcdGRvbUJ1aWxkZXIuZW5kRFREKCk7XG5cblx0XHRcdHJldHVybiBsYXN0TWF0Y2guaW5kZXgrbGFzdE1hdGNoWzBdLmxlbmd0aFxuXHRcdH1cblx0fVxuXHRyZXR1cm4gLTE7XG59XG5cblxuXG5mdW5jdGlvbiBwYXJzZUluc3RydWN0aW9uKHNvdXJjZSxzdGFydCxkb21CdWlsZGVyKXtcblx0dmFyIGVuZCA9IHNvdXJjZS5pbmRleE9mKCc/Picsc3RhcnQpO1xuXHRpZihlbmQpe1xuXHRcdHZhciBtYXRjaCA9IHNvdXJjZS5zdWJzdHJpbmcoc3RhcnQsZW5kKS5tYXRjaCgvXjxcXD8oXFxTKilcXHMqKFtcXHNcXFNdKj8pXFxzKiQvKTtcblx0XHRpZihtYXRjaCl7XG5cdFx0XHR2YXIgbGVuID0gbWF0Y2hbMF0ubGVuZ3RoO1xuXHRcdFx0ZG9tQnVpbGRlci5wcm9jZXNzaW5nSW5zdHJ1Y3Rpb24obWF0Y2hbMV0sIG1hdGNoWzJdKSA7XG5cdFx0XHRyZXR1cm4gZW5kKzI7XG5cdFx0fWVsc2V7Ly9lcnJvclxuXHRcdFx0cmV0dXJuIC0xO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gLTE7XG59XG5cbmZ1bmN0aW9uIEVsZW1lbnRBdHRyaWJ1dGVzKCl7XG5cdHRoaXMuYXR0cmlidXRlTmFtZXMgPSB7fVxufVxuRWxlbWVudEF0dHJpYnV0ZXMucHJvdG90eXBlID0ge1xuXHRzZXRUYWdOYW1lOmZ1bmN0aW9uKHRhZ05hbWUpe1xuXHRcdGlmKCF0YWdOYW1lUGF0dGVybi50ZXN0KHRhZ05hbWUpKXtcblx0XHRcdHRocm93IG5ldyBFcnJvcignaW52YWxpZCB0YWdOYW1lOicrdGFnTmFtZSlcblx0XHR9XG5cdFx0dGhpcy50YWdOYW1lID0gdGFnTmFtZVxuXHR9LFxuXHRhZGRWYWx1ZTpmdW5jdGlvbihxTmFtZSwgdmFsdWUsIG9mZnNldCkge1xuXHRcdGlmKCF0YWdOYW1lUGF0dGVybi50ZXN0KHFOYW1lKSl7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ2ludmFsaWQgYXR0cmlidXRlOicrcU5hbWUpXG5cdFx0fVxuXHRcdHRoaXMuYXR0cmlidXRlTmFtZXNbcU5hbWVdID0gdGhpcy5sZW5ndGg7XG5cdFx0dGhpc1t0aGlzLmxlbmd0aCsrXSA9IHtxTmFtZTpxTmFtZSx2YWx1ZTp2YWx1ZSxvZmZzZXQ6b2Zmc2V0fVxuXHR9LFxuXHRsZW5ndGg6MCxcblx0Z2V0TG9jYWxOYW1lOmZ1bmN0aW9uKGkpe3JldHVybiB0aGlzW2ldLmxvY2FsTmFtZX0sXG5cdGdldExvY2F0b3I6ZnVuY3Rpb24oaSl7cmV0dXJuIHRoaXNbaV0ubG9jYXRvcn0sXG5cdGdldFFOYW1lOmZ1bmN0aW9uKGkpe3JldHVybiB0aGlzW2ldLnFOYW1lfSxcblx0Z2V0VVJJOmZ1bmN0aW9uKGkpe3JldHVybiB0aGlzW2ldLnVyaX0sXG5cdGdldFZhbHVlOmZ1bmN0aW9uKGkpe3JldHVybiB0aGlzW2ldLnZhbHVlfVxuLy9cdCxnZXRJbmRleDpmdW5jdGlvbih1cmksIGxvY2FsTmFtZSkpe1xuLy9cdFx0aWYobG9jYWxOYW1lKXtcbi8vXG4vL1x0XHR9ZWxzZXtcbi8vXHRcdFx0dmFyIHFOYW1lID0gdXJpXG4vL1x0XHR9XG4vL1x0fSxcbi8vXHRnZXRWYWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldFZhbHVlKHRoaXMuZ2V0SW5kZXguYXBwbHkodGhpcyxhcmd1bWVudHMpKX0sXG4vL1x0Z2V0VHlwZTpmdW5jdGlvbih1cmksbG9jYWxOYW1lKXt9XG4vL1x0Z2V0VHlwZTpmdW5jdGlvbihpKXt9LFxufVxuXG5cblxuZnVuY3Rpb24gc3BsaXQoc291cmNlLHN0YXJ0KXtcblx0dmFyIG1hdGNoO1xuXHR2YXIgYnVmID0gW107XG5cdHZhciByZWcgPSAvJ1teJ10rJ3xcIlteXCJdK1wifFteXFxzPD5cXC89XSs9P3woXFwvP1xccyo+fDwpL2c7XG5cdHJlZy5sYXN0SW5kZXggPSBzdGFydDtcblx0cmVnLmV4ZWMoc291cmNlKTsvL3NraXAgPFxuXHR3aGlsZShtYXRjaCA9IHJlZy5leGVjKHNvdXJjZSkpe1xuXHRcdGJ1Zi5wdXNoKG1hdGNoKTtcblx0XHRpZihtYXRjaFsxXSlyZXR1cm4gYnVmO1xuXHR9XG59XG5cbmV4cG9ydHMuWE1MUmVhZGVyID0gWE1MUmVhZGVyO1xuZXhwb3J0cy5QYXJzZUVycm9yID0gUGFyc2VFcnJvcjtcblxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL25vZGVfbW9kdWxlcy9wcm9jZXNzL2Jyb3dzZXIuanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbi8vIGNhY2hlZCBmcm9tIHdoYXRldmVyIGdsb2JhbCBpcyBwcmVzZW50IHNvIHRoYXQgdGVzdCBydW5uZXJzIHRoYXQgc3R1YiBpdFxuLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzXG4vLyB3cmFwcGVkIGluIHN0cmljdCBtb2RlIGNvZGUgd2hpY2ggZG9lc24ndCBkZWZpbmUgYW55IGdsb2JhbHMuICBJdCdzIGluc2lkZSBhXG4vLyBmdW5jdGlvbiBiZWNhdXNlIHRyeS9jYXRjaGVzIGRlb3B0aW1pemUgaW4gY2VydGFpbiBlbmdpbmVzLlxuXG52YXIgY2FjaGVkU2V0VGltZW91dDtcbnZhciBjYWNoZWRDbGVhclRpbWVvdXQ7XG5cbmZ1bmN0aW9uIGRlZmF1bHRTZXRUaW1vdXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkJyk7XG59XG5mdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0ICgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsZWFyVGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpO1xufVxuKGZ1bmN0aW9uICgpIHtcbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBzZXRUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gY2xlYXJUaW1lb3V0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDtcbiAgICB9XG59ICgpKVxuZnVuY3Rpb24gcnVuVGltZW91dChmdW4pIHtcbiAgICBpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkge1xuICAgICAgICAvL25vcm1hbCBlbnZpcm9tZW50cyBpbiBzYW5lIHNpdHVhdGlvbnNcbiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9XG4gICAgLy8gaWYgc2V0VGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWRcbiAgICBpZiAoKGNhY2hlZFNldFRpbWVvdXQgPT09IGRlZmF1bHRTZXRUaW1vdXQgfHwgIWNhY2hlZFNldFRpbWVvdXQpICYmIHNldFRpbWVvdXQpIHtcbiAgICAgICAgY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIC8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3NcbiAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQoZnVuLCAwKTtcbiAgICB9IGNhdGNoKGUpe1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkU2V0VGltZW91dC5jYWxsKG51bGwsIGZ1biwgMCk7XG4gICAgICAgIH0gY2F0Y2goZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFNldFRpbWVvdXQuY2FsbCh0aGlzLCBmdW4sIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbn1cbmZ1bmN0aW9uIHJ1bkNsZWFyVGltZW91dChtYXJrZXIpIHtcbiAgICBpZiAoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBjbGVhclRpbWVvdXQpIHtcbiAgICAgICAgLy9ub3JtYWwgZW52aXJvbWVudHMgaW4gc2FuZSBzaXR1YXRpb25zXG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgLy8gaWYgY2xlYXJUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZFxuICAgIGlmICgoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBkZWZhdWx0Q2xlYXJUaW1lb3V0IHx8ICFjYWNoZWRDbGVhclRpbWVvdXQpICYmIGNsZWFyVGltZW91dCkge1xuICAgICAgICBjYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7XG4gICAgICAgIHJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzc1xuICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7XG4gICAgfSBjYXRjaCAoZSl7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXaGVuIHdlIGFyZSBpbiBJLkUuIGJ1dCB0aGUgc2NyaXB0IGhhcyBiZWVuIGV2YWxlZCBzbyBJLkUuIGRvZXNuJ3QgIHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTtcbiAgICAgICAgfSBjYXRjaCAoZSl7XG4gICAgICAgICAgICAvLyBzYW1lIGFzIGFib3ZlIGJ1dCB3aGVuIGl0J3MgYSB2ZXJzaW9uIG9mIEkuRS4gdGhhdCBtdXN0IGhhdmUgdGhlIGdsb2JhbCBvYmplY3QgZm9yICd0aGlzJywgaG9wZnVsbHkgb3VyIGNvbnRleHQgY29ycmVjdCBvdGhlcndpc2UgaXQgd2lsbCB0aHJvdyBhIGdsb2JhbCBlcnJvci5cbiAgICAgICAgICAgIC8vIFNvbWUgdmVyc2lvbnMgb2YgSS5FLiBoYXZlIGRpZmZlcmVudCBydWxlcyBmb3IgY2xlYXJUaW1lb3V0IHZzIHNldFRpbWVvdXRcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG5cblxufVxudmFyIHF1ZXVlID0gW107XG52YXIgZHJhaW5pbmcgPSBmYWxzZTtcbnZhciBjdXJyZW50UXVldWU7XG52YXIgcXVldWVJbmRleCA9IC0xO1xuXG5mdW5jdGlvbiBjbGVhblVwTmV4dFRpY2soKSB7XG4gICAgaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZHJhaW5pbmcgPSBmYWxzZTtcbiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBxdWV1ZSA9IGN1cnJlbnRRdWV1ZS5jb25jYXQocXVldWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICB9XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCkge1xuICAgICAgICBkcmFpblF1ZXVlKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkcmFpblF1ZXVlKCkge1xuICAgIGlmIChkcmFpbmluZykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spO1xuICAgIGRyYWluaW5nID0gdHJ1ZTtcblxuICAgIHZhciBsZW4gPSBxdWV1ZS5sZW5ndGg7XG4gICAgd2hpbGUobGVuKSB7XG4gICAgICAgIGN1cnJlbnRRdWV1ZSA9IHF1ZXVlO1xuICAgICAgICBxdWV1ZSA9IFtdO1xuICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7XG4gICAgICAgICAgICBpZiAoY3VycmVudFF1ZXVlKSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlSW5kZXggPSAtMTtcbiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoO1xuICAgIH1cbiAgICBjdXJyZW50UXVldWUgPSBudWxsO1xuICAgIGRyYWluaW5nID0gZmFsc2U7XG4gICAgcnVuQ2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xufVxuXG5wcm9jZXNzLm5leHRUaWNrID0gZnVuY3Rpb24gKGZ1bikge1xuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGFyZ3VtZW50cy5sZW5ndGggLSAxKTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGFyZ3NbaSAtIDFdID0gYXJndW1lbnRzW2ldO1xuICAgICAgICB9XG4gICAgfVxuICAgIHF1ZXVlLnB1c2gobmV3IEl0ZW0oZnVuLCBhcmdzKSk7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHtcbiAgICAgICAgcnVuVGltZW91dChkcmFpblF1ZXVlKTtcbiAgICB9XG59O1xuXG4vLyB2OCBsaWtlcyBwcmVkaWN0aWJsZSBvYmplY3RzXG5mdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHtcbiAgICB0aGlzLmZ1biA9IGZ1bjtcbiAgICB0aGlzLmFycmF5ID0gYXJyYXk7XG59XG5JdGVtLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mdW4uYXBwbHkobnVsbCwgdGhpcy5hcnJheSk7XG59O1xucHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJztcbnByb2Nlc3MuYnJvd3NlciA9IHRydWU7XG5wcm9jZXNzLmVudiA9IHt9O1xucHJvY2Vzcy5hcmd2ID0gW107XG5wcm9jZXNzLnZlcnNpb24gPSAnJzsgLy8gZW1wdHkgc3RyaW5nIHRvIGF2b2lkIHJlZ2V4cCBpc3N1ZXNcbnByb2Nlc3MudmVyc2lvbnMgPSB7fTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kTGlzdGVuZXIgPSBub29wO1xucHJvY2Vzcy5wcmVwZW5kT25jZUxpc3RlbmVyID0gbm9vcDtcblxucHJvY2Vzcy5saXN0ZW5lcnMgPSBmdW5jdGlvbiAobmFtZSkgeyByZXR1cm4gW10gfVxuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG5cbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xucHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gMDsgfTtcblxuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vYW1kLW9wdGlvbnMuanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogKHdlYnBhY2spL2J1aWxkaW4vYW1kLW9wdGlvbnMuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovKGZ1bmN0aW9uKF9fd2VicGFja19hbWRfb3B0aW9uc19fKSB7LyogZ2xvYmFscyBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXyAqL1xubW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXztcblxuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIHt9KSlcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2dsb2JhbC5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogKHdlYnBhY2spL2J1aWxkaW4vZ2xvYmFsLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG52YXIgZztcblxuLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGVcbmcgPSAoZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzO1xufSkoKTtcblxudHJ5IHtcblx0Ly8gVGhpcyB3b3JrcyBpZiBldmFsIGlzIGFsbG93ZWQgKHNlZSBDU1ApXG5cdGcgPSBnIHx8IG5ldyBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCk7XG59IGNhdGNoIChlKSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG5cdGlmICh0eXBlb2Ygd2luZG93ID09PSBcIm9iamVjdFwiKSBnID0gd2luZG93O1xufVxuXG4vLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uXG4vLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQnc1xuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGc7XG5cblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL21vZHVsZS5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuXHRpZiAoIW1vZHVsZS53ZWJwYWNrUG9seWZpbGwpIHtcblx0XHRtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fTtcblx0XHRtb2R1bGUucGF0aHMgPSBbXTtcblx0XHQvLyBtb2R1bGUucGFyZW50ID0gdW5kZWZpbmVkIGJ5IGRlZmF1bHRcblx0XHRpZiAoIW1vZHVsZS5jaGlsZHJlbikgbW9kdWxlLmNoaWxkcmVuID0gW107XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG1vZHVsZSwgXCJsb2FkZWRcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBtb2R1bGUubDtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImlkXCIsIHtcblx0XHRcdGVudW1lcmFibGU6IHRydWUsXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gbW9kdWxlLmk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XG5cdH1cblx0cmV0dXJuIG1vZHVsZTtcbn07XG5cblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9wYWNrYWdlLmpzb25cIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9wYWNrYWdlLmpzb24gKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgZXhwb3J0cyBwcm92aWRlZDogbmFtZSwgdmVyc2lvbiwgZGVzY3JpcHRpb24sIG1haW4sIHR5cGVzLCBzY3JpcHRzLCByZXBvc2l0b3J5LCBrZXl3b3JkcywgYXV0aG9yLCBsaWNlbnNlLCBidWdzLCBob21lcGFnZSwgZGVwZW5kZW5jaWVzLCBkZXZEZXBlbmRlbmNpZXMsIGRlZmF1bHQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUpIHtcblxubW9kdWxlLmV4cG9ydHMgPSBKU09OLnBhcnNlKFwie1xcXCJuYW1lXFxcIjpcXFwiY29zLWpzLXNkay12NVxcXCIsXFxcInZlcnNpb25cXFwiOlxcXCIxLjQuMTBcXFwiLFxcXCJkZXNjcmlwdGlvblxcXCI6XFxcIkphdmFTY3JpcHQgU0RLIGZvciBb6IW+6K6v5LqR5a+56LGh5a2Y5YKoXShodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL3Byb2R1Y3QvY29zKVxcXCIsXFxcIm1haW5cXFwiOlxcXCJkaXN0L2Nvcy1qcy1zZGstdjUuanNcXFwiLFxcXCJ0eXBlc1xcXCI6XFxcImluZGV4LmQudHNcXFwiLFxcXCJzY3JpcHRzXFxcIjp7XFxcInNlcnZlclxcXCI6XFxcIm5vZGUgc2VydmVyL3N0cy5qc1xcXCIsXFxcImRldlxcXCI6XFxcImNyb3NzLWVudiBOT0RFX0VOVj1kZXZlbG9wbWVudCB3ZWJwYWNrIC13IC0tbW9kZT1kZXZlbG9wbWVudFxcXCIsXFxcImJ1aWxkXFxcIjpcXFwiY3Jvc3MtZW52IE5PREVfRU5WPXByb2R1Y3Rpb24gd2VicGFjayAtLW1vZGU9cHJvZHVjdGlvblxcXCIsXFxcImNvcy1hdXRoLm1pbi5qc1xcXCI6XFxcInVnbGlmeWpzIC4vZGVtby9jb21tb24vY29zLWF1dGguanMgLW8gLi9kZW1vL2NvbW1vbi9jb3MtYXV0aC5taW4uanMgLWMgLW1cXFwifSxcXFwicmVwb3NpdG9yeVxcXCI6e1xcXCJ0eXBlXFxcIjpcXFwiZ2l0XFxcIixcXFwidXJsXFxcIjpcXFwiZ2l0K2h0dHBzOi8vZ2l0aHViLmNvbS90ZW5jZW50eXVuL2Nvcy1qcy1zZGstdjUuZ2l0XFxcIn0sXFxcImtleXdvcmRzXFxcIjpbXSxcXFwiYXV0aG9yXFxcIjpcXFwiY2Fyc29ueHVcXFwiLFxcXCJsaWNlbnNlXFxcIjpcXFwiSVNDXFxcIixcXFwiYnVnc1xcXCI6e1xcXCJ1cmxcXFwiOlxcXCJodHRwczovL2dpdGh1Yi5jb20vdGVuY2VudHl1bi9jb3MtanMtc2RrLXY1L2lzc3Vlc1xcXCJ9LFxcXCJob21lcGFnZVxcXCI6XFxcImh0dHBzOi8vZ2l0aHViLmNvbS90ZW5jZW50eXVuL2Nvcy1qcy1zZGstdjUjcmVhZG1lXFxcIixcXFwiZGVwZW5kZW5jaWVzXFxcIjp7XFxcIkB4bWxkb20veG1sZG9tXFxcIjpcXFwiXjAuOC4yXFxcIn0sXFxcImRldkRlcGVuZGVuY2llc1xcXCI6e1xcXCJAYmFiZWwvY29yZVxcXCI6XFxcIjcuMTcuOVxcXCIsXFxcIkBiYWJlbC9wbHVnaW4tdHJhbnNmb3JtLXJ1bnRpbWVcXFwiOlxcXCI3LjE4LjEwXFxcIixcXFwiQGJhYmVsL3ByZXNldC1lbnZcXFwiOlxcXCI3LjE2LjExXFxcIixcXFwiYmFiZWwtbG9hZGVyXFxcIjpcXFwiOC4yLjVcXFwiLFxcXCJib2R5LXBhcnNlclxcXCI6XFxcIl4xLjE4LjNcXFwiLFxcXCJjcm9zcy1lbnZcXFwiOlxcXCJeNS4yLjBcXFwiLFxcXCJleHByZXNzXFxcIjpcXFwiXjQuMTYuNFxcXCIsXFxcInFjbG91ZC1jb3Mtc3RzXFxcIjpcXFwiXjMuMC4yXFxcIixcXFwicmVxdWVzdFxcXCI6XFxcIl4yLjg3LjBcXFwiLFxcXCJ0ZXJzZXItd2VicGFjay1wbHVnaW5cXFwiOlxcXCI0LjIuM1xcXCIsXFxcIndlYnBhY2tcXFwiOlxcXCI0LjQ2LjBcXFwiLFxcXCJ3ZWJwYWNrLWNsaVxcXCI6XFxcIjQuMTAuMFxcXCJ9fVwiKTtcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvYWR2YW5jZS5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vc3JjL2FkdmFuY2UuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgX3R5cGVvZiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIEBiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mICovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YuanNcIik7XG5cbnZhciBzZXNzaW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9zZXNzaW9uICovIFwiLi9zcmMvc2Vzc2lvbi5qc1wiKTtcblxudmFyIEFzeW5jID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9hc3luYyAqLyBcIi4vc3JjL2FzeW5jLmpzXCIpO1xuXG52YXIgRXZlbnRQcm94eSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vZXZlbnQgKi8gXCIuL3NyYy9ldmVudC5qc1wiKS5FdmVudFByb3h5O1xuXG52YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbCAqLyBcIi4vc3JjL3V0aWwuanNcIik7XG5cbnZhciBUcmFja2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi90cmFja2VyICovIFwiLi9zcmMvdHJhY2tlci5qc1wiKTsgLy8g5paH5Lu25YiG5Z2X5LiK5Lyg5YWo6L+H56iL77yM5pq06Zyy55qE5YiG5Z2X5LiK5Lyg5o6l5Y+jXG5cblxuZnVuY3Rpb24gc2xpY2VVcGxvYWRGaWxlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZXAgPSBuZXcgRXZlbnRQcm94eSgpO1xuICB2YXIgVGFza0lkID0gcGFyYW1zLlRhc2tJZDtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIEJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIENodW5rU2l6ZSA9IHBhcmFtcy5DaHVua1NpemUgfHwgcGFyYW1zLlNsaWNlU2l6ZSB8fCBzZWxmLm9wdGlvbnMuQ2h1bmtTaXplO1xuICB2YXIgQXN5bmNMaW1pdCA9IHBhcmFtcy5Bc3luY0xpbWl0O1xuICB2YXIgU3RvcmFnZUNsYXNzID0gcGFyYW1zLlN0b3JhZ2VDbGFzcztcbiAgdmFyIFNlcnZlclNpZGVFbmNyeXB0aW9uID0gcGFyYW1zLlNlcnZlclNpZGVFbmNyeXB0aW9uO1xuICB2YXIgRmlsZVNpemU7XG4gIHZhciBvblByb2dyZXNzO1xuICB2YXIgb25IYXNoUHJvZ3Jlc3MgPSBwYXJhbXMub25IYXNoUHJvZ3Jlc3M7XG4gIHZhciB0cmFja2VyID0gcGFyYW1zLnRyYWNrZXI7XG4gIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgIGNodW5rU2l6ZTogQ2h1bmtTaXplXG4gIH0pOyAvLyDkuIrkvKDov4fnqIvkuK3lh7rnjrDplJnor6/vvIzov5Tlm57plJnor69cblxuICBlcC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICBlcnIuVXBsb2FkSWQgPSBwYXJhbXMuVXBsb2FkRGF0YS5VcGxvYWRJZCB8fCAnJztcbiAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgfSk7IC8vIOS4iuS8oOWIhuWdl+WujOaIkO+8jOW8gOWniyB1cGxvYWRTbGljZUNvbXBsZXRlIOaTjeS9nFxuXG4gIGVwLm9uKCd1cGxvYWRfY29tcGxldGUnLCBmdW5jdGlvbiAoVXBsb2FkQ29tcGxldGVEYXRhKSB7XG4gICAgdmFyIF9VcGxvYWRDb21wbGV0ZURhdGEgPSB1dGlsLmV4dGVuZCh7XG4gICAgICBVcGxvYWRJZDogcGFyYW1zLlVwbG9hZERhdGEuVXBsb2FkSWQgfHwgJydcbiAgICB9LCBVcGxvYWRDb21wbGV0ZURhdGEpO1xuXG4gICAgY2FsbGJhY2sobnVsbCwgX1VwbG9hZENvbXBsZXRlRGF0YSk7XG4gIH0pOyAvLyDkuIrkvKDliIblnZflrozmiJDvvIzlvIDlp4sgdXBsb2FkU2xpY2VDb21wbGV0ZSDmk43kvZxcblxuICBlcC5vbigndXBsb2FkX3NsaWNlX2NvbXBsZXRlJywgZnVuY3Rpb24gKFVwbG9hZERhdGEpIHtcbiAgICB2YXIgbWV0YUhlYWRlcnMgPSB7fTtcbiAgICB1dGlsLmVhY2gocGFyYW1zLkhlYWRlcnMsIGZ1bmN0aW9uICh2YWwsIGspIHtcbiAgICAgIHZhciBzaG9ydEtleSA9IGsudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChzaG9ydEtleS5pbmRleE9mKCd4LWNvcy1tZXRhLScpID09PSAwIHx8IHNob3J0S2V5ID09PSAncGljLW9wZXJhdGlvbnMnKSBtZXRhSGVhZGVyc1trXSA9IHZhbDtcbiAgICB9KTtcbiAgICB1cGxvYWRTbGljZUNvbXBsZXRlLmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgVXBsb2FkSWQ6IFVwbG9hZERhdGEuVXBsb2FkSWQsXG4gICAgICBTbGljZUxpc3Q6IFVwbG9hZERhdGEuU2xpY2VMaXN0LFxuICAgICAgSGVhZGVyczogbWV0YUhlYWRlcnMsXG4gICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIHNlc3Npb24ucmVtb3ZlVXNpbmcoVXBsb2FkRGF0YS5VcGxvYWRJZCk7XG5cbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgb25Qcm9ncmVzcyhudWxsLCB0cnVlKTtcbiAgICAgICAgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIH1cblxuICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZC5jYWxsKHNlbGYsIFVwbG9hZERhdGEuVXBsb2FkSWQpO1xuICAgICAgb25Qcm9ncmVzcyh7XG4gICAgICAgIGxvYWRlZDogRmlsZVNpemUsXG4gICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgfSwgdHJ1ZSk7XG4gICAgICBlcC5lbWl0KCd1cGxvYWRfY29tcGxldGUnLCBkYXRhKTtcbiAgICB9KTtcbiAgfSk7IC8vIOiOt+WPliBVcGxvYWRJZCDlrozmiJDvvIzlvIDlp4vkuIrkvKDmr4/kuKrliIbniYdcblxuICBlcC5vbignZ2V0X3VwbG9hZF9kYXRhX2ZpbmlzaCcsIGZ1bmN0aW9uIChVcGxvYWREYXRhKSB7XG4gICAgLy8g5aSE55CGIFVwbG9hZElkIOe8k+WtmFxuICAgIHZhciB1dWlkID0gc2Vzc2lvbi5nZXRGaWxlSWQoQm9keSwgcGFyYW1zLkNodW5rU2l6ZSwgQnVja2V0LCBLZXkpO1xuICAgIHV1aWQgJiYgc2Vzc2lvbi5zYXZlVXBsb2FkSWQuY2FsbChzZWxmLCB1dWlkLCBVcGxvYWREYXRhLlVwbG9hZElkLCBzZWxmLm9wdGlvbnMuVXBsb2FkSWRDYWNoZUxpbWl0KTsgLy8g57yT5a2YIFVwbG9hZElkXG5cbiAgICBzZXNzaW9uLnNldFVzaW5nKFVwbG9hZERhdGEuVXBsb2FkSWQpOyAvLyDmoIforrAgVXBsb2FkSWQg5Li65q2j5Zyo5L2/55SoXG4gICAgLy8g6I635Y+WIFVwbG9hZElkXG5cbiAgICBvblByb2dyZXNzKG51bGwsIHRydWUpOyAvLyDku7vliqHnirbmgIHlvIDlp4sgdXBsb2FkaW5nXG5cbiAgICB1cGxvYWRTbGljZUxpc3QuY2FsbChzZWxmLCB7XG4gICAgICBUYXNrSWQ6IFRhc2tJZCxcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEtleSxcbiAgICAgIEJvZHk6IEJvZHksXG4gICAgICBGaWxlU2l6ZTogRmlsZVNpemUsXG4gICAgICBTbGljZVNpemU6IENodW5rU2l6ZSxcbiAgICAgIEFzeW5jTGltaXQ6IEFzeW5jTGltaXQsXG4gICAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbjogU2VydmVyU2lkZUVuY3J5cHRpb24sXG4gICAgICBVcGxvYWREYXRhOiBVcGxvYWREYXRhLFxuICAgICAgSGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICBvblByb2dyZXNzOiBvblByb2dyZXNzLFxuICAgICAgdHJhY2tlcjogdHJhY2tlclxuICAgIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG5cbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgb25Qcm9ncmVzcyhudWxsLCB0cnVlKTtcbiAgICAgICAgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIH1cblxuICAgICAgZXAuZW1pdCgndXBsb2FkX3NsaWNlX2NvbXBsZXRlJywgZGF0YSk7XG4gICAgfSk7XG4gIH0pOyAvLyDlvIDlp4vojrflj5bmlofku7YgVXBsb2FkSWTvvIzph4zpnaLkvJrop4bmg4XlhrXorqHnrpcgRVRhZ++8jOW5tuavlOWvue+8jOS/neivgeaWh+S7tuS4gOiHtOaAp++8jOS5n+S8mOWMluS4iuS8oFxuXG4gIGVwLm9uKCdnZXRfZmlsZV9zaXplX2ZpbmlzaCcsIGZ1bmN0aW9uICgpIHtcbiAgICBvblByb2dyZXNzID0gdXRpbC50aHJvdHRsZU9uUHJvZ3Jlc3MuY2FsbChzZWxmLCBGaWxlU2l6ZSwgcGFyYW1zLm9uUHJvZ3Jlc3MpO1xuXG4gICAgaWYgKHBhcmFtcy5VcGxvYWREYXRhLlVwbG9hZElkKSB7XG4gICAgICBlcC5lbWl0KCdnZXRfdXBsb2FkX2RhdGFfZmluaXNoJywgcGFyYW1zLlVwbG9hZERhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3BhcmFtcyA9IHV0aWwuZXh0ZW5kKHtcbiAgICAgICAgVGFza0lkOiBUYXNrSWQsXG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIEhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgICAgICBTdG9yYWdlQ2xhc3M6IFN0b3JhZ2VDbGFzcyxcbiAgICAgICAgQm9keTogQm9keSxcbiAgICAgICAgRmlsZVNpemU6IEZpbGVTaXplLFxuICAgICAgICBTbGljZVNpemU6IENodW5rU2l6ZSxcbiAgICAgICAgb25IYXNoUHJvZ3Jlc3M6IG9uSGFzaFByb2dyZXNzLFxuICAgICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgICB9LCBwYXJhbXMpO1xuXG4gICAgICBnZXRVcGxvYWRJZEFuZFBhcnRMaXN0LmNhbGwoc2VsZiwgX3BhcmFtcywgZnVuY3Rpb24gKGVyciwgVXBsb2FkRGF0YSkge1xuICAgICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gZXAuZW1pdCgnZXJyb3InLCBlcnIpO1xuICAgICAgICBwYXJhbXMuVXBsb2FkRGF0YS5VcGxvYWRJZCA9IFVwbG9hZERhdGEuVXBsb2FkSWQ7XG4gICAgICAgIHBhcmFtcy5VcGxvYWREYXRhLlBhcnRMaXN0ID0gVXBsb2FkRGF0YS5QYXJ0TGlzdDtcbiAgICAgICAgZXAuZW1pdCgnZ2V0X3VwbG9hZF9kYXRhX2ZpbmlzaCcsIHBhcmFtcy5VcGxvYWREYXRhKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7IC8vIOiOt+WPluS4iuS8oOaWh+S7tuWkp+Wwj1xuXG4gIEZpbGVTaXplID0gcGFyYW1zLkNvbnRlbnRMZW5ndGg7XG4gIGRlbGV0ZSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgIXBhcmFtcy5IZWFkZXJzICYmIChwYXJhbXMuSGVhZGVycyA9IHt9KTtcbiAgdXRpbC5lYWNoKHBhcmFtcy5IZWFkZXJzLCBmdW5jdGlvbiAoaXRlbSwga2V5KSB7XG4gICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSAnY29udGVudC1sZW5ndGgnKSB7XG4gICAgICBkZWxldGUgcGFyYW1zLkhlYWRlcnNba2V5XTtcbiAgICB9XG4gIH0pOyAvLyDmjqfliLbliIbniYflpKflsI9cblxuICAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBTSVpFID0gWzEsIDIsIDQsIDgsIDE2LCAzMiwgNjQsIDEyOCwgMjU2LCA1MTIsIDEwMjQsIDEwMjQgKiAyLCAxMDI0ICogNCwgMTAyNCAqIDVdO1xuICAgIHZhciBBdXRvQ2h1bmtTaXplID0gMTAyNCAqIDEwMjQ7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IFNJWkUubGVuZ3RoOyBpKyspIHtcbiAgICAgIEF1dG9DaHVua1NpemUgPSBTSVpFW2ldICogMTAyNCAqIDEwMjQ7XG4gICAgICBpZiAoRmlsZVNpemUgLyBBdXRvQ2h1bmtTaXplIDw9IHNlbGYub3B0aW9ucy5NYXhQYXJ0TnVtYmVyKSBicmVhaztcbiAgICB9XG5cbiAgICBwYXJhbXMuQ2h1bmtTaXplID0gcGFyYW1zLlNsaWNlU2l6ZSA9IENodW5rU2l6ZSA9IE1hdGgubWF4KENodW5rU2l6ZSwgQXV0b0NodW5rU2l6ZSk7XG4gIH0pKCk7IC8vIOW8gOWni+S4iuS8oFxuXG5cbiAgaWYgKEZpbGVTaXplID09PSAwKSB7XG4gICAgcGFyYW1zLkJvZHkgPSAnJztcbiAgICBwYXJhbXMuQ29udGVudExlbmd0aCA9IDA7XG4gICAgcGFyYW1zLlNraXBUYXNrID0gdHJ1ZTtcbiAgICBzZWxmLnB1dE9iamVjdChwYXJhbXMsIGNhbGxiYWNrKTtcbiAgfSBlbHNlIHtcbiAgICBlcC5lbWl0KCdnZXRfZmlsZV9zaXplX2ZpbmlzaCcpO1xuICB9XG59IC8vIOiOt+WPluS4iuS8oOS7u+WKoeeahCBVcGxvYWRJZFxuXG5cbmZ1bmN0aW9uIGdldFVwbG9hZElkQW5kUGFydExpc3QocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgVGFza0lkID0gcGFyYW1zLlRhc2tJZDtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIFN0b3JhZ2VDbGFzcyA9IHBhcmFtcy5TdG9yYWdlQ2xhc3M7XG4gIHZhciBzZWxmID0gdGhpczsgLy8g6K6h566XIEVUYWdcblxuICB2YXIgRVRhZ01hcCA9IHt9O1xuICB2YXIgRmlsZVNpemUgPSBwYXJhbXMuRmlsZVNpemU7XG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgU2xpY2VDb3VudCA9IE1hdGguY2VpbChGaWxlU2l6ZSAvIFNsaWNlU2l6ZSk7XG4gIHZhciBGaW5pc2hTbGljZUNvdW50ID0gMDtcbiAgdmFyIEZpbmlzaFNpemUgPSAwO1xuICB2YXIgb25IYXNoUHJvZ3Jlc3MgPSB1dGlsLnRocm90dGxlT25Qcm9ncmVzcy5jYWxsKHNlbGYsIEZpbGVTaXplLCBwYXJhbXMub25IYXNoUHJvZ3Jlc3MpO1xuXG4gIHZhciBnZXRDaHVua0VUYWcgPSBmdW5jdGlvbiBnZXRDaHVua0VUYWcoUGFydE51bWJlciwgY2FsbGJhY2spIHtcbiAgICB2YXIgc3RhcnQgPSBTbGljZVNpemUgKiAoUGFydE51bWJlciAtIDEpO1xuICAgIHZhciBlbmQgPSBNYXRoLm1pbihzdGFydCArIFNsaWNlU2l6ZSwgRmlsZVNpemUpO1xuICAgIHZhciBDaHVua1NpemUgPSBlbmQgLSBzdGFydDtcblxuICAgIGlmIChFVGFnTWFwW1BhcnROdW1iZXJdKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIFBhcnROdW1iZXI6IFBhcnROdW1iZXIsXG4gICAgICAgIEVUYWc6IEVUYWdNYXBbUGFydE51bWJlcl0sXG4gICAgICAgIFNpemU6IENodW5rU2l6ZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHV0aWwuZmlsZVNsaWNlKHBhcmFtcy5Cb2R5LCBzdGFydCwgZW5kLCBmYWxzZSwgZnVuY3Rpb24gKGNodW5rSXRlbSkge1xuICAgICAgICB1dGlsLmdldEZpbGVNZDUoY2h1bmtJdGVtLCBmdW5jdGlvbiAoZXJyLCBtZDUpIHtcbiAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihlcnIpKTtcbiAgICAgICAgICB2YXIgRVRhZyA9ICdcIicgKyBtZDUgKyAnXCInO1xuICAgICAgICAgIEVUYWdNYXBbUGFydE51bWJlcl0gPSBFVGFnO1xuICAgICAgICAgIEZpbmlzaFNsaWNlQ291bnQgKz0gMTtcbiAgICAgICAgICBGaW5pc2hTaXplICs9IENodW5rU2l6ZTtcbiAgICAgICAgICBvbkhhc2hQcm9ncmVzcyh7XG4gICAgICAgICAgICBsb2FkZWQ6IEZpbmlzaFNpemUsXG4gICAgICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgICBQYXJ0TnVtYmVyOiBQYXJ0TnVtYmVyLFxuICAgICAgICAgICAgRVRhZzogRVRhZyxcbiAgICAgICAgICAgIFNpemU6IENodW5rU2l6ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTsgLy8g6YCa6L+H5ZKM5paH5Lu255qEIG1kNSDlr7nmr5TvvIzliKTmlq0gVXBsb2FkSWQg5piv5ZCm5Y+v55SoXG5cblxuICB2YXIgaXNBdmFpbGFibGVVcGxvYWRMaXN0ID0gZnVuY3Rpb24gaXNBdmFpbGFibGVVcGxvYWRMaXN0KFBhcnRMaXN0LCBjYWxsYmFjaykge1xuICAgIHZhciBQYXJ0Q291bnQgPSBQYXJ0TGlzdC5sZW5ndGg7IC8vIOWmguaenOayoeacieWIhueJh++8jOmAmui/h1xuXG4gICAgaWYgKFBhcnRDb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHRydWUpO1xuICAgIH0gLy8g5qOA5p+l5YiG54mH5pWw6YePXG5cblxuICAgIGlmIChQYXJ0Q291bnQgPiBTbGljZUNvdW50KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgZmFsc2UpO1xuICAgIH0gLy8g5qOA5p+l5YiG54mH5aSn5bCPXG5cblxuICAgIGlmIChQYXJ0Q291bnQgPiAxKSB7XG4gICAgICB2YXIgUGFydFNsaWNlU2l6ZSA9IE1hdGgubWF4KFBhcnRMaXN0WzBdLlNpemUsIFBhcnRMaXN0WzFdLlNpemUpO1xuXG4gICAgICBpZiAoUGFydFNsaWNlU2l6ZSAhPT0gU2xpY2VTaXplKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBmYWxzZSk7XG4gICAgICB9XG4gICAgfSAvLyDpgJDkuKrliIbniYforqHnrpflubbmo4Dmn6UgRVRhZyDmmK/lkKbkuIDoh7RcblxuXG4gICAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KGluZGV4KSB7XG4gICAgICBpZiAoaW5kZXggPCBQYXJ0Q291bnQpIHtcbiAgICAgICAgdmFyIFBhcnQgPSBQYXJ0TGlzdFtpbmRleF07XG4gICAgICAgIGdldENodW5rRVRhZyhQYXJ0LlBhcnROdW1iZXIsIGZ1bmN0aW9uIChlcnIsIGNodW5rKSB7XG4gICAgICAgICAgaWYgKGNodW5rICYmIGNodW5rLkVUYWcgPT09IFBhcnQuRVRhZyAmJiBjaHVuay5TaXplID09PSBQYXJ0LlNpemUpIHtcbiAgICAgICAgICAgIG5leHQoaW5kZXggKyAxKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbmV4dCgwKTtcbiAgfTtcblxuICB2YXIgZXAgPSBuZXcgRXZlbnRQcm94eSgpO1xuICBlcC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyRGF0YSkge1xuICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgcmV0dXJuIGNhbGxiYWNrKGVyckRhdGEpO1xuICB9KTsgLy8g5a2Y5ZyoIFVwbG9hZElkXG5cbiAgZXAub24oJ3VwbG9hZF9pZF9hdmFpbGFibGUnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIC8vIOi9rOaNouaIkCBtYXBcbiAgICB2YXIgbWFwID0ge307XG4gICAgdmFyIGxpc3QgPSBbXTtcbiAgICB1dGlsLmVhY2goVXBsb2FkRGF0YS5QYXJ0TGlzdCwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIG1hcFtpdGVtLlBhcnROdW1iZXJdID0gaXRlbTtcbiAgICB9KTtcblxuICAgIGZvciAodmFyIFBhcnROdW1iZXIgPSAxOyBQYXJ0TnVtYmVyIDw9IFNsaWNlQ291bnQ7IFBhcnROdW1iZXIrKykge1xuICAgICAgdmFyIGl0ZW0gPSBtYXBbUGFydE51bWJlcl07XG5cbiAgICAgIGlmIChpdGVtKSB7XG4gICAgICAgIGl0ZW0uUGFydE51bWJlciA9IFBhcnROdW1iZXI7XG4gICAgICAgIGl0ZW0uVXBsb2FkZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbSA9IHtcbiAgICAgICAgICBQYXJ0TnVtYmVyOiBQYXJ0TnVtYmVyLFxuICAgICAgICAgIEVUYWc6IG51bGwsXG4gICAgICAgICAgVXBsb2FkZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGxpc3QucHVzaChpdGVtKTtcbiAgICB9XG5cbiAgICBVcGxvYWREYXRhLlBhcnRMaXN0ID0gbGlzdDtcbiAgICBjYWxsYmFjayhudWxsLCBVcGxvYWREYXRhKTtcbiAgfSk7IC8vIOS4jeWtmOWcqCBVcGxvYWRJZCwg5Yid5aeL5YyW55Sf5oiQIFVwbG9hZElkXG5cbiAgZXAub24oJ25vX2F2YWlsYWJsZV91cGxvYWRfaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcblxuICAgIHZhciBfcGFyYW1zID0gdXRpbC5leHRlbmQoe1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgUXVlcnk6IHV0aWwuY2xvbmUocGFyYW1zLlF1ZXJ5KSxcbiAgICAgIFN0b3JhZ2VDbGFzczogU3RvcmFnZUNsYXNzLFxuICAgICAgQm9keTogcGFyYW1zLkJvZHksXG4gICAgICBjYWxsZWRCeVNkazogJ3NsaWNlVXBsb2FkRmlsZScsXG4gICAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICAgIH0sIHBhcmFtcyk7XG5cbiAgICB2YXIgaGVhZGVycyA9IHV0aWwuY2xvbmUocGFyYW1zLkhlYWRlcnMpO1xuICAgIGRlbGV0ZSBoZWFkZXJzWyd4LWNvcy1taW1lLWxpbWl0J107XG4gICAgX3BhcmFtcy5IZWFkZXJzID0gaGVhZGVycztcbiAgICBzZWxmLm11bHRpcGFydEluaXQoX3BhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIGlmIChlcnIpIHJldHVybiBlcC5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICB2YXIgVXBsb2FkSWQgPSBkYXRhLlVwbG9hZElkO1xuXG4gICAgICBpZiAoIVVwbG9hZElkKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbm8gc3VjaCB1cGxvYWQgaWQnKSkpO1xuICAgICAgfVxuXG4gICAgICBlcC5lbWl0KCd1cGxvYWRfaWRfYXZhaWxhYmxlJywge1xuICAgICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICAgIFBhcnRMaXN0OiBbXVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pOyAvLyDlpoLmnpzlt7LlrZjlnKggVXBsb2FkSWTvvIzmib7kuIDkuKrlj6/ku6XnlKjnmoQgVXBsb2FkSWRcblxuICBlcC5vbignaGFzX2FuZF9jaGVja191cGxvYWRfaWQnLCBmdW5jdGlvbiAoVXBsb2FkSWRMaXN0KSB7XG4gICAgLy8g5Liy6KGM5Zyw77yM5om+5LiA5Liq5YaF5a655LiA6Ie055qEIFVwbG9hZElkXG4gICAgVXBsb2FkSWRMaXN0ID0gVXBsb2FkSWRMaXN0LnJldmVyc2UoKTtcbiAgICBBc3luYy5lYWNoTGltaXQoVXBsb2FkSWRMaXN0LCAxLCBmdW5jdGlvbiAoVXBsb2FkSWQsIGFzeW5jQ2FsbGJhY2spIHtcbiAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47IC8vIOWmguaenOato+WcqOS4iuS8oO+8jOi3s+i/h1xuXG4gICAgICBpZiAoc2Vzc2lvbi51c2luZ1tVcGxvYWRJZF0pIHtcbiAgICAgICAgYXN5bmNDYWxsYmFjaygpOyAvLyDmo4Dmn6XkuIvkuIDkuKogVXBsb2FkSWRcblxuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIOWIpOaWrSBVcGxvYWRJZCDmmK/lkKblj6/nlKhcblxuXG4gICAgICB3aG9sZU11bHRpcGFydExpc3RQYXJ0LmNhbGwoc2VsZiwge1xuICAgICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICAgIEtleTogS2V5LFxuICAgICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBQYXJ0TGlzdERhdGEpIHtcbiAgICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcblxuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWRJZCk7XG4gICAgICAgICAgcmV0dXJuIGVwLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBQYXJ0TGlzdCA9IFBhcnRMaXN0RGF0YS5QYXJ0TGlzdDtcbiAgICAgICAgUGFydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIGl0ZW0uUGFydE51bWJlciAqPSAxO1xuICAgICAgICAgIGl0ZW0uU2l6ZSAqPSAxO1xuICAgICAgICAgIGl0ZW0uRVRhZyA9IGl0ZW0uRVRhZyB8fCAnJztcbiAgICAgICAgfSk7XG4gICAgICAgIGlzQXZhaWxhYmxlVXBsb2FkTGlzdChQYXJ0TGlzdCwgZnVuY3Rpb24gKGVyciwgaXNBdmFpbGFibGUpIHtcbiAgICAgICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuICAgICAgICAgIGlmIChlcnIpIHJldHVybiBlcC5lbWl0KCdlcnJvcicsIGVycik7XG5cbiAgICAgICAgICBpZiAoaXNBdmFpbGFibGUpIHtcbiAgICAgICAgICAgIGFzeW5jQ2FsbGJhY2soe1xuICAgICAgICAgICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICAgICAgICAgIFBhcnRMaXN0OiBQYXJ0TGlzdFxuICAgICAgICAgICAgfSk7IC8vIOmprOS4iue7k+adn1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhc3luY0NhbGxiYWNrKCk7IC8vIOajgOafpeS4i+S4gOS4qiBVcGxvYWRJZFxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LCBmdW5jdGlvbiAoQXZhaWxhYmxlVXBsb2FkRGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIG9uSGFzaFByb2dyZXNzKG51bGwsIHRydWUpO1xuXG4gICAgICBpZiAoQXZhaWxhYmxlVXBsb2FkRGF0YSAmJiBBdmFpbGFibGVVcGxvYWREYXRhLlVwbG9hZElkKSB7XG4gICAgICAgIGVwLmVtaXQoJ3VwbG9hZF9pZF9hdmFpbGFibGUnLCBBdmFpbGFibGVVcGxvYWREYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVwLmVtaXQoJ25vX2F2YWlsYWJsZV91cGxvYWRfaWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7IC8vIOWcqOacrOWcsOe8k+WtmOaJvuWPr+eUqOeahCBVcGxvYWRJZFxuXG4gIGVwLm9uKCdzZWVrX2xvY2FsX2F2YWlsX3VwbG9hZF9pZCcsIGZ1bmN0aW9uIChSZW1vdGVVcGxvYWRJZExpc3QpIHtcbiAgICAvLyDlnKjmnKzlnLDmib7lj6/nlKjnmoQgVXBsb2FkSWRcbiAgICB2YXIgdXVpZCA9IHNlc3Npb24uZ2V0RmlsZUlkKHBhcmFtcy5Cb2R5LCBwYXJhbXMuQ2h1bmtTaXplLCBCdWNrZXQsIEtleSk7XG4gICAgdmFyIExvY2FsVXBsb2FkSWRMaXN0ID0gc2Vzc2lvbi5nZXRVcGxvYWRJZExpc3QuY2FsbChzZWxmLCB1dWlkKTtcblxuICAgIGlmICghdXVpZCB8fCAhTG9jYWxVcGxvYWRJZExpc3QpIHtcbiAgICAgIGVwLmVtaXQoJ2hhc19hbmRfY2hlY2tfdXBsb2FkX2lkJywgUmVtb3RlVXBsb2FkSWRMaXN0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQoaW5kZXgpIHtcbiAgICAgIC8vIOWmguaenOacrOWcsOaJvuS4jeWIsOWPr+eUqCBVcGxvYWRJZO+8jOWGjeS4gOS4quS4qumBjeWOhuagoemqjOi/nOerr1xuICAgICAgaWYgKGluZGV4ID49IExvY2FsVXBsb2FkSWRMaXN0Lmxlbmd0aCkge1xuICAgICAgICBlcC5lbWl0KCdoYXNfYW5kX2NoZWNrX3VwbG9hZF9pZCcsIFJlbW90ZVVwbG9hZElkTGlzdCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIFVwbG9hZElkID0gTG9jYWxVcGxvYWRJZExpc3RbaW5kZXhdOyAvLyDlpoLmnpzkuI3lnKjov5znq68gVXBsb2FkSWQg5YiX6KGo6YeM77yM6Lez6L+H5bm25Yig6ZmkXG5cbiAgICAgIGlmICghdXRpbC5pc0luQXJyYXkoUmVtb3RlVXBsb2FkSWRMaXN0LCBVcGxvYWRJZCkpIHtcbiAgICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZC5jYWxsKHNlbGYsIFVwbG9hZElkKTtcbiAgICAgICAgbmV4dChpbmRleCArIDEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IC8vIOWmguaenOato+WcqOS4iuS8oO+8jOi3s+i/h1xuXG5cbiAgICAgIGlmIChzZXNzaW9uLnVzaW5nW1VwbG9hZElkXSkge1xuICAgICAgICBuZXh0KGluZGV4ICsgMSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH0gLy8g5Yik5patIFVwbG9hZElkIOaYr+WQpuWtmOWcqOe6v+S4ilxuXG5cbiAgICAgIHdob2xlTXVsdGlwYXJ0TGlzdFBhcnQuY2FsbChzZWxmLCB7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgICAgdHJhY2tlcjogcGFyYW1zLnRyYWNrZXJcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIFBhcnRMaXN0RGF0YSkge1xuICAgICAgICBpZiAoIXNlbGYuX2lzUnVubmluZ1Rhc2soVGFza0lkKSkgcmV0dXJuO1xuXG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAvLyDlpoLmnpwgVXBsb2FkSWQg6I635Y+W5Lya5Ye66ZSZ77yM6Lez6L+H5bm25Yig6ZmkXG4gICAgICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZC5jYWxsKHNlbGYsIFVwbG9hZElkKTtcbiAgICAgICAgICBuZXh0KGluZGV4ICsgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8g5om+5Yiw5Y+v55SoIFVwbG9hZElkXG4gICAgICAgICAgZXAuZW1pdCgndXBsb2FkX2lkX2F2YWlsYWJsZScsIHtcbiAgICAgICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgICAgICAgIFBhcnRMaXN0OiBQYXJ0TGlzdERhdGEuUGFydExpc3RcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIG5leHQoMCk7XG4gIH0pOyAvLyDojrflj5bnur/kuIogVXBsb2FkSWQg5YiX6KGoXG5cbiAgZXAub24oJ2dldF9yZW1vdGVfdXBsb2FkX2lkX2xpc3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgLy8g6I635Y+W56ym5ZCI5p2h5Lu255qEIFVwbG9hZElkIOWIl+ihqO+8jOWboOS4uuWQjOS4gOS4quaWh+S7tuWPr+S7peacieWkmuS4quS4iuS8oOS7u+WKoeOAglxuICAgIHdob2xlTXVsdGlwYXJ0TGlzdC5jYWxsKHNlbGYsIHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEtleSxcbiAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIGlmIChlcnIpIHJldHVybiBlcC5lbWl0KCdlcnJvcicsIGVycik7IC8vIOaVtOeQhui/nOerryBVcGxvYWRJZCDliJfooahcblxuICAgICAgdmFyIFJlbW90ZVVwbG9hZElkTGlzdCA9IHV0aWwuZmlsdGVyKGRhdGEuVXBsb2FkTGlzdCwgZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0uS2V5ID09PSBLZXkgJiYgKCFTdG9yYWdlQ2xhc3MgfHwgaXRlbS5TdG9yYWdlQ2xhc3MudG9VcHBlckNhc2UoKSA9PT0gU3RvcmFnZUNsYXNzLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgfSkucmV2ZXJzZSgpLm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICByZXR1cm4gaXRlbS5VcGxvYWRJZCB8fCBpdGVtLlVwbG9hZElEO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChSZW1vdGVVcGxvYWRJZExpc3QubGVuZ3RoKSB7XG4gICAgICAgIGVwLmVtaXQoJ3NlZWtfbG9jYWxfYXZhaWxfdXBsb2FkX2lkJywgUmVtb3RlVXBsb2FkSWRMaXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIOi/nOerr+ayoeaciSBVcGxvYWRJZO+8jOa4heeQhue8k+WtmOeahCBVcGxvYWRJZFxuICAgICAgICB2YXIgdXVpZCA9IHNlc3Npb24uZ2V0RmlsZUlkKHBhcmFtcy5Cb2R5LCBwYXJhbXMuQ2h1bmtTaXplLCBCdWNrZXQsIEtleSksXG4gICAgICAgICAgICBMb2NhbFVwbG9hZElkTGlzdDtcblxuICAgICAgICBpZiAodXVpZCAmJiAoTG9jYWxVcGxvYWRJZExpc3QgPSBzZXNzaW9uLmdldFVwbG9hZElkTGlzdC5jYWxsKHNlbGYsIHV1aWQpKSkge1xuICAgICAgICAgIHV0aWwuZWFjaChMb2NhbFVwbG9hZElkTGlzdCwgZnVuY3Rpb24gKFVwbG9hZElkKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnJlbW92ZVVwbG9hZElkLmNhbGwoc2VsZiwgVXBsb2FkSWQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZXAuZW1pdCgnbm9fYXZhaWxhYmxlX3VwbG9hZF9pZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTsgLy8g5byA5aeL5om+5Y+v55SoIFVwbG9hZElkXG5cbiAgZXAuZW1pdCgnZ2V0X3JlbW90ZV91cGxvYWRfaWRfbGlzdCcpO1xufSAvLyDojrflj5bnrKblkIjmnaHku7bnmoTlhajpg6jkuIrkvKDku7vliqEgKOadoeS7tuWMheaLrCBCdWNrZXQsIFJlZ2lvbiwgUHJlZml4KVxuXG5cbmZ1bmN0aW9uIHdob2xlTXVsdGlwYXJ0TGlzdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIFVwbG9hZExpc3QgPSBbXTtcbiAgdmFyIHNlbmRQYXJhbXMgPSB7XG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBQcmVmaXg6IHBhcmFtcy5LZXksXG4gICAgY2FsbGVkQnlTZGs6IHBhcmFtcy5jYWxsZWRCeVNkayB8fCAnc2xpY2VVcGxvYWRGaWxlJyxcbiAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICB9O1xuXG4gIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICBzZWxmLm11bHRpcGFydExpc3Qoc2VuZFBhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICBVcGxvYWRMaXN0LnB1c2guYXBwbHkoVXBsb2FkTGlzdCwgZGF0YS5VcGxvYWQgfHwgW10pO1xuXG4gICAgICBpZiAoZGF0YS5Jc1RydW5jYXRlZCA9PT0gJ3RydWUnKSB7XG4gICAgICAgIC8vIOWIl+ihqOS4jeWujOaVtFxuICAgICAgICBzZW5kUGFyYW1zLktleU1hcmtlciA9IGRhdGEuTmV4dEtleU1hcmtlcjtcbiAgICAgICAgc2VuZFBhcmFtcy5VcGxvYWRJZE1hcmtlciA9IGRhdGEuTmV4dFVwbG9hZElkTWFya2VyO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgVXBsb2FkTGlzdDogVXBsb2FkTGlzdFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBuZXh0KCk7XG59IC8vIOiOt+WPluaMh+WumuS4iuS8oOS7u+WKoeeahOWIhuWdl+WIl+ihqFxuXG5cbmZ1bmN0aW9uIHdob2xlTXVsdGlwYXJ0TGlzdFBhcnQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBQYXJ0TGlzdCA9IFtdO1xuICB2YXIgc2VuZFBhcmFtcyA9IHtcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBVcGxvYWRJZDogcGFyYW1zLlVwbG9hZElkLFxuICAgIGNhbGxlZEJ5U2RrOiAnc2xpY2VVcGxvYWRGaWxlJyxcbiAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICB9O1xuXG4gIHZhciBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICBzZWxmLm11bHRpcGFydExpc3RQYXJ0KHNlbmRQYXJhbXMsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgUGFydExpc3QucHVzaC5hcHBseShQYXJ0TGlzdCwgZGF0YS5QYXJ0IHx8IFtdKTtcblxuICAgICAgaWYgKGRhdGEuSXNUcnVuY2F0ZWQgPT09ICd0cnVlJykge1xuICAgICAgICAvLyDliJfooajkuI3lrozmlbRcbiAgICAgICAgc2VuZFBhcmFtcy5QYXJ0TnVtYmVyTWFya2VyID0gZGF0YS5OZXh0UGFydE51bWJlck1hcmtlcjtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgICAgIFBhcnRMaXN0OiBQYXJ0TGlzdFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBuZXh0KCk7XG59IC8vIOS4iuS8oOaWh+S7tuWIhuWdl++8jOWMheaLrFxuXG4vKlxuIFVwbG9hZElkICjkuIrkvKDku7vliqHnvJblj7cpXG4gQXN5bmNMaW1pdCAo5bm25Y+R6YePKe+8jFxuIFNsaWNlTGlzdCAo5LiK5Lyg55qE5YiG5Z2X5pWw57uEKe+8jFxuIEZpbGVQYXRoICjmnKzlnLDmlofku7bnmoTkvY3nva4p77yMXG4gU2xpY2VTaXplICjmlofku7bliIblnZflpKflsI8pXG4gRmlsZVNpemUgKOaWh+S7tuWkp+WwjylcbiBvblByb2dyZXNzICjkuIrkvKDmiJDlip/kuYvlkI7nmoTlm57osIPlh73mlbApXG4gKi9cblxuXG5mdW5jdGlvbiB1cGxvYWRTbGljZUxpc3QocGFyYW1zLCBjYikge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgVXBsb2FkRGF0YSA9IHBhcmFtcy5VcGxvYWREYXRhO1xuICB2YXIgRmlsZVNpemUgPSBwYXJhbXMuRmlsZVNpemU7XG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgQ2h1bmtQYXJhbGxlbCA9IE1hdGgubWluKHBhcmFtcy5Bc3luY0xpbWl0IHx8IHNlbGYub3B0aW9ucy5DaHVua1BhcmFsbGVsTGltaXQgfHwgMSwgMjU2KTtcbiAgdmFyIEJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIFNsaWNlQ291bnQgPSBNYXRoLmNlaWwoRmlsZVNpemUgLyBTbGljZVNpemUpO1xuICB2YXIgRmluaXNoU2l6ZSA9IDA7XG4gIHZhciBTZXJ2ZXJTaWRlRW5jcnlwdGlvbiA9IHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbjtcbiAgdmFyIEhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIG5lZWRVcGxvYWRTbGljZXMgPSB1dGlsLmZpbHRlcihVcGxvYWREYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoU2xpY2VJdGVtKSB7XG4gICAgaWYgKFNsaWNlSXRlbVsnVXBsb2FkZWQnXSkge1xuICAgICAgRmluaXNoU2l6ZSArPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXSA+PSBTbGljZUNvdW50ID8gRmlsZVNpemUgJSBTbGljZVNpemUgfHwgU2xpY2VTaXplIDogU2xpY2VTaXplO1xuICAgIH1cblxuICAgIHJldHVybiAhU2xpY2VJdGVtWydVcGxvYWRlZCddO1xuICB9KTtcbiAgdmFyIF9vblByb2dyZXNzMiA9IHBhcmFtcy5vblByb2dyZXNzO1xuICBBc3luYy5lYWNoTGltaXQobmVlZFVwbG9hZFNsaWNlcywgQ2h1bmtQYXJhbGxlbCwgZnVuY3Rpb24gKFNsaWNlSXRlbSwgYXN5bmNDYWxsYmFjaykge1xuICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgdmFyIFBhcnROdW1iZXIgPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXTtcbiAgICB2YXIgY3VycmVudFNpemUgPSBNYXRoLm1pbihGaWxlU2l6ZSwgU2xpY2VJdGVtWydQYXJ0TnVtYmVyJ10gKiBTbGljZVNpemUpIC0gKFNsaWNlSXRlbVsnUGFydE51bWJlciddIC0gMSkgKiBTbGljZVNpemU7XG4gICAgdmFyIHByZUFkZFNpemUgPSAwO1xuICAgIHVwbG9hZFNsaWNlSXRlbS5jYWxsKHNlbGYsIHtcbiAgICAgIFRhc2tJZDogVGFza0lkLFxuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgU2xpY2VTaXplOiBTbGljZVNpemUsXG4gICAgICBGaWxlU2l6ZTogRmlsZVNpemUsXG4gICAgICBQYXJ0TnVtYmVyOiBQYXJ0TnVtYmVyLFxuICAgICAgU2VydmVyU2lkZUVuY3J5cHRpb246IFNlcnZlclNpZGVFbmNyeXB0aW9uLFxuICAgICAgQm9keTogQm9keSxcbiAgICAgIFVwbG9hZERhdGE6IFVwbG9hZERhdGEsXG4gICAgICBIZWFkZXJzOiBIZWFkZXJzLFxuICAgICAgb25Qcm9ncmVzczogZnVuY3Rpb24gb25Qcm9ncmVzcyhkYXRhKSB7XG4gICAgICAgIEZpbmlzaFNpemUgKz0gZGF0YS5sb2FkZWQgLSBwcmVBZGRTaXplO1xuICAgICAgICBwcmVBZGRTaXplID0gZGF0YS5sb2FkZWQ7XG5cbiAgICAgICAgX29uUHJvZ3Jlc3MyKHtcbiAgICAgICAgICBsb2FkZWQ6IEZpbmlzaFNpemUsXG4gICAgICAgICAgdG90YWw6IEZpbGVTaXplXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIGlmICghZXJyICYmICFkYXRhLkVUYWcpIGVyciA9ICdnZXQgRVRhZyBlcnJvciwgcGxlYXNlIGFkZCBcIkVUYWdcIiB0byBDT1JTIEV4cG9zZUhlYWRlciBzZXR0aW5nLigg6I635Y+WRVRhZ+Wksei0pe+8jOivt+WcqENPUlMgRXhwb3NlSGVhZGVy6K6+572u5Lit5re75YqgRVRhZ++8jOivt+WPguiAg+aWh+aho++8mmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvMTMzMTggKSc7XG5cbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgRmluaXNoU2l6ZSAtPSBwcmVBZGRTaXplO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgRmluaXNoU2l6ZSArPSBjdXJyZW50U2l6ZSAtIHByZUFkZFNpemU7XG4gICAgICAgIFNsaWNlSXRlbS5FVGFnID0gZGF0YS5FVGFnO1xuICAgICAgfVxuXG4gICAgICBfb25Qcm9ncmVzczIoe1xuICAgICAgICBsb2FkZWQ6IEZpbmlzaFNpemUsXG4gICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgfSk7XG5cbiAgICAgIGFzeW5jQ2FsbGJhY2soZXJyIHx8IG51bGwsIGRhdGEpO1xuICAgIH0pO1xuICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2IoZXJyKTtcbiAgICBjYihudWxsLCB7XG4gICAgICBVcGxvYWRJZDogVXBsb2FkRGF0YS5VcGxvYWRJZCxcbiAgICAgIFNsaWNlTGlzdDogVXBsb2FkRGF0YS5QYXJ0TGlzdFxuICAgIH0pO1xuICB9KTtcbn0gLy8g5LiK5Lyg5oyH5a6a5YiG54mHXG5cblxuZnVuY3Rpb24gdXBsb2FkU2xpY2VJdGVtKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgVGFza0lkID0gcGFyYW1zLlRhc2tJZDtcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIEZpbGVTaXplID0gcGFyYW1zLkZpbGVTaXplO1xuICB2YXIgRmlsZUJvZHkgPSBwYXJhbXMuQm9keTtcbiAgdmFyIFBhcnROdW1iZXIgPSBwYXJhbXMuUGFydE51bWJlciAqIDE7XG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplO1xuICB2YXIgU2VydmVyU2lkZUVuY3J5cHRpb24gPSBwYXJhbXMuU2VydmVyU2lkZUVuY3J5cHRpb247XG4gIHZhciBVcGxvYWREYXRhID0gcGFyYW1zLlVwbG9hZERhdGE7XG4gIHZhciBIZWFkZXJzID0gcGFyYW1zLkhlYWRlcnMgfHwge307XG4gIHZhciBDaHVua1JldHJ5VGltZXMgPSBzZWxmLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzICsgMTtcbiAgdmFyIHN0YXJ0ID0gU2xpY2VTaXplICogKFBhcnROdW1iZXIgLSAxKTtcbiAgdmFyIENvbnRlbnRMZW5ndGggPSBTbGljZVNpemU7XG4gIHZhciBlbmQgPSBzdGFydCArIFNsaWNlU2l6ZTtcblxuICBpZiAoZW5kID4gRmlsZVNpemUpIHtcbiAgICBlbmQgPSBGaWxlU2l6ZTtcbiAgICBDb250ZW50TGVuZ3RoID0gZW5kIC0gc3RhcnQ7XG4gIH1cblxuICB2YXIgaGVhZGVyc1doaXRlTGlzdCA9IFsneC1jb3MtdHJhZmZpYy1saW1pdCcsICd4LWNvcy1taW1lLWxpbWl0J107XG4gIHZhciBoZWFkZXJzID0ge307XG4gIHV0aWwuZWFjaChIZWFkZXJzLCBmdW5jdGlvbiAodiwgaykge1xuICAgIGlmIChoZWFkZXJzV2hpdGVMaXN0LmluZGV4T2YoaykgPiAtMSkge1xuICAgICAgaGVhZGVyc1trXSA9IHY7XG4gICAgfVxuICB9KTtcbiAgdmFyIFBhcnRJdGVtID0gVXBsb2FkRGF0YS5QYXJ0TGlzdFtQYXJ0TnVtYmVyIC0gMV07XG4gIEFzeW5jLnJldHJ5KENodW5rUmV0cnlUaW1lcywgZnVuY3Rpb24gKHRyeUNhbGxiYWNrKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICB1dGlsLmZpbGVTbGljZShGaWxlQm9keSwgc3RhcnQsIGVuZCwgdHJ1ZSwgZnVuY3Rpb24gKEJvZHkpIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0VXBsb2FkKHtcbiAgICAgICAgVGFza0lkOiBUYXNrSWQsXG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIENvbnRlbnRMZW5ndGg6IENvbnRlbnRMZW5ndGgsXG4gICAgICAgIFBhcnROdW1iZXI6IFBhcnROdW1iZXIsXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWREYXRhLlVwbG9hZElkLFxuICAgICAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbjogU2VydmVyU2lkZUVuY3J5cHRpb24sXG4gICAgICAgIEJvZHk6IEJvZHksXG4gICAgICAgIEhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgIG9uUHJvZ3Jlc3M6IHBhcmFtcy5vblByb2dyZXNzLFxuICAgICAgICBjYWxsZWRCeVNkazogJ3NsaWNlVXBsb2FkRmlsZScsXG4gICAgICAgIHRyYWNrZXI6IHBhcmFtcy50cmFja2VyXG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmICghc2VsZi5faXNSdW5uaW5nVGFzayhUYXNrSWQpKSByZXR1cm47XG4gICAgICAgIGlmIChlcnIpIHJldHVybiB0cnlDYWxsYmFjayhlcnIpO1xuICAgICAgICBQYXJ0SXRlbS5VcGxvYWRlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnlDYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKCFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICByZXR1cm4gY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgfSk7XG59IC8vIOWujOaIkOWIhuWdl+S4iuS8oFxuXG5cbmZ1bmN0aW9uIHVwbG9hZFNsaWNlQ29tcGxldGUocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgVXBsb2FkSWQgPSBwYXJhbXMuVXBsb2FkSWQ7XG4gIHZhciBTbGljZUxpc3QgPSBwYXJhbXMuU2xpY2VMaXN0O1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBDaHVua1JldHJ5VGltZXMgPSB0aGlzLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzICsgMTtcbiAgdmFyIEhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIFBhcnRzID0gU2xpY2VMaXN0Lm1hcChmdW5jdGlvbiAoaXRlbSkge1xuICAgIHJldHVybiB7XG4gICAgICBQYXJ0TnVtYmVyOiBpdGVtLlBhcnROdW1iZXIsXG4gICAgICBFVGFnOiBpdGVtLkVUYWdcbiAgICB9O1xuICB9KTsgLy8g5a6M5oiQ5LiK5Lyg55qE6K+35rGC5Lmf5YGa6YeN6K+VXG5cbiAgQXN5bmMucmV0cnkoQ2h1bmtSZXRyeVRpbWVzLCBmdW5jdGlvbiAodHJ5Q2FsbGJhY2spIHtcbiAgICBzZWxmLm11bHRpcGFydENvbXBsZXRlKHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEtleSxcbiAgICAgIFVwbG9hZElkOiBVcGxvYWRJZCxcbiAgICAgIFBhcnRzOiBQYXJ0cyxcbiAgICAgIEhlYWRlcnM6IEhlYWRlcnMsXG4gICAgICBjYWxsZWRCeVNkazogJ3NsaWNlVXBsb2FkRmlsZScsXG4gICAgICB0cmFja2VyOiBwYXJhbXMudHJhY2tlclxuICAgIH0sIHRyeUNhbGxiYWNrKTtcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufSAvLyDmipvlvIPliIblnZfkuIrkvKDku7vliqFcblxuLypcbiBBc3luY0xpbWl0ICjmipvlvIPkuIrkvKDku7vliqHnmoTlubblj5Hph48p77yMXG4gVXBsb2FkSWQgKOS4iuS8oOS7u+WKoeeahOe8luWPt++8jOW9kyBMZXZlbCDkuLogdGFzayDml7blgJnpnIDopoEpXG4gTGV2ZWwgKOaKm+W8g+WIhuWdl+S4iuS8oOS7u+WKoeeahOe6p+WIq++8jHRhc2sgOiDmipvlvIPmjIflrprnmoTkuIrkvKDku7vliqHvvIxmaWxlIO+8miDmipvlvIPmjIflrprnmoTmlofku7blr7nlupTnmoTkuIrkvKDku7vliqHvvIzlhbbku5blgLwg77ya5oqb5byD5oyH5a6aQnVja2V0IOeahOWFqOmDqOS4iuS8oOS7u+WKoSlcbiAqL1xuXG5cbmZ1bmN0aW9uIGFib3J0VXBsb2FkVGFzayhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBCdWNrZXQgPSBwYXJhbXMuQnVja2V0O1xuICB2YXIgUmVnaW9uID0gcGFyYW1zLlJlZ2lvbjtcbiAgdmFyIEtleSA9IHBhcmFtcy5LZXk7XG4gIHZhciBVcGxvYWRJZCA9IHBhcmFtcy5VcGxvYWRJZDtcbiAgdmFyIExldmVsID0gcGFyYW1zLkxldmVsIHx8ICd0YXNrJztcbiAgdmFyIEFzeW5jTGltaXQgPSBwYXJhbXMuQXN5bmNMaW1pdDtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgZXAgPSBuZXcgRXZlbnRQcm94eSgpO1xuICBlcC5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyRGF0YSkge1xuICAgIHJldHVybiBjYWxsYmFjayhlcnJEYXRhKTtcbiAgfSk7IC8vIOW3sue7j+iOt+WPluWIsOmcgOimgeaKm+W8g+eahOS7u+WKoeWIl+ihqFxuXG4gIGVwLm9uKCdnZXRfYWJvcnRfYXJyYXknLCBmdW5jdGlvbiAoQWJvcnRBcnJheSkge1xuICAgIGFib3J0VXBsb2FkVGFza0FycmF5LmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgSGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICBBc3luY0xpbWl0OiBBc3luY0xpbWl0LFxuICAgICAgQWJvcnRBcnJheTogQWJvcnRBcnJheVxuICAgIH0sIGNhbGxiYWNrKTtcbiAgfSk7XG5cbiAgaWYgKExldmVsID09PSAnYnVja2V0Jykge1xuICAgIC8vIEJ1Y2tldCDnuqfliKvnmoTku7vliqHmipvlvIPvvIzmipvlvIPor6UgQnVja2V0IOS4i+eahOWFqOmDqOS4iuS8oOS7u+WKoVxuICAgIHdob2xlTXVsdGlwYXJ0TGlzdC5jYWxsKHNlbGYsIHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBjYWxsZWRCeVNkazogJ2Fib3J0VXBsb2FkVGFzaydcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIGVwLmVtaXQoJ2dldF9hYm9ydF9hcnJheScsIGRhdGEuVXBsb2FkTGlzdCB8fCBbXSk7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoTGV2ZWwgPT09ICdmaWxlJykge1xuICAgIC8vIOaWh+S7tue6p+WIq+eahOS7u+WKoeaKm+W8g++8jOaKm+W8g+ivpeaWh+S7tueahOWFqOmDqOS4iuS8oOS7u+WKoVxuICAgIGlmICghS2V5KSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ2Fib3J0X3VwbG9hZF90YXNrX25vX2tleScpKSk7XG4gICAgd2hvbGVNdWx0aXBhcnRMaXN0LmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgIEtleTogS2V5LFxuICAgICAgY2FsbGVkQnlTZGs6ICdhYm9ydFVwbG9hZFRhc2snXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICBlcC5lbWl0KCdnZXRfYWJvcnRfYXJyYXknLCBkYXRhLlVwbG9hZExpc3QgfHwgW10pO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKExldmVsID09PSAndGFzaycpIHtcbiAgICAvLyDljZXkuKrku7vliqHnuqfliKvnmoTku7vliqHmipvlvIPvvIzmipvlvIPmjIflrpogVXBsb2FkSWQg55qE5LiK5Lyg5Lu75YqhXG4gICAgaWYgKCFVcGxvYWRJZCkgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdhYm9ydF91cGxvYWRfdGFza19ub19pZCcpKSk7XG4gICAgaWYgKCFLZXkpIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignYWJvcnRfdXBsb2FkX3Rhc2tfbm9fa2V5JykpKTtcbiAgICBlcC5lbWl0KCdnZXRfYWJvcnRfYXJyYXknLCBbe1xuICAgICAgS2V5OiBLZXksXG4gICAgICBVcGxvYWRJZDogVXBsb2FkSWRcbiAgICB9XSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdhYm9ydF91bmtub3duX2xldmVsJykpKTtcbiAgfVxufSAvLyDmibnph4/mipvlvIPliIblnZfkuIrkvKDku7vliqFcblxuXG5mdW5jdGlvbiBhYm9ydFVwbG9hZFRhc2tBcnJheShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBCdWNrZXQgPSBwYXJhbXMuQnVja2V0O1xuICB2YXIgUmVnaW9uID0gcGFyYW1zLlJlZ2lvbjtcbiAgdmFyIEtleSA9IHBhcmFtcy5LZXk7XG4gIHZhciBBYm9ydEFycmF5ID0gcGFyYW1zLkFib3J0QXJyYXk7XG4gIHZhciBBc3luY0xpbWl0ID0gcGFyYW1zLkFzeW5jTGltaXQgfHwgMTtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgaW5kZXggPSAwO1xuICB2YXIgcmVzdWx0TGlzdCA9IG5ldyBBcnJheShBYm9ydEFycmF5Lmxlbmd0aCk7XG4gIEFzeW5jLmVhY2hMaW1pdChBYm9ydEFycmF5LCBBc3luY0xpbWl0LCBmdW5jdGlvbiAoQWJvcnRJdGVtLCBuZXh0SXRlbSkge1xuICAgIHZhciBlYWNoSW5kZXggPSBpbmRleDtcblxuICAgIGlmIChLZXkgJiYgS2V5ICE9PSBBYm9ydEl0ZW0uS2V5KSB7XG4gICAgICByZXN1bHRMaXN0W2VhY2hJbmRleF0gPSB7XG4gICAgICAgIGVycm9yOiB7XG4gICAgICAgICAgS2V5Tm90TWF0Y2g6IHRydWVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIG5leHRJdGVtKG51bGwpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBVcGxvYWRJZCA9IEFib3J0SXRlbS5VcGxvYWRJZCB8fCBBYm9ydEl0ZW0uVXBsb2FkSUQ7XG4gICAgc2VsZi5tdWx0aXBhcnRBYm9ydCh7XG4gICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgS2V5OiBBYm9ydEl0ZW0uS2V5LFxuICAgICAgSGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgICBVcGxvYWRJZDogVXBsb2FkSWRcbiAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICB2YXIgdGFzayA9IHtcbiAgICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgICBLZXk6IEFib3J0SXRlbS5LZXksXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZFxuICAgICAgfTtcbiAgICAgIHJlc3VsdExpc3RbZWFjaEluZGV4XSA9IHtcbiAgICAgICAgZXJyb3I6IGVycixcbiAgICAgICAgdGFzazogdGFza1xuICAgICAgfTtcbiAgICAgIG5leHRJdGVtKG51bGwpO1xuICAgIH0pO1xuICAgIGluZGV4Kys7XG4gIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgc3VjY2Vzc0xpc3QgPSBbXTtcbiAgICB2YXIgZXJyb3JMaXN0ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcmVzdWx0TGlzdC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGl0ZW0gPSByZXN1bHRMaXN0W2ldO1xuXG4gICAgICBpZiAoaXRlbVsndGFzayddKSB7XG4gICAgICAgIGlmIChpdGVtWydlcnJvciddKSB7XG4gICAgICAgICAgZXJyb3JMaXN0LnB1c2goaXRlbVsndGFzayddKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdWNjZXNzTGlzdC5wdXNoKGl0ZW1bJ3Rhc2snXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3VjY2Vzc0xpc3Q6IHN1Y2Nlc3NMaXN0LFxuICAgICAgZXJyb3JMaXN0OiBlcnJvckxpc3RcbiAgICB9KTtcbiAgfSk7XG59IC8vIOmrmOe6p+S4iuS8oFxuXG5cbmZ1bmN0aW9uIHVwbG9hZEZpbGUocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7IC8vIOWIpOaWreWkmuWkp+eahOaWh+S7tuS9v+eUqOWIhueJh+S4iuS8oFxuXG4gIHZhciBTbGljZVNpemUgPSBwYXJhbXMuU2xpY2VTaXplID09PSB1bmRlZmluZWQgPyBzZWxmLm9wdGlvbnMuU2xpY2VTaXplIDogcGFyYW1zLlNsaWNlU2l6ZTtcbiAgdmFyIHRhc2tMaXN0ID0gW107XG4gIHZhciBCb2R5ID0gcGFyYW1zLkJvZHk7XG4gIHZhciBGaWxlU2l6ZSA9IEJvZHkuc2l6ZSB8fCBCb2R5Lmxlbmd0aCB8fCAwO1xuICB2YXIgZmlsZUluZm8gPSB7XG4gICAgVGFza0lkOiAnJ1xuICB9OyAvLyDkuIrkvKDpk77ot69cblxuICBpZiAoc2VsZi5vcHRpb25zLkVuYWJsZVRyYWNrZXIpIHtcbiAgICB2YXIgYWNjZWxlcmF0ZSA9IHNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlIHx8IHR5cGVvZiBzZWxmLm9wdGlvbnMuRG9tYWluID09PSAnc3RyaW5nJyAmJiBzZWxmLm9wdGlvbnMuRG9tYWluLmluY2x1ZGVzKCdhY2NlbGVyYXRlLicpO1xuICAgIHBhcmFtcy50cmFja2VyID0gbmV3IFRyYWNrZXIoe1xuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgYXBpTmFtZTogJ3VwbG9hZEZpbGUnLFxuICAgICAgZmlsZUtleTogcGFyYW1zLktleSxcbiAgICAgIGZpbGVTaXplOiBGaWxlU2l6ZSxcbiAgICAgIGFjY2VsZXJhdGU6IGFjY2VsZXJhdGUsXG4gICAgICBkZWVwVHJhY2tlcjogc2VsZi5vcHRpb25zLkRlZXBUcmFja2VyLFxuICAgICAgY3VzdG9tSWQ6IHNlbGYub3B0aW9ucy5DdXN0b21JZCxcbiAgICAgIGRlbGF5OiBzZWxmLm9wdGlvbnMuVHJhY2tlckRlbGF5XG4gICAgfSk7XG4gIH0gLy8g5pW055CGIG9wdGlvbu+8jOeUqOS6jui/lOWbnue7meWbnuiwg1xuXG5cbiAgdXRpbC5lYWNoKHBhcmFtcywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICBpZiAoX3R5cGVvZih2KSAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIHYgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGZpbGVJbmZvW2tdID0gdjtcbiAgICB9XG4gIH0pOyAvLyDlpITnkIbmlofku7YgVGFza1JlYWR5XG5cbiAgdmFyIF9vblRhc2tSZWFkeSA9IHBhcmFtcy5vblRhc2tSZWFkeTtcblxuICB2YXIgb25UYXNrUmVhZHkgPSBmdW5jdGlvbiBvblRhc2tSZWFkeSh0aWQpIHtcbiAgICBmaWxlSW5mby5UYXNrSWQgPSB0aWQ7XG4gICAgX29uVGFza1JlYWR5ICYmIF9vblRhc2tSZWFkeSh0aWQpO1xuICB9O1xuXG4gIHBhcmFtcy5vblRhc2tSZWFkeSA9IG9uVGFza1JlYWR5OyAvLyDmt7vliqDkuIrkvKDku7vliqEs6LaF6L+H6ZiI5YC85L2/55So5YiG5Z2X5LiK5Lyg77yM5bCP5LqO562J5LqO5YiZ566A5Y2V5LiK5LygXG5cbiAgdmFyIGFwaSA9IEZpbGVTaXplID4gU2xpY2VTaXplID8gJ3NsaWNlVXBsb2FkRmlsZScgOiAncHV0T2JqZWN0JzsgLy8g5aSE55CG5paH5Lu25a6M5oiQXG5cbiAgdmFyIF9vbkZpbGVGaW5pc2ggPSBwYXJhbXMub25GaWxlRmluaXNoO1xuXG4gIHZhciBvbkZpbGVGaW5pc2ggPSBmdW5jdGlvbiBvbkZpbGVGaW5pc2goZXJyLCBkYXRhKSB7XG4gICAgLy8g5qC85byP5YyW5LiK5oql5Y+C5pWw5bm25LiK5oqlXG4gICAgcGFyYW1zLnRyYWNrZXIgJiYgcGFyYW1zLnRyYWNrZXIuZm9ybWF0UmVzdWx0KGVyciwgZGF0YSk7XG4gICAgX29uRmlsZUZpbmlzaCAmJiBfb25GaWxlRmluaXNoKGVyciwgZGF0YSwgZmlsZUluZm8pO1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH07XG5cbiAgdGFza0xpc3QucHVzaCh7XG4gICAgYXBpOiBhcGksXG4gICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgY2FsbGJhY2s6IG9uRmlsZUZpbmlzaFxuICB9KTtcblxuICBzZWxmLl9hZGRUYXNrcyh0YXNrTGlzdCk7XG59IC8vIOaJuemHj+S4iuS8oOaWh+S7tlxuXG5cbmZ1bmN0aW9uIHVwbG9hZEZpbGVzKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzOyAvLyDliKTmlq3lpJrlpKfnmoTmlofku7bkvb/nlKjliIbniYfkuIrkvKBcblxuICB2YXIgU2xpY2VTaXplID0gcGFyYW1zLlNsaWNlU2l6ZSA9PT0gdW5kZWZpbmVkID8gc2VsZi5vcHRpb25zLlNsaWNlU2l6ZSA6IHBhcmFtcy5TbGljZVNpemU7IC8vIOaxh+aAu+i/lOWbnui/m+W6plxuXG4gIHZhciBUb3RhbFNpemUgPSAwO1xuICB2YXIgVG90YWxGaW5pc2ggPSAwO1xuICB2YXIgb25Ub3RhbFByb2dyZXNzID0gdXRpbC50aHJvdHRsZU9uUHJvZ3Jlc3MuY2FsbChzZWxmLCBUb3RhbEZpbmlzaCwgcGFyYW1zLm9uUHJvZ3Jlc3MpOyAvLyDmsYfmgLvov5Tlm57lm57osINcblxuICB2YXIgdW5GaW5pc2hDb3VudCA9IHBhcmFtcy5maWxlcy5sZW5ndGg7XG4gIHZhciBfb25Ub3RhbEZpbGVGaW5pc2ggPSBwYXJhbXMub25GaWxlRmluaXNoO1xuICB2YXIgcmVzdWx0TGlzdCA9IEFycmF5KHVuRmluaXNoQ291bnQpO1xuXG4gIHZhciBvblRvdGFsRmlsZUZpbmlzaCA9IGZ1bmN0aW9uIG9uVG90YWxGaWxlRmluaXNoKGVyciwgZGF0YSwgb3B0aW9ucykge1xuICAgIG9uVG90YWxQcm9ncmVzcyhudWxsLCB0cnVlKTtcbiAgICBfb25Ub3RhbEZpbGVGaW5pc2ggJiYgX29uVG90YWxGaWxlRmluaXNoKGVyciwgZGF0YSwgb3B0aW9ucyk7XG4gICAgcmVzdWx0TGlzdFtvcHRpb25zLkluZGV4XSA9IHtcbiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICBlcnJvcjogZXJyLFxuICAgICAgZGF0YTogZGF0YVxuICAgIH07XG5cbiAgICBpZiAoLS11bkZpbmlzaENvdW50IDw9IDAgJiYgY2FsbGJhY2spIHtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgZmlsZXM6IHJlc3VsdExpc3RcbiAgICAgIH0pO1xuICAgIH1cbiAgfTsgLy8g5byA5aeL5aSE55CG5q+P5Liq5paH5Lu2XG5cblxuICB2YXIgdGFza0xpc3QgPSBbXTtcbiAgdXRpbC5lYWNoKHBhcmFtcy5maWxlcywgZnVuY3Rpb24gKGZpbGVQYXJhbXMsIGluZGV4KSB7XG4gICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIOWvuem9kCBub2RlanMg57yp6L+bXG4gICAgICB2YXIgQm9keSA9IGZpbGVQYXJhbXMuQm9keTtcbiAgICAgIHZhciBGaWxlU2l6ZSA9IEJvZHkuc2l6ZSB8fCBCb2R5Lmxlbmd0aCB8fCAwO1xuICAgICAgdmFyIGZpbGVJbmZvID0ge1xuICAgICAgICBJbmRleDogaW5kZXgsXG4gICAgICAgIFRhc2tJZDogJydcbiAgICAgIH07IC8vIOabtOaWsOaWh+S7tuaAu+Wkp+Wwj1xuXG4gICAgICBUb3RhbFNpemUgKz0gRmlsZVNpemU7IC8vIOWNleS4quaWh+S7tuS4iuS8oOmTvui3r1xuXG4gICAgICBpZiAoc2VsZi5vcHRpb25zLkVuYWJsZVRyYWNrZXIpIHtcbiAgICAgICAgdmFyIGFjY2VsZXJhdGUgPSBzZWxmLm9wdGlvbnMuVXNlQWNjZWxlcmF0ZSB8fCB0eXBlb2Ygc2VsZi5vcHRpb25zLkRvbWFpbiA9PT0gJ3N0cmluZycgJiYgc2VsZi5vcHRpb25zLkRvbWFpbi5pbmNsdWRlcygnYWNjZWxlcmF0ZS4nKTtcbiAgICAgICAgZmlsZVBhcmFtcy50cmFja2VyID0gbmV3IFRyYWNrZXIoe1xuICAgICAgICAgIGJ1Y2tldDogZmlsZVBhcmFtcy5CdWNrZXQsXG4gICAgICAgICAgcmVnaW9uOiBmaWxlUGFyYW1zLlJlZ2lvbixcbiAgICAgICAgICBhcGlOYW1lOiAndXBsb2FkRmlsZXMnLFxuICAgICAgICAgIGZpbGVLZXk6IGZpbGVQYXJhbXMuS2V5LFxuICAgICAgICAgIGZpbGVTaXplOiBGaWxlU2l6ZSxcbiAgICAgICAgICBhY2NlbGVyYXRlOiBhY2NlbGVyYXRlLFxuICAgICAgICAgIGRlZXBUcmFja2VyOiBzZWxmLm9wdGlvbnMuRGVlcFRyYWNrZXIsXG4gICAgICAgICAgY3VzdG9tSWQ6IHNlbGYub3B0aW9ucy5DdXN0b21JZCxcbiAgICAgICAgICBkZWxheTogc2VsZi5vcHRpb25zLlRyYWNrZXJEZWxheVxuICAgICAgICB9KTtcbiAgICAgIH0gLy8g5pW055CGIG9wdGlvbu+8jOeUqOS6jui/lOWbnue7meWbnuiwg1xuXG5cbiAgICAgIHV0aWwuZWFjaChmaWxlUGFyYW1zLCBmdW5jdGlvbiAodiwgaykge1xuICAgICAgICBpZiAoX3R5cGVvZih2KSAhPT0gJ29iamVjdCcgJiYgdHlwZW9mIHYgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBmaWxlSW5mb1trXSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH0pOyAvLyDlpITnkIbljZXkuKrmlofku7YgVGFza1JlYWR5XG5cbiAgICAgIHZhciBfb25UYXNrUmVhZHkgPSBmaWxlUGFyYW1zLm9uVGFza1JlYWR5O1xuXG4gICAgICB2YXIgb25UYXNrUmVhZHkgPSBmdW5jdGlvbiBvblRhc2tSZWFkeSh0aWQpIHtcbiAgICAgICAgZmlsZUluZm8uVGFza0lkID0gdGlkO1xuICAgICAgICBfb25UYXNrUmVhZHkgJiYgX29uVGFza1JlYWR5KHRpZCk7XG4gICAgICB9O1xuXG4gICAgICBmaWxlUGFyYW1zLm9uVGFza1JlYWR5ID0gb25UYXNrUmVhZHk7IC8vIOWkhOeQhuWNleS4quaWh+S7tui/m+W6plxuXG4gICAgICB2YXIgUHJlQWRkU2l6ZSA9IDA7XG4gICAgICB2YXIgX29uUHJvZ3Jlc3MgPSBmaWxlUGFyYW1zLm9uUHJvZ3Jlc3M7XG5cbiAgICAgIHZhciBvblByb2dyZXNzID0gZnVuY3Rpb24gb25Qcm9ncmVzcyhpbmZvKSB7XG4gICAgICAgIFRvdGFsRmluaXNoID0gVG90YWxGaW5pc2ggLSBQcmVBZGRTaXplICsgaW5mby5sb2FkZWQ7XG4gICAgICAgIFByZUFkZFNpemUgPSBpbmZvLmxvYWRlZDtcbiAgICAgICAgX29uUHJvZ3Jlc3MgJiYgX29uUHJvZ3Jlc3MoaW5mbyk7XG4gICAgICAgIG9uVG90YWxQcm9ncmVzcyh7XG4gICAgICAgICAgbG9hZGVkOiBUb3RhbEZpbmlzaCxcbiAgICAgICAgICB0b3RhbDogVG90YWxTaXplXG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgZmlsZVBhcmFtcy5vblByb2dyZXNzID0gb25Qcm9ncmVzczsgLy8g5re75Yqg5LiK5Lyg5Lu75YqhXG5cbiAgICAgIHZhciBhcGkgPSBGaWxlU2l6ZSA+IFNsaWNlU2l6ZSA/ICdzbGljZVVwbG9hZEZpbGUnIDogJ3B1dE9iamVjdCc7IC8vIOWkhOeQhuWNleS4quaWh+S7tuWujOaIkFxuXG4gICAgICB2YXIgX29uRmlsZUZpbmlzaCA9IGZpbGVQYXJhbXMub25GaWxlRmluaXNoO1xuXG4gICAgICB2YXIgb25GaWxlRmluaXNoID0gZnVuY3Rpb24gb25GaWxlRmluaXNoKGVyciwgZGF0YSkge1xuICAgICAgICAvLyDmoLzlvI/ljJbkuIrmiqXlj4LmlbDlubbkuIrmiqVcbiAgICAgICAgZmlsZVBhcmFtcy50cmFja2VyICYmIGZpbGVQYXJhbXMudHJhY2tlci5mb3JtYXRSZXN1bHQoZXJyLCBkYXRhKTtcbiAgICAgICAgX29uRmlsZUZpbmlzaCAmJiBfb25GaWxlRmluaXNoKGVyciwgZGF0YSk7XG4gICAgICAgIG9uVG90YWxGaWxlRmluaXNoICYmIG9uVG90YWxGaWxlRmluaXNoKGVyciwgZGF0YSwgZmlsZUluZm8pO1xuICAgICAgfTtcblxuICAgICAgdGFza0xpc3QucHVzaCh7XG4gICAgICAgIGFwaTogYXBpLFxuICAgICAgICBwYXJhbXM6IGZpbGVQYXJhbXMsXG4gICAgICAgIGNhbGxiYWNrOiBvbkZpbGVGaW5pc2hcbiAgICAgIH0pO1xuICAgIH0pKCk7XG4gIH0pO1xuXG4gIHNlbGYuX2FkZFRhc2tzKHRhc2tMaXN0KTtcbn0gLy8g5YiG54mH5aSN5Yi25paH5Lu2XG5cblxuZnVuY3Rpb24gc2xpY2VDb3B5RmlsZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBlcCA9IG5ldyBFdmVudFByb3h5KCk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIEJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciBSZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgS2V5ID0gcGFyYW1zLktleTtcbiAgdmFyIENvcHlTb3VyY2UgPSBwYXJhbXMuQ29weVNvdXJjZTtcbiAgdmFyIG0gPSB1dGlsLmdldFNvdXJjZVBhcmFtcy5jYWxsKHRoaXMsIENvcHlTb3VyY2UpO1xuXG4gIGlmICghbSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdDb3B5U291cmNlIGZvcm1hdCBlcnJvcicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFNvdXJjZUJ1Y2tldCA9IG0uQnVja2V0O1xuICB2YXIgU291cmNlUmVnaW9uID0gbS5SZWdpb247XG4gIHZhciBTb3VyY2VLZXkgPSBkZWNvZGVVUklDb21wb25lbnQobS5LZXkpO1xuICB2YXIgQ29weVNsaWNlU2l6ZSA9IHBhcmFtcy5Db3B5U2xpY2VTaXplID09PSB1bmRlZmluZWQgPyBzZWxmLm9wdGlvbnMuQ29weVNsaWNlU2l6ZSA6IHBhcmFtcy5Db3B5U2xpY2VTaXplO1xuICBDb3B5U2xpY2VTaXplID0gTWF0aC5tYXgoMCwgQ29weVNsaWNlU2l6ZSk7XG4gIHZhciBDaHVua1NpemUgPSBwYXJhbXMuQ29weUNodW5rU2l6ZSB8fCB0aGlzLm9wdGlvbnMuQ29weUNodW5rU2l6ZTtcbiAgdmFyIENodW5rUGFyYWxsZWwgPSB0aGlzLm9wdGlvbnMuQ29weUNodW5rUGFyYWxsZWxMaW1pdDtcbiAgdmFyIENodW5rUmV0cnlUaW1lcyA9IHRoaXMub3B0aW9ucy5DaHVua1JldHJ5VGltZXMgKyAxO1xuICB2YXIgQ2h1bmtDb3VudCA9IDA7XG4gIHZhciBGaW5pc2hTaXplID0gMDtcbiAgdmFyIEZpbGVTaXplO1xuICB2YXIgb25Qcm9ncmVzcztcbiAgdmFyIFNvdXJjZVJlc0hlYWRlcnMgPSB7fTtcbiAgdmFyIFNvdXJjZUhlYWRlcnMgPSB7fTtcbiAgdmFyIFRhcmdldEhlYWRlciA9IHt9OyAvLyDliIbniYflpI3liLblrozmiJDvvIzlvIDlp4sgbXVsdGlwYXJ0Q29tcGxldGUg5pON5L2cXG5cbiAgZXAub24oJ2NvcHlfc2xpY2VfY29tcGxldGUnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIHZhciBtZXRhSGVhZGVycyA9IHt9O1xuICAgIHV0aWwuZWFjaChwYXJhbXMuSGVhZGVycywgZnVuY3Rpb24gKHZhbCwgaykge1xuICAgICAgaWYgKGsudG9Mb3dlckNhc2UoKS5pbmRleE9mKCd4LWNvcy1tZXRhLScpID09PSAwKSBtZXRhSGVhZGVyc1trXSA9IHZhbDtcbiAgICB9KTtcbiAgICB2YXIgUGFydHMgPSB1dGlsLm1hcChVcGxvYWREYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgUGFydE51bWJlcjogaXRlbS5QYXJ0TnVtYmVyLFxuICAgICAgICBFVGFnOiBpdGVtLkVUYWdcbiAgICAgIH07XG4gICAgfSk7IC8vIOWujOaIkOS4iuS8oOeahOivt+axguS5n+WBmumHjeivlVxuXG4gICAgQXN5bmMucmV0cnkoQ2h1bmtSZXRyeVRpbWVzLCBmdW5jdGlvbiAodHJ5Q2FsbGJhY2spIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0Q29tcGxldGUoe1xuICAgICAgICBCdWNrZXQ6IEJ1Y2tldCxcbiAgICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICAgIEtleTogS2V5LFxuICAgICAgICBVcGxvYWRJZDogVXBsb2FkRGF0YS5VcGxvYWRJZCxcbiAgICAgICAgUGFydHM6IFBhcnRzLFxuICAgICAgICBjYWxsZWRCeVNkazogJ3NsaWNlQ29weUZpbGUnXG4gICAgICB9LCB0cnlDYWxsYmFjayk7XG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWREYXRhLlVwbG9hZElkKTsgLy8g5qCH6K6wIFVwbG9hZElkIOayoeiiq+S9v+eUqOS6hu+8jOWboOS4uuWkjeWItuayoeaPkOS+m+mHjeivle+8jOaJgOS7peWPquimgeWHuumUme+8jOWwseaYryBVcGxvYWRJZCDlgZznlKjkuobjgIJcblxuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZChVcGxvYWREYXRhLlVwbG9hZElkKTtcbiAgICAgIG9uUHJvZ3Jlc3Moe1xuICAgICAgICBsb2FkZWQ6IEZpbGVTaXplLFxuICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgIH0sIHRydWUpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gICAgfSk7XG4gIH0pO1xuICBlcC5vbignZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCBmdW5jdGlvbiAoVXBsb2FkRGF0YSkge1xuICAgIC8vIOWkhOeQhiBVcGxvYWRJZCDnvJPlrZhcbiAgICB2YXIgdXVpZCA9IHNlc3Npb24uZ2V0Q29weUZpbGVJZChDb3B5U291cmNlLCBTb3VyY2VSZXNIZWFkZXJzLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5KTtcbiAgICB1dWlkICYmIHNlc3Npb24uc2F2ZVVwbG9hZElkKHV1aWQsIFVwbG9hZERhdGEuVXBsb2FkSWQsIHNlbGYub3B0aW9ucy5VcGxvYWRJZENhY2hlTGltaXQpOyAvLyDnvJPlrZggVXBsb2FkSWRcblxuICAgIHNlc3Npb24uc2V0VXNpbmcoVXBsb2FkRGF0YS5VcGxvYWRJZCk7IC8vIOagh+iusCBVcGxvYWRJZCDkuLrmraPlnKjkvb/nlKhcblxuICAgIHZhciBuZWVkQ29weVNsaWNlcyA9IHV0aWwuZmlsdGVyKFVwbG9hZERhdGEuUGFydExpc3QsIGZ1bmN0aW9uIChTbGljZUl0ZW0pIHtcbiAgICAgIGlmIChTbGljZUl0ZW1bJ1VwbG9hZGVkJ10pIHtcbiAgICAgICAgRmluaXNoU2l6ZSArPSBTbGljZUl0ZW1bJ1BhcnROdW1iZXInXSA+PSBDaHVua0NvdW50ID8gRmlsZVNpemUgJSBDaHVua1NpemUgfHwgQ2h1bmtTaXplIDogQ2h1bmtTaXplO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gIVNsaWNlSXRlbVsnVXBsb2FkZWQnXTtcbiAgICB9KTtcbiAgICBBc3luYy5lYWNoTGltaXQobmVlZENvcHlTbGljZXMsIENodW5rUGFyYWxsZWwsIGZ1bmN0aW9uIChTbGljZUl0ZW0sIGFzeW5jQ2FsbGJhY2spIHtcbiAgICAgIHZhciBQYXJ0TnVtYmVyID0gU2xpY2VJdGVtLlBhcnROdW1iZXI7XG4gICAgICB2YXIgQ29weVNvdXJjZVJhbmdlID0gU2xpY2VJdGVtLkNvcHlTb3VyY2VSYW5nZTtcbiAgICAgIHZhciBjdXJyZW50U2l6ZSA9IFNsaWNlSXRlbS5lbmQgLSBTbGljZUl0ZW0uc3RhcnQ7XG4gICAgICBBc3luYy5yZXRyeShDaHVua1JldHJ5VGltZXMsIGZ1bmN0aW9uICh0cnlDYWxsYmFjaykge1xuICAgICAgICBjb3B5U2xpY2VJdGVtLmNhbGwoc2VsZiwge1xuICAgICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICAgIFJlZ2lvbjogUmVnaW9uLFxuICAgICAgICAgIEtleTogS2V5LFxuICAgICAgICAgIENvcHlTb3VyY2U6IENvcHlTb3VyY2UsXG4gICAgICAgICAgVXBsb2FkSWQ6IFVwbG9hZERhdGEuVXBsb2FkSWQsXG4gICAgICAgICAgUGFydE51bWJlcjogUGFydE51bWJlcixcbiAgICAgICAgICBDb3B5U291cmNlUmFuZ2U6IENvcHlTb3VyY2VSYW5nZVxuICAgICAgICB9LCB0cnlDYWxsYmFjayk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiBhc3luY0NhbGxiYWNrKGVycik7XG4gICAgICAgIEZpbmlzaFNpemUgKz0gY3VycmVudFNpemU7XG4gICAgICAgIG9uUHJvZ3Jlc3Moe1xuICAgICAgICAgIGxvYWRlZDogRmluaXNoU2l6ZSxcbiAgICAgICAgICB0b3RhbDogRmlsZVNpemVcbiAgICAgICAgfSk7XG4gICAgICAgIFNsaWNlSXRlbS5FVGFnID0gZGF0YS5FVGFnO1xuICAgICAgICBhc3luY0NhbGxiYWNrKGVyciB8fCBudWxsLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgc2Vzc2lvbi5yZW1vdmVVc2luZyhVcGxvYWREYXRhLlVwbG9hZElkKTsgLy8g5qCH6K6wIFVwbG9hZElkIOayoeiiq+S9v+eUqOS6hu+8jOWboOS4uuWkjeWItuayoeaPkOS+m+mHjeivle+8jOaJgOS7peWPquimgeWHuumUme+8jOWwseaYryBVcGxvYWRJZCDlgZznlKjkuobjgIJcblxuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgZXAuZW1pdCgnY29weV9zbGljZV9jb21wbGV0ZScsIFVwbG9hZERhdGEpO1xuICAgIH0pO1xuICB9KTtcbiAgZXAub24oJ2dldF9jaHVua19zaXplX2ZpbmlzaCcsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY3JlYXRlTmV3VXBsb2FkSWQgPSBmdW5jdGlvbiBjcmVhdGVOZXdVcGxvYWRJZCgpIHtcbiAgICAgIHNlbGYubXVsdGlwYXJ0SW5pdCh7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIEhlYWRlcnM6IFRhcmdldEhlYWRlclxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcGFyYW1zLlVwbG9hZElkID0gZGF0YS5VcGxvYWRJZDtcbiAgICAgICAgZXAuZW1pdCgnZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCB7XG4gICAgICAgICAgVXBsb2FkSWQ6IHBhcmFtcy5VcGxvYWRJZCxcbiAgICAgICAgICBQYXJ0TGlzdDogcGFyYW1zLlBhcnRMaXN0XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTsgLy8g5Zyo5pys5Zyw5om+5Y+v55So55qEIFVwbG9hZElkXG5cblxuICAgIHZhciB1dWlkID0gc2Vzc2lvbi5nZXRDb3B5RmlsZUlkKENvcHlTb3VyY2UsIFNvdXJjZVJlc0hlYWRlcnMsIENodW5rU2l6ZSwgQnVja2V0LCBLZXkpO1xuICAgIHZhciBMb2NhbFVwbG9hZElkTGlzdCA9IHNlc3Npb24uZ2V0VXBsb2FkSWRMaXN0KHV1aWQpO1xuICAgIGlmICghdXVpZCB8fCAhTG9jYWxVcGxvYWRJZExpc3QpIHJldHVybiBjcmVhdGVOZXdVcGxvYWRJZCgpO1xuXG4gICAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KGluZGV4KSB7XG4gICAgICAvLyDlpoLmnpzmnKzlnLDmib7kuI3liLDlj6/nlKggVXBsb2FkSWTvvIzlho3kuIDkuKrkuKrpgY3ljobmoKHpqozov5znq69cbiAgICAgIGlmIChpbmRleCA+PSBMb2NhbFVwbG9hZElkTGlzdC5sZW5ndGgpIHJldHVybiBjcmVhdGVOZXdVcGxvYWRJZCgpO1xuICAgICAgdmFyIFVwbG9hZElkID0gTG9jYWxVcGxvYWRJZExpc3RbaW5kZXhdOyAvLyDlpoLmnpzmraPlnKjooqvkvb/nlKjvvIzot7Pov4dcblxuICAgICAgaWYgKHNlc3Npb24udXNpbmdbVXBsb2FkSWRdKSByZXR1cm4gbmV4dChpbmRleCArIDEpOyAvLyDliKTmlq0gVXBsb2FkSWQg5piv5ZCm5a2Y5Zyo57q/5LiKXG5cbiAgICAgIHdob2xlTXVsdGlwYXJ0TGlzdFBhcnQuY2FsbChzZWxmLCB7XG4gICAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgICBSZWdpb246IFJlZ2lvbixcbiAgICAgICAgS2V5OiBLZXksXG4gICAgICAgIFVwbG9hZElkOiBVcGxvYWRJZFxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgUGFydExpc3REYXRhKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAvLyDlpoLmnpwgVXBsb2FkSWQg6I635Y+W5Lya5Ye66ZSZ77yM6Lez6L+H5bm25Yig6ZmkXG4gICAgICAgICAgc2Vzc2lvbi5yZW1vdmVVcGxvYWRJZChVcGxvYWRJZCk7XG4gICAgICAgICAgbmV4dChpbmRleCArIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIOWmguaenOW8guatpeWbnuadpSBVcGxvYWRJZCDlt7Lnu4/ooqvnlKjkuobvvIzkuZ/ot7Pov4dcbiAgICAgICAgICBpZiAoc2Vzc2lvbi51c2luZ1tVcGxvYWRJZF0pIHJldHVybiBuZXh0KGluZGV4ICsgMSk7IC8vIOaJvuWIsOWPr+eUqCBVcGxvYWRJZFxuXG4gICAgICAgICAgdmFyIGZpbmlzaEVUYWdNYXAgPSB7fTtcbiAgICAgICAgICB2YXIgb2Zmc2V0ID0gMDtcbiAgICAgICAgICB1dGlsLmVhY2goUGFydExpc3REYXRhLlBhcnRMaXN0LCBmdW5jdGlvbiAoUGFydEl0ZW0pIHtcbiAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQoUGFydEl0ZW0uU2l6ZSk7XG4gICAgICAgICAgICB2YXIgZW5kID0gb2Zmc2V0ICsgc2l6ZSAtIDE7XG4gICAgICAgICAgICBmaW5pc2hFVGFnTWFwW1BhcnRJdGVtLlBhcnROdW1iZXIgKyAnfCcgKyBvZmZzZXQgKyAnfCcgKyBlbmRdID0gUGFydEl0ZW0uRVRhZztcbiAgICAgICAgICAgIG9mZnNldCArPSBzaXplO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHV0aWwuZWFjaChwYXJhbXMuUGFydExpc3QsIGZ1bmN0aW9uIChQYXJ0SXRlbSkge1xuICAgICAgICAgICAgdmFyIEVUYWcgPSBmaW5pc2hFVGFnTWFwW1BhcnRJdGVtLlBhcnROdW1iZXIgKyAnfCcgKyBQYXJ0SXRlbS5zdGFydCArICd8JyArIFBhcnRJdGVtLmVuZF07XG5cbiAgICAgICAgICAgIGlmIChFVGFnKSB7XG4gICAgICAgICAgICAgIFBhcnRJdGVtLkVUYWcgPSBFVGFnO1xuICAgICAgICAgICAgICBQYXJ0SXRlbS5VcGxvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXAuZW1pdCgnZ2V0X2NvcHlfZGF0YV9maW5pc2gnLCB7XG4gICAgICAgICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICAgICAgICBQYXJ0TGlzdDogcGFyYW1zLlBhcnRMaXN0XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBuZXh0KDApO1xuICB9KTtcbiAgZXAub24oJ2dldF9maWxlX3NpemVfZmluaXNoJywgZnVuY3Rpb24gKCkge1xuICAgIC8vIOaOp+WItuWIhueJh+Wkp+Wwj1xuICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgU0laRSA9IFsxLCAyLCA0LCA4LCAxNiwgMzIsIDY0LCAxMjgsIDI1NiwgNTEyLCAxMDI0LCAxMDI0ICogMiwgMTAyNCAqIDQsIDEwMjQgKiA1XTtcbiAgICAgIHZhciBBdXRvQ2h1bmtTaXplID0gMTAyNCAqIDEwMjQ7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgU0laRS5sZW5ndGg7IGkrKykge1xuICAgICAgICBBdXRvQ2h1bmtTaXplID0gU0laRVtpXSAqIDEwMjQgKiAxMDI0O1xuICAgICAgICBpZiAoRmlsZVNpemUgLyBBdXRvQ2h1bmtTaXplIDw9IHNlbGYub3B0aW9ucy5NYXhQYXJ0TnVtYmVyKSBicmVhaztcbiAgICAgIH1cblxuICAgICAgcGFyYW1zLkNodW5rU2l6ZSA9IENodW5rU2l6ZSA9IE1hdGgubWF4KENodW5rU2l6ZSwgQXV0b0NodW5rU2l6ZSk7XG4gICAgICBDaHVua0NvdW50ID0gTWF0aC5jZWlsKEZpbGVTaXplIC8gQ2h1bmtTaXplKTtcbiAgICAgIHZhciBsaXN0ID0gW107XG5cbiAgICAgIGZvciAodmFyIHBhcnROdW1iZXIgPSAxOyBwYXJ0TnVtYmVyIDw9IENodW5rQ291bnQ7IHBhcnROdW1iZXIrKykge1xuICAgICAgICB2YXIgc3RhcnQgPSAocGFydE51bWJlciAtIDEpICogQ2h1bmtTaXplO1xuICAgICAgICB2YXIgZW5kID0gcGFydE51bWJlciAqIENodW5rU2l6ZSA8IEZpbGVTaXplID8gcGFydE51bWJlciAqIENodW5rU2l6ZSAtIDEgOiBGaWxlU2l6ZSAtIDE7XG4gICAgICAgIHZhciBpdGVtID0ge1xuICAgICAgICAgIFBhcnROdW1iZXI6IHBhcnROdW1iZXIsXG4gICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgIGVuZDogZW5kLFxuICAgICAgICAgIENvcHlTb3VyY2VSYW5nZTogXCJieXRlcz1cIiArIHN0YXJ0ICsgXCItXCIgKyBlbmRcbiAgICAgICAgfTtcbiAgICAgICAgbGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgfVxuXG4gICAgICBwYXJhbXMuUGFydExpc3QgPSBsaXN0O1xuICAgIH0pKCk7XG5cbiAgICBpZiAocGFyYW1zLkhlYWRlcnNbJ3gtY29zLW1ldGFkYXRhLWRpcmVjdGl2ZSddID09PSAnUmVwbGFjZWQnKSB7XG4gICAgICBUYXJnZXRIZWFkZXIgPSBwYXJhbXMuSGVhZGVycztcbiAgICB9IGVsc2Uge1xuICAgICAgVGFyZ2V0SGVhZGVyID0gU291cmNlSGVhZGVycztcbiAgICB9XG5cbiAgICBUYXJnZXRIZWFkZXJbJ3gtY29zLXN0b3JhZ2UtY2xhc3MnXSA9IHBhcmFtcy5IZWFkZXJzWyd4LWNvcy1zdG9yYWdlLWNsYXNzJ10gfHwgU291cmNlSGVhZGVyc1sneC1jb3Mtc3RvcmFnZS1jbGFzcyddO1xuICAgIFRhcmdldEhlYWRlciA9IHV0aWwuY2xlYXJLZXkoVGFyZ2V0SGVhZGVyKTtcbiAgICAvKipcbiAgICAgKiDlr7nkuo7lvZLmoaPlrZjlgqjnmoTlr7nosaHvvIzlpoLmnpzmnKrmgaLlpI3lia/mnKzvvIzliJnkuI3lhYHorrggQ29weVxuICAgICAqL1xuXG4gICAgaWYgKFNvdXJjZUhlYWRlcnNbJ3gtY29zLXN0b3JhZ2UtY2xhc3MnXSA9PT0gJ0FSQ0hJVkUnIHx8IFNvdXJjZUhlYWRlcnNbJ3gtY29zLXN0b3JhZ2UtY2xhc3MnXSA9PT0gJ0RFRVBfQVJDSElWRScpIHtcbiAgICAgIHZhciByZXN0b3JlSGVhZGVyID0gU291cmNlSGVhZGVyc1sneC1jb3MtcmVzdG9yZSddO1xuXG4gICAgICBpZiAoIXJlc3RvcmVIZWFkZXIgfHwgcmVzdG9yZUhlYWRlciA9PT0gJ29uZ29pbmctcmVxdWVzdD1cInRydWVcIicpIHtcbiAgICAgICAgY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ1VucmVzdG9yZWQgYXJjaGl2ZSBvYmplY3QgaXMgbm90IGFsbG93ZWQgdG8gYmUgY29waWVkJykpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiDljrvpmaTkuIDkupvml6DnlKjnmoTlpLTpg6jvvIzop4Tpgb8gbXVsdGlwYXJ0SW5pdCDlh7rplJlcbiAgICAgKiDov5nkupvlpLTpg6jpgJrluLjmmK/lnKggcHV0T2JqZWN0Q29weSDml7bmiY3kvb/nlKhcbiAgICAgKi9cblxuXG4gICAgZGVsZXRlIFRhcmdldEhlYWRlclsneC1jb3MtY29weS1zb3VyY2UnXTtcbiAgICBkZWxldGUgVGFyZ2V0SGVhZGVyWyd4LWNvcy1tZXRhZGF0YS1kaXJlY3RpdmUnXTtcbiAgICBkZWxldGUgVGFyZ2V0SGVhZGVyWyd4LWNvcy1jb3B5LXNvdXJjZS1JZi1Nb2RpZmllZC1TaW5jZSddO1xuICAgIGRlbGV0ZSBUYXJnZXRIZWFkZXJbJ3gtY29zLWNvcHktc291cmNlLUlmLVVubW9kaWZpZWQtU2luY2UnXTtcbiAgICBkZWxldGUgVGFyZ2V0SGVhZGVyWyd4LWNvcy1jb3B5LXNvdXJjZS1JZi1NYXRjaCddO1xuICAgIGRlbGV0ZSBUYXJnZXRIZWFkZXJbJ3gtY29zLWNvcHktc291cmNlLUlmLU5vbmUtTWF0Y2gnXTtcbiAgICBlcC5lbWl0KCdnZXRfY2h1bmtfc2l6ZV9maW5pc2gnKTtcbiAgfSk7IC8vIOiOt+WPlui/nOerr+WkjeWItua6kOaWh+S7tueahOWkp+Wwj1xuXG4gIHNlbGYuaGVhZE9iamVjdCh7XG4gICAgQnVja2V0OiBTb3VyY2VCdWNrZXQsXG4gICAgUmVnaW9uOiBTb3VyY2VSZWdpb24sXG4gICAgS2V5OiBTb3VyY2VLZXlcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gNDA0KSB7XG4gICAgICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IoZXJyLCB7XG4gICAgICAgICAgRXJyb3JTdGF0dXM6IFNvdXJjZUtleSArICcgTm90IEV4aXN0J1xuICAgICAgICB9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgRmlsZVNpemUgPSBwYXJhbXMuRmlsZVNpemUgPSBkYXRhLmhlYWRlcnNbJ2NvbnRlbnQtbGVuZ3RoJ107XG5cbiAgICBpZiAoRmlsZVNpemUgPT09IHVuZGVmaW5lZCB8fCAhRmlsZVNpemUpIHtcbiAgICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXQgQ29udGVudC1MZW5ndGggZXJyb3IsIHBsZWFzZSBhZGQgXCJDb250ZW50LUxlbmd0aFwiIHRvIENPUlMgRXhwb3NlSGVhZGVyIHNldHRpbmcu77yIIOiOt+WPlkNvbnRlbnQtTGVuZ3Ro5aSx6LSl77yM6K+35ZyoQ09SUyBFeHBvc2VIZWFkZXLorr7nva7kuK3mt7vliqBDb250ZW50LUxlbmd0aO+8jOivt+WPguiAg+aWh+aho++8mmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvMTMzMTgg77yJJykpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBvblByb2dyZXNzID0gdXRpbC50aHJvdHRsZU9uUHJvZ3Jlc3MuY2FsbChzZWxmLCBGaWxlU2l6ZSwgcGFyYW1zLm9uUHJvZ3Jlc3MpOyAvLyDlvIDlp4vkuIrkvKBcblxuICAgIGlmIChGaWxlU2l6ZSA8PSBDb3B5U2xpY2VTaXplKSB7XG4gICAgICBpZiAoIXBhcmFtcy5IZWFkZXJzWyd4LWNvcy1tZXRhZGF0YS1kaXJlY3RpdmUnXSkge1xuICAgICAgICBwYXJhbXMuSGVhZGVyc1sneC1jb3MtbWV0YWRhdGEtZGlyZWN0aXZlJ10gPSAnQ29weSc7XG4gICAgICB9XG5cbiAgICAgIHNlbGYucHV0T2JqZWN0Q29weShwYXJhbXMsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIG9uUHJvZ3Jlc3MobnVsbCwgdHJ1ZSk7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH1cblxuICAgICAgICBvblByb2dyZXNzKHtcbiAgICAgICAgICBsb2FkZWQ6IEZpbGVTaXplLFxuICAgICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgICB9LCB0cnVlKTtcbiAgICAgICAgY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcmVzSGVhZGVycyA9IGRhdGEuaGVhZGVycztcbiAgICAgIFNvdXJjZVJlc0hlYWRlcnMgPSByZXNIZWFkZXJzO1xuICAgICAgU291cmNlSGVhZGVycyA9IHtcbiAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiByZXNIZWFkZXJzWydjYWNoZS1jb250cm9sJ10sXG4gICAgICAgICdDb250ZW50LURpc3Bvc2l0aW9uJzogcmVzSGVhZGVyc1snY29udGVudC1kaXNwb3NpdGlvbiddLFxuICAgICAgICAnQ29udGVudC1FbmNvZGluZyc6IHJlc0hlYWRlcnNbJ2NvbnRlbnQtZW5jb2RpbmcnXSxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6IHJlc0hlYWRlcnNbJ2NvbnRlbnQtdHlwZSddLFxuICAgICAgICAnRXhwaXJlcyc6IHJlc0hlYWRlcnNbJ2V4cGlyZXMnXSxcbiAgICAgICAgJ3gtY29zLXN0b3JhZ2UtY2xhc3MnOiByZXNIZWFkZXJzWyd4LWNvcy1zdG9yYWdlLWNsYXNzJ11cbiAgICAgIH07XG4gICAgICB1dGlsLmVhY2gocmVzSGVhZGVycywgZnVuY3Rpb24gKHYsIGspIHtcbiAgICAgICAgdmFyIG1ldGFQcmVmaXggPSAneC1jb3MtbWV0YS0nO1xuXG4gICAgICAgIGlmIChrLmluZGV4T2YobWV0YVByZWZpeCkgPT09IDAgJiYgay5sZW5ndGggPiBtZXRhUHJlZml4Lmxlbmd0aCkge1xuICAgICAgICAgIFNvdXJjZUhlYWRlcnNba10gPSB2O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGVwLmVtaXQoJ2dldF9maWxlX3NpemVfZmluaXNoJyk7XG4gICAgfVxuICB9KTtcbn0gLy8g5aSN5Yi25oyH5a6a5YiG54mHXG5cblxuZnVuY3Rpb24gY29weVNsaWNlSXRlbShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgQ29weVNvdXJjZSA9IHBhcmFtcy5Db3B5U291cmNlO1xuICB2YXIgVXBsb2FkSWQgPSBwYXJhbXMuVXBsb2FkSWQ7XG4gIHZhciBQYXJ0TnVtYmVyID0gcGFyYW1zLlBhcnROdW1iZXIgKiAxO1xuICB2YXIgQ29weVNvdXJjZVJhbmdlID0gcGFyYW1zLkNvcHlTb3VyY2VSYW5nZTtcbiAgdmFyIENodW5rUmV0cnlUaW1lcyA9IHRoaXMub3B0aW9ucy5DaHVua1JldHJ5VGltZXMgKyAxO1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIEFzeW5jLnJldHJ5KENodW5rUmV0cnlUaW1lcywgZnVuY3Rpb24gKHRyeUNhbGxiYWNrKSB7XG4gICAgc2VsZi51cGxvYWRQYXJ0Q29weSh7XG4gICAgICBUYXNrSWQ6IFRhc2tJZCxcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBLZXk6IEtleSxcbiAgICAgIENvcHlTb3VyY2U6IENvcHlTb3VyY2UsXG4gICAgICBVcGxvYWRJZDogVXBsb2FkSWQsXG4gICAgICBQYXJ0TnVtYmVyOiBQYXJ0TnVtYmVyLFxuICAgICAgQ29weVNvdXJjZVJhbmdlOiBDb3B5U291cmNlUmFuZ2VcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICB0cnlDYWxsYmFjayhlcnIgfHwgbnVsbCwgZGF0YSk7XG4gICAgfSk7XG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICByZXR1cm4gY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgfSk7XG59XG5cbnZhciBBUElfTUFQID0ge1xuICBzbGljZVVwbG9hZEZpbGU6IHNsaWNlVXBsb2FkRmlsZSxcbiAgYWJvcnRVcGxvYWRUYXNrOiBhYm9ydFVwbG9hZFRhc2ssXG4gIHVwbG9hZEZpbGU6IHVwbG9hZEZpbGUsXG4gIHVwbG9hZEZpbGVzOiB1cGxvYWRGaWxlcyxcbiAgc2xpY2VDb3B5RmlsZTogc2xpY2VDb3B5RmlsZVxufTtcblxubW9kdWxlLmV4cG9ydHMuaW5pdCA9IGZ1bmN0aW9uIChDT1MsIHRhc2spIHtcbiAgdGFzay50cmFuc2ZlclRvVGFza01ldGhvZChBUElfTUFQLCAnc2xpY2VVcGxvYWRGaWxlJyk7XG4gIHV0aWwuZWFjaChBUElfTUFQLCBmdW5jdGlvbiAoZm4sIGFwaU5hbWUpIHtcbiAgICBDT1MucHJvdG90eXBlW2FwaU5hbWVdID0gdXRpbC5hcGlXcmFwcGVyKGFwaU5hbWUsIGZuKTtcbiAgfSk7XG59O1xuXG4vKioqLyB9KSxcblxuLyoqKi8gXCIuL3NyYy9hc3luYy5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKiEqXFxcbiAgISoqKiAuL3NyYy9hc3luYy5qcyAqKiohXG4gIFxcKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG52YXIgZWFjaExpbWl0ID0gZnVuY3Rpb24gZWFjaExpbWl0KGFyciwgbGltaXQsIGl0ZXJhdG9yLCBjYWxsYmFjaykge1xuICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uICgpIHt9O1xuXG4gIGlmICghYXJyLmxlbmd0aCB8fCBsaW1pdCA8PSAwKSB7XG4gICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gIH1cblxuICB2YXIgY29tcGxldGVkID0gMDtcbiAgdmFyIHN0YXJ0ZWQgPSAwO1xuICB2YXIgcnVubmluZyA9IDA7XG5cbiAgKGZ1bmN0aW9uIHJlcGxlbmlzaCgpIHtcbiAgICBpZiAoY29tcGxldGVkID49IGFyci5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cblxuICAgIHdoaWxlIChydW5uaW5nIDwgbGltaXQgJiYgc3RhcnRlZCA8IGFyci5sZW5ndGgpIHtcbiAgICAgIHN0YXJ0ZWQgKz0gMTtcbiAgICAgIHJ1bm5pbmcgKz0gMTtcbiAgICAgIGl0ZXJhdG9yKGFycltzdGFydGVkIC0gMV0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNhbGxiYWNrKGVycik7XG5cbiAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKCkge307XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29tcGxldGVkICs9IDE7XG4gICAgICAgICAgcnVubmluZyAtPSAxO1xuXG4gICAgICAgICAgaWYgKGNvbXBsZXRlZCA+PSBhcnIubGVuZ3RoKSB7XG4gICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXBsZW5pc2goKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSkoKTtcbn07XG5cbnZhciByZXRyeSA9IGZ1bmN0aW9uIHJldHJ5KHRpbWVzLCBpdGVyYXRvciwgY2FsbGJhY2spIHtcbiAgdmFyIG5leHQgPSBmdW5jdGlvbiBuZXh0KGluZGV4KSB7XG4gICAgaXRlcmF0b3IoZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVyciAmJiBpbmRleCA8IHRpbWVzKSB7XG4gICAgICAgIG5leHQoaW5kZXggKyAxKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgaWYgKHRpbWVzIDwgMSkge1xuICAgIGNhbGxiYWNrKCk7XG4gIH0gZWxzZSB7XG4gICAgbmV4dCgxKTtcbiAgfVxufTtcblxudmFyIGFzeW5jID0ge1xuICBlYWNoTGltaXQ6IGVhY2hMaW1pdCxcbiAgcmV0cnk6IHJldHJ5XG59O1xubW9kdWxlLmV4cG9ydHMgPSBhc3luYztcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvYmFzZS5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vc3JjL2Jhc2UuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgUkVRVUVTVCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL2xpYi9yZXF1ZXN0ICovIFwiLi9saWIvcmVxdWVzdC5qc1wiKTtcblxudmFyIHV0aWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3V0aWwgKi8gXCIuL3NyYy91dGlsLmpzXCIpOyAvLyBCdWNrZXQg55u45YWzXG5cbi8qKlxuICog6I635Y+W55So5oi355qEIGJ1Y2tldCDliJfooahcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu++8jOS4i+mdouS4uuWPguaVsOWIl+ihqFxuICog5peg54m55q6K5Y+C5pWwXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqL1xuXG5cbmZ1bmN0aW9uIGdldFNlcnZpY2UocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIHBhcmFtcyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNhbGxiYWNrID0gcGFyYW1zO1xuICAgIHBhcmFtcyA9IHt9O1xuICB9XG5cbiAgdmFyIHByb3RvY29sID0gdGhpcy5vcHRpb25zLlByb3RvY29sIHx8ICh1dGlsLmlzQnJvd3NlciAmJiBsb2NhdGlvbi5wcm90b2NvbCA9PT0gJ2h0dHA6JyA/ICdodHRwOicgOiAnaHR0cHM6Jyk7XG4gIHZhciBkb21haW4gPSB0aGlzLm9wdGlvbnMuU2VydmljZURvbWFpbjtcbiAgdmFyIGFwcElkID0gcGFyYW1zLkFwcElkIHx8IHRoaXMub3B0aW9ucy5hcHBJZDtcbiAgdmFyIHJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG5cbiAgaWYgKGRvbWFpbikge1xuICAgIGRvbWFpbiA9IGRvbWFpbi5yZXBsYWNlKC9cXHtcXHtBcHBJZFxcfVxcfS9pZywgYXBwSWQgfHwgJycpLnJlcGxhY2UoL1xce1xce1JlZ2lvblxcfVxcfS9pZywgcmVnaW9uIHx8ICcnKS5yZXBsYWNlKC9cXHtcXHsuKj9cXH1cXH0vaWcsICcnKTtcblxuICAgIGlmICghL15bYS16QS1aXSs6XFwvXFwvLy50ZXN0KGRvbWFpbikpIHtcbiAgICAgIGRvbWFpbiA9IHByb3RvY29sICsgJy8vJyArIGRvbWFpbjtcbiAgICB9XG5cbiAgICBpZiAoZG9tYWluLnNsaWNlKC0xKSA9PT0gJy8nKSB7XG4gICAgICBkb21haW4gPSBkb21haW4uc2xpY2UoMCwgLTEpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZWdpb24pIHtcbiAgICBkb21haW4gPSBwcm90b2NvbCArICcvL2Nvcy4nICsgcmVnaW9uICsgJy5teXFjbG91ZC5jb20nO1xuICB9IGVsc2Uge1xuICAgIGRvbWFpbiA9IHByb3RvY29sICsgJy8vc2VydmljZS5jb3MubXlxY2xvdWQuY29tJztcbiAgfVxuXG4gIHZhciBTaWduSG9zdCA9ICcnO1xuICB2YXIgc3RhbmRhcmRIb3N0ID0gcmVnaW9uID8gJ2Nvcy4nICsgcmVnaW9uICsgJy5teXFjbG91ZC5jb20nIDogJ3NlcnZpY2UuY29zLm15cWNsb3VkLmNvbSc7XG4gIHZhciB1cmxIb3N0ID0gZG9tYWluLnJlcGxhY2UoL15odHRwcz86XFwvXFwvKFteL10rKShcXC8uKik/JC8sICckMScpO1xuICBpZiAoc3RhbmRhcmRIb3N0ID09PSB1cmxIb3N0KSBTaWduSG9zdCA9IHN0YW5kYXJkSG9zdDtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRTZXJ2aWNlJyxcbiAgICB1cmw6IGRvbWFpbixcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIFNpZ25Ib3N0OiBTaWduSG9zdFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIGJ1Y2tldHMgPSBkYXRhICYmIGRhdGEuTGlzdEFsbE15QnVja2V0c1Jlc3VsdCAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQuQnVja2V0cyAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQuQnVja2V0cy5CdWNrZXQgfHwgW107XG4gICAgYnVja2V0cyA9IHV0aWwuaXNBcnJheShidWNrZXRzKSA/IGJ1Y2tldHMgOiBbYnVja2V0c107XG4gICAgdmFyIG93bmVyID0gZGF0YSAmJiBkYXRhLkxpc3RBbGxNeUJ1Y2tldHNSZXN1bHQgJiYgZGF0YS5MaXN0QWxsTXlCdWNrZXRzUmVzdWx0Lk93bmVyIHx8IHt9O1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIEJ1Y2tldHM6IGJ1Y2tldHMsXG4gICAgICBPd25lcjogb3duZXIsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOWIm+W7uiBCdWNrZXTvvIzlubbliJ3lp4vljJborr/pl67mnYPpmZBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQUNMICAgICAgICAgICAgICAgICDnlKjmiLfoh6rlrprkuYnmlofku7bmnYPpmZDvvIzlj6/ku6Xorr7nva7vvJpwcml2YXRl77yMcHVibGljLXJlYWTvvJvpu5jorqTlgLzvvJpwcml2YXRl77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZCAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+755qE5p2D6ZmQ77yM5qC85byPeC1jb3MtZ3JhbnQtcmVhZDogdWluPVwiIFwiLHVpbj1cIiBcIu+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFdyaXRlICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheWGmeeahOadg+mZkO+8jOagvOW8j3gtY29zLWdyYW50LXdyaXRlOiB1aW49XCIgXCIsdWluPVwiIFwi77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50RnVsbENvbnRyb2wgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+75YaZ5p2D6ZmQ77yM5qC85byPeC1jb3MtZ3JhbnQtZnVsbC1jb250cm9sOiB1aW49XCIgXCIsdWluPVwiIFwi77yM6Z2e5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKiAgICAgQHJldHVybiAge1N0cmluZ30gIGRhdGEuTG9jYXRpb24gICAgICAgICAgICAg5pON5L2c5Zyw5Z2AXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB4bWwgPSAnJztcblxuICBpZiAocGFyYW1zWydCdWNrZXRBWkNvbmZpZyddKSB7XG4gICAgdmFyIENyZWF0ZUJ1Y2tldENvbmZpZ3VyYXRpb24gPSB7XG4gICAgICBCdWNrZXRBWkNvbmZpZzogcGFyYW1zLkJ1Y2tldEFaQ29uZmlnXG4gICAgfTtcbiAgICB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICAgIENyZWF0ZUJ1Y2tldENvbmZpZ3VyYXRpb246IENyZWF0ZUJ1Y2tldENvbmZpZ3VyYXRpb25cbiAgICB9KTtcbiAgfVxuXG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0JyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYm9keTogeG1sXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgIHByb3RvY29sOiBzZWxmLm9wdGlvbnMuUHJvdG9jb2wsXG4gICAgICBkb21haW46IHNlbGYub3B0aW9ucy5Eb21haW4sXG4gICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICByZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBpc0xvY2F0aW9uOiB0cnVlXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgTG9jYXRpb246IHVybCxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog5p+l55yL5piv5ZCm5a2Y5Zyo6K+lQnVja2V077yM5piv5ZCm5pyJ5p2D6ZmQ6K6/6ZeuXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKiAgICAgQHJldHVybiAge0Jvb2xlYW59ICBkYXRhLkJ1Y2tldEV4aXN0ICAgICBCdWNrZXTmmK/lkKblrZjlnKhcbiAqICAgICBAcmV0dXJuICB7Qm9vbGVhbn0gIGRhdGEuQnVja2V0QXV0aCAgICAgIOaYr+WQpuaciSBCdWNrZXQg55qE6K6/6Zeu5p2D6ZmQXG4gKi9cblxuXG5mdW5jdGlvbiBoZWFkQnVja2V0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpIZWFkQnVja2V0JyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIG1ldGhvZDogJ0hFQUQnXG4gIH0sIGNhbGxiYWNrKTtcbn1cbi8qKlxuICog6I635Y+WIEJ1Y2tldCDkuIvnmoQgb2JqZWN0IOWIl+ihqFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5QcmVmaXggICAgICAgICAgICAgIOWJjee8gOWMuemFje+8jOeUqOadpeinhOWumui/lOWbnueahOaWh+S7tuWJjee8gOWcsOWdgO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5EZWxpbWl0ZXIgICAgICAgICAgIOWumueVjOespuS4uuS4gOS4quespuWPt++8jOWmguaenOaciVByZWZpeO+8jOWImeWwhlByZWZpeOWIsGRlbGltaXRlcuS5i+mXtOeahOebuOWQjOi3r+W+hOW9kuS4uuS4gOexu++8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NYXJrZXIgICAgICAgICAgICAgIOm7mOiupOS7pVVURi045LqM6L+b5Yi26aG65bqP5YiX5Ye65p2h55uu77yM5omA5pyJ5YiX5Ye65p2h55uu5LuObWFya2Vy5byA5aeL77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLk1heEtleXMgICAgICAgICAgICAg5Y2V5qyh6L+U5Zue5pyA5aSn55qE5p2h55uu5pWw6YeP77yM6buY6K6kMTAwMO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FbmNvZGluZ1R5cGUgICAgICAgIOinhOWumui/lOWbnuWAvOeahOe8lueggeaWueW8j++8jOmdnuW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkxpc3RCdWNrZXRSZXN1bHQgICAgIOi/lOWbnueahCBvYmplY3Qg5YiX6KGo5L+h5oGvXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0ge307XG4gIHJlcVBhcmFtc1sncHJlZml4J10gPSBwYXJhbXNbJ1ByZWZpeCddIHx8ICcnO1xuICByZXFQYXJhbXNbJ2RlbGltaXRlciddID0gcGFyYW1zWydEZWxpbWl0ZXInXTtcbiAgcmVxUGFyYW1zWydtYXJrZXInXSA9IHBhcmFtc1snTWFya2VyJ107XG4gIHJlcVBhcmFtc1snbWF4LWtleXMnXSA9IHBhcmFtc1snTWF4S2V5cyddO1xuICByZXFQYXJhbXNbJ2VuY29kaW5nLXR5cGUnXSA9IHBhcmFtc1snRW5jb2RpbmdUeXBlJ107XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0JyxcbiAgICBSZXNvdXJjZUtleTogcmVxUGFyYW1zWydwcmVmaXgnXSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIExpc3RCdWNrZXRSZXN1bHQgPSBkYXRhLkxpc3RCdWNrZXRSZXN1bHQgfHwge307XG4gICAgdmFyIENvbnRlbnRzID0gTGlzdEJ1Y2tldFJlc3VsdC5Db250ZW50cyB8fCBbXTtcbiAgICB2YXIgQ29tbW9uUHJlZml4ZXMgPSBMaXN0QnVja2V0UmVzdWx0LkNvbW1vblByZWZpeGVzIHx8IFtdO1xuICAgIENvbnRlbnRzID0gdXRpbC5pc0FycmF5KENvbnRlbnRzKSA/IENvbnRlbnRzIDogW0NvbnRlbnRzXTtcbiAgICBDb21tb25QcmVmaXhlcyA9IHV0aWwuaXNBcnJheShDb21tb25QcmVmaXhlcykgPyBDb21tb25QcmVmaXhlcyA6IFtDb21tb25QcmVmaXhlc107XG4gICAgdmFyIHJlc3VsdCA9IHV0aWwuY2xvbmUoTGlzdEJ1Y2tldFJlc3VsdCk7XG4gICAgdXRpbC5leHRlbmQocmVzdWx0LCB7XG4gICAgICBDb250ZW50czogQ29udGVudHMsXG4gICAgICBDb21tb25QcmVmaXhlczogQ29tbW9uUHJlZml4ZXMsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cbi8qKlxuICog5Yig6ZmkIEJ1Y2tldFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICogICAgIEByZXR1cm4gIHtTdHJpbmd9ICBkYXRhLkxvY2F0aW9uICAgICDmk43kvZzlnLDlnYBcbiAqL1xuXG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0JyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIG1ldGhvZDogJ0RFTEVURSdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiuvue9riBCdWNrZXQg55qEIOadg+mZkOWIl+ihqFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5BQ0wgICAgICAgICAgICAgICAgIOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkO+8jOWPr+S7peiuvue9ru+8mnByaXZhdGXvvIxwdWJsaWMtcmVhZO+8m+m7mOiupOWAvO+8mnByaXZhdGXvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRSZWFkICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vnmoTmnYPpmZDvvIzmoLzlvI94LWNvcy1ncmFudC1yZWFkOiB1aW49XCIgXCIsdWluPVwiIFwi77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGUgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF5YaZ55qE5p2D6ZmQ77yM5qC85byPeC1jb3MtZ3JhbnQtd3JpdGU6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRGdWxsQ29udHJvbCAgICDotYvkuojooqvmjojmnYPogIXor7vlhpnmnYPpmZDvvIzmoLzlvI94LWNvcy1ncmFudC1mdWxsLWNvbnRyb2w6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldEFjbChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIHZhciB4bWwgPSAnJztcblxuICBpZiAocGFyYW1zWydBY2Nlc3NDb250cm9sUG9saWN5J10pIHtcbiAgICB2YXIgQWNjZXNzQ29udHJvbFBvbGljeSA9IHV0aWwuY2xvbmUocGFyYW1zWydBY2Nlc3NDb250cm9sUG9saWN5J10gfHwge30pO1xuICAgIHZhciBHcmFudHMgPSBBY2Nlc3NDb250cm9sUG9saWN5LkdyYW50cyB8fCBBY2Nlc3NDb250cm9sUG9saWN5LkdyYW50O1xuICAgIEdyYW50cyA9IHV0aWwuaXNBcnJheShHcmFudHMpID8gR3JhbnRzIDogW0dyYW50c107XG4gICAgZGVsZXRlIEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnQ7XG4gICAgZGVsZXRlIEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnRzO1xuICAgIEFjY2Vzc0NvbnRyb2xQb2xpY3kuQWNjZXNzQ29udHJvbExpc3QgPSB7XG4gICAgICBHcmFudDogR3JhbnRzXG4gICAgfTtcbiAgICB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICAgIEFjY2Vzc0NvbnRyb2xQb2xpY3k6IEFjY2Vzc0NvbnRyb2xQb2xpY3lcbiAgICB9KTtcbiAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICAgIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgfSAvLyBHcmFudCBIZWFkZXIg5Y676YeNXG5cblxuICB1dGlsLmVhY2goaGVhZGVycywgZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgaWYgKGtleS5pbmRleE9mKCd4LWNvcy1ncmFudC0nKSA9PT0gMCkge1xuICAgICAgaGVhZGVyc1trZXldID0gdW5pcUdyYW50KGhlYWRlcnNba2V5XSk7XG4gICAgfVxuICB9KTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRBQ0wnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIGFjdGlvbjogJ2FjbCcsXG4gICAgYm9keTogeG1sXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPliBCdWNrZXQg55qEIOadg+mZkOWIl+ihqFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkFjY2Vzc0NvbnRyb2xQb2xpY3kgIOiuv+mXruadg+mZkOS/oeaBr1xuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0QWNsKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRBQ0wnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdhY2wnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgQWNjZXNzQ29udHJvbFBvbGljeSA9IGRhdGEuQWNjZXNzQ29udHJvbFBvbGljeSB8fCB7fTtcbiAgICB2YXIgT3duZXIgPSBBY2Nlc3NDb250cm9sUG9saWN5Lk93bmVyIHx8IHt9O1xuICAgIHZhciBHcmFudCA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuQWNjZXNzQ29udHJvbExpc3QuR3JhbnQgfHwgW107XG4gICAgR3JhbnQgPSB1dGlsLmlzQXJyYXkoR3JhbnQpID8gR3JhbnQgOiBbR3JhbnRdO1xuICAgIHZhciByZXN1bHQgPSBkZWNvZGVBY2woQWNjZXNzQ29udHJvbFBvbGljeSk7XG5cbiAgICBpZiAoZGF0YS5oZWFkZXJzICYmIGRhdGEuaGVhZGVyc1sneC1jb3MtYWNsJ10pIHtcbiAgICAgIHJlc3VsdC5BQ0wgPSBkYXRhLmhlYWRlcnNbJ3gtY29zLWFjbCddO1xuICAgIH1cblxuICAgIHJlc3VsdCA9IHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgT3duZXI6IE93bmVyLFxuICAgICAgR3JhbnRzOiBHcmFudCxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXG4gKiDorr7nva4gQnVja2V0IOeahCDot6jln5/orr7nva5cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMuQ09SU0NvbmZpZ3VyYXRpb24gICAgICAg55u45YWz55qE6Leo5Z+f6K6+572u77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtBcnJheX0gIHBhcmFtcy5DT1JTQ29uZmlndXJhdGlvbi5DT1JTUnVsZXMgIOWvueW6lOeahOi3qOWfn+inhOWImVxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0Q29ycyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBDT1JTQ29uZmlndXJhdGlvbiA9IHBhcmFtc1snQ09SU0NvbmZpZ3VyYXRpb24nXSB8fCB7fTtcbiAgdmFyIENPUlNSdWxlcyA9IENPUlNDb25maWd1cmF0aW9uWydDT1JTUnVsZXMnXSB8fCBwYXJhbXNbJ0NPUlNSdWxlcyddIHx8IFtdO1xuICBDT1JTUnVsZXMgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShDT1JTUnVsZXMpID8gQ09SU1J1bGVzIDogW0NPUlNSdWxlc10pO1xuICB1dGlsLmVhY2goQ09SU1J1bGVzLCBmdW5jdGlvbiAocnVsZSkge1xuICAgIHV0aWwuZWFjaChbJ0FsbG93ZWRPcmlnaW4nLCAnQWxsb3dlZEhlYWRlcicsICdBbGxvd2VkTWV0aG9kJywgJ0V4cG9zZUhlYWRlciddLCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICB2YXIgc0tleSA9IGtleSArICdzJztcbiAgICAgIHZhciB2YWwgPSBydWxlW3NLZXldIHx8IHJ1bGVba2V5XSB8fCBbXTtcbiAgICAgIGRlbGV0ZSBydWxlW3NLZXldO1xuICAgICAgcnVsZVtrZXldID0gdXRpbC5pc0FycmF5KHZhbCkgPyB2YWwgOiBbdmFsXTtcbiAgICB9KTtcbiAgfSk7XG4gIHZhciBDb25mID0ge1xuICAgIENPUlNSdWxlOiBDT1JTUnVsZXNcbiAgfTtcbiAgaWYgKHBhcmFtcy5SZXNwb25zZVZhcnkpIENvbmYuUmVzcG9uc2VWYXJ5ID0gcGFyYW1zLlJlc3BvbnNlVmFyeTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIENPUlNDb25maWd1cmF0aW9uOiBDb25mXG4gIH0pO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0Q09SUycsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdjb3JzJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPliBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhLkNPUlNSdWxlcyAgICAgICAgICAgIEJ1Y2tldOeahOi3qOWfn+iuvue9rlxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0Q29ycyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0Q09SUycsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2NvcnMnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IgJiYgZXJyLmVycm9yLkNvZGUgPT09ICdOb1N1Y2hDT1JTQ29uZmlndXJhdGlvbicpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgICBDT1JTUnVsZXM6IFtdLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH07XG4gICAgICAgIGVyci5oZWFkZXJzICYmIChyZXN1bHQuaGVhZGVycyA9IGVyci5oZWFkZXJzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgQ09SU0NvbmZpZ3VyYXRpb24gPSBkYXRhLkNPUlNDb25maWd1cmF0aW9uIHx8IHt9O1xuICAgIHZhciBDT1JTUnVsZXMgPSBDT1JTQ29uZmlndXJhdGlvbi5DT1JTUnVsZXMgfHwgQ09SU0NvbmZpZ3VyYXRpb24uQ09SU1J1bGUgfHwgW107XG4gICAgQ09SU1J1bGVzID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoQ09SU1J1bGVzKSA/IENPUlNSdWxlcyA6IFtDT1JTUnVsZXNdKTtcbiAgICB2YXIgUmVzcG9uc2VWYXJ5ID0gQ09SU0NvbmZpZ3VyYXRpb24uUmVzcG9uc2VWYXJ5O1xuICAgIHV0aWwuZWFjaChDT1JTUnVsZXMsIGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICB1dGlsLmVhY2goWydBbGxvd2VkT3JpZ2luJywgJ0FsbG93ZWRIZWFkZXInLCAnQWxsb3dlZE1ldGhvZCcsICdFeHBvc2VIZWFkZXInXSwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgc0tleSA9IGtleSArICdzJztcbiAgICAgICAgdmFyIHZhbCA9IHJ1bGVbc0tleV0gfHwgcnVsZVtrZXldIHx8IFtdO1xuICAgICAgICBkZWxldGUgcnVsZVtrZXldO1xuICAgICAgICBydWxlW3NLZXldID0gdXRpbC5pc0FycmF5KHZhbCkgPyB2YWwgOiBbdmFsXTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIENPUlNSdWxlczogQ09SU1J1bGVzLFxuICAgICAgUmVzcG9uc2VWYXJ5OiBSZXNwb25zZVZhcnksXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOWIoOmZpCBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0Q29ycyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0Q09SUycsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2NvcnMnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlIHx8IGVyci5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDojrflj5YgQnVja2V0IOeahCDlnLDln5/kv6Hmga9cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja7vvIzljIXlkKvlnLDln5/kv6Hmga8gTG9jYXRpb25Db25zdHJhaW50XG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRMb2NhdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0TG9jYXRpb24nLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdsb2NhdGlvbidcbiAgfSwgY2FsbGJhY2spO1xufVxuXG5mdW5jdGlvbiBwdXRCdWNrZXRQb2xpY3kocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgUG9saWN5ID0gcGFyYW1zWydQb2xpY3knXTtcblxuICB0cnkge1xuICAgIGlmICh0eXBlb2YgUG9saWN5ID09PSAnc3RyaW5nJykgUG9saWN5ID0gSlNPTi5wYXJzZShQb2xpY3kpO1xuICB9IGNhdGNoIChlKSB7fVxuXG4gIGlmICghUG9saWN5IHx8IHR5cGVvZiBQb2xpY3kgPT09ICdzdHJpbmcnKSByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ1BvbGljeSBmb3JtYXQgZXJyb3InKSkpO1xuICB2YXIgUG9saWN5U3RyID0gSlNPTi5zdHJpbmdpZnkoUG9saWN5KTtcbiAgaWYgKCFQb2xpY3kudmVyc2lvbikgUG9saWN5LnZlcnNpb24gPSAnMi4wJztcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNShQb2xpY3lTdHIpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRQb2xpY3knLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBhY3Rpb246ICdwb2xpY3knLFxuICAgIGJvZHk6IFBvbGljeVN0cixcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDojrflj5YgQnVja2V0IOeahOivu+WPluadg+mZkOetlueVpVxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0UG9saWN5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRQb2xpY3knLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdwb2xpY3knLFxuICAgIHJhd0JvZHk6IHRydWVcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gNDAzKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKGVyciwge1xuICAgICAgICAgIEVycm9yU3RhdHVzOiAnQWNjZXNzIERlbmllZCdcbiAgICAgICAgfSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDQwNSkge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihlcnIsIHtcbiAgICAgICAgICBFcnJvclN0YXR1czogJ01ldGhvZCBOb3QgQWxsb3dlZCdcbiAgICAgICAgfSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDQwNCkge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2sodXRpbC5lcnJvcihlcnIsIHtcbiAgICAgICAgICBFcnJvclN0YXR1czogJ1BvbGljeSBOb3QgRm91bmQnXG4gICAgICAgIH0pKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgdmFyIFBvbGljeSA9IHt9O1xuXG4gICAgdHJ5IHtcbiAgICAgIFBvbGljeSA9IEpTT04ucGFyc2UoZGF0YS5ib2R5KTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgUG9saWN5OiBQb2xpY3ksXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOWIoOmZpCBCdWNrZXQg55qEIOi3qOWfn+iuvue9rlxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0UG9saWN5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRQb2xpY3knLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdwb2xpY3knXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlIHx8IGVyci5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDorr7nva4gQnVja2V0IOeahOagh+etvlxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge0FycmF5fSAgIHBhcmFtcy5UYWdTZXQgIOagh+etvuiuvue9ru+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0VGFnZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBUYWdnaW5nID0gcGFyYW1zWydUYWdnaW5nJ10gfHwge307XG4gIHZhciBUYWdzID0gVGFnZ2luZy5UYWdTZXQgfHwgVGFnZ2luZy5UYWdzIHx8IHBhcmFtc1snVGFncyddIHx8IFtdO1xuICBUYWdzID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoVGFncykgPyBUYWdzIDogW1RhZ3NdKTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIFRhZ2dpbmc6IHtcbiAgICAgIFRhZ1NldDoge1xuICAgICAgICBUYWc6IFRhZ3NcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0QnVja2V0VGFnZ2luZycsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICd0YWdnaW5nJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDojrflj5YgQnVja2V0IOeahOagh+etvuiuvue9rlxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0VGFnZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0VGFnZ2luZycsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3RhZ2dpbmcnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IgJiYgKGVyci5lcnJvciA9PT0gXCJOb3QgRm91bmRcIiB8fCBlcnIuZXJyb3IuQ29kZSA9PT0gJ05vU3VjaFRhZ1NldCcpKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgVGFnczogW10sXG4gICAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgICAgfTtcbiAgICAgICAgZXJyLmhlYWRlcnMgJiYgKHJlc3VsdC5oZWFkZXJzID0gZXJyLmhlYWRlcnMpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBUYWdzID0gW107XG5cbiAgICB0cnkge1xuICAgICAgVGFncyA9IGRhdGEuVGFnZ2luZy5UYWdTZXQuVGFnIHx8IFtdO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICBUYWdzID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoVGFncykgPyBUYWdzIDogW1RhZ3NdKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBUYWdzOiBUYWdzLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDliKDpmaQgQnVja2V0IOeahCDmoIfnrb7orr7nva5cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldFRhZ2dpbmcocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldFRhZ2dpbmcnLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd0YWdnaW5nJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcHV0QnVja2V0TGlmZWN5Y2xlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIExpZmVjeWNsZUNvbmZpZ3VyYXRpb24gPSBwYXJhbXNbJ0xpZmVjeWNsZUNvbmZpZ3VyYXRpb24nXSB8fCB7fTtcbiAgdmFyIFJ1bGVzID0gTGlmZWN5Y2xlQ29uZmlndXJhdGlvbi5SdWxlcyB8fCBwYXJhbXMuUnVsZXMgfHwgW107XG4gIFJ1bGVzID0gdXRpbC5jbG9uZShSdWxlcyk7XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBMaWZlY3ljbGVDb25maWd1cmF0aW9uOiB7XG4gICAgICBSdWxlOiBSdWxlc1xuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRMaWZlY3ljbGUnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnbGlmZWN5Y2xlJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCdWNrZXRMaWZlY3ljbGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldExpZmVjeWNsZScsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2xpZmVjeWNsZSdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDA0ICYmIGVyci5lcnJvciAmJiBlcnIuZXJyb3IuQ29kZSA9PT0gJ05vU3VjaExpZmVjeWNsZUNvbmZpZ3VyYXRpb24nKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgUnVsZXM6IFtdLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH07XG4gICAgICAgIGVyci5oZWFkZXJzICYmIChyZXN1bHQuaGVhZGVycyA9IGVyci5oZWFkZXJzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgUnVsZXMgPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBSdWxlcyA9IGRhdGEuTGlmZWN5Y2xlQ29uZmlndXJhdGlvbi5SdWxlIHx8IFtdO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICBSdWxlcyA9IHV0aWwuY2xvbmUodXRpbC5pc0FycmF5KFJ1bGVzKSA/IFJ1bGVzIDogW1J1bGVzXSk7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgUnVsZXM6IFJ1bGVzLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkZWxldGVCdWNrZXRMaWZlY3ljbGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldExpZmVjeWNsZScsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2xpZmVjeWNsZSdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldFZlcnNpb25pbmcocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAoIXBhcmFtc1snVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb24nXSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFZlcnNpb25pbmdDb25maWd1cmF0aW9uJykpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb24gPSBwYXJhbXNbJ1ZlcnNpb25pbmdDb25maWd1cmF0aW9uJ10gfHwge307XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBWZXJzaW9uaW5nQ29uZmlndXJhdGlvbjogVmVyc2lvbmluZ0NvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRWZXJzaW9uaW5nJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3ZlcnNpb25pbmcnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGdldEJ1Y2tldFZlcnNpb25pbmcocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldFZlcnNpb25pbmcnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd2ZXJzaW9uaW5nJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKCFlcnIpIHtcbiAgICAgICFkYXRhLlZlcnNpb25pbmdDb25maWd1cmF0aW9uICYmIChkYXRhLlZlcnNpb25pbmdDb25maWd1cmF0aW9uID0ge30pO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBwdXRCdWNrZXRSZXBsaWNhdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBSZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24gPSB1dGlsLmNsb25lKHBhcmFtcy5SZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb24pO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgUmVwbGljYXRpb25Db25maWd1cmF0aW9uOiBSZXBsaWNhdGlvbkNvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHhtbCA9IHhtbC5yZXBsYWNlKC88KFxcLz8pUnVsZXM+L2lnLCAnPCQxUnVsZT4nKTtcbiAgeG1sID0geG1sLnJlcGxhY2UoLzwoXFwvPylUYWdzPi9pZywgJzwkMVRhZz4nKTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldFJlcGxpY2F0aW9uJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3JlcGxpY2F0aW9uJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCdWNrZXRSZXBsaWNhdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0UmVwbGljYXRpb24nLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdyZXBsaWNhdGlvbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDA0ICYmIGVyci5lcnJvciAmJiAoZXJyLmVycm9yID09PSAnTm90IEZvdW5kJyB8fCBlcnIuZXJyb3IuQ29kZSA9PT0gJ1JlcGxpY2F0aW9uQ29uZmlndXJhdGlvbm5vdEZvdW5kRXJyb3InKSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgIFJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgUnVsZXM6IFtdXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9O1xuICAgICAgICBlcnIuaGVhZGVycyAmJiAocmVzdWx0LmhlYWRlcnMgPSBlcnIuaGVhZGVycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgIWRhdGEuUmVwbGljYXRpb25Db25maWd1cmF0aW9uICYmIChkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbiA9IHt9KTtcblxuICAgIGlmIChkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbi5SdWxlKSB7XG4gICAgICBkYXRhLlJlcGxpY2F0aW9uQ29uZmlndXJhdGlvbi5SdWxlcyA9IHV0aWwubWFrZUFycmF5KGRhdGEuUmVwbGljYXRpb25Db25maWd1cmF0aW9uLlJ1bGUpO1xuICAgICAgZGVsZXRlIGRhdGEuUmVwbGljYXRpb25Db25maWd1cmF0aW9uLlJ1bGU7XG4gICAgfVxuXG4gICAgY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldFJlcGxpY2F0aW9uKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXRSZXBsaWNhdGlvbicsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3JlcGxpY2F0aW9uJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6K6+572uIEJ1Y2tldCDpnZnmgIHnvZHnq5nphY3nva7kv6Hmga9cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMuV2Vic2l0ZUNvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICAgICAgQHBhcmFtICB7T2JqZWN0fSAgIFdlYnNpdGVDb25maWd1cmF0aW9uLkluZGV4RG9jdW1lbnQgICAgICAgICAgICDntKLlvJXmlofmoaPvvIzlv4XpobtcbiAqICAgICAgICAgQHBhcmFtICB7T2JqZWN0fSAgIFdlYnNpdGVDb25maWd1cmF0aW9uLkVycm9yRG9jdW1lbnQgICAgICAgICAgICDplJnor6/mlofmoaPvvIzpnZ7lv4XpobtcbiAqICAgICAgICAgQHBhcmFtICB7T2JqZWN0fSAgIFdlYnNpdGVDb25maWd1cmF0aW9uLlJlZGlyZWN0QWxsUmVxdWVzdHNUbyAgICDph43lrprlkJHmiYDmnInor7fmsYLvvIzpnZ7lv4XpobtcbiAqICAgICAgICAgQHBhcmFtICB7QXJyYXl9ICAgcGFyYW1zLlJvdXRpbmdSdWxlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICDph43lrprlkJHop4TliJnvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldFdlYnNpdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBpZiAoIXBhcmFtc1snV2Vic2l0ZUNvbmZpZ3VyYXRpb24nXSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFdlYnNpdGVDb25maWd1cmF0aW9uJykpKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgV2Vic2l0ZUNvbmZpZ3VyYXRpb24gPSB1dGlsLmNsb25lKHBhcmFtc1snV2Vic2l0ZUNvbmZpZ3VyYXRpb24nXSB8fCB7fSk7XG4gIHZhciBSb3V0aW5nUnVsZXMgPSBXZWJzaXRlQ29uZmlndXJhdGlvblsnUm91dGluZ1J1bGVzJ10gfHwgV2Vic2l0ZUNvbmZpZ3VyYXRpb25bJ1JvdXRpbmdSdWxlJ10gfHwgW107XG4gIFJvdXRpbmdSdWxlcyA9IHV0aWwuaXNBcnJheShSb3V0aW5nUnVsZXMpID8gUm91dGluZ1J1bGVzIDogW1JvdXRpbmdSdWxlc107XG4gIGRlbGV0ZSBXZWJzaXRlQ29uZmlndXJhdGlvbi5Sb3V0aW5nUnVsZTtcbiAgZGVsZXRlIFdlYnNpdGVDb25maWd1cmF0aW9uLlJvdXRpbmdSdWxlcztcbiAgaWYgKFJvdXRpbmdSdWxlcy5sZW5ndGgpIFdlYnNpdGVDb25maWd1cmF0aW9uLlJvdXRpbmdSdWxlcyA9IHtcbiAgICBSb3V0aW5nUnVsZTogUm91dGluZ1J1bGVzXG4gIH07XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjogV2Vic2l0ZUNvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRXZWJzaXRlJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ3dlYnNpdGUnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPliBCdWNrZXQg55qE6Z2Z5oCB572R56uZ6YWN572u5L+h5oGvXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRXZWJzaXRlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRXZWJzaXRlJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3dlYnNpdGUnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuZXJyb3IuQ29kZSA9PT0gJ05vU3VjaFdlYnNpdGVDb25maWd1cmF0aW9uJykge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgIFdlYnNpdGVDb25maWd1cmF0aW9uOiB7fSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9O1xuICAgICAgICBlcnIuaGVhZGVycyAmJiAocmVzdWx0LmhlYWRlcnMgPSBlcnIuaGVhZGVycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIFdlYnNpdGVDb25maWd1cmF0aW9uID0gZGF0YS5XZWJzaXRlQ29uZmlndXJhdGlvbiB8fCB7fTtcblxuICAgIGlmIChXZWJzaXRlQ29uZmlndXJhdGlvblsnUm91dGluZ1J1bGVzJ10pIHtcbiAgICAgIHZhciBSb3V0aW5nUnVsZXMgPSB1dGlsLmNsb25lKFdlYnNpdGVDb25maWd1cmF0aW9uWydSb3V0aW5nUnVsZXMnXS5Sb3V0aW5nUnVsZSB8fCBbXSk7XG4gICAgICBSb3V0aW5nUnVsZXMgPSB1dGlsLm1ha2VBcnJheShSb3V0aW5nUnVsZXMpO1xuICAgICAgV2Vic2l0ZUNvbmZpZ3VyYXRpb24uUm91dGluZ1J1bGVzID0gUm91dGluZ1J1bGVzO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFdlYnNpdGVDb25maWd1cmF0aW9uOiBXZWJzaXRlQ29uZmlndXJhdGlvbixcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog5Yig6ZmkIEJ1Y2tldCDnmoTpnZnmgIHnvZHnq5nphY3nva5cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldFdlYnNpdGUocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldFdlYnNpdGUnLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd3ZWJzaXRlJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6K6+572uIEJ1Y2tldCDnmoTpmLLnm5fpk77nmb3lkI3ljZXmiJbogIXpu5HlkI3ljZVcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMuUmVmZXJlckNvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICAgICAgQHBhcmFtICB7U3RyaW5nfSAgIFJlZmVyZXJDb25maWd1cmF0aW9uLlN0YXR1cyAgICAgICAgICAgICAgICAgICDmmK/lkKblvIDlkK/pmLLnm5fpk77vvIzmnprkuL7lgLzvvJpFbmFibGVk44CBRGlzYWJsZWRcbiAqICAgICAgICAgQHBhcmFtICB7U3RyaW5nfSAgIFJlZmVyZXJDb25maWd1cmF0aW9uLlJlZmVyZXJUeXBlICAgICAgICAgICAgICDpmLLnm5fpk77nsbvlnovvvIzmnprkuL7lgLzvvJpCbGFjay1MaXN044CBV2hpdGUtTGlzdO+8jOW/hemhu1xuICogICAgICAgICBAcGFyYW0gIHtBcnJheX0gICBSZWZlcmVyQ29uZmlndXJhdGlvbi5Eb21pYW5MaXN0LkRvbWFpbiAgICAgICAgIOeUn+aViOWfn+WQje+8jOW/hemhu1xuICogICAgICAgICBAcGFyYW0gIHtTdHJpbmd9ICAgUmVmZXJlckNvbmZpZ3VyYXRpb24uRW1wdHlSZWZlckNvbmZpZ3VyYXRpb24gIO+8jOmdnuW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0UmVmZXJlcihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIGlmICghcGFyYW1zWydSZWZlcmVyQ29uZmlndXJhdGlvbiddKSB7XG4gICAgY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoJ21pc3NpbmcgcGFyYW0gUmVmZXJlckNvbmZpZ3VyYXRpb24nKSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBSZWZlcmVyQ29uZmlndXJhdGlvbiA9IHV0aWwuY2xvbmUocGFyYW1zWydSZWZlcmVyQ29uZmlndXJhdGlvbiddIHx8IHt9KTtcbiAgdmFyIERvbWFpbkxpc3QgPSBSZWZlcmVyQ29uZmlndXJhdGlvblsnRG9tYWluTGlzdCddIHx8IHt9O1xuICB2YXIgRG9tYWlucyA9IERvbWFpbkxpc3RbJ0RvbWFpbnMnXSB8fCBEb21haW5MaXN0WydEb21haW4nXSB8fCBbXTtcbiAgRG9tYWlucyA9IHV0aWwuaXNBcnJheShEb21haW5zKSA/IERvbWFpbnMgOiBbRG9tYWluc107XG4gIGlmIChEb21haW5zLmxlbmd0aCkgUmVmZXJlckNvbmZpZ3VyYXRpb24uRG9tYWluTGlzdCA9IHtcbiAgICBEb21haW46IERvbWFpbnNcbiAgfTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIFJlZmVyZXJDb25maWd1cmF0aW9uOiBSZWZlcmVyQ29uZmlndXJhdGlvblxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldFJlZmVyZXInLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAncmVmZXJlcicsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6I635Y+WIEJ1Y2tldCDnmoTpmLLnm5fpk77nmb3lkI3ljZXmiJbogIXpu5HlkI3ljZVcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldFJlZmVyZXIocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldFJlZmVyZXInLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAncmVmZXJlcidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDA0ICYmIGVyci5lcnJvci5Db2RlID09PSAnTm9TdWNoUmVmZXJlckNvbmZpZ3VyYXRpb24nKSB7XG4gICAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgICAgV2Vic2l0ZUNvbmZpZ3VyYXRpb246IHt9LFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH07XG4gICAgICAgIGVyci5oZWFkZXJzICYmIChyZXN1bHQuaGVhZGVycyA9IGVyci5oZWFkZXJzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgUmVmZXJlckNvbmZpZ3VyYXRpb24gPSBkYXRhLlJlZmVyZXJDb25maWd1cmF0aW9uIHx8IHt9O1xuXG4gICAgaWYgKFJlZmVyZXJDb25maWd1cmF0aW9uWydEb21haW5MaXN0J10pIHtcbiAgICAgIHZhciBEb21haW5zID0gdXRpbC5tYWtlQXJyYXkoUmVmZXJlckNvbmZpZ3VyYXRpb25bJ0RvbWFpbkxpc3QnXS5Eb21haW4gfHwgW10pO1xuICAgICAgUmVmZXJlckNvbmZpZ3VyYXRpb24uRG9tYWluTGlzdCA9IHtcbiAgICAgICAgRG9tYWluczogRG9tYWluc1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBSZWZlcmVyQ29uZmlndXJhdGlvbjogUmVmZXJlckNvbmZpZ3VyYXRpb24sXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiuvue9riBCdWNrZXQg6Ieq5a6a5LmJ5Z+f5ZCNXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXREb21haW4ocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgRG9tYWluQ29uZmlndXJhdGlvbiA9IHBhcmFtc1snRG9tYWluQ29uZmlndXJhdGlvbiddIHx8IHt9O1xuICB2YXIgRG9tYWluUnVsZSA9IERvbWFpbkNvbmZpZ3VyYXRpb24uRG9tYWluUnVsZSB8fCBwYXJhbXMuRG9tYWluUnVsZSB8fCBbXTtcbiAgRG9tYWluUnVsZSA9IHV0aWwuY2xvbmUoRG9tYWluUnVsZSk7XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBEb21haW5Db25maWd1cmF0aW9uOiB7XG4gICAgICBEb21haW5SdWxlOiBEb21haW5SdWxlXG4gICAgfVxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldERvbWFpbicsXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdkb21haW4nLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPliBCdWNrZXQg55qE6Ieq5a6a5LmJ5Z+f5ZCNXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXREb21haW4ocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldERvbWFpbicsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2RvbWFpbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBEb21haW5SdWxlID0gW107XG5cbiAgICB0cnkge1xuICAgICAgRG9tYWluUnVsZSA9IGRhdGEuRG9tYWluQ29uZmlndXJhdGlvbi5Eb21haW5SdWxlIHx8IFtdO1xuICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICBEb21haW5SdWxlID0gdXRpbC5jbG9uZSh1dGlsLmlzQXJyYXkoRG9tYWluUnVsZSkgPyBEb21haW5SdWxlIDogW0RvbWFpblJ1bGVdKTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBEb21haW5SdWxlOiBEb21haW5SdWxlLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDliKDpmaQgQnVja2V0IOiHquWumuS5ieWfn+WQjVxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlQnVja2V0RG9tYWluKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpEZWxldGVCdWNrZXREb21haW4nLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdkb21haW4nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDorr7nva4gQnVja2V0IOeahOWbnua6kFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gcHV0QnVja2V0T3JpZ2luKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIE9yaWdpbkNvbmZpZ3VyYXRpb24gPSBwYXJhbXNbJ09yaWdpbkNvbmZpZ3VyYXRpb24nXSB8fCB7fTtcbiAgdmFyIE9yaWdpblJ1bGUgPSBPcmlnaW5Db25maWd1cmF0aW9uLk9yaWdpblJ1bGUgfHwgcGFyYW1zLk9yaWdpblJ1bGUgfHwgW107XG4gIE9yaWdpblJ1bGUgPSB1dGlsLmNsb25lKE9yaWdpblJ1bGUpO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgT3JpZ2luQ29uZmlndXJhdGlvbjoge1xuICAgICAgT3JpZ2luUnVsZTogT3JpZ2luUnVsZVxuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRPcmlnaW4nLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnb3JpZ2luJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyICYmIGVyci5zdGF0dXNDb2RlID09PSAyMDQpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDojrflj5YgQnVja2V0IOeahOWbnua6kFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZ2V0QnVja2V0T3JpZ2luKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRPcmlnaW4nLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdvcmlnaW4nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgT3JpZ2luUnVsZSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIE9yaWdpblJ1bGUgPSBkYXRhLk9yaWdpbkNvbmZpZ3VyYXRpb24uT3JpZ2luUnVsZSB8fCBbXTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgT3JpZ2luUnVsZSA9IHV0aWwuY2xvbmUodXRpbC5pc0FycmF5KE9yaWdpblJ1bGUpID8gT3JpZ2luUnVsZSA6IFtPcmlnaW5SdWxlXSk7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgT3JpZ2luUnVsZTogT3JpZ2luUnVsZSxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog5Yig6ZmkIEJ1Y2tldCDnmoTlm57mupBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldE9yaWdpbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0T3JpZ2luJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnb3JpZ2luJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6K6+572uIEJ1Y2tldCDnmoTml6Xlv5forrDlvZVcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHsoT2JqZWN0fFN0cmluZyl9ICBwYXJhbXMuQnVja2V0TG9nZ2luZ1N0YXR1cyAgICAgICAgICAgICAgICAgICAgICAgICDor7TmmI7ml6Xlv5forrDlvZXphY3nva7nmoTnirbmgIHvvIzlpoLmnpzml6DlrZDoioLngrnkv6Hmga/liJnmhI/kuLrlhbPpl63ml6Xlv5forrDlvZXvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dEJ1Y2tldExvZ2dpbmcocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgQnVja2V0TG9nZ2luZ1N0YXR1czogcGFyYW1zWydCdWNrZXRMb2dnaW5nU3RhdHVzJ10gfHwgJydcbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRMb2dnaW5nJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYm9keTogeG1sLFxuICAgIGFjdGlvbjogJ2xvZ2dpbmcnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPliBCdWNrZXQg55qE5pel5b+X6K6w5b2VXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRCdWNrZXRMb2dnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRMb2dnaW5nJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnbG9nZ2luZydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIEJ1Y2tldExvZ2dpbmdTdGF0dXM6IGRhdGEuQnVja2V0TG9nZ2luZ1N0YXR1cyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog5Yib5bu6L+e8lui+kSBCdWNrZXQg55qE5riF5Y2V5Lu75YqhXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLklkICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5riF5Y2V5Lu75Yqh55qE5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zLkludmVudG9yeUNvbmZpZ3VyYXRpb24gICAgICAgICAgICAgICAgICAgICAg5YyF5ZCr5riF5Y2V55qE6YWN572u5Y+C5pWw77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXRJbnZlbnRvcnkocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgSW52ZW50b3J5Q29uZmlndXJhdGlvbiA9IHV0aWwuY2xvbmUocGFyYW1zWydJbnZlbnRvcnlDb25maWd1cmF0aW9uJ10pO1xuXG4gIGlmIChJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzKSB7XG4gICAgdmFyIEZpZWxkID0gSW52ZW50b3J5Q29uZmlndXJhdGlvbi5PcHRpb25hbEZpZWxkcyB8fCBbXTtcbiAgICBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzID0ge1xuICAgICAgRmllbGQ6IEZpZWxkXG4gICAgfTtcbiAgfVxuXG4gIGlmIChJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbi5FbmNyeXB0aW9uKSB7XG4gICAgdmFyIEVuY3J5cHRpb24gPSBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uLkVuY3J5cHRpb247XG5cbiAgICBpZiAoT2JqZWN0LmtleXMoRW5jcnlwdGlvbikuaW5kZXhPZignU1NFQ09TJykgPiAtMSkge1xuICAgICAgRW5jcnlwdGlvblsnU1NFLUNPUyddID0gRW5jcnlwdGlvblsnU1NFQ09TJ107XG4gICAgICBkZWxldGUgRW5jcnlwdGlvblsnU1NFQ09TJ107XG4gICAgfVxuICB9XG5cbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIEludmVudG9yeUNvbmZpZ3VyYXRpb246IEludmVudG9yeUNvbmZpZ3VyYXRpb25cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRCdWNrZXRJbnZlbnRvcnknLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnaW52ZW50b3J5JyxcbiAgICBxczoge1xuICAgICAgaWQ6IHBhcmFtc1snSWQnXVxuICAgIH0sXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6I635Y+WIEJ1Y2tldCDnmoTmuIXljZXku7vliqHkv6Hmga9cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWQgICAgICDmuIXljZXku7vliqHnmoTlkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGdldEJ1Y2tldEludmVudG9yeShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0SW52ZW50b3J5JyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnaW52ZW50b3J5JyxcbiAgICBxczoge1xuICAgICAgaWQ6IHBhcmFtc1snSWQnXVxuICAgIH1cbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBJbnZlbnRvcnlDb25maWd1cmF0aW9uID0gZGF0YVsnSW52ZW50b3J5Q29uZmlndXJhdGlvbiddO1xuXG4gICAgaWYgKEludmVudG9yeUNvbmZpZ3VyYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5PcHRpb25hbEZpZWxkcyAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzLkZpZWxkKSB7XG4gICAgICB2YXIgRmllbGQgPSBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzLkZpZWxkO1xuXG4gICAgICBpZiAoIXV0aWwuaXNBcnJheShGaWVsZCkpIHtcbiAgICAgICAgRmllbGQgPSBbRmllbGRdO1xuICAgICAgfVxuXG4gICAgICBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzID0gRmllbGQ7XG4gICAgfVxuXG4gICAgaWYgKEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uLkVuY3J5cHRpb24pIHtcbiAgICAgIHZhciBFbmNyeXB0aW9uID0gSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbi5DT1NCdWNrZXREZXN0aW5hdGlvbi5FbmNyeXB0aW9uO1xuXG4gICAgICBpZiAoT2JqZWN0LmtleXMoRW5jcnlwdGlvbikuaW5kZXhPZignU1NFLUNPUycpID4gLTEpIHtcbiAgICAgICAgRW5jcnlwdGlvblsnU1NFQ09TJ10gPSBFbmNyeXB0aW9uWydTU0UtQ09TJ107XG4gICAgICAgIGRlbGV0ZSBFbmNyeXB0aW9uWydTU0UtQ09TJ107XG4gICAgICB9XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgSW52ZW50b3J5Q29uZmlndXJhdGlvbjogSW52ZW50b3J5Q29uZmlndXJhdGlvbixcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6I635Y+WIEJ1Y2tldCDnmoTmuIXljZXku7vliqHkv6Hmga9cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGludWF0aW9uVG9rZW4gICAgICAg5b2TIENPUyDlk43lupTkvZPkuK0gSXNUcnVuY2F0ZWQg5Li6IHRydWXvvIzkuJQgTmV4dENvbnRpbnVhdGlvblRva2VuIOiKgueCueS4reWtmOWcqOWPguaVsOWAvOaXtu+8jOaCqOWPr+S7peWwhui/meS4quWPguaVsOS9nOS4uiBjb250aW51YXRpb24tdG9rZW4g5Y+C5pWw5YC877yM5Lul6I635Y+W5LiL5LiA6aG155qE5riF5Y2V5Lu75Yqh5L+h5oGv77yM6Z2e5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBsaXN0QnVja2V0SW52ZW50b3J5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpMaXN0QnVja2V0SW52ZW50b3J5JyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnaW52ZW50b3J5JyxcbiAgICBxczoge1xuICAgICAgJ2NvbnRpbnVhdGlvbi10b2tlbic6IHBhcmFtc1snQ29udGludWF0aW9uVG9rZW4nXVxuICAgIH1cbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBMaXN0SW52ZW50b3J5Q29uZmlndXJhdGlvblJlc3VsdCA9IGRhdGFbJ0xpc3RJbnZlbnRvcnlDb25maWd1cmF0aW9uUmVzdWx0J107XG4gICAgdmFyIEludmVudG9yeUNvbmZpZ3VyYXRpb25zID0gTGlzdEludmVudG9yeUNvbmZpZ3VyYXRpb25SZXN1bHQuSW52ZW50b3J5Q29uZmlndXJhdGlvbiB8fCBbXTtcbiAgICBJbnZlbnRvcnlDb25maWd1cmF0aW9ucyA9IHV0aWwuaXNBcnJheShJbnZlbnRvcnlDb25maWd1cmF0aW9ucykgPyBJbnZlbnRvcnlDb25maWd1cmF0aW9ucyA6IFtJbnZlbnRvcnlDb25maWd1cmF0aW9uc107XG4gICAgZGVsZXRlIExpc3RJbnZlbnRvcnlDb25maWd1cmF0aW9uUmVzdWx0WydJbnZlbnRvcnlDb25maWd1cmF0aW9uJ107XG4gICAgdXRpbC5lYWNoKEludmVudG9yeUNvbmZpZ3VyYXRpb25zLCBmdW5jdGlvbiAoSW52ZW50b3J5Q29uZmlndXJhdGlvbikge1xuICAgICAgaWYgKEludmVudG9yeUNvbmZpZ3VyYXRpb24gJiYgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5PcHRpb25hbEZpZWxkcyAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLk9wdGlvbmFsRmllbGRzLkZpZWxkKSB7XG4gICAgICAgIHZhciBGaWVsZCA9IEludmVudG9yeUNvbmZpZ3VyYXRpb24uT3B0aW9uYWxGaWVsZHMuRmllbGQ7XG5cbiAgICAgICAgaWYgKCF1dGlsLmlzQXJyYXkoRmllbGQpKSB7XG4gICAgICAgICAgRmllbGQgPSBbRmllbGRdO1xuICAgICAgICB9XG5cbiAgICAgICAgSW52ZW50b3J5Q29uZmlndXJhdGlvbi5PcHRpb25hbEZpZWxkcyA9IEZpZWxkO1xuICAgICAgfVxuXG4gICAgICBpZiAoSW52ZW50b3J5Q29uZmlndXJhdGlvbi5EZXN0aW5hdGlvbiAmJiBJbnZlbnRvcnlDb25maWd1cmF0aW9uLkRlc3RpbmF0aW9uLkNPU0J1Y2tldERlc3RpbmF0aW9uICYmIEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24uRW5jcnlwdGlvbikge1xuICAgICAgICB2YXIgRW5jcnlwdGlvbiA9IEludmVudG9yeUNvbmZpZ3VyYXRpb24uRGVzdGluYXRpb24uQ09TQnVja2V0RGVzdGluYXRpb24uRW5jcnlwdGlvbjtcblxuICAgICAgICBpZiAoT2JqZWN0LmtleXMoRW5jcnlwdGlvbikuaW5kZXhPZignU1NFLUNPUycpID4gLTEpIHtcbiAgICAgICAgICBFbmNyeXB0aW9uWydTU0VDT1MnXSA9IEVuY3J5cHRpb25bJ1NTRS1DT1MnXTtcbiAgICAgICAgICBkZWxldGUgRW5jcnlwdGlvblsnU1NFLUNPUyddO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgTGlzdEludmVudG9yeUNvbmZpZ3VyYXRpb25SZXN1bHQuSW52ZW50b3J5Q29uZmlndXJhdGlvbnMgPSBJbnZlbnRvcnlDb25maWd1cmF0aW9ucztcbiAgICB1dGlsLmV4dGVuZChMaXN0SW52ZW50b3J5Q29uZmlndXJhdGlvblJlc3VsdCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgTGlzdEludmVudG9yeUNvbmZpZ3VyYXRpb25SZXN1bHQpO1xuICB9KTtcbn1cbi8qKlxuICog5Yig6ZmkIEJ1Y2tldCDnmoTmuIXljZXku7vliqFcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWQgICAgICDmuIXljZXku7vliqHnmoTlkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57mlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldEludmVudG9yeShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlQnVja2V0SW52ZW50b3J5JyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnaW52ZW50b3J5JyxcbiAgICBxczoge1xuICAgICAgaWQ6IHBhcmFtc1snSWQnXVxuICAgIH1cbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKiDlhajnkIPliqDpgJ8gKi9cblxuXG5mdW5jdGlvbiBwdXRCdWNrZXRBY2NlbGVyYXRlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgaWYgKCFwYXJhbXNbJ0FjY2VsZXJhdGVDb25maWd1cmF0aW9uJ10pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBBY2NlbGVyYXRlQ29uZmlndXJhdGlvbicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNvbmZpZ3VyYXRpb24gPSB7XG4gICAgQWNjZWxlcmF0ZUNvbmZpZ3VyYXRpb246IHBhcmFtcy5BY2NlbGVyYXRlQ29uZmlndXJhdGlvbiB8fCB7fVxuICB9O1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbChjb25maWd1cmF0aW9uKTtcbiAgdmFyIGhlYWRlcnMgPSB7fTtcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldEFjY2VsZXJhdGUnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnYWNjZWxlcmF0ZScsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRCdWNrZXRBY2NlbGVyYXRlKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRCdWNrZXRBY2NlbGVyYXRlJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYWN0aW9uOiAnYWNjZWxlcmF0ZSdcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmICghZXJyKSB7XG4gICAgICAhZGF0YS5BY2NlbGVyYXRlQ29uZmlndXJhdGlvbiAmJiAoZGF0YS5BY2NlbGVyYXRlQ29uZmlndXJhdGlvbiA9IHt9KTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhlcnIsIGRhdGEpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcHV0QnVja2V0RW5jcnlwdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBjb25mID0gcGFyYW1zLlNlcnZlclNpZGVFbmNyeXB0aW9uQ29uZmlndXJhdGlvbiB8fCB7fTtcbiAgdmFyIFJ1bGVzID0gY29uZi5SdWxlIHx8IGNvbmYuUnVsZXMgfHwgW107XG4gIHZhciB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICBTZXJ2ZXJTaWRlRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb246IHtcbiAgICAgIFJ1bGU6IFJ1bGVzXG4gICAgfVxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOlB1dEJ1Y2tldEVuY3J5cHRpb24nLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBib2R5OiB4bWwsXG4gICAgYWN0aW9uOiAnZW5jcnlwdGlvbicsXG4gICAgaGVhZGVyczogaGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0QnVja2V0RW5jcnlwdGlvbihwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6R2V0QnVja2V0RW5jcnlwdGlvbicsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ2VuY3J5cHRpb24nXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwNCAmJiBlcnIuY29kZSA9PT0gJ05vU3VjaEVuY3J5cHRpb25Db25maWd1cmF0aW9uJykge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgIEVuY3J5cHRpb25Db25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICBSdWxlczogW11cbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH07XG4gICAgICAgIGVyci5oZWFkZXJzICYmIChyZXN1bHQuaGVhZGVycyA9IGVyci5oZWFkZXJzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgUnVsZXMgPSB1dGlsLm1ha2VBcnJheShkYXRhLkVuY3J5cHRpb25Db25maWd1cmF0aW9uICYmIGRhdGEuRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb24uUnVsZSB8fCBbXSk7XG4gICAgZGF0YS5FbmNyeXB0aW9uQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgIFJ1bGVzOiBSdWxlc1xuICAgIH07XG4gICAgY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUJ1Y2tldEVuY3J5cHRpb24ocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZUJ1Y2tldFJlcGxpY2F0aW9uJyxcbiAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgYWN0aW9uOiAnZW5jcnlwdGlvbidcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59IC8vIE9iamVjdCDnm7jlhbNcblxuLyoqXG4gKiDlj5blm57lr7nlupRPYmplY3TnmoTlhYPmlbDmja7vvIxIZWFk55qE5p2D6ZmQ5LiOR2V055qE5p2D6ZmQ5LiA6Ie0XG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgICAgICAgICAg5paH5Lu25ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLklmTW9kaWZpZWRTaW5jZSAgICAg5b2TT2JqZWN05Zyo5oyH5a6a5pe26Ze05ZCO6KKr5L+u5pS577yM5YiZ6L+U5Zue5a+55bqUT2JqZWN05YWD5L+h5oGv77yM5ZCm5YiZ6L+U5ZueMzA077yM6Z2e5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAg5Li65oyH5a6aIG9iamVjdCDnmoTlhYPmlbDmja7vvIzlpoLmnpzorr7nva7kuoYgSWZNb2RpZmllZFNpbmNlIO+8jOS4lOaWh+S7tuacquS/ruaUue+8jOWImei/lOWbnuS4gOS4quWvueixoe+8jE5vdE1vZGlmaWVkIOWxnuaAp+S4uiB0cnVlXG4gKiAgICAgQHJldHVybiAge0Jvb2xlYW59ICBkYXRhLk5vdE1vZGlmaWVkICAgICAgICAg5piv5ZCm5ZyoIElmTW9kaWZpZWRTaW5jZSDml7bpl7TngrnkuYvlkI7mnKrkv67mlLnor6Ugb2JqZWN077yM5YiZ5Li6IHRydWVcbiAqL1xuXG5cbmZ1bmN0aW9uIGhlYWRPYmplY3QocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkhlYWRPYmplY3QnLFxuICAgIG1ldGhvZDogJ0hFQUQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdmFyIHN0YXR1c0NvZGUgPSBlcnIuc3RhdHVzQ29kZTtcblxuICAgICAgaWYgKHBhcmFtcy5IZWFkZXJzWydJZi1Nb2RpZmllZC1TaW5jZSddICYmIHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA9PT0gMzA0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgTm90TW9kaWZpZWQ6IHRydWUsXG4gICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgZGF0YS5FVGFnID0gdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyk7XG4gICAgY2FsbGJhY2sobnVsbCwgZGF0YSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsaXN0T2JqZWN0VmVyc2lvbnMocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0ge307XG4gIHJlcVBhcmFtc1sncHJlZml4J10gPSBwYXJhbXNbJ1ByZWZpeCddIHx8ICcnO1xuICByZXFQYXJhbXNbJ2RlbGltaXRlciddID0gcGFyYW1zWydEZWxpbWl0ZXInXTtcbiAgcmVxUGFyYW1zWydrZXktbWFya2VyJ10gPSBwYXJhbXNbJ0tleU1hcmtlciddO1xuICByZXFQYXJhbXNbJ3ZlcnNpb24taWQtbWFya2VyJ10gPSBwYXJhbXNbJ1ZlcnNpb25JZE1hcmtlciddO1xuICByZXFQYXJhbXNbJ21heC1rZXlzJ10gPSBwYXJhbXNbJ01heEtleXMnXTtcbiAgcmVxUGFyYW1zWydlbmNvZGluZy10eXBlJ10gPSBwYXJhbXNbJ0VuY29kaW5nVHlwZSddO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldEJ1Y2tldE9iamVjdFZlcnNpb25zJyxcbiAgICBSZXNvdXJjZUtleTogcmVxUGFyYW1zWydwcmVmaXgnXSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtcyxcbiAgICBhY3Rpb246ICd2ZXJzaW9ucydcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBMaXN0VmVyc2lvbnNSZXN1bHQgPSBkYXRhLkxpc3RWZXJzaW9uc1Jlc3VsdCB8fCB7fTtcbiAgICB2YXIgRGVsZXRlTWFya2VycyA9IExpc3RWZXJzaW9uc1Jlc3VsdC5EZWxldGVNYXJrZXIgfHwgW107XG4gICAgRGVsZXRlTWFya2VycyA9IHV0aWwuaXNBcnJheShEZWxldGVNYXJrZXJzKSA/IERlbGV0ZU1hcmtlcnMgOiBbRGVsZXRlTWFya2Vyc107XG4gICAgdmFyIFZlcnNpb25zID0gTGlzdFZlcnNpb25zUmVzdWx0LlZlcnNpb24gfHwgW107XG4gICAgVmVyc2lvbnMgPSB1dGlsLmlzQXJyYXkoVmVyc2lvbnMpID8gVmVyc2lvbnMgOiBbVmVyc2lvbnNdO1xuICAgIHZhciByZXN1bHQgPSB1dGlsLmNsb25lKExpc3RWZXJzaW9uc1Jlc3VsdCk7XG4gICAgZGVsZXRlIHJlc3VsdC5EZWxldGVNYXJrZXI7XG4gICAgZGVsZXRlIHJlc3VsdC5WZXJzaW9uO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgRGVsZXRlTWFya2VyczogRGVsZXRlTWFya2VycyxcbiAgICAgIFZlcnNpb25zOiBWZXJzaW9ucyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXG4gKiDkuIvovb0gb2JqZWN0XG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgICAgICAgICAgICAgICAgICDmlofku7blkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtXcml0ZVN0cmVhbX0gIHBhcmFtcy5PdXRwdXQgICAgICAgICAgICAgICAgIOaWh+S7tuWGmeWFpea1ge+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZk1vZGlmaWVkU2luY2UgICAgICAgICAgICAg5b2TT2JqZWN05Zyo5oyH5a6a5pe26Ze05ZCO6KKr5L+u5pS577yM5YiZ6L+U5Zue5a+55bqUT2JqZWN05YWD5L+h5oGv77yM5ZCm5YiZ6L+U5ZueMzA077yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLklmVW5tb2RpZmllZFNpbmNlICAgICAgICAgICDlpoLmnpzmlofku7bkv67mlLnml7bpl7Tml6nkuo7miJbnrYnkuo7mjIflrprml7bpl7TvvIzmiY3ov5Tlm57mlofku7blhoXlrrnjgILlkKbliJnov5Tlm54gNDEyIChwcmVjb25kaXRpb24gZmFpbGVkKe+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5JZk1hdGNoICAgICAgICAgICAgICAgICAgICAg5b2TIEVUYWcg5LiO5oyH5a6a55qE5YaF5a655LiA6Ie077yM5omN6L+U5Zue5paH5Lu244CC5ZCm5YiZ6L+U5ZueIDQxMiAocHJlY29uZGl0aW9uIGZhaWxlZCnvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuSWZOb25lTWF0Y2ggICAgICAgICAgICAgICAgIOW9kyBFVGFnIOS4juaMh+WumueahOWGheWuueS4jeS4gOiHtO+8jOaJjei/lOWbnuaWh+S7tuOAguWQpuWImei/lOWbnjMwNCAobm90IG1vZGlmaWVkKe+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZXNwb25zZUNvbnRlbnRUeXBlICAgICAgICAg6K6+572u6L+U5Zue5aS06YOo5Lit55qEIENvbnRlbnQtVHlwZSDlj4LmlbDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVzcG9uc2VDb250ZW50TGFuZ3VhZ2UgICAgIOiuvue9rui/lOWbnuWktOmDqOS4reeahCBDb250ZW50LUxhbmd1YWdlIOWPguaVsO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZXNwb25zZUV4cGlyZXMgICAgICAgICAgICAg6K6+572u6L+U5Zue5aS06YOo5Lit55qEIENvbnRlbnQtRXhwaXJlcyDlj4LmlbDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVzcG9uc2VDYWNoZUNvbnRyb2wgICAgICAgIOiuvue9rui/lOWbnuWktOmDqOS4reeahCBDYWNoZS1Db250cm9sIOWPguaVsO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZXNwb25zZUNvbnRlbnREaXNwb3NpdGlvbiAg6K6+572u6L+U5Zue5aS06YOo5Lit55qEIENvbnRlbnQtRGlzcG9zaXRpb24g5Y+C5pWw77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlc3BvbnNlQ29udGVudEVuY29kaW5nICAgICDorr7nva7ov5Tlm57lpLTpg6jkuK3nmoQgQ29udGVudC1FbmNvZGluZyDlj4LmlbDvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHBhcmFtICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDkuLrlr7nlupTnmoQgb2JqZWN0IOaVsOaNru+8jOWMheaLrCBib2R5IOWSjCBoZWFkZXJzXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRPYmplY3QocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0gcGFyYW1zLlF1ZXJ5IHx8IHt9O1xuICB2YXIgcmVxUGFyYW1zU3RyID0gcGFyYW1zLlF1ZXJ5U3RyaW5nIHx8ICcnO1xuICB2YXIgb25Qcm9ncmVzcyA9IHV0aWwudGhyb3R0bGVPblByb2dyZXNzLmNhbGwodGhpcywgMCwgcGFyYW1zLm9uUHJvZ3Jlc3MpO1xuICB2YXIgdHJhY2tlciA9IHBhcmFtcy50cmFja2VyO1xuICB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICBzaWduU3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9KTtcbiAgcmVxUGFyYW1zWydyZXNwb25zZS1jb250ZW50LXR5cGUnXSA9IHBhcmFtc1snUmVzcG9uc2VDb250ZW50VHlwZSddO1xuICByZXFQYXJhbXNbJ3Jlc3BvbnNlLWNvbnRlbnQtbGFuZ3VhZ2UnXSA9IHBhcmFtc1snUmVzcG9uc2VDb250ZW50TGFuZ3VhZ2UnXTtcbiAgcmVxUGFyYW1zWydyZXNwb25zZS1leHBpcmVzJ10gPSBwYXJhbXNbJ1Jlc3BvbnNlRXhwaXJlcyddO1xuICByZXFQYXJhbXNbJ3Jlc3BvbnNlLWNhY2hlLWNvbnRyb2wnXSA9IHBhcmFtc1snUmVzcG9uc2VDYWNoZUNvbnRyb2wnXTtcbiAgcmVxUGFyYW1zWydyZXNwb25zZS1jb250ZW50LWRpc3Bvc2l0aW9uJ10gPSBwYXJhbXNbJ1Jlc3BvbnNlQ29udGVudERpc3Bvc2l0aW9uJ107XG4gIHJlcVBhcmFtc1sncmVzcG9uc2UtY29udGVudC1lbmNvZGluZyddID0gcGFyYW1zWydSZXNwb25zZUNvbnRlbnRFbmNvZGluZyddOyAvLyDlpoLmnpznlKjmiLfoh6rlt7HkvKDlhaXkuoYgb3V0cHV0XG5cbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRPYmplY3QnLFxuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgVmVyc2lvbklkOiBwYXJhbXMuVmVyc2lvbklkLFxuICAgIERhdGFUeXBlOiBwYXJhbXMuRGF0YVR5cGUsXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtcyxcbiAgICBxc1N0cjogcmVxUGFyYW1zU3RyLFxuICAgIHJhd0JvZHk6IHRydWUsXG4gICAgb25Eb3dubG9hZFByb2dyZXNzOiBvblByb2dyZXNzLFxuICAgIHRyYWNrZXI6IHRyYWNrZXJcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIG9uUHJvZ3Jlc3MobnVsbCwgdHJ1ZSk7XG5cbiAgICBpZiAoZXJyKSB7XG4gICAgICB2YXIgc3RhdHVzQ29kZSA9IGVyci5zdGF0dXNDb2RlO1xuXG4gICAgICBpZiAocGFyYW1zLkhlYWRlcnNbJ0lmLU1vZGlmaWVkLVNpbmNlJ10gJiYgc3RhdHVzQ29kZSAmJiBzdGF0dXNDb2RlID09PSAzMDQpIHtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICBOb3RNb2RpZmllZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgQm9keTogZGF0YS5ib2R5LFxuICAgICAgRVRhZzogdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyksXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOS4iuS8oCBvYmplY3RcbiAqIEBwYXJhbSAge09iamVjdH0gcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5paH5Lu25ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7RmlsZSB8fCBCbG9iIHx8IFN0cmluZ30gIHBhcmFtcy5Cb2R5ICAgICAgICAgICAgICAgIOS4iuS8oOaWh+S7tuWvueixoeaIluWtl+espuS4su+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5DYWNoZUNvbnRyb2wgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTnvJPlrZjnrZbnlaXvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RGlzcG9zaXRpb24gICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTmlofku7blkI3np7DvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RW5jb2RpbmcgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTnvJbnoIHmoLzlvI/vvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50TGVuZ3RoICAgICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoQgSFRUUCDor7fmsYLlhoXlrrnplb/luqbvvIjlrZfoioLvvInvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudFR5cGUgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE5YaF5a6557G75Z6L77yITUlNRe+8ie+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGVjdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOW9k+S9v+eUqCBFeHBlY3Q6IDEwMC1jb250aW51ZSDml7bvvIzlnKjmlLbliLDmnI3liqHnq6/noa7orqTlkI7vvIzmiY3kvJrlj5HpgIHor7fmsYLlhoXlrrnvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRXhwaXJlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE6L+H5pyf5pe26Ze077yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQUNMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5YWB6K6455So5oi36Ieq5a6a5LmJ5paH5Lu25p2D6ZmQ77yM5pyJ5pWI5YC877yacHJpdmF0ZSB8IHB1YmxpYy1yZWFk77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50UmVhZCAgICAgICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WPluWvueixoeeahOadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFJlYWRBY3AgICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vlj5blr7nosaHnmoTorr/pl67mjqfliLbliJfooajvvIhBQ0zvvInnmoTmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRXcml0ZUFjcCAgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF5YaZ5YWl5a+56LGh55qE6K6/6Zeu5o6n5Yi25YiX6KGo77yIQUNM77yJ55qE5p2D6ZmQ77yM5qC85byP77yaaWQ9XCJbT3duZXJVaW5dXCLvvIzlj6/kvb/nlKjljYrop5LpgJflj7fvvIgs77yJ5YiG6ZqU5aSa57uE6KKr5o6I5p2D6ICF77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50RnVsbENvbnRyb2wgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheaTjeS9nOWvueixoeeahOaJgOacieadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TdG9yYWdlQ2xhc3MgICAgICAgICAgICAgICAgICAgICAgICDorr7nva7lr7nosaHnmoTlrZjlgqjnuqfliKvvvIzmnprkuL7lgLzvvJpTVEFOREFSROOAgVNUQU5EQVJEX0lB44CBQVJDSElWRe+8jOm7mOiupOWAvO+8mlNUQU5EQVJE77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLngtY29zLW1ldGEtKiAgICAgICAgICAgICAgICAgICAgICAgIOWFgeiuuOeUqOaIt+iHquWumuS5ieeahOWktOmDqOS/oeaBr++8jOWwhuS9nOS4uuWvueixoeeahOWFg+aVsOaNruS/neWtmOOAguWkp+Wwj+mZkOWItjJLQu+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50U2hhMSAgICAgICAgICAgICAgICAgICAgICAgICBSRkMgMzE3NCDkuK3lrprkuYnnmoQgMTYwLWJpdCDlhoXlrrkgU0hBLTEg566X5rOV5qCh6aqM77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlNlcnZlclNpZGVFbmNyeXB0aW9uICAgICAgICAgICAgICAgIOaUr+aMgeaMieeFp+aMh+WumueahOWKoOWvhueul+azlei/m+ihjOacjeWKoeerr+aVsOaNruWKoOWvhu+8jOagvOW8jyB4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uOiBcIkFFUzI1Nlwi77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7RnVuY3Rpb259ICBwYXJhbXMub25Qcm9ncmVzcyAgICAgICAgICAgICAgICAgICAgICAgIOS4iuS8oOi/m+W6puWbnuiwg+WHveaVsFxuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOS4uuWvueW6lOeahCBvYmplY3Qg5pWw5o2uXG4gKiAgICAgQHJldHVybiAge1N0cmluZ30gIGRhdGEuRVRhZyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOS4uuWvueW6lOS4iuS8oOaWh+S7tueahCBFVGFnIOWAvFxuICovXG5cblxuZnVuY3Rpb24gcHV0T2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgRmlsZVNpemUgPSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgdmFyIG9uUHJvZ3Jlc3MgPSB1dGlsLnRocm90dGxlT25Qcm9ncmVzcy5jYWxsKHNlbGYsIEZpbGVTaXplLCBwYXJhbXMub25Qcm9ncmVzcyk7IC8vIOeJueauiuWkhOeQhiBDYWNoZS1Db250cm9s44CBQ29udGVudC1UeXBl77yM6YG/5YWN5Luj55CG5pu05pS56L+Z5Lik5Liq5a2X5q615a+86Ie05YaZ5YWl5YiwIE9iamVjdCDlsZ7mgKfph4xcblxuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgaWYgKCFoZWFkZXJzWydDb250ZW50LVR5cGUnXSAmJiAhaGVhZGVyc1snY29udGVudC10eXBlJ10pIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gcGFyYW1zLkJvZHkgJiYgcGFyYW1zLkJvZHkudHlwZSB8fCAnJztcbiAgdmFyIG5lZWRDYWxjTWQ1ID0gcGFyYW1zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZENoZWNrQ29udGVudE1kNTtcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgbWQ1U3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9KTtcbiAgdXRpbC5nZXRCb2R5TWQ1KG5lZWRDYWxjTWQ1LCBwYXJhbXMuQm9keSwgZnVuY3Rpb24gKG1kNSkge1xuICAgIGlmIChtZDUpIHtcbiAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgICBtZDVFbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgICAgfSk7XG4gICAgICBpZiAoc2VsZi5vcHRpb25zLlVwbG9hZENoZWNrQ29udGVudE1kNSkgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KG1kNSk7XG4gICAgICBpZiAocGFyYW1zLlVwbG9hZEFkZE1ldGFNZDUgfHwgc2VsZi5vcHRpb25zLlVwbG9hZEFkZE1ldGFNZDUpIGhlYWRlcnNbJ3gtY29zLW1ldGEtbWQ1J10gPSBtZDU7XG4gICAgfVxuXG4gICAgaWYgKHBhcmFtcy5Db250ZW50TGVuZ3RoICE9PSB1bmRlZmluZWQpIGhlYWRlcnNbJ0NvbnRlbnQtTGVuZ3RoJ10gPSBwYXJhbXMuQ29udGVudExlbmd0aDtcbiAgICBvblByb2dyZXNzKG51bGwsIHRydWUpOyAvLyDku7vliqHnirbmgIHlvIDlp4sgdXBsb2FkaW5nXG5cbiAgICBzdWJtaXRSZXF1ZXN0LmNhbGwoc2VsZiwge1xuICAgICAgQWN0aW9uOiAnbmFtZS9jb3M6UHV0T2JqZWN0JyxcbiAgICAgIFRhc2tJZDogcGFyYW1zLlRhc2tJZCxcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICAgIHFzOiBwYXJhbXMuUXVlcnksXG4gICAgICBib2R5OiBwYXJhbXMuQm9keSxcbiAgICAgIG9uUHJvZ3Jlc3M6IG9uUHJvZ3Jlc3MsXG4gICAgICB0cmFja2VyOiB0cmFja2VyXG4gICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBvblByb2dyZXNzKG51bGwsIHRydWUpO1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgb25Qcm9ncmVzcyh7XG4gICAgICAgIGxvYWRlZDogRmlsZVNpemUsXG4gICAgICAgIHRvdGFsOiBGaWxlU2l6ZVxuICAgICAgfSwgdHJ1ZSk7XG4gICAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgICAgRm9yY2VQYXRoU3R5bGU6IHNlbGYub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSxcbiAgICAgICAgcHJvdG9jb2w6IHNlbGYub3B0aW9ucy5Qcm90b2NvbCxcbiAgICAgICAgZG9tYWluOiBzZWxmLm9wdGlvbnMuRG9tYWluLFxuICAgICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICAgIHJlZ2lvbjogIXNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlID8gcGFyYW1zLlJlZ2lvbiA6ICdhY2NlbGVyYXRlJyxcbiAgICAgICAgb2JqZWN0OiBwYXJhbXMuS2V5XG4gICAgICB9KTtcbiAgICAgIHVybCA9IHVybC5zdWJzdHIodXJsLmluZGV4T2YoJzovLycpICsgMyk7XG4gICAgICBkYXRhLkxvY2F0aW9uID0gdXJsO1xuICAgICAgZGF0YS5FVGFnID0gdXRpbC5hdHRyKGRhdGEuaGVhZGVycywgJ2V0YWcnLCAnJyk7XG4gICAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgICB9KTtcbiAgfSwgcGFyYW1zLm9uSGFzaFByb2dyZXNzKTtcbn1cbi8qKlxuICog5Yig6ZmkIG9iamVjdFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEBwYXJhbSAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHBhcmFtICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAg5Yig6Zmk5pON5L2c5oiQ5Yqf5LmL5ZCO6L+U5Zue55qE5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBkZWxldGVPYmplY3QocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkRlbGV0ZU9iamVjdCcsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWQsXG4gICAgYWN0aW9uOiBwYXJhbXMuUmVjdXJzaXZlID8gJ3JlY3Vyc2l2ZScgOiAnJ1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgdmFyIHN0YXR1c0NvZGUgPSBlcnIuc3RhdHVzQ29kZTtcblxuICAgICAgaWYgKHN0YXR1c0NvZGUgJiYgc3RhdHVzQ29kZSA9PT0gNDA0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgQnVja2V0Tm90Rm91bmQ6IHRydWUsXG4gICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6I635Y+WIG9iamVjdCDnmoQg5p2D6ZmQ5YiX6KGoXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgICAgICAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gIGRhdGEuQWNjZXNzQ29udHJvbFBvbGljeSAg5p2D6ZmQ5YiX6KGoXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRPYmplY3RBY2wocGFyYW1zLCBjYWxsYmFjaykge1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkdldE9iamVjdEFDTCcsXG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICdhY2wnXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB2YXIgQWNjZXNzQ29udHJvbFBvbGljeSA9IGRhdGEuQWNjZXNzQ29udHJvbFBvbGljeSB8fCB7fTtcbiAgICB2YXIgT3duZXIgPSBBY2Nlc3NDb250cm9sUG9saWN5Lk93bmVyIHx8IHt9O1xuICAgIHZhciBHcmFudCA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kuQWNjZXNzQ29udHJvbExpc3QgJiYgQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdC5HcmFudCB8fCBbXTtcbiAgICBHcmFudCA9IHV0aWwuaXNBcnJheShHcmFudCkgPyBHcmFudCA6IFtHcmFudF07XG4gICAgdmFyIHJlc3VsdCA9IGRlY29kZUFjbChBY2Nlc3NDb250cm9sUG9saWN5KTtcbiAgICBkZWxldGUgcmVzdWx0LkdyYW50V3JpdGU7XG5cbiAgICBpZiAoZGF0YS5oZWFkZXJzICYmIGRhdGEuaGVhZGVyc1sneC1jb3MtYWNsJ10pIHtcbiAgICAgIHJlc3VsdC5BQ0wgPSBkYXRhLmhlYWRlcnNbJ3gtY29zLWFjbCddO1xuICAgIH1cblxuICAgIHJlc3VsdCA9IHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgT3duZXI6IE93bmVyLFxuICAgICAgR3JhbnRzOiBHcmFudCxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXG4gKiDorr7nva4gb2JqZWN0IOeahCDmnYPpmZDliJfooahcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIHB1dE9iamVjdEFjbChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIHZhciB4bWwgPSAnJztcblxuICBpZiAocGFyYW1zWydBY2Nlc3NDb250cm9sUG9saWN5J10pIHtcbiAgICB2YXIgQWNjZXNzQ29udHJvbFBvbGljeSA9IHV0aWwuY2xvbmUocGFyYW1zWydBY2Nlc3NDb250cm9sUG9saWN5J10gfHwge30pO1xuICAgIHZhciBHcmFudHMgPSBBY2Nlc3NDb250cm9sUG9saWN5LkdyYW50cyB8fCBBY2Nlc3NDb250cm9sUG9saWN5LkdyYW50O1xuICAgIEdyYW50cyA9IHV0aWwuaXNBcnJheShHcmFudHMpID8gR3JhbnRzIDogW0dyYW50c107XG4gICAgZGVsZXRlIEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnQ7XG4gICAgZGVsZXRlIEFjY2Vzc0NvbnRyb2xQb2xpY3kuR3JhbnRzO1xuICAgIEFjY2Vzc0NvbnRyb2xQb2xpY3kuQWNjZXNzQ29udHJvbExpc3QgPSB7XG4gICAgICBHcmFudDogR3JhbnRzXG4gICAgfTtcbiAgICB4bWwgPSB1dGlsLmpzb24yeG1sKHtcbiAgICAgIEFjY2Vzc0NvbnRyb2xQb2xpY3k6IEFjY2Vzc0NvbnRyb2xQb2xpY3lcbiAgICB9KTtcbiAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICAgIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgfSAvLyBHcmFudCBIZWFkZXIg5Y676YeNXG5cblxuICB1dGlsLmVhY2goaGVhZGVycywgZnVuY3Rpb24gKHZhbCwga2V5KSB7XG4gICAgaWYgKGtleS5pbmRleE9mKCd4LWNvcy1ncmFudC0nKSA9PT0gMCkge1xuICAgICAgaGVhZGVyc1trZXldID0gdW5pcUdyYW50KGhlYWRlcnNba2V5XSk7XG4gICAgfVxuICB9KTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRPYmplY3RBQ0wnLFxuICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgYWN0aW9uOiAnYWNsJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIGJvZHk6IHhtbFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiBPcHRpb25zIE9iamVjdOivt+axguWunueOsOi3qOWfn+iuv+mXrueahOmihOivt+axguOAguWNs+WPkeWHuuS4gOS4qiBPUFRJT05TIOivt+axgue7meacjeWKoeWZqOS7peehruiupOaYr+WQpuWPr+S7pei/m+ihjOi3qOWfn+aTjeS9nOOAglxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gb3B0aW9uc09iamVjdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ09yaWdpbiddID0gcGFyYW1zWydPcmlnaW4nXTtcbiAgaGVhZGVyc1snQWNjZXNzLUNvbnRyb2wtUmVxdWVzdC1NZXRob2QnXSA9IHBhcmFtc1snQWNjZXNzQ29udHJvbFJlcXVlc3RNZXRob2QnXTtcbiAgaGVhZGVyc1snQWNjZXNzLUNvbnRyb2wtUmVxdWVzdC1IZWFkZXJzJ10gPSBwYXJhbXNbJ0FjY2Vzc0NvbnRyb2xSZXF1ZXN0SGVhZGVycyddO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOk9wdGlvbnNPYmplY3QnLFxuICAgIG1ldGhvZDogJ09QVElPTlMnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gNDAzKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgICAgT3B0aW9uc0ZvcmJpZGRlbjogdHJ1ZSxcbiAgICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgfVxuXG4gICAgdmFyIGhlYWRlcnMgPSBkYXRhLmhlYWRlcnMgfHwge307XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgQWNjZXNzQ29udHJvbEFsbG93T3JpZ2luOiBoZWFkZXJzWydhY2Nlc3MtY29udHJvbC1hbGxvdy1vcmlnaW4nXSxcbiAgICAgIEFjY2Vzc0NvbnRyb2xBbGxvd01ldGhvZHM6IGhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWFsbG93LW1ldGhvZHMnXSxcbiAgICAgIEFjY2Vzc0NvbnRyb2xBbGxvd0hlYWRlcnM6IGhlYWRlcnNbJ2FjY2Vzcy1jb250cm9sLWFsbG93LWhlYWRlcnMnXSxcbiAgICAgIEFjY2Vzc0NvbnRyb2xFeHBvc2VIZWFkZXJzOiBoZWFkZXJzWydhY2Nlc3MtY29udHJvbC1leHBvc2UtaGVhZGVycyddLFxuICAgICAgQWNjZXNzQ29udHJvbE1heEFnZTogaGVhZGVyc1snYWNjZXNzLWNvbnRyb2wtbWF4LWFnZSddLFxuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiBAcGFyYW0gIHtPYmplY3R9ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWIl+ihqFxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXQg5ZCN56ewXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensFxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEtleSAgICAgICAgICAgICAgICAgICAgICAgICAgICDmlofku7blkI3np7BcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb3B5U291cmNlICAgICAgICAgICAgICAgICAgICAg5rqQ5paH5Lu2VVJM57ud5a+56Lev5b6E77yM5Y+v5Lul6YCa6L+HdmVyc2lvbmlk5a2Q6LWE5rqQ5oyH5a6a5Y6G5Y+y54mI5pysXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgQUNMICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWFgeiuuOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkOOAguacieaViOWAvO+8mnByaXZhdGXvvIxwdWJsaWMtcmVhZOm7mOiupOWAvO+8mnByaXZhdGXjgIJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBHcmFudFJlYWQgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+755qE5p2D6ZmQ77yM5qC85byPIHgtY29zLWdyYW50LXJlYWQ6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzlvZPpnIDopoHnu5nlrZDotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SUQvU3ViQWNjb3VudElEXCLvvIzlvZPpnIDopoHnu5nmoLnotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SURcIuOAglxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEdyYW50V3JpdGUgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXlhpnnmoTmnYPpmZDvvIzmoLzlvI8geC1jb3MtZ3JhbnQtd3JpdGU6IHVpbj1cIiBcIix1aW49XCIgXCLvvIzlvZPpnIDopoHnu5nlrZDotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SUQvU3ViQWNjb3VudElEXCLvvIzlvZPpnIDopoHnu5nmoLnotKbmiLfmjojmnYPml7bvvIx1aW49XCJSb290QWNvdW50SURcIuOAglxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIEdyYW50RnVsbENvbnRyb2wgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vlhpnmnYPpmZDvvIzmoLzlvI8geC1jb3MtZ3JhbnQtZnVsbC1jb250cm9sOiB1aW49XCIgXCIsdWluPVwiIFwi77yM5b2T6ZyA6KaB57uZ5a2Q6LSm5oi35o6I5p2D5pe277yMdWluPVwiUm9vdEFjb3VudElEL1N1YkFjY291bnRJRFwi77yM5b2T6ZyA6KaB57uZ5qC56LSm5oi35o6I5p2D5pe277yMdWluPVwiUm9vdEFjb3VudElEXCLjgIJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBNZXRhZGF0YURpcmVjdGl2ZSAgICAgICAgICAgICAg5piv5ZCm5ou36LSd5YWD5pWw5o2u77yM5p6a5Li+5YC877yaQ29weSwgUmVwbGFjZWTvvIzpu5jorqTlgLxDb3B544CC5YGH5aaC5qCH6K6w5Li6Q29wee+8jOW/veeVpUhlYWRlcuS4reeahOeUqOaIt+WFg+aVsOaNruS/oeaBr+ebtOaOpeWkjeWItu+8m+WBh+Wmguagh+iusOS4ulJlcGxhY2Vk77yM5oyJSGVhZGVy5L+h5oGv5L+u5pS55YWD5pWw5o2u44CC5b2T55uu5qCH6Lev5b6E5ZKM5Y6f6Lev5b6E5LiA6Ie077yM5Y2z55So5oi36K+V5Zu+5L+u5pS55YWD5pWw5o2u5pe277yM5b+F6aG75Li6UmVwbGFjZWRcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb3B5U291cmNlSWZNb2RpZmllZFNpbmNlICAgICAg5b2TT2JqZWN05Zyo5oyH5a6a5pe26Ze05ZCO6KKr5L+u5pS577yM5YiZ5omn6KGM5pON5L2c77yM5ZCm5YiZ6L+U5ZueNDEy44CC5Y+v5LiOeC1jb3MtY29weS1zb3VyY2UtSWYtTm9uZS1NYXRjaOS4gOi1t+S9v+eUqO+8jOS4juWFtuS7luadoeS7tuiBlOWQiOS9v+eUqOi/lOWbnuWGsueqgeOAglxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvcHlTb3VyY2VJZlVubW9kaWZpZWRTaW5jZSAgICDlvZNPYmplY3TlnKjmjIflrprml7bpl7TlkI7mnKrooqvkv67mlLnvvIzliJnmiafooYzmk43kvZzvvIzlkKbliJnov5Tlm540MTLjgILlj6/kuI54LWNvcy1jb3B5LXNvdXJjZS1JZi1NYXRjaOS4gOi1t+S9v+eUqO+8jOS4juWFtuS7luadoeS7tuiBlOWQiOS9v+eUqOi/lOWbnuWGsueqgeOAglxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvcHlTb3VyY2VJZk1hdGNoICAgICAgICAgICAgICDlvZNPYmplY3TnmoRFVGFn5ZKM57uZ5a6a5LiA6Ie05pe277yM5YiZ5omn6KGM5pON5L2c77yM5ZCm5YiZ6L+U5ZueNDEy44CC5Y+v5LiOeC1jb3MtY29weS1zb3VyY2UtSWYtVW5tb2RpZmllZC1TaW5jZeS4gOi1t+S9v+eUqO+8jOS4juWFtuS7luadoeS7tuiBlOWQiOS9v+eUqOi/lOWbnuWGsueqgeOAglxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvcHlTb3VyY2VJZk5vbmVNYXRjaCAgICAgICAgICDlvZNPYmplY3TnmoRFVGFn5ZKM57uZ5a6a5LiN5LiA6Ie05pe277yM5YiZ5omn6KGM5pON5L2c77yM5ZCm5YiZ6L+U5ZueNDEy44CC5Y+v5LiOeC1jb3MtY29weS1zb3VyY2UtSWYtTW9kaWZpZWQtU2luY2XkuIDotbfkvb/nlKjvvIzkuI7lhbbku5bmnaHku7bogZTlkIjkvb/nlKjov5Tlm57lhrLnqoHjgIJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBTdG9yYWdlQ2xhc3MgICAgICAgICAgICAgICAgICAg5a2Y5YKo57qn5Yir77yM5p6a5Li+5YC877ya5a2Y5YKo57qn5Yir77yM5p6a5Li+5YC877yaU3RhbmRhcmQsIFN0YW5kYXJkX0lB77yMQXJjaGl2Ze+8m+m7mOiupOWAvO+8mlN0YW5kYXJkXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgQ2FjaGVDb250cm9sICAgICAgICAgICAgICAgICAgIOaMh+WumuaJgOaciee8k+WtmOacuuWItuWcqOaVtOS4quivt+axgi/lk43lupTpk77kuK3lv4XpobvmnI3ku47nmoTmjIfku6TjgIJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50RGlzcG9zaXRpb24gICAgICAgICAgICAgTUlNRSDljY/orq7nmoTmianlsZXvvIxNSU1FIOWNj+iuruaMh+ekuiBNSU1FIOeUqOaIt+S7o+eQhuWmguS9leaYvuekuumZhOWKoOeahOaWh+S7tlxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvbnRlbnRFbmNvZGluZyAgICAgICAgICAgICAgICBIVFRQIOS4reeUqOadpeWvueOAjOmHh+eUqOS9leenjee8lueggeagvOW8j+S8oOi+k+ato+aWh+OAjei/m+ihjOWNj+WumueahOS4gOWvueWktOmDqOWtl+autVxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIENvbnRlbnRMZW5ndGggICAgICAgICAgICAgICAgICDorr7nva7lk43lupTmtojmga/nmoTlrp7kvZPlhoXlrrnnmoTlpKflsI/vvIzljZXkvY3kuLrlrZfoioJcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBDb250ZW50VHlwZSAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qEIEhUVFAg6K+35rGC5YaF5a6557G75Z6L77yITUlNRe+8ie+8jOS+i+WmgnRleHQvcGxhaW5cbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBFeHBlY3QgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC55qE54m55a6a55qE5pyN5Yqh5Zmo6KGM5Li6XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgRXhwaXJlcyAgICAgICAgICAgICAgICAgICAgICAgIOWTjeW6lOi/h+acn+eahOaXpeacn+WSjOaXtumXtFxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgIOaUr+aMgeaMieeFp+aMh+WumueahOWKoOWvhueul+azlei/m+ihjOacjeWKoeerr+aVsOaNruWKoOWvhu+8jOagvOW8jyB4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uOiBcIkFFUzI1Nlwi77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgQ29udGVudExhbmd1YWdlICAgICAgICAgICAgICAgIOaMh+WumuWGheWuueivreiogFxuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHgtY29zLW1ldGEtKiAgICAgICAgICAgICAgICAgICDlhYHorrjnlKjmiLfoh6rlrprkuYnnmoTlpLTpg6jkv6Hmga/vvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNrui/lOWbnuOAguWkp+Wwj+mZkOWItjJL44CCXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRPYmplY3RDb3B5KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2xcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgdmFyIENvcHlTb3VyY2UgPSBwYXJhbXMuQ29weVNvdXJjZSB8fCAnJztcbiAgdmFyIG0gPSB1dGlsLmdldFNvdXJjZVBhcmFtcy5jYWxsKHRoaXMsIENvcHlTb3VyY2UpO1xuXG4gIGlmICghbSkge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdDb3B5U291cmNlIGZvcm1hdCBlcnJvcicpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFNvdXJjZUJ1Y2tldCA9IG0uQnVja2V0O1xuICB2YXIgU291cmNlUmVnaW9uID0gbS5SZWdpb247XG4gIHZhciBTb3VyY2VLZXkgPSBkZWNvZGVVUklDb21wb25lbnQobS5LZXkpO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIFNjb3BlOiBbe1xuICAgICAgYWN0aW9uOiAnbmFtZS9jb3M6R2V0T2JqZWN0JyxcbiAgICAgIGJ1Y2tldDogU291cmNlQnVja2V0LFxuICAgICAgcmVnaW9uOiBTb3VyY2VSZWdpb24sXG4gICAgICBwcmVmaXg6IFNvdXJjZUtleVxuICAgIH0sIHtcbiAgICAgIGFjdGlvbjogJ25hbWUvY29zOlB1dE9iamVjdCcsXG4gICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICByZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBwcmVmaXg6IHBhcmFtcy5LZXlcbiAgICB9XSxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVyc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgdmFyIHJlc3VsdCA9IHV0aWwuY2xvbmUoZGF0YS5Db3B5T2JqZWN0UmVzdWx0IHx8IHt9KTtcbiAgICB2YXIgdXJsID0gZ2V0VXJsKHtcbiAgICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgICBwcm90b2NvbDogc2VsZi5vcHRpb25zLlByb3RvY29sLFxuICAgICAgZG9tYWluOiBzZWxmLm9wdGlvbnMuRG9tYWluLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgb2JqZWN0OiBwYXJhbXMuS2V5LFxuICAgICAgaXNMb2NhdGlvbjogdHJ1ZVxuICAgIH0pO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgTG9jYXRpb246IHVybCxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB1cGxvYWRQYXJ0Q29weShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBDb3B5U291cmNlID0gcGFyYW1zLkNvcHlTb3VyY2UgfHwgJyc7XG4gIHZhciBtID0gdXRpbC5nZXRTb3VyY2VQYXJhbXMuY2FsbCh0aGlzLCBDb3B5U291cmNlKTtcblxuICBpZiAoIW0pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignQ29weVNvdXJjZSBmb3JtYXQgZXJyb3InKSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBTb3VyY2VCdWNrZXQgPSBtLkJ1Y2tldDtcbiAgdmFyIFNvdXJjZVJlZ2lvbiA9IG0uUmVnaW9uO1xuICB2YXIgU291cmNlS2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KG0uS2V5KTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBTY29wZTogW3tcbiAgICAgIGFjdGlvbjogJ25hbWUvY29zOkdldE9iamVjdCcsXG4gICAgICBidWNrZXQ6IFNvdXJjZUJ1Y2tldCxcbiAgICAgIHJlZ2lvbjogU291cmNlUmVnaW9uLFxuICAgICAgcHJlZml4OiBTb3VyY2VLZXlcbiAgICB9LCB7XG4gICAgICBhY3Rpb246ICduYW1lL2NvczpQdXRPYmplY3QnLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgcHJlZml4OiBwYXJhbXMuS2V5XG4gICAgfV0sXG4gICAgbWV0aG9kOiAnUFVUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWQsXG4gICAgcXM6IHtcbiAgICAgIHBhcnROdW1iZXI6IHBhcmFtc1snUGFydE51bWJlciddLFxuICAgICAgdXBsb2FkSWQ6IHBhcmFtc1snVXBsb2FkSWQnXVxuICAgIH0sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciByZXN1bHQgPSB1dGlsLmNsb25lKGRhdGEuQ29weVBhcnRSZXN1bHQgfHwge30pO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZU11bHRpcGxlT2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIE9iamVjdHMgPSBwYXJhbXMuT2JqZWN0cyB8fCBbXTtcbiAgdmFyIFF1aWV0ID0gcGFyYW1zLlF1aWV0O1xuICBPYmplY3RzID0gdXRpbC5pc0FycmF5KE9iamVjdHMpID8gT2JqZWN0cyA6IFtPYmplY3RzXTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIERlbGV0ZToge1xuICAgICAgT2JqZWN0OiBPYmplY3RzLFxuICAgICAgUXVpZXQ6IFF1aWV0IHx8IGZhbHNlXG4gICAgfVxuICB9KTtcbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24veG1sJztcbiAgaGVhZGVyc1snQ29udGVudC1NRDUnXSA9IHV0aWwuYmluYXJ5QmFzZTY0KHV0aWwubWQ1KHhtbCkpO1xuICB2YXIgU2NvcGUgPSB1dGlsLm1hcChPYmplY3RzLCBmdW5jdGlvbiAodikge1xuICAgIHJldHVybiB7XG4gICAgICBhY3Rpb246ICduYW1lL2NvczpEZWxldGVPYmplY3QnLFxuICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgcmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgICAgcHJlZml4OiB2LktleVxuICAgIH07XG4gIH0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIFNjb3BlOiBTY29wZSxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdkZWxldGUnLFxuICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIHZhciBEZWxldGVSZXN1bHQgPSBkYXRhLkRlbGV0ZVJlc3VsdCB8fCB7fTtcbiAgICB2YXIgRGVsZXRlZCA9IERlbGV0ZVJlc3VsdC5EZWxldGVkIHx8IFtdO1xuICAgIHZhciBFcnJvcnMgPSBEZWxldGVSZXN1bHQuRXJyb3IgfHwgW107XG4gICAgRGVsZXRlZCA9IHV0aWwuaXNBcnJheShEZWxldGVkKSA/IERlbGV0ZWQgOiBbRGVsZXRlZF07XG4gICAgRXJyb3JzID0gdXRpbC5pc0FycmF5KEVycm9ycykgPyBFcnJvcnMgOiBbRXJyb3JzXTtcbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5jbG9uZShEZWxldGVSZXN1bHQpO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgRXJyb3I6IEVycm9ycyxcbiAgICAgIERlbGV0ZWQ6IERlbGV0ZWQsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVzdG9yZU9iamVjdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG5cbiAgaWYgKCFwYXJhbXNbJ1Jlc3RvcmVSZXF1ZXN0J10pIHtcbiAgICBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBSZXN0b3JlUmVxdWVzdCcpKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIFJlc3RvcmVSZXF1ZXN0ID0gcGFyYW1zLlJlc3RvcmVSZXF1ZXN0IHx8IHt9O1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgUmVzdG9yZVJlcXVlc3Q6IFJlc3RvcmVSZXF1ZXN0XG4gIH0pO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6UmVzdG9yZU9iamVjdCcsXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgVmVyc2lvbklkOiBwYXJhbXMuVmVyc2lvbklkLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICdyZXN0b3JlJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0sIGNhbGxiYWNrKTtcbn1cbi8qKlxuICog6K6+572uIE9iamVjdCDnmoTmoIfnrb5cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBPYmplY3TlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtBcnJheX0gICBwYXJhbXMuVGFnU2V0ICDmoIfnrb7orr7nva7vvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzQyOTk4XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBwdXRPYmplY3RUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIFRhZ2dpbmcgPSBwYXJhbXNbJ1RhZ2dpbmcnXSB8fCB7fTtcbiAgdmFyIFRhZ3MgPSBUYWdnaW5nLlRhZ1NldCB8fCBUYWdnaW5nLlRhZ3MgfHwgcGFyYW1zWydUYWdzJ10gfHwgW107XG4gIFRhZ3MgPSB1dGlsLmNsb25lKHV0aWwuaXNBcnJheShUYWdzKSA/IFRhZ3MgOiBbVGFnc10pO1xuICB2YXIgeG1sID0gdXRpbC5qc29uMnhtbCh7XG4gICAgVGFnZ2luZzoge1xuICAgICAgVGFnU2V0OiB7XG4gICAgICAgIFRhZzogVGFnc1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpQdXRPYmplY3RUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdQVVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGJvZHk6IHhtbCxcbiAgICBhY3Rpb246ICd0YWdnaW5nJyxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzQ29kZSA9PT0gMjA0KSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwge1xuICAgICAgICBzdGF0dXNDb2RlOiBlcnIuc3RhdHVzQ29kZVxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChlcnIpIHtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog6I635Y+WIE9iamVjdCDnmoTmoIfnrb7orr7nva5cbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2LzQyOTk4XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAg6L+U5Zue5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRPYmplY3RUYWdnaW5nKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRPYmplY3RUYWdnaW5nJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3RhZ2dpbmcnLFxuICAgIFZlcnNpb25JZDogcGFyYW1zLlZlcnNpb25JZFxuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXNDb2RlID09PSA0MDQgJiYgZXJyLmVycm9yICYmIChlcnIuZXJyb3IgPT09IFwiTm90IEZvdW5kXCIgfHwgZXJyLmVycm9yLkNvZGUgPT09ICdOb1N1Y2hUYWdTZXQnKSkge1xuICAgICAgICB2YXIgcmVzdWx0ID0ge1xuICAgICAgICAgIFRhZ3M6IFtdLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGVyci5zdGF0dXNDb2RlXG4gICAgICAgIH07XG4gICAgICAgIGVyci5oZWFkZXJzICYmIChyZXN1bHQuaGVhZGVycyA9IGVyci5oZWFkZXJzKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgVGFncyA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIFRhZ3MgPSBkYXRhLlRhZ2dpbmcuVGFnU2V0LlRhZyB8fCBbXTtcbiAgICB9IGNhdGNoIChlKSB7fVxuXG4gICAgVGFncyA9IHV0aWwuY2xvbmUodXRpbC5pc0FycmF5KFRhZ3MpID8gVGFncyA6IFtUYWdzXSk7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgVGFnczogVGFncyxcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICB9KTtcbn1cbi8qKlxuICog5Yig6ZmkIE9iamVjdCDnmoQg5qCH562+6K6+572uXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgT2JqZWN05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi80Mjk5OFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gZGVsZXRlT2JqZWN0VGFnZ2luZyhwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6RGVsZXRlT2JqZWN0VGFnZ2luZycsXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBoZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBhY3Rpb246ICd0YWdnaW5nJyxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWRcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOS9v+eUqCBTUUwg6K+t5Y+l5LuO5oyH5a6a5a+56LGh77yIQ1NWIOagvOW8j+aIluiAhSBKU09OIOagvOW8j++8ieS4reajgOe0ouWGheWuuVxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgIE9iamVjdOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcy5TZWxlY3RSZXF1ZXN0IOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNDI5OThcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIHNlbGVjdE9iamVjdENvbnRlbnQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgU2VsZWN0VHlwZSA9IHBhcmFtc1snU2VsZWN0VHlwZSddO1xuICBpZiAoIVNlbGVjdFR5cGUpIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcignbWlzc2luZyBwYXJhbSBTZWxlY3RUeXBlJykpKTtcbiAgdmFyIFNlbGVjdFJlcXVlc3QgPSBwYXJhbXNbJ1NlbGVjdFJlcXVlc3QnXSB8fCB7fTtcbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIFNlbGVjdFJlcXVlc3Q6IFNlbGVjdFJlcXVlc3RcbiAgfSk7XG4gIHZhciBoZWFkZXJzID0gcGFyYW1zLkhlYWRlcnM7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL3htbCc7XG4gIGhlYWRlcnNbJ0NvbnRlbnQtTUQ1J10gPSB1dGlsLmJpbmFyeUJhc2U2NCh1dGlsLm1kNSh4bWwpKTtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpHZXRPYmplY3QnLFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIGFjdGlvbjogJ3NlbGVjdCcsXG4gICAgcXM6IHtcbiAgICAgICdzZWxlY3QtdHlwZSc6IHBhcmFtc1snU2VsZWN0VHlwZSddXG4gICAgfSxcbiAgICBWZXJzaW9uSWQ6IHBhcmFtcy5WZXJzaW9uSWQsXG4gICAgYm9keTogeG1sLFxuICAgIERhdGFUeXBlOiAnYXJyYXlidWZmZXInLFxuICAgIHJhd0JvZHk6IHRydWVcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIgJiYgZXJyLnN0YXR1c0NvZGUgPT09IDIwNCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgc3RhdHVzQ29kZTogZXJyLnN0YXR1c0NvZGVcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZXJyKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5wYXJzZVNlbGVjdFBheWxvYWQoZGF0YS5ib2R5KTtcbiAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXG4gICAgICBCb2R5OiByZXN1bHQuYm9keSxcbiAgICAgIFBheWxvYWQ6IHJlc3VsdC5wYXlsb2FkXG4gICAgfSk7XG4gIH0pO1xufSAvLyDliIblnZfkuIrkvKBcblxuLyoqXG4gKiDliJ3lp4vljJbliIblnZfkuIrkvKBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuVXBsb2FkSWQgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ2FjaGVDb250cm9sICAgICAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoTnvJPlrZjnrZbnlaXvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RGlzcG9zaXRpb24gICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOaWh+S7tuWQjeensO+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2YICAgIO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5Db250ZW50RW5jb2RpbmcgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOe8lueggeagvOW8j++8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnRUeXBlICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE5YaF5a6557G75Z6L77yITUlNRe+8ie+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGlyZXMgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE6L+H5pyf5pe26Ze077yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQUNMICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlhYHorrjnlKjmiLfoh6rlrprkuYnmlofku7bmnYPpmZDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRSZWFkICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vnmoTmnYPpmZAg77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGUgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF5YaZ55qE5p2D6ZmQIO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudEZ1bGxDb250cm9sICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheivu+WGmeadg+mZkCDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuU3RvcmFnZUNsYXNzICAgICAgICAgICAgICAgICAgICDorr7nva5PYmplY3TnmoTlrZjlgqjnuqfliKvvvIzmnprkuL7lgLzvvJpTdGFuZGFyZO+8jFN0YW5kYXJkX0lB77yMQXJjaGl2Ze+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgICAgICAgICAg5pSv5oyB5oyJ54Wn5oyH5a6a55qE5Yqg5a+G566X5rOV6L+b6KGM5pyN5Yqh56uv5pWw5o2u5Yqg5a+G77yM5qC85byPIHgtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb246IFwiQUVTMjU2XCLvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIG11bHRpcGFydEluaXQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7IC8vIOeJueauiuWkhOeQhiBDYWNoZS1Db250cm9sXG5cbiAgdmFyIGhlYWRlcnMgPSBwYXJhbXMuSGVhZGVycztcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjsgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2zjgIFDb250ZW50LVR5cGVcblxuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgaWYgKCFoZWFkZXJzWydDb250ZW50LVR5cGUnXSAmJiAhaGVhZGVyc1snY29udGVudC10eXBlJ10pIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gcGFyYW1zLkJvZHkgJiYgcGFyYW1zLkJvZHkudHlwZSB8fCAnJztcbiAgdmFyIG5lZWRDYWxjTWQ1ID0gcGFyYW1zLkJvZHkgJiYgKHBhcmFtcy5VcGxvYWRBZGRNZXRhTWQ1IHx8IHNlbGYub3B0aW9ucy5VcGxvYWRBZGRNZXRhTWQ1KTtcbiAgbmVlZENhbGNNZDUgJiYgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgbWQ1U3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9KTtcbiAgdXRpbC5nZXRCb2R5TWQ1KG5lZWRDYWxjTWQ1LCBwYXJhbXMuQm9keSwgZnVuY3Rpb24gKG1kNSkge1xuICAgIGlmIChtZDUpIHBhcmFtcy5IZWFkZXJzWyd4LWNvcy1tZXRhLW1kNSddID0gbWQ1O1xuICAgIG5lZWRDYWxjTWQ1ICYmIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgbWQ1RW5kVGltZTogbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgICB9KTtcbiAgICBzdWJtaXRSZXF1ZXN0LmNhbGwoc2VsZiwge1xuICAgICAgQWN0aW9uOiAnbmFtZS9jb3M6SW5pdGlhdGVNdWx0aXBhcnRVcGxvYWQnLFxuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgICBhY3Rpb246ICd1cGxvYWRzJyxcbiAgICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgICAgcXM6IHBhcmFtcy5RdWVyeSxcbiAgICAgIHRyYWNrZXI6IHRyYWNrZXJcbiAgICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5wYXJlbnQgJiYgdHJhY2tlci5wYXJlbnQuc2V0UGFyYW1zKHtcbiAgICAgICAgICBlcnJvck5vZGU6ICdtdWx0aXBhcnRJbml0J1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICB9XG5cbiAgICAgIGRhdGEgPSB1dGlsLmNsb25lKGRhdGEgfHwge30pO1xuXG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLkluaXRpYXRlTXVsdGlwYXJ0VXBsb2FkUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB1dGlsLmV4dGVuZChkYXRhLkluaXRpYXRlTXVsdGlwYXJ0VXBsb2FkUmVzdWx0LCB7XG4gICAgICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgICAgICB9KSk7XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgIH0pO1xuICB9LCBwYXJhbXMub25IYXNoUHJvZ3Jlc3MpO1xufVxuLyoqXG4gKiDliIblnZfkuIrkvKBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge0ZpbGUgfHwgQmxvYiB8fCBTdHJpbmd9ICBwYXJhbXMuQm9keSAgICAgICAg5LiK5Lyg5paH5Lu25a+56LGh5oiW5a2X56ym5LiyXG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSBwYXJhbXMuQ29udGVudExlbmd0aCAgICAgICAgICAgICAgICBSRkMgMjYxNiDkuK3lrprkuYnnmoQgSFRUUCDor7fmsYLlhoXlrrnplb/luqbvvIjlrZfoioLvvInvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9IHBhcmFtcy5FeHBlY3QgICAgICAgICAgICAgICAgICAgICAgIOW9k+S9v+eUqCBFeHBlY3Q6IDEwMC1jb250aW51ZSDml7bvvIzlnKjmlLbliLDmnI3liqHnq6/noa7orqTlkI7vvIzmiY3kvJrlj5HpgIHor7fmsYLlhoXlrrnvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9IHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgICAgICAgIOaUr+aMgeaMieeFp+aMh+WumueahOWKoOWvhueul+azlei/m+ihjOacjeWKoeerr+aVsOaNruWKoOWvhu+8jOagvOW8jyB4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uOiBcIkFFUzI1Nlwi77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSBwYXJhbXMuQ29udGVudFNoYTEgICAgICAgICAgICAgICAgICBSRkMgMzE3NCDkuK3lrprkuYnnmoQgMTYwLWJpdCDlhoXlrrkgU0hBLTEg566X5rOV5qCh6aqM5YC877yM6Z2e5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICBkYXRhICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gIGRhdGEuRVRhZyAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlofku7bliIblnZcgc2hhMSDlgLxcbiAqL1xuXG5cbmZ1bmN0aW9uIG11bHRpcGFydFVwbG9hZChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdXRpbC5nZXRGaWxlU2l6ZSgnbXVsdGlwYXJ0VXBsb2FkJywgcGFyYW1zLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcbiAgICB2YXIgbmVlZENhbGNNZDUgPSBzZWxmLm9wdGlvbnMuVXBsb2FkQ2hlY2tDb250ZW50TWQ1O1xuICAgIG5lZWRDYWxjTWQ1ICYmIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgbWQ1U3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgIH0pO1xuICAgIHV0aWwuZ2V0Qm9keU1kNShuZWVkQ2FsY01kNSwgcGFyYW1zLkJvZHksIGZ1bmN0aW9uIChtZDUpIHtcbiAgICAgIGlmIChtZDUpIHBhcmFtcy5IZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQobWQ1KTtcbiAgICAgIG5lZWRDYWxjTWQ1ICYmIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgICBtZDVFbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgICAgfSk7XG4gICAgICB0cmFja2VyICYmIHRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICAgICAgcGFydE51bWJlcjogcGFyYW1zLlBhcnROdW1iZXJcbiAgICAgIH0pO1xuICAgICAgc3VibWl0UmVxdWVzdC5jYWxsKHNlbGYsIHtcbiAgICAgICAgQWN0aW9uOiAnbmFtZS9jb3M6VXBsb2FkUGFydCcsXG4gICAgICAgIFRhc2tJZDogcGFyYW1zLlRhc2tJZCxcbiAgICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICAgIEtleTogcGFyYW1zLktleSxcbiAgICAgICAgcXM6IHtcbiAgICAgICAgICBwYXJ0TnVtYmVyOiBwYXJhbXNbJ1BhcnROdW1iZXInXSxcbiAgICAgICAgICB1cGxvYWRJZDogcGFyYW1zWydVcGxvYWRJZCddXG4gICAgICAgIH0sXG4gICAgICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgICAgICBvblByb2dyZXNzOiBwYXJhbXMub25Qcm9ncmVzcyxcbiAgICAgICAgYm9keTogcGFyYW1zLkJvZHkgfHwgbnVsbCxcbiAgICAgICAgdHJhY2tlcjogdHJhY2tlclxuICAgICAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnBhcmVudCAmJiB0cmFja2VyLnBhcmVudC5zZXRQYXJhbXMoe1xuICAgICAgICAgICAgZXJyb3JOb2RlOiAnbXVsdGlwYXJ0VXBsb2FkJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgICAgIEVUYWc6IHV0aWwuYXR0cihkYXRhLmhlYWRlcnMsICdldGFnJywgJycpLFxuICAgICAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59XG4vKipcbiAqIOWujOaIkOWIhuWdl+S4iuS8oFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICAgICAgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtBcnJheX0gICBwYXJhbXMuUGFydHMgICAgICAgICAgICAgICAgICAg5YiG5Z2X5L+h5oGv5YiX6KGo77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlBhcnRzW2ldLlBhcnROdW1iZXIgICAgIOWdl+e8luWPt++8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5QYXJ0c1tpXS5FVGFnICAgICAgICAgICDliIblnZfnmoQgc2hhMSDmoKHpqozlgLxcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZXJyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogQHJldHVybiAge09iamVjdH0gIGRhdGEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YS5Db21wbGV0ZU11bHRpcGFydFVwbG9hZCAg5a6M5oiQ5YiG5Z2X5LiK5Lyg5ZCO55qE5paH5Lu25L+h5oGv77yM5YyF5ousTG9jYXRpb24sIEJ1Y2tldCwgS2V5IOWSjCBFVGFnXG4gKi9cblxuXG5mdW5jdGlvbiBtdWx0aXBhcnRDb21wbGV0ZShwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIFVwbG9hZElkID0gcGFyYW1zLlVwbG9hZElkO1xuICB2YXIgUGFydHMgPSBwYXJhbXNbJ1BhcnRzJ107XG4gIHZhciB0cmFja2VyID0gcGFyYW1zLnRyYWNrZXI7XG5cbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IFBhcnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgaWYgKFBhcnRzW2ldWydFVGFnJ10gJiYgUGFydHNbaV1bJ0VUYWcnXS5pbmRleE9mKCdcIicpID09PSAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBQYXJ0c1tpXVsnRVRhZyddID0gJ1wiJyArIFBhcnRzW2ldWydFVGFnJ10gKyAnXCInO1xuICB9XG5cbiAgdmFyIHhtbCA9IHV0aWwuanNvbjJ4bWwoe1xuICAgIENvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkOiB7XG4gICAgICBQYXJ0OiBQYXJ0c1xuICAgIH1cbiAgfSk7IC8vIENTUC9jZXBoIENvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkIOaOpeWPoyBib2R5IOWGmeatu+S6humZkOWItiAxTULvvIzov5nph4zphonlgJIgMTAwMDAg54mH5pe277yMeG1sIOWtl+espuS4suWOu+aOieepuuagvDg1M0tCXG5cbiAgeG1sID0geG1sLnJlcGxhY2UoL1xcblxccyovZywgJycpO1xuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94bWwnO1xuICBoZWFkZXJzWydDb250ZW50LU1ENSddID0gdXRpbC5iaW5hcnlCYXNlNjQodXRpbC5tZDUoeG1sKSk7XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6Q29tcGxldGVNdWx0aXBhcnRVcGxvYWQnLFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIHFzOiB7XG4gICAgICB1cGxvYWRJZDogVXBsb2FkSWRcbiAgICB9LFxuICAgIGJvZHk6IHhtbCxcbiAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgIHRyYWNrZXI6IHRyYWNrZXJcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5wYXJlbnQgJiYgdHJhY2tlci5wYXJlbnQuc2V0UGFyYW1zKHtcbiAgICAgICAgZXJyb3JOb2RlOiAnbXVsdGlwYXJ0Q29tcGxldGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIHZhciB1cmwgPSBnZXRVcmwoe1xuICAgICAgRm9yY2VQYXRoU3R5bGU6IHNlbGYub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSxcbiAgICAgIHByb3RvY29sOiBzZWxmLm9wdGlvbnMuUHJvdG9jb2wsXG4gICAgICBkb21haW46IHNlbGYub3B0aW9ucy5Eb21haW4sXG4gICAgICBidWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgICByZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgICBvYmplY3Q6IHBhcmFtcy5LZXksXG4gICAgICBpc0xvY2F0aW9uOiB0cnVlXG4gICAgfSk7XG4gICAgdmFyIHJlcyA9IGRhdGEuQ29tcGxldGVNdWx0aXBhcnRVcGxvYWRSZXN1bHQgfHwge307XG5cbiAgICBpZiAocmVzLlByb2Nlc3NSZXN1bHRzKSB7XG4gICAgICBpZiAocmVzICYmIHJlcy5Qcm9jZXNzUmVzdWx0cykge1xuICAgICAgICByZXMuVXBsb2FkUmVzdWx0ID0ge1xuICAgICAgICAgIE9yaWdpbmFsSW5mbzoge1xuICAgICAgICAgICAgS2V5OiByZXMuS2V5LFxuICAgICAgICAgICAgTG9jYXRpb246IHVybCxcbiAgICAgICAgICAgIEVUYWc6IHJlcy5FVGFnLFxuICAgICAgICAgICAgSW1hZ2VJbmZvOiByZXMuSW1hZ2VJbmZvXG4gICAgICAgICAgfSxcbiAgICAgICAgICBQcm9jZXNzUmVzdWx0czogcmVzLlByb2Nlc3NSZXN1bHRzXG4gICAgICAgIH07XG4gICAgICAgIGRlbGV0ZSByZXMuSW1hZ2VJbmZvO1xuICAgICAgICBkZWxldGUgcmVzLlByb2Nlc3NSZXN1bHRzO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciByZXN1bHQgPSB1dGlsLmV4dGVuZChyZXMsIHtcbiAgICAgIExvY2F0aW9uOiB1cmwsXG4gICAgICBzdGF0dXNDb2RlOiBkYXRhLnN0YXR1c0NvZGUsXG4gICAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjYWxsYmFjayhudWxsLCByZXN1bHQpO1xuICB9KTtcbn1cbi8qKlxuICog5YiG5Z2X5LiK5Lyg5Lu75Yqh5YiX6KGo5p+l6K+iXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkRlbGltaXRlciAgICAgICAgICAgICAgICAgICDlrprnlYznrKbkuLrkuIDkuKrnrKblj7fvvIzlpoLmnpzmnIlQcmVmaXjvvIzliJnlsIZQcmVmaXjliLBkZWxpbWl0ZXLkuYvpl7TnmoTnm7jlkIzot6/lvoTlvZLkuLrkuIDnsbvvvIzlrprkuYnkuLpDb21tb24gUHJlZml477yM54S25ZCO5YiX5Ye65omA5pyJQ29tbW9uIFByZWZpeOOAguWmguaenOayoeaciVByZWZpeO+8jOWImeS7jui3r+W+hOi1t+eCueW8gOWni++8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FbmNvZGluZ1R5cGUgICAgICAgICAgICAgICAg6KeE5a6a6L+U5Zue5YC855qE57yW56CB5pa55byP77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlByZWZpeCAgICAgICAgICAgICAgICAgICAgICDliY3nvIDljLnphY3vvIznlKjmnaXop4Tlrprov5Tlm57nmoTmlofku7bliY3nvIDlnLDlnYDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuTWF4VXBsb2FkcyAgICAgICAgICAgICAgICAgIOWNleasoei/lOWbnuacgOWkp+eahOadoeebruaVsOmHj++8jOm7mOiupDEwMDDvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5TWFya2VyICAgICAgICAgICAgICAgICAgIOS4jnVwbG9hZC1pZC1tYXJrZXLkuIDotbfkvb/nlKggPC9Ccj7lvZN1cGxvYWQtaWQtbWFya2Vy5pyq6KKr5oyH5a6a5pe277yMT2JqZWN0TmFtZeWtl+avjemhuuW6j+Wkp+S6jmtleS1tYXJrZXLnmoTmnaHnm67lsIbooqvliJflh7ogPC9Ccj7lvZN1cGxvYWQtaWQtbWFya2Vy6KKr5oyH5a6a5pe277yMT2JqZWN0TmFtZeWtl+avjemhuuW6j+Wkp+S6jmtleS1tYXJrZXLnmoTmnaHnm67ooqvliJflh7rvvIxPYmplY3ROYW1l5a2X5q+N6aG65bqP562J5LqOa2V5LW1hcmtlcuWQjOaXtlVwbG9hZElk5aSn5LqOdXBsb2FkLWlkLW1hcmtlcueahOadoeebruWwhuiiq+WIl+WHuu+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZE1hcmtlciAgICAgICAgICAgICAg5LiOa2V5LW1hcmtlcuS4gOi1t+S9v+eUqCA8L0JyPuW9k2tleS1tYXJrZXLmnKrooqvmjIflrprml7bvvIx1cGxvYWQtaWQtbWFya2Vy5bCG6KKr5b+955WlIDwvQnI+5b2Ta2V5LW1hcmtlcuiiq+aMh+WumuaXtu+8jE9iamVjdE5hbWXlrZfmr43pobrluo/lpKfkuo5rZXktbWFya2Vy55qE5p2h55uu6KKr5YiX5Ye677yMT2JqZWN0TmFtZeWtl+avjemhuuW6j+etieS6jmtleS1tYXJrZXLlkIzml7ZVcGxvYWRJZOWkp+S6jnVwbG9hZC1pZC1tYXJrZXLnmoTmnaHnm67lsIbooqvliJflh7rvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdCAgIOWIhuWdl+S4iuS8oOS7u+WKoeS/oeaBr1xuICovXG5cblxuZnVuY3Rpb24gbXVsdGlwYXJ0TGlzdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciByZXFQYXJhbXMgPSB7fTtcbiAgcmVxUGFyYW1zWydkZWxpbWl0ZXInXSA9IHBhcmFtc1snRGVsaW1pdGVyJ107XG4gIHJlcVBhcmFtc1snZW5jb2RpbmctdHlwZSddID0gcGFyYW1zWydFbmNvZGluZ1R5cGUnXTtcbiAgcmVxUGFyYW1zWydwcmVmaXgnXSA9IHBhcmFtc1snUHJlZml4J10gfHwgJyc7XG4gIHJlcVBhcmFtc1snbWF4LXVwbG9hZHMnXSA9IHBhcmFtc1snTWF4VXBsb2FkcyddO1xuICByZXFQYXJhbXNbJ2tleS1tYXJrZXInXSA9IHBhcmFtc1snS2V5TWFya2VyJ107XG4gIHJlcVBhcmFtc1sndXBsb2FkLWlkLW1hcmtlciddID0gcGFyYW1zWydVcGxvYWRJZE1hcmtlciddO1xuICByZXFQYXJhbXMgPSB1dGlsLmNsZWFyS2V5KHJlcVBhcmFtcyk7XG4gIHZhciB0cmFja2VyID0gcGFyYW1zLnRyYWNrZXI7XG4gIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgIHNpZ25TdGFydFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG4gIH0pO1xuICBzdWJtaXRSZXF1ZXN0LmNhbGwodGhpcywge1xuICAgIEFjdGlvbjogJ25hbWUvY29zOkxpc3RNdWx0aXBhcnRVcGxvYWRzJyxcbiAgICBSZXNvdXJjZUtleTogcmVxUGFyYW1zWydwcmVmaXgnXSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtcyxcbiAgICBhY3Rpb246ICd1cGxvYWRzJyxcbiAgICB0cmFja2VyOiB0cmFja2VyXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICB0cmFja2VyICYmIHRyYWNrZXIucGFyZW50ICYmIHRyYWNrZXIucGFyZW50LnNldFBhcmFtcyh7XG4gICAgICAgIGVycm9yTm9kZTogJ211bHRpcGFydExpc3QnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIGlmIChkYXRhICYmIGRhdGEuTGlzdE11bHRpcGFydFVwbG9hZHNSZXN1bHQpIHtcbiAgICAgIHZhciBVcGxvYWQgPSBkYXRhLkxpc3RNdWx0aXBhcnRVcGxvYWRzUmVzdWx0LlVwbG9hZCB8fCBbXTtcbiAgICAgIFVwbG9hZCA9IHV0aWwuaXNBcnJheShVcGxvYWQpID8gVXBsb2FkIDogW1VwbG9hZF07XG4gICAgICBkYXRhLkxpc3RNdWx0aXBhcnRVcGxvYWRzUmVzdWx0LlVwbG9hZCA9IFVwbG9hZDtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5jbG9uZShkYXRhLkxpc3RNdWx0aXBhcnRVcGxvYWRzUmVzdWx0IHx8IHt9KTtcbiAgICB1dGlsLmV4dGVuZChyZXN1bHQsIHtcbiAgICAgIHN0YXR1c0NvZGU6IGRhdGEuc3RhdHVzQ29kZSxcbiAgICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVyc1xuICAgIH0pO1xuICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdCk7XG4gIH0pO1xufVxuLyoqXG4gKiDkuIrkvKDnmoTliIblnZfliJfooajmn6Xor6JcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICAgICAgICAgICAgICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5VcGxvYWRJZCAgICAgICAgICAgICAgICAgICAg5qCH56S65pys5qyh5YiG5Z2X5LiK5Lyg55qESUTvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRW5jb2RpbmdUeXBlICAgICAgICAgICAgICAgIOinhOWumui/lOWbnuWAvOeahOe8lueggeaWueW8j++8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NYXhQYXJ0cyAgICAgICAgICAgICAgICAgICAg5Y2V5qyh6L+U5Zue5pyA5aSn55qE5p2h55uu5pWw6YeP77yM6buY6K6kMTAwMO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5QYXJ0TnVtYmVyTWFya2VyICAgICAgICAgICAg6buY6K6k5LulVVRGLTjkuozov5vliLbpobrluo/liJflh7rmnaHnm67vvIzmiYDmnInliJflh7rmnaHnm67ku45tYXJrZXLlvIDlp4vvvIzpnZ7lv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogQHJldHVybiAge09iamVjdH0gIGVyciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgZGF0YS5MaXN0TXVsdGlwYXJ0VXBsb2Fkc1Jlc3VsdCAgIOWIhuWdl+S/oeaBr1xuICovXG5cblxuZnVuY3Rpb24gbXVsdGlwYXJ0TGlzdFBhcnQocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgcmVxUGFyYW1zID0ge307XG4gIHZhciB0cmFja2VyID0gcGFyYW1zLnRyYWNrZXI7XG4gIHJlcVBhcmFtc1sndXBsb2FkSWQnXSA9IHBhcmFtc1snVXBsb2FkSWQnXTtcbiAgcmVxUGFyYW1zWydlbmNvZGluZy10eXBlJ10gPSBwYXJhbXNbJ0VuY29kaW5nVHlwZSddO1xuICByZXFQYXJhbXNbJ21heC1wYXJ0cyddID0gcGFyYW1zWydNYXhQYXJ0cyddO1xuICByZXFQYXJhbXNbJ3BhcnQtbnVtYmVyLW1hcmtlciddID0gcGFyYW1zWydQYXJ0TnVtYmVyTWFya2VyJ107XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6TGlzdFBhcnRzJyxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgS2V5OiBwYXJhbXMuS2V5LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiByZXFQYXJhbXNcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5wYXJlbnQgJiYgdHJhY2tlci5wYXJlbnQuc2V0UGFyYW1zKHtcbiAgICAgICAgZXJyb3JOb2RlOiAnbXVsdGlwYXJ0TGlzdFBhcnQnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgIH1cblxuICAgIHZhciBMaXN0UGFydHNSZXN1bHQgPSBkYXRhLkxpc3RQYXJ0c1Jlc3VsdCB8fCB7fTtcbiAgICB2YXIgUGFydCA9IExpc3RQYXJ0c1Jlc3VsdC5QYXJ0IHx8IFtdO1xuICAgIFBhcnQgPSB1dGlsLmlzQXJyYXkoUGFydCkgPyBQYXJ0IDogW1BhcnRdO1xuICAgIExpc3RQYXJ0c1Jlc3VsdC5QYXJ0ID0gUGFydDtcbiAgICB2YXIgcmVzdWx0ID0gdXRpbC5jbG9uZShMaXN0UGFydHNSZXN1bHQpO1xuICAgIHV0aWwuZXh0ZW5kKHJlc3VsdCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcbiAgfSk7XG59XG4vKipcbiAqIOaKm+W8g+WIhuWdl+S4iuS8oFxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgICAgICDlj4LmlbDlr7nosaHvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQnVja2V0ICAgICAgQnVja2V05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlJlZ2lvbiAgICAgIOWcsOWfn+WQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgICAgICBvYmplY3TlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuVXBsb2FkSWQgICAg5qCH56S65pys5qyh5YiG5Z2X5LiK5Lyg55qESUTvvIzlv4XpobtcbiAqIEBwYXJhbSAge0Z1bmN0aW9ufSAgY2FsbGJhY2sgICAgICAgICAgICAg5Zue6LCD5Ye95pWw77yM5b+F6aG7XG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZXJyICAgICAgICAgICAgIOivt+axguWksei0peeahOmUmeivr++8jOWmguaenOivt+axguaIkOWKn++8jOWImeS4uuepuuOAgmh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvNzczMFxuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICAgIGRhdGEgICAgICAgICAgICDov5Tlm57nmoTmlbDmja5cbiAqL1xuXG5cbmZ1bmN0aW9uIG11bHRpcGFydEFib3J0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIHJlcVBhcmFtcyA9IHt9O1xuICByZXFQYXJhbXNbJ3VwbG9hZElkJ10gPSBwYXJhbXNbJ1VwbG9hZElkJ107XG4gIHN1Ym1pdFJlcXVlc3QuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAnbmFtZS9jb3M6QWJvcnRNdWx0aXBhcnRVcGxvYWQnLFxuICAgIG1ldGhvZDogJ0RFTEVURScsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgaGVhZGVyczogcGFyYW1zLkhlYWRlcnMsXG4gICAgcXM6IHJlcVBhcmFtc1xuICB9LCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgaWYgKGVycikgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgY2FsbGJhY2sobnVsbCwge1xuICAgICAgc3RhdHVzQ29kZTogZGF0YS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogZGF0YS5oZWFkZXJzXG4gICAgfSk7XG4gIH0pO1xufVxuLyoqXG4gKiDmipvlvIPliIblnZfkuIrkvKBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLlVwbG9hZElkICAgIOagh+ekuuacrOasoeWIhuWdl+S4iuS8oOeahElE77yM5b+F6aG7XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICAgIGVyciAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgICBkYXRhICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiByZXF1ZXN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBtZXRob2Q6IHBhcmFtcy5NZXRob2QsXG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgYWN0aW9uOiBwYXJhbXMuQWN0aW9uLFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzLFxuICAgIHFzOiBwYXJhbXMuUXVlcnksXG4gICAgYm9keTogcGFyYW1zLkJvZHksXG4gICAgVXJsOiBwYXJhbXMuVXJsLFxuICAgIHJhd0JvZHk6IHBhcmFtcy5SYXdCb2R5LFxuICAgIERhdGFUeXBlOiBwYXJhbXMuRGF0YVR5cGVcbiAgfSwgZnVuY3Rpb24gKGVyciwgZGF0YSkge1xuICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayhlcnIpO1xuXG4gICAgaWYgKGRhdGEgJiYgZGF0YS5ib2R5KSB7XG4gICAgICBkYXRhLkJvZHkgPSBkYXRhLmJvZHk7XG4gICAgICBkZWxldGUgZGF0YS5ib2R5O1xuICAgIH1cblxuICAgIGNhbGxiYWNrKGVyciwgZGF0YSk7XG4gIH0pO1xufVxuLyoqXG4gKiDov73liqDkuIrkvKBcbiAqIEBwYXJhbSAge09iamVjdH0gIHBhcmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg5Y+C5pWw5a+56LGh77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkJ1Y2tldCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ1Y2tldOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5SZWdpb24gICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlnLDln5/lkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuS2V5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN05ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7RmlsZSB8fCBCbG9iIHx8IFN0cmluZ30gIHBhcmFtcy5Cb2R5ICAgICAgICAgICAgICAgIOS4iuS8oOaWh+S7tuWvueixoeaIluWtl+espuS4slxuICogICAgIEBwYXJhbSAge051bWJlcn0gIHBhcmFtcy5Qb3NpdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICDov73liqDmk43kvZznmoTotbflp4vngrnvvIzljZXkvY3kuLrlrZfoioLvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ2FjaGVDb250cm9sICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE57yT5a2Y562W55Wl77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudERpc3Bvc2l0aW9uICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE5paH5Lu25ZCN56ew77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudEVuY29kaW5nICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qE57yW56CB5qC85byP77yM5bCG5L2c5Li6IE9iamVjdCDlhYPmlbDmja7kv53lrZjvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudExlbmd0aCAgICAgICAgICAgICAgICAgICAgICAgUkZDIDI2MTYg5Lit5a6a5LmJ55qEIEhUVFAg6K+35rGC5YaF5a656ZW/5bqm77yI5a2X6IqC77yJ77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkNvbnRlbnRUeXBlICAgICAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOWGheWuueexu+Wei++8iE1JTUXvvInvvIzlsIbkvZzkuLogT2JqZWN0IOWFg+aVsOaNruS/neWtmO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FeHBlY3QgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlvZPkvb/nlKggRXhwZWN0OiAxMDAtY29udGludWUg5pe277yM5Zyo5pS25Yiw5pyN5Yqh56uv56Gu6K6k5ZCO77yM5omN5Lya5Y+R6YCB6K+35rGC5YaF5a6577yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkV4cGlyZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJGQyAyNjE2IOS4reWumuS5ieeahOi/h+acn+aXtumXtO+8jOWwhuS9nOS4uiBPYmplY3Qg5YWD5pWw5o2u5L+d5a2Y77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkFDTCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOWFgeiuuOeUqOaIt+iHquWumuS5ieaWh+S7tuadg+mZkO+8jOacieaViOWAvO+8mnByaXZhdGUgfCBwdWJsaWMtcmVhZO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudFJlYWQgICAgICAgICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXor7vlj5blr7nosaHnmoTmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuR3JhbnRSZWFkQWNwICAgICAgICAgICAgICAgICAgICAgICAg6LWL5LqI6KKr5o6I5p2D6ICF6K+75Y+W5a+56LGh55qE6K6/6Zeu5o6n5Yi25YiX6KGo77yIQUNM77yJ55qE5p2D6ZmQ77yM5qC85byP77yaaWQ9XCJbT3duZXJVaW5dXCLvvIzlj6/kvb/nlKjljYrop5LpgJflj7fvvIgs77yJ5YiG6ZqU5aSa57uE6KKr5o6I5p2D6ICF77yM6Z2e5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLkdyYW50V3JpdGVBY3AgICAgICAgICAgICAgICAgICAgICAgIOi1i+S6iOiiq+aOiOadg+iAheWGmeWFpeWvueixoeeahOiuv+mXruaOp+WItuWIl+ihqO+8iEFDTO+8ieeahOadg+mZkO+8jOagvOW8j++8mmlkPVwiW093bmVyVWluXVwi77yM5Y+v5L2/55So5Y2K6KeS6YCX5Y+377yILO+8ieWIhumalOWkmue7hOiiq+aOiOadg+iAhe+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5HcmFudEZ1bGxDb250cm9sICAgICAgICAgICAgICAgICAgICDotYvkuojooqvmjojmnYPogIXmk43kvZzlr7nosaHnmoTmiYDmnInmnYPpmZDvvIzmoLzlvI/vvJppZD1cIltPd25lclVpbl1cIu+8jOWPr+S9v+eUqOWNiuinkumAl+WPt++8iCzvvInliIbpmpTlpJrnu4TooqvmjojmnYPogIXvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuU3RvcmFnZUNsYXNzICAgICAgICAgICAgICAgICAgICAgICAg6K6+572u5a+56LGh55qE5a2Y5YKo57qn5Yir77yM5p6a5Li+5YC877yaU1RBTkRBUkTjgIFTVEFOREFSRF9JQeOAgUFSQ0hJVkXvvIzpu5jorqTlgLzvvJpTVEFOREFSRO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy54LWNvcy1tZXRhLSogICAgICAgICAgICAgICAgICAgICAgICDlhYHorrjnlKjmiLfoh6rlrprkuYnnmoTlpLTpg6jkv6Hmga/vvIzlsIbkvZzkuLrlr7nosaHnmoTlhYPmlbDmja7kv53lrZjjgILlpKflsI/pmZDliLYyS0LvvIzpnZ7lv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuQ29udGVudFNoYTEgICAgICAgICAgICAgICAgICAgICAgICAgUkZDIDMxNzQg5Lit5a6a5LmJ55qEIDE2MC1iaXQg5YaF5a65IFNIQS0xIOeul+azleagoemqjO+8jOmdnuW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5TZXJ2ZXJTaWRlRW5jcnlwdGlvbiAgICAgICAgICAgICAgICDmlK/mjIHmjInnhafmjIflrprnmoTliqDlr4bnrpfms5Xov5vooYzmnI3liqHnq6/mlbDmja7liqDlr4bvvIzmoLzlvI8geC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbjogXCJBRVMyNTZcIu+8jOmdnuW/hemhu1xuICogQHBhcmFtICB7RnVuY3Rpb259ICBjYWxsYmFjayAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDlm57osIPlh73mlbDvvIzlv4XpobtcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgICBlcnIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg6K+35rGC5aSx6LSl55qE6ZSZ6K+v77yM5aaC5p6c6K+35rGC5oiQ5Yqf77yM5YiZ5Li656m644CCaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi83NzMwXG4gKiAgICAgQHJldHVybiAge09iamVjdH0gICAgZGF0YSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOi/lOWbnueahOaVsOaNrlxuICovXG5cblxuZnVuY3Rpb24gYXBwZW5kT2JqZWN0KHBhcmFtcywgY2FsbGJhY2spIHtcbiAgLy8g54m55q6K5aSE55CGIENhY2hlLUNvbnRyb2zjgIFDb250ZW50LVR5cGXvvIzpgb/lhY3ku6PnkIbmm7TmlLnov5nkuKTkuKrlrZfmrrXlr7zoh7TlhpnlhaXliLAgT2JqZWN0IOWxnuaAp+mHjFxuICB2YXIgaGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzO1xuICBpZiAoIWhlYWRlcnNbJ0NhY2hlLUNvbnRyb2wnXSAmJiAhaGVhZGVyc1snY2FjaGUtY29udHJvbCddKSBoZWFkZXJzWydDYWNoZS1Db250cm9sJ10gPSAnJztcbiAgaWYgKCFoZWFkZXJzWydDb250ZW50LVR5cGUnXSAmJiAhaGVhZGVyc1snY29udGVudC10eXBlJ10pIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gcGFyYW1zLkJvZHkgJiYgcGFyYW1zLkJvZHkudHlwZSB8fCAnJztcbiAgc3VibWl0UmVxdWVzdC5jYWxsKHRoaXMsIHtcbiAgICBBY3Rpb246ICduYW1lL2NvczpBcHBlbmRPYmplY3QnLFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24sXG4gICAgYWN0aW9uOiAnYXBwZW5kJyxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgYm9keTogcGFyYW1zLkJvZHksXG4gICAgcXM6IHtcbiAgICAgIHBvc2l0aW9uOiBwYXJhbXMuUG9zaXRpb25cbiAgICB9LFxuICAgIGhlYWRlcnM6IHBhcmFtcy5IZWFkZXJzXG4gIH0sIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICBpZiAoZXJyKSByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICBjYWxsYmFjayhudWxsLCBkYXRhKTtcbiAgfSk7XG59XG4vKipcbiAqIOiOt+WPluetvuWQjVxuICogQHBhcmFtICB7T2JqZWN0fSAgcGFyYW1zICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NZXRob2QgIOivt+axguaWueazle+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5LZXkgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5FeHBpcmVzIOWQjei2heaXtuaXtumXtO+8jOWNleS9jeenku+8jOWPr+mAiVxuICogQHJldHVybiAge1N0cmluZ30gIGRhdGEgICAgICAgICAgICAgIOi/lOWbnuetvuWQjeWtl+espuS4slxuICovXG5cblxuZnVuY3Rpb24gZ2V0QXV0aChwYXJhbXMpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICByZXR1cm4gdXRpbC5nZXRBdXRoKHtcbiAgICBTZWNyZXRJZDogcGFyYW1zLlNlY3JldElkIHx8IHRoaXMub3B0aW9ucy5TZWNyZXRJZCB8fCAnJyxcbiAgICBTZWNyZXRLZXk6IHBhcmFtcy5TZWNyZXRLZXkgfHwgdGhpcy5vcHRpb25zLlNlY3JldEtleSB8fCAnJyxcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIE1ldGhvZDogcGFyYW1zLk1ldGhvZCxcbiAgICBLZXk6IHBhcmFtcy5LZXksXG4gICAgUXVlcnk6IHBhcmFtcy5RdWVyeSxcbiAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBFeHBpcmVzOiBwYXJhbXMuRXhwaXJlcyxcbiAgICBVc2VSYXdLZXk6IHNlbGYub3B0aW9ucy5Vc2VSYXdLZXksXG4gICAgU3lzdGVtQ2xvY2tPZmZzZXQ6IHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldFxuICB9KTtcbn1cbi8qKlxuICog6I635Y+W5paH5Lu25LiL6L296ZO+5o6lXG4gKiBAcGFyYW0gIHtPYmplY3R9ICBwYXJhbXMgICAgICAgICAgICAgICAgIOWPguaVsOWvueixoe+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5CdWNrZXQgICAgICBCdWNrZXTlkI3np7DvvIzlv4XpobtcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuUmVnaW9uICAgICAg5Zyw5Z+f5ZCN56ew77yM5b+F6aG7XG4gKiAgICAgQHBhcmFtICB7U3RyaW5nfSAgcGFyYW1zLktleSAgICAgICAgIG9iamVjdOWQjeensO+8jOW/hemhu1xuICogICAgIEBwYXJhbSAge1N0cmluZ30gIHBhcmFtcy5NZXRob2QgICAgICDor7fmsYLnmoTmlrnms5XvvIzlj6/pgIlcbiAqICAgICBAcGFyYW0gIHtTdHJpbmd9ICBwYXJhbXMuRXhwaXJlcyAgICAg562+5ZCN6LaF5pe25pe26Ze077yM5Y2V5L2N56eS77yM5Y+v6YCJXG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gIGNhbGxiYWNrICAgICAgICAgICAgIOWbnuiwg+WHveaVsO+8jOW/hemhu1xuICogICAgIEByZXR1cm4gIHtPYmplY3R9ICAgIGVyciAgICAgICAgICAgICDor7fmsYLlpLHotKXnmoTplJnor6/vvIzlpoLmnpzor7fmsYLmiJDlip/vvIzliJnkuLrnqbrjgIJodHRwczovL2Nsb3VkLnRlbmNlbnQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3MzBcbiAqICAgICBAcmV0dXJuICB7T2JqZWN0fSAgICBkYXRhICAgICAgICAgICAg6L+U5Zue55qE5pWw5o2uXG4gKi9cblxuXG5mdW5jdGlvbiBnZXRPYmplY3RVcmwocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciB1c2VBY2NlbGVyYXRlID0gcGFyYW1zLlVzZUFjY2VsZXJhdGUgPT09IHVuZGVmaW5lZCA/IHNlbGYub3B0aW9ucy5Vc2VBY2NlbGVyYXRlIDogcGFyYW1zLlVzZUFjY2VsZXJhdGU7XG4gIHZhciB1cmwgPSBnZXRVcmwoe1xuICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgcHJvdG9jb2w6IHBhcmFtcy5Qcm90b2NvbCB8fCBzZWxmLm9wdGlvbnMuUHJvdG9jb2wsXG4gICAgZG9tYWluOiBwYXJhbXMuRG9tYWluIHx8IHNlbGYub3B0aW9ucy5Eb21haW4sXG4gICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIHJlZ2lvbjogdXNlQWNjZWxlcmF0ZSA/ICdhY2NlbGVyYXRlJyA6IHBhcmFtcy5SZWdpb24sXG4gICAgb2JqZWN0OiBwYXJhbXMuS2V5XG4gIH0pO1xuICB2YXIgcXVlcnlQYXJhbXNTdHIgPSAnJztcblxuICBpZiAocGFyYW1zLlF1ZXJ5KSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgKz0gdXRpbC5vYmoyc3RyKHBhcmFtcy5RdWVyeSk7XG4gIH1cblxuICBpZiAocGFyYW1zLlF1ZXJ5U3RyaW5nKSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgKz0gKHF1ZXJ5UGFyYW1zU3RyID8gJyYnIDogJycpICsgcGFyYW1zLlF1ZXJ5U3RyaW5nO1xuICB9XG5cbiAgdmFyIHN5bmNVcmwgPSB1cmw7XG5cbiAgaWYgKHBhcmFtcy5TaWduICE9PSB1bmRlZmluZWQgJiYgIXBhcmFtcy5TaWduKSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgJiYgKHN5bmNVcmwgKz0gJz8nICsgcXVlcnlQYXJhbXNTdHIpO1xuICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgIFVybDogc3luY1VybFxuICAgIH0pO1xuICAgIHJldHVybiBzeW5jVXJsO1xuICB9IC8vIOetvuWQjeWKoOS4iiBIb3N077yM6YG/5YWN6Leo5qG26K6/6ZeuXG5cblxuICB2YXIgU2lnbkhvc3QgPSBnZXRTaWduSG9zdC5jYWxsKHRoaXMsIHtcbiAgICBCdWNrZXQ6IHBhcmFtcy5CdWNrZXQsXG4gICAgUmVnaW9uOiBwYXJhbXMuUmVnaW9uLFxuICAgIFVzZUFjY2VsZXJhdGU6IHBhcmFtcy5Vc2VBY2NlbGVyYXRlLFxuICAgIFVybDogdXJsXG4gIH0pO1xuICB2YXIgQXV0aERhdGEgPSBnZXRBdXRob3JpemF0aW9uQXN5bmMuY2FsbCh0aGlzLCB7XG4gICAgQWN0aW9uOiAocGFyYW1zLk1ldGhvZCB8fCAnJykudG9VcHBlckNhc2UoKSA9PT0gJ1BVVCcgPyAnbmFtZS9jb3M6UHV0T2JqZWN0JyA6ICduYW1lL2NvczpHZXRPYmplY3QnLFxuICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCB8fCAnJyxcbiAgICBSZWdpb246IHBhcmFtcy5SZWdpb24gfHwgJycsXG4gICAgTWV0aG9kOiBwYXJhbXMuTWV0aG9kIHx8ICdnZXQnLFxuICAgIEtleTogcGFyYW1zLktleSxcbiAgICBFeHBpcmVzOiBwYXJhbXMuRXhwaXJlcyxcbiAgICBIZWFkZXJzOiBwYXJhbXMuSGVhZGVycyxcbiAgICBRdWVyeTogcGFyYW1zLlF1ZXJ5LFxuICAgIFNpZ25Ib3N0OiBTaWduSG9zdCxcbiAgICBGb3JjZVNpZ25Ib3N0OiBwYXJhbXMuRm9yY2VTaWduSG9zdCA9PT0gZmFsc2UgPyBmYWxzZSA6IHNlbGYub3B0aW9ucy5Gb3JjZVNpZ25Ib3N0IC8vIGdldE9iamVjdFVybOaUr+aMgeS8oOWPgkZvcmNlU2lnbkhvc3RcblxuICB9LCBmdW5jdGlvbiAoZXJyLCBBdXRoRGF0YSkge1xuICAgIGlmICghY2FsbGJhY2spIHJldHVybjtcblxuICAgIGlmIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICByZXR1cm47XG4gICAgfSAvLyDlhbzlrrnkuIfosaF1cmwgcVVybFBhcmFtTGlzdOmcgOimgeWGjWVuY29kZeS4gOasoVxuXG5cbiAgICB2YXIgcmVwbGFjZVVybFBhcmFtTGlzdCA9IGZ1bmN0aW9uIHJlcGxhY2VVcmxQYXJhbUxpc3QodXJsKSB7XG4gICAgICB2YXIgdXJsUGFyYW1zID0gdXJsLm1hdGNoKC9xLXVybC1wYXJhbS1saXN0Lio/KD89JikvZylbMF07XG4gICAgICB2YXIgZW5jb2RlZFBhcmFtcyA9ICdxLXVybC1wYXJhbS1saXN0PScgKyBlbmNvZGVVUklDb21wb25lbnQodXJsUGFyYW1zLnJlcGxhY2UoL3EtdXJsLXBhcmFtLWxpc3Q9LywgJycpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAodXJsUGFyYW1zLCAnZycpO1xuICAgICAgdmFyIHJlcGxhY2VkVXJsID0gdXJsLnJlcGxhY2UocmVnLCBlbmNvZGVkUGFyYW1zKTtcbiAgICAgIHJldHVybiByZXBsYWNlZFVybDtcbiAgICB9O1xuXG4gICAgdmFyIHNpZ25VcmwgPSB1cmw7XG4gICAgc2lnblVybCArPSAnPycgKyAoQXV0aERhdGEuQXV0aG9yaXphdGlvbi5pbmRleE9mKCdxLXNpZ25hdHVyZScpID4gLTEgPyByZXBsYWNlVXJsUGFyYW1MaXN0KEF1dGhEYXRhLkF1dGhvcml6YXRpb24pIDogJ3NpZ249JyArIGVuY29kZVVSSUNvbXBvbmVudChBdXRoRGF0YS5BdXRob3JpemF0aW9uKSk7XG4gICAgQXV0aERhdGEuU2VjdXJpdHlUb2tlbiAmJiAoc2lnblVybCArPSAnJngtY29zLXNlY3VyaXR5LXRva2VuPScgKyBBdXRoRGF0YS5TZWN1cml0eVRva2VuKTtcbiAgICBBdXRoRGF0YS5DbGllbnRJUCAmJiAoc2lnblVybCArPSAnJmNsaWVudElQPScgKyBBdXRoRGF0YS5DbGllbnRJUCk7XG4gICAgQXV0aERhdGEuQ2xpZW50VUEgJiYgKHNpZ25VcmwgKz0gJyZjbGllbnRVQT0nICsgQXV0aERhdGEuQ2xpZW50VUEpO1xuICAgIEF1dGhEYXRhLlRva2VuICYmIChzaWduVXJsICs9ICcmdG9rZW49JyArIEF1dGhEYXRhLlRva2VuKTtcbiAgICBxdWVyeVBhcmFtc1N0ciAmJiAoc2lnblVybCArPSAnJicgKyBxdWVyeVBhcmFtc1N0cik7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBjYWxsYmFjayhudWxsLCB7XG4gICAgICAgIFVybDogc2lnblVybFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGlmIChBdXRoRGF0YSkge1xuICAgIHN5bmNVcmwgKz0gJz8nICsgQXV0aERhdGEuQXV0aG9yaXphdGlvbiArIChBdXRoRGF0YS5TZWN1cml0eVRva2VuID8gJyZ4LWNvcy1zZWN1cml0eS10b2tlbj0nICsgQXV0aERhdGEuU2VjdXJpdHlUb2tlbiA6ICcnKTtcbiAgICBxdWVyeVBhcmFtc1N0ciAmJiAoc3luY1VybCArPSAnJicgKyBxdWVyeVBhcmFtc1N0cik7XG4gIH0gZWxzZSB7XG4gICAgcXVlcnlQYXJhbXNTdHIgJiYgKHN5bmNVcmwgKz0gJz8nICsgcXVlcnlQYXJhbXNTdHIpO1xuICB9XG5cbiAgcmV0dXJuIHN5bmNVcmw7XG59XG4vKipcbiAqIOengeacieaWueazlVxuICovXG5cblxuZnVuY3Rpb24gZGVjb2RlQWNsKEFjY2Vzc0NvbnRyb2xQb2xpY3kpIHtcbiAgdmFyIHJlc3VsdCA9IHtcbiAgICBHcmFudEZ1bGxDb250cm9sOiBbXSxcbiAgICBHcmFudFdyaXRlOiBbXSxcbiAgICBHcmFudFJlYWQ6IFtdLFxuICAgIEdyYW50UmVhZEFjcDogW10sXG4gICAgR3JhbnRXcml0ZUFjcDogW10sXG4gICAgQUNMOiAnJ1xuICB9O1xuICB2YXIgR3JhbnRNYXAgPSB7XG4gICAgJ0ZVTExfQ09OVFJPTCc6ICdHcmFudEZ1bGxDb250cm9sJyxcbiAgICAnV1JJVEUnOiAnR3JhbnRXcml0ZScsXG4gICAgJ1JFQUQnOiAnR3JhbnRSZWFkJyxcbiAgICAnUkVBRF9BQ1AnOiAnR3JhbnRSZWFkQWNwJyxcbiAgICAnV1JJVEVfQUNQJzogJ0dyYW50V3JpdGVBY3AnXG4gIH07XG4gIHZhciBBY2Nlc3NDb250cm9sTGlzdCA9IEFjY2Vzc0NvbnRyb2xQb2xpY3kgJiYgQWNjZXNzQ29udHJvbFBvbGljeS5BY2Nlc3NDb250cm9sTGlzdCB8fCB7fTtcbiAgdmFyIEdyYW50ID0gQWNjZXNzQ29udHJvbExpc3QuR3JhbnQ7XG5cbiAgaWYgKEdyYW50KSB7XG4gICAgR3JhbnQgPSB1dGlsLmlzQXJyYXkoR3JhbnQpID8gR3JhbnQgOiBbR3JhbnRdO1xuICB9XG5cbiAgdmFyIFB1YmxpY0FjbCA9IHtcbiAgICBSRUFEOiAwLFxuICAgIFdSSVRFOiAwLFxuICAgIEZVTExfQ09OVFJPTDogMFxuICB9O1xuICBHcmFudCAmJiBHcmFudC5sZW5ndGggJiYgdXRpbC5lYWNoKEdyYW50LCBmdW5jdGlvbiAoaXRlbSkge1xuICAgIGlmIChpdGVtLkdyYW50ZWUuSUQgPT09ICdxY3M6OmNhbTo6YW55b25lOmFueW9uZScgfHwgaXRlbS5HcmFudGVlLlVSSSA9PT0gJ2h0dHA6Ly9jYW0ucWNsb3VkLmNvbS9ncm91cHMvZ2xvYmFsL0FsbFVzZXJzJykge1xuICAgICAgUHVibGljQWNsW2l0ZW0uUGVybWlzc2lvbl0gPSAxO1xuICAgIH0gZWxzZSBpZiAoaXRlbS5HcmFudGVlLklEICE9PSBBY2Nlc3NDb250cm9sUG9saWN5Lk93bmVyLklEKSB7XG4gICAgICByZXN1bHRbR3JhbnRNYXBbaXRlbS5QZXJtaXNzaW9uXV0ucHVzaCgnaWQ9XCInICsgaXRlbS5HcmFudGVlLklEICsgJ1wiJyk7XG4gICAgfVxuICB9KTtcblxuICBpZiAoUHVibGljQWNsLkZVTExfQ09OVFJPTCB8fCBQdWJsaWNBY2wuV1JJVEUgJiYgUHVibGljQWNsLlJFQUQpIHtcbiAgICByZXN1bHQuQUNMID0gJ3B1YmxpYy1yZWFkLXdyaXRlJztcbiAgfSBlbHNlIGlmIChQdWJsaWNBY2wuUkVBRCkge1xuICAgIHJlc3VsdC5BQ0wgPSAncHVibGljLXJlYWQnO1xuICB9IGVsc2Uge1xuICAgIHJlc3VsdC5BQ0wgPSAncHJpdmF0ZSc7XG4gIH1cblxuICB1dGlsLmVhY2goR3JhbnRNYXAsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgcmVzdWx0W2l0ZW1dID0gdW5pcUdyYW50KHJlc3VsdFtpdGVtXS5qb2luKCcsJykpO1xuICB9KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn0gLy8gR3JhbnQg5Y676YeNXG5cblxuZnVuY3Rpb24gdW5pcUdyYW50KHN0cikge1xuICB2YXIgYXJyID0gc3RyLnNwbGl0KCcsJyk7XG4gIHZhciBleGlzdCA9IHt9O1xuICB2YXIgaSwgaXRlbTtcblxuICBmb3IgKGkgPSAwOyBpIDwgYXJyLmxlbmd0aDspIHtcbiAgICBpdGVtID0gYXJyW2ldLnRyaW0oKTtcblxuICAgIGlmIChleGlzdFtpdGVtXSkge1xuICAgICAgYXJyLnNwbGljZShpLCAxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXhpc3RbaXRlbV0gPSB0cnVlO1xuICAgICAgYXJyW2ldID0gaXRlbTtcbiAgICAgIGkrKztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYXJyLmpvaW4oJywnKTtcbn0gLy8g55Sf5oiQ5pON5L2cIHVybFxuXG5cbmZ1bmN0aW9uIGdldFVybChwYXJhbXMpIHtcbiAgdmFyIHJlZ2lvbiA9IHBhcmFtcy5yZWdpb24gfHwgJyc7XG4gIHZhciBsb25nQnVja2V0ID0gcGFyYW1zLmJ1Y2tldCB8fCAnJztcbiAgdmFyIHNob3J0QnVja2V0ID0gbG9uZ0J1Y2tldC5zdWJzdHIoMCwgbG9uZ0J1Y2tldC5sYXN0SW5kZXhPZignLScpKTtcbiAgdmFyIGFwcElkID0gbG9uZ0J1Y2tldC5zdWJzdHIobG9uZ0J1Y2tldC5sYXN0SW5kZXhPZignLScpICsgMSk7XG4gIHZhciBkb21haW4gPSBwYXJhbXMuZG9tYWluO1xuICB2YXIgb2JqZWN0ID0gcGFyYW1zLm9iamVjdDtcblxuICBpZiAodHlwZW9mIGRvbWFpbiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGRvbWFpbiA9IGRvbWFpbih7XG4gICAgICBCdWNrZXQ6IGxvbmdCdWNrZXQsXG4gICAgICBSZWdpb246IHJlZ2lvblxuICAgIH0pO1xuICB9IC8vIOWFvOWuueS4jeW4puWGkuWPt+eahGh0dHDjgIFodHRwc1xuXG5cbiAgaWYgKFsnaHR0cCcsICdodHRwcyddLmluY2x1ZGVzKHBhcmFtcy5wcm90b2NvbCkpIHtcbiAgICBwYXJhbXMucHJvdG9jb2wgPSBwYXJhbXMucHJvdG9jb2wgKyAnOic7XG4gIH1cblxuICB2YXIgcHJvdG9jb2wgPSBwYXJhbXMucHJvdG9jb2wgfHwgKHV0aWwuaXNCcm93c2VyICYmIGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cDonID8gJ2h0dHA6JyA6ICdodHRwczonKTtcblxuICBpZiAoIWRvbWFpbikge1xuICAgIGlmIChbJ2NuLXNvdXRoJywgJ2NuLXNvdXRoLTInLCAnY24tbm9ydGgnLCAnY24tZWFzdCcsICdjbi1zb3V0aHdlc3QnLCAnc2cnXS5pbmRleE9mKHJlZ2lvbikgPiAtMSkge1xuICAgICAgZG9tYWluID0gJ3tSZWdpb259Lm15cWNsb3VkLmNvbSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvbWFpbiA9ICdjb3Mue1JlZ2lvbn0ubXlxY2xvdWQuY29tJztcbiAgICB9XG5cbiAgICBpZiAoIXBhcmFtcy5Gb3JjZVBhdGhTdHlsZSkge1xuICAgICAgZG9tYWluID0gJ3tCdWNrZXR9LicgKyBkb21haW47XG4gICAgfVxuICB9XG5cbiAgZG9tYWluID0gZG9tYWluLnJlcGxhY2UoL1xce1xce0FwcElkXFx9XFx9L2lnLCBhcHBJZCkucmVwbGFjZSgvXFx7XFx7QnVja2V0XFx9XFx9L2lnLCBzaG9ydEJ1Y2tldCkucmVwbGFjZSgvXFx7XFx7UmVnaW9uXFx9XFx9L2lnLCByZWdpb24pLnJlcGxhY2UoL1xce1xcey4qP1xcfVxcfS9pZywgJycpO1xuICBkb21haW4gPSBkb21haW4ucmVwbGFjZSgvXFx7QXBwSWRcXH0vaWcsIGFwcElkKS5yZXBsYWNlKC9cXHtCdWNrZXROYW1lXFx9L2lnLCBzaG9ydEJ1Y2tldCkucmVwbGFjZSgvXFx7QnVja2V0XFx9L2lnLCBsb25nQnVja2V0KS5yZXBsYWNlKC9cXHtSZWdpb25cXH0vaWcsIHJlZ2lvbikucmVwbGFjZSgvXFx7Lio/XFx9L2lnLCAnJyk7XG5cbiAgaWYgKCEvXlthLXpBLVpdKzpcXC9cXC8vLnRlc3QoZG9tYWluKSkge1xuICAgIGRvbWFpbiA9IHByb3RvY29sICsgJy8vJyArIGRvbWFpbjtcbiAgfSAvLyDljrvmjonln5/lkI3mnIDlkI7nmoTmlpzmnYZcblxuXG4gIGlmIChkb21haW4uc2xpY2UoLTEpID09PSAnLycpIHtcbiAgICBkb21haW4gPSBkb21haW4uc2xpY2UoMCwgLTEpO1xuICB9XG5cbiAgdmFyIHVybCA9IGRvbWFpbjtcblxuICBpZiAocGFyYW1zLkZvcmNlUGF0aFN0eWxlKSB7XG4gICAgdXJsICs9ICcvJyArIGxvbmdCdWNrZXQ7XG4gIH1cblxuICB1cmwgKz0gJy8nO1xuXG4gIGlmIChvYmplY3QpIHtcbiAgICB1cmwgKz0gdXRpbC5jYW1TYWZlVXJsRW5jb2RlKG9iamVjdCkucmVwbGFjZSgvJTJGL2csICcvJyk7XG4gIH1cblxuICBpZiAocGFyYW1zLmlzTG9jYXRpb24pIHtcbiAgICB1cmwgPSB1cmwucmVwbGFjZSgvXmh0dHBzPzpcXC9cXC8vLCAnJyk7XG4gIH1cblxuICByZXR1cm4gdXJsO1xufVxuXG52YXIgZ2V0U2lnbkhvc3QgPSBmdW5jdGlvbiBnZXRTaWduSG9zdChvcHQpIHtcbiAgaWYgKCFvcHQuQnVja2V0IHx8ICFvcHQuUmVnaW9uKSByZXR1cm4gJyc7XG4gIHZhciB1c2VBY2NlbGVyYXRlID0gb3B0LlVzZUFjY2VsZXJhdGUgPT09IHVuZGVmaW5lZCA/IHRoaXMub3B0aW9ucy5Vc2VBY2NlbGVyYXRlIDogb3B0LlVzZUFjY2VsZXJhdGU7XG4gIHZhciB1cmwgPSBvcHQuVXJsIHx8IGdldFVybCh7XG4gICAgRm9yY2VQYXRoU3R5bGU6IHRoaXMub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSxcbiAgICBwcm90b2NvbDogdGhpcy5vcHRpb25zLlByb3RvY29sLFxuICAgIGRvbWFpbjogdGhpcy5vcHRpb25zLkRvbWFpbixcbiAgICBidWNrZXQ6IG9wdC5CdWNrZXQsXG4gICAgcmVnaW9uOiB1c2VBY2NlbGVyYXRlID8gJ2FjY2VsZXJhdGUnIDogb3B0LlJlZ2lvblxuICB9KTtcbiAgdmFyIHVybEhvc3QgPSB1cmwucmVwbGFjZSgvXmh0dHBzPzpcXC9cXC8oW14vXSspKFxcLy4qKT8kLywgJyQxJyk7XG4gIHZhciBzdGFuZGFyZEhvc3RSZWcgPSBuZXcgUmVnRXhwKCdeKFthLXpcXFxcZC1dKy1cXFxcZCtcXFxcLik/KGNvc3xjb3N2NnxjaXxwaWMpXFxcXC4oW2EtelxcXFxkLV0rKVxcXFwubXlxY2xvdWRcXFxcLmNvbSQnKTtcbiAgaWYgKHN0YW5kYXJkSG9zdFJlZy50ZXN0KHVybEhvc3QpKSByZXR1cm4gdXJsSG9zdDtcbiAgcmV0dXJuICcnO1xufTsgLy8g5byC5q2l6I635Y+W562+5ZCNXG5cblxuZnVuY3Rpb24gZ2V0QXV0aG9yaXphdGlvbkFzeW5jKHBhcmFtcywgY2FsbGJhY2spIHtcbiAgdmFyIGhlYWRlcnMgPSB1dGlsLmNsb25lKHBhcmFtcy5IZWFkZXJzKTtcbiAgdmFyIGhlYWRlckhvc3QgPSAnJztcbiAgdXRpbC5lYWNoKGhlYWRlcnMsIGZ1bmN0aW9uICh2LCBrKSB7XG4gICAgKHYgPT09ICcnIHx8IFsnY29udGVudC10eXBlJywgJ2NhY2hlLWNvbnRyb2wnLCAnZXhwaXJlcyddLmluZGV4T2Yoay50b0xvd2VyQ2FzZSgpKSA+IC0xKSAmJiBkZWxldGUgaGVhZGVyc1trXTtcbiAgICBpZiAoay50b0xvd2VyQ2FzZSgpID09PSAnaG9zdCcpIGhlYWRlckhvc3QgPSB2O1xuICB9KTsgLy8gRm9yY2VTaWduSG9zdOaYjuehruS8oOWFpWZhbHNl5omN5LiN5Yqg5YWlaG9zdOetvuWQjVxuXG4gIHZhciBmb3JjZVNpZ25Ib3N0ID0gcGFyYW1zLkZvcmNlU2lnbkhvc3QgPT09IGZhbHNlID8gZmFsc2UgOiB0cnVlOyAvLyBIb3N0IOWKoOWFpeetvuWQjeiuoeeul1xuXG4gIGlmICghaGVhZGVySG9zdCAmJiBwYXJhbXMuU2lnbkhvc3QgJiYgZm9yY2VTaWduSG9zdCkgaGVhZGVycy5Ib3N0ID0gcGFyYW1zLlNpZ25Ib3N0OyAvLyDojrflj5blh63or4HnmoTlm57osIPvvIzpgb/lhY3nlKjmiLcgY2FsbGJhY2sg5aSa5qyhXG5cbiAgdmFyIGNiRG9uZSA9IGZhbHNlO1xuXG4gIHZhciBjYiA9IGZ1bmN0aW9uIGNiKGVyciwgQXV0aERhdGEpIHtcbiAgICBpZiAoY2JEb25lKSByZXR1cm47XG4gICAgY2JEb25lID0gdHJ1ZTtcblxuICAgIGlmIChBdXRoRGF0YSAmJiBBdXRoRGF0YS5YQ29zU2VjdXJpdHlUb2tlbiAmJiAhQXV0aERhdGEuU2VjdXJpdHlUb2tlbikge1xuICAgICAgQXV0aERhdGEgPSB1dGlsLmNsb25lKEF1dGhEYXRhKTtcbiAgICAgIEF1dGhEYXRhLlNlY3VyaXR5VG9rZW4gPSBBdXRoRGF0YS5YQ29zU2VjdXJpdHlUb2tlbjtcbiAgICAgIGRlbGV0ZSBBdXRoRGF0YS5YQ29zU2VjdXJpdHlUb2tlbjtcbiAgICB9XG5cbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlcnIsIEF1dGhEYXRhKTtcbiAgfTtcblxuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBCdWNrZXQgPSBwYXJhbXMuQnVja2V0IHx8ICcnO1xuICB2YXIgUmVnaW9uID0gcGFyYW1zLlJlZ2lvbiB8fCAnJzsgLy8gUGF0aE5hbWVcblxuICB2YXIgS2V5TmFtZSA9IHBhcmFtcy5LZXkgfHwgJyc7XG5cbiAgaWYgKHNlbGYub3B0aW9ucy5Gb3JjZVBhdGhTdHlsZSAmJiBCdWNrZXQpIHtcbiAgICBLZXlOYW1lID0gQnVja2V0ICsgJy8nICsgS2V5TmFtZTtcbiAgfVxuXG4gIHZhciBQYXRobmFtZSA9ICcvJyArIEtleU5hbWU7IC8vIEFjdGlvbuOAgVJlc291cmNlS2V5XG5cbiAgdmFyIFN0c0RhdGEgPSB7fTtcbiAgdmFyIFNjb3BlID0gcGFyYW1zLlNjb3BlO1xuXG4gIGlmICghU2NvcGUpIHtcbiAgICB2YXIgQWN0aW9uID0gcGFyYW1zLkFjdGlvbiB8fCAnJztcbiAgICB2YXIgUmVzb3VyY2VLZXkgPSBwYXJhbXMuUmVzb3VyY2VLZXkgfHwgcGFyYW1zLktleSB8fCAnJztcbiAgICBTY29wZSA9IHBhcmFtcy5TY29wZSB8fCBbe1xuICAgICAgYWN0aW9uOiBBY3Rpb24sXG4gICAgICBidWNrZXQ6IEJ1Y2tldCxcbiAgICAgIHJlZ2lvbjogUmVnaW9uLFxuICAgICAgcHJlZml4OiBSZXNvdXJjZUtleVxuICAgIH1dO1xuICB9XG5cbiAgdmFyIFNjb3BlS2V5ID0gdXRpbC5tZDUoSlNPTi5zdHJpbmdpZnkoU2NvcGUpKTsgLy8gU1RTXG5cbiAgc2VsZi5fU3RzQ2FjaGUgPSBzZWxmLl9TdHNDYWNoZSB8fCBbXTtcblxuICAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBpLCBBdXRoRGF0YTtcblxuICAgIGZvciAoaSA9IHNlbGYuX1N0c0NhY2hlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBBdXRoRGF0YSA9IHNlbGYuX1N0c0NhY2hlW2ldO1xuICAgICAgdmFyIGNvbXBhcmVUaW1lID0gTWF0aC5yb3VuZCh1dGlsLmdldFNrZXdUaW1lKHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldCkgLyAxMDAwKSArIDMwO1xuXG4gICAgICBpZiAoQXV0aERhdGEuU3RhcnRUaW1lICYmIGNvbXBhcmVUaW1lIDwgQXV0aERhdGEuU3RhcnRUaW1lIHx8IGNvbXBhcmVUaW1lID49IEF1dGhEYXRhLkV4cGlyZWRUaW1lKSB7XG4gICAgICAgIHNlbGYuX1N0c0NhY2hlLnNwbGljZShpLCAxKTtcblxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFBdXRoRGF0YS5TY29wZUxpbWl0IHx8IEF1dGhEYXRhLlNjb3BlTGltaXQgJiYgQXV0aERhdGEuU2NvcGVLZXkgPT09IFNjb3BlS2V5KSB7XG4gICAgICAgIFN0c0RhdGEgPSBBdXRoRGF0YTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KSgpO1xuXG4gIHZhciBjYWxjQXV0aEJ5VG1wS2V5ID0gZnVuY3Rpb24gY2FsY0F1dGhCeVRtcEtleSgpIHtcbiAgICB2YXIgS2V5VGltZSA9ICcnO1xuICAgIGlmIChTdHNEYXRhLlN0YXJ0VGltZSAmJiBwYXJhbXMuRXhwaXJlcykgS2V5VGltZSA9IFN0c0RhdGEuU3RhcnRUaW1lICsgJzsnICsgKFN0c0RhdGEuU3RhcnRUaW1lICsgcGFyYW1zLkV4cGlyZXMgKiAxKTtlbHNlIGlmIChTdHNEYXRhLlN0YXJ0VGltZSAmJiBTdHNEYXRhLkV4cGlyZWRUaW1lKSBLZXlUaW1lID0gU3RzRGF0YS5TdGFydFRpbWUgKyAnOycgKyBTdHNEYXRhLkV4cGlyZWRUaW1lO1xuICAgIHZhciBBdXRob3JpemF0aW9uID0gdXRpbC5nZXRBdXRoKHtcbiAgICAgIFNlY3JldElkOiBTdHNEYXRhLlRtcFNlY3JldElkLFxuICAgICAgU2VjcmV0S2V5OiBTdHNEYXRhLlRtcFNlY3JldEtleSxcbiAgICAgIE1ldGhvZDogcGFyYW1zLk1ldGhvZCxcbiAgICAgIFBhdGhuYW1lOiBQYXRobmFtZSxcbiAgICAgIFF1ZXJ5OiBwYXJhbXMuUXVlcnksXG4gICAgICBIZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgRXhwaXJlczogcGFyYW1zLkV4cGlyZXMsXG4gICAgICBVc2VSYXdLZXk6IHNlbGYub3B0aW9ucy5Vc2VSYXdLZXksXG4gICAgICBTeXN0ZW1DbG9ja09mZnNldDogc2VsZi5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0LFxuICAgICAgS2V5VGltZTogS2V5VGltZSxcbiAgICAgIEZvcmNlU2lnbkhvc3Q6IGZvcmNlU2lnbkhvc3RcbiAgICB9KTtcbiAgICB2YXIgQXV0aERhdGEgPSB7XG4gICAgICBBdXRob3JpemF0aW9uOiBBdXRob3JpemF0aW9uLFxuICAgICAgU2VjdXJpdHlUb2tlbjogU3RzRGF0YS5TZWN1cml0eVRva2VuIHx8IFN0c0RhdGEuWENvc1NlY3VyaXR5VG9rZW4gfHwgJycsXG4gICAgICBUb2tlbjogU3RzRGF0YS5Ub2tlbiB8fCAnJyxcbiAgICAgIENsaWVudElQOiBTdHNEYXRhLkNsaWVudElQIHx8ICcnLFxuICAgICAgQ2xpZW50VUE6IFN0c0RhdGEuQ2xpZW50VUEgfHwgJydcbiAgICB9O1xuICAgIGNiKG51bGwsIEF1dGhEYXRhKTtcbiAgfTtcblxuICB2YXIgY2hlY2tBdXRoRXJyb3IgPSBmdW5jdGlvbiBjaGVja0F1dGhFcnJvcihBdXRoRGF0YSkge1xuICAgIGlmIChBdXRoRGF0YS5BdXRob3JpemF0aW9uKSB7XG4gICAgICAvLyDmo4Dmn6Xnrb7lkI3moLzlvI9cbiAgICAgIHZhciBmb3JtYXRBbGxvdyA9IGZhbHNlO1xuICAgICAgdmFyIGF1dGggPSBBdXRoRGF0YS5BdXRob3JpemF0aW9uO1xuXG4gICAgICBpZiAoYXV0aCkge1xuICAgICAgICBpZiAoYXV0aC5pbmRleE9mKCcgJykgPiAtMSkge1xuICAgICAgICAgIGZvcm1hdEFsbG93ID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoYXV0aC5pbmRleE9mKCdxLXNpZ24tYWxnb3JpdGhtPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdxLWFrPScpID4gLTEgJiYgYXV0aC5pbmRleE9mKCdxLXNpZ24tdGltZT0nKSA+IC0xICYmIGF1dGguaW5kZXhPZigncS1rZXktdGltZT0nKSA+IC0xICYmIGF1dGguaW5kZXhPZigncS11cmwtcGFyYW0tbGlzdD0nKSA+IC0xKSB7XG4gICAgICAgICAgZm9ybWF0QWxsb3cgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhdXRoID0gYXRvYihhdXRoKTtcblxuICAgICAgICAgICAgaWYgKGF1dGguaW5kZXhPZignYT0nKSA+IC0xICYmIGF1dGguaW5kZXhPZignaz0nKSA+IC0xICYmIGF1dGguaW5kZXhPZigndD0nKSA+IC0xICYmIGF1dGguaW5kZXhPZigncj0nKSA+IC0xICYmIGF1dGguaW5kZXhPZignYj0nKSA+IC0xKSB7XG4gICAgICAgICAgICAgIGZvcm1hdEFsbG93ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZm9ybWF0QWxsb3cpIHJldHVybiB1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0QXV0aG9yaXphdGlvbiBjYWxsYmFjayBwYXJhbXMgZm9ybWF0IGVycm9yJykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoIUF1dGhEYXRhLlRtcFNlY3JldElkKSByZXR1cm4gdXRpbC5lcnJvcihuZXcgRXJyb3IoJ2dldEF1dGhvcml6YXRpb24gY2FsbGJhY2sgcGFyYW1zIG1pc3NpbmcgXCJUbXBTZWNyZXRJZFwiJykpO1xuICAgICAgaWYgKCFBdXRoRGF0YS5UbXBTZWNyZXRLZXkpIHJldHVybiB1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0QXV0aG9yaXphdGlvbiBjYWxsYmFjayBwYXJhbXMgbWlzc2luZyBcIlRtcFNlY3JldEtleVwiJykpO1xuICAgICAgaWYgKCFBdXRoRGF0YS5TZWN1cml0eVRva2VuICYmICFBdXRoRGF0YS5YQ29zU2VjdXJpdHlUb2tlbikgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBtaXNzaW5nIFwiU2VjdXJpdHlUb2tlblwiJykpO1xuICAgICAgaWYgKCFBdXRoRGF0YS5FeHBpcmVkVGltZSkgcmV0dXJuIHV0aWwuZXJyb3IobmV3IEVycm9yKCdnZXRBdXRob3JpemF0aW9uIGNhbGxiYWNrIHBhcmFtcyBtaXNzaW5nIFwiRXhwaXJlZFRpbWVcIicpKTtcbiAgICAgIGlmIChBdXRoRGF0YS5FeHBpcmVkVGltZSAmJiBBdXRoRGF0YS5FeHBpcmVkVGltZS50b1N0cmluZygpLmxlbmd0aCAhPT0gMTApIHJldHVybiB1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0QXV0aG9yaXphdGlvbiBjYWxsYmFjayBwYXJhbXMgXCJFeHBpcmVkVGltZVwiIHNob3VsZCBiZSAxMCBkaWdpdHMnKSk7XG4gICAgICBpZiAoQXV0aERhdGEuU3RhcnRUaW1lICYmIEF1dGhEYXRhLlN0YXJ0VGltZS50b1N0cmluZygpLmxlbmd0aCAhPT0gMTApIHJldHVybiB1dGlsLmVycm9yKG5ldyBFcnJvcignZ2V0QXV0aG9yaXphdGlvbiBjYWxsYmFjayBwYXJhbXMgXCJTdGFydFRpbWVcIiBzaG91bGQgYmUgMTAgU3RhcnRUaW1lJykpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfTsgLy8g5YWI5Yik5pat5piv5ZCm5pyJ5Li05pe25a+G6ZKlXG5cblxuICBpZiAoU3RzRGF0YS5FeHBpcmVkVGltZSAmJiBTdHNEYXRhLkV4cGlyZWRUaW1lIC0gdXRpbC5nZXRTa2V3VGltZShzZWxmLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQpIC8gMTAwMCA+IDYwKSB7XG4gICAgLy8g5aaC5p6c57yT5a2Y55qE5Li05pe25a+G6ZKl5pyJ5pWI77yM5bm26L+Y5pyJ6LaF6L+HNjDnp5LmnInmlYjmnJ/lsLHnm7TmjqXkvb/nlKhcbiAgICBjYWxjQXV0aEJ5VG1wS2V5KCk7XG4gIH0gZWxzZSBpZiAoc2VsZi5vcHRpb25zLmdldEF1dGhvcml6YXRpb24pIHtcbiAgICAvLyDlpJbpg6jorqHnrpfnrb7lkI3miJbojrflj5bkuLTml7blr4bpkqVcbiAgICBzZWxmLm9wdGlvbnMuZ2V0QXV0aG9yaXphdGlvbi5jYWxsKHNlbGYsIHtcbiAgICAgIEJ1Y2tldDogQnVja2V0LFxuICAgICAgUmVnaW9uOiBSZWdpb24sXG4gICAgICBNZXRob2Q6IHBhcmFtcy5NZXRob2QsXG4gICAgICBLZXk6IEtleU5hbWUsXG4gICAgICBQYXRobmFtZTogUGF0aG5hbWUsXG4gICAgICBRdWVyeTogcGFyYW1zLlF1ZXJ5LFxuICAgICAgSGVhZGVyczogaGVhZGVycyxcbiAgICAgIFNjb3BlOiBTY29wZSxcbiAgICAgIFN5c3RlbUNsb2NrT2Zmc2V0OiBzZWxmLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQsXG4gICAgICBGb3JjZVNpZ25Ib3N0OiBmb3JjZVNpZ25Ib3N0XG4gICAgfSwgZnVuY3Rpb24gKEF1dGhEYXRhKSB7XG4gICAgICBpZiAodHlwZW9mIEF1dGhEYXRhID09PSAnc3RyaW5nJykgQXV0aERhdGEgPSB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IEF1dGhEYXRhXG4gICAgICB9O1xuICAgICAgdmFyIEF1dGhFcnJvciA9IGNoZWNrQXV0aEVycm9yKEF1dGhEYXRhKTtcbiAgICAgIGlmIChBdXRoRXJyb3IpIHJldHVybiBjYihBdXRoRXJyb3IpO1xuXG4gICAgICBpZiAoQXV0aERhdGEuQXV0aG9yaXphdGlvbikge1xuICAgICAgICBjYihudWxsLCBBdXRoRGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBTdHNEYXRhID0gQXV0aERhdGEgfHwge307XG4gICAgICAgIFN0c0RhdGEuU2NvcGUgPSBTY29wZTtcbiAgICAgICAgU3RzRGF0YS5TY29wZUtleSA9IFNjb3BlS2V5O1xuXG4gICAgICAgIHNlbGYuX1N0c0NhY2hlLnB1c2goU3RzRGF0YSk7XG5cbiAgICAgICAgY2FsY0F1dGhCeVRtcEtleSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2UgaWYgKHNlbGYub3B0aW9ucy5nZXRTVFMpIHtcbiAgICAvLyDlpJbpg6jojrflj5bkuLTml7blr4bpkqVcbiAgICBzZWxmLm9wdGlvbnMuZ2V0U1RTLmNhbGwoc2VsZiwge1xuICAgICAgQnVja2V0OiBCdWNrZXQsXG4gICAgICBSZWdpb246IFJlZ2lvblxuICAgIH0sIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICBTdHNEYXRhID0gZGF0YSB8fCB7fTtcbiAgICAgIFN0c0RhdGEuU2NvcGUgPSBTY29wZTtcbiAgICAgIFN0c0RhdGEuU2NvcGVLZXkgPSBTY29wZUtleTtcbiAgICAgIGlmICghU3RzRGF0YS5UbXBTZWNyZXRJZCkgU3RzRGF0YS5UbXBTZWNyZXRJZCA9IFN0c0RhdGEuU2VjcmV0SWQ7XG4gICAgICBpZiAoIVN0c0RhdGEuVG1wU2VjcmV0S2V5KSBTdHNEYXRhLlRtcFNlY3JldEtleSA9IFN0c0RhdGEuU2VjcmV0S2V5O1xuICAgICAgdmFyIEF1dGhFcnJvciA9IGNoZWNrQXV0aEVycm9yKFN0c0RhdGEpO1xuICAgICAgaWYgKEF1dGhFcnJvcikgcmV0dXJuIGNiKEF1dGhFcnJvcik7XG5cbiAgICAgIHNlbGYuX1N0c0NhY2hlLnB1c2goU3RzRGF0YSk7XG5cbiAgICAgIGNhbGNBdXRoQnlUbXBLZXkoKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICAvLyDlhoXpg6jorqHnrpfojrflj5bnrb7lkI1cbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIEF1dGhvcml6YXRpb24gPSB1dGlsLmdldEF1dGgoe1xuICAgICAgICBTZWNyZXRJZDogcGFyYW1zLlNlY3JldElkIHx8IHNlbGYub3B0aW9ucy5TZWNyZXRJZCxcbiAgICAgICAgU2VjcmV0S2V5OiBwYXJhbXMuU2VjcmV0S2V5IHx8IHNlbGYub3B0aW9ucy5TZWNyZXRLZXksXG4gICAgICAgIE1ldGhvZDogcGFyYW1zLk1ldGhvZCxcbiAgICAgICAgUGF0aG5hbWU6IFBhdGhuYW1lLFxuICAgICAgICBRdWVyeTogcGFyYW1zLlF1ZXJ5LFxuICAgICAgICBIZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgICBFeHBpcmVzOiBwYXJhbXMuRXhwaXJlcyxcbiAgICAgICAgVXNlUmF3S2V5OiBzZWxmLm9wdGlvbnMuVXNlUmF3S2V5LFxuICAgICAgICBTeXN0ZW1DbG9ja09mZnNldDogc2VsZi5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0LFxuICAgICAgICBGb3JjZVNpZ25Ib3N0OiBmb3JjZVNpZ25Ib3N0XG4gICAgICB9KTtcbiAgICAgIHZhciBBdXRoRGF0YSA9IHtcbiAgICAgICAgQXV0aG9yaXphdGlvbjogQXV0aG9yaXphdGlvbixcbiAgICAgICAgU2VjdXJpdHlUb2tlbjogc2VsZi5vcHRpb25zLlNlY3VyaXR5VG9rZW4gfHwgc2VsZi5vcHRpb25zLlhDb3NTZWN1cml0eVRva2VuXG4gICAgICB9O1xuICAgICAgY2IobnVsbCwgQXV0aERhdGEpO1xuICAgICAgcmV0dXJuIEF1dGhEYXRhO1xuICAgIH0oKTtcbiAgfVxuXG4gIHJldHVybiAnJztcbn0gLy8g6LCD5pW05pe26Ze05YGP5beuXG5cblxuZnVuY3Rpb24gYWxsb3dSZXRyeShlcnIpIHtcbiAgdmFyIGFsbG93UmV0cnkgPSBmYWxzZTtcbiAgdmFyIGlzVGltZUVycm9yID0gZmFsc2U7XG4gIHZhciBzZXJ2ZXJEYXRlID0gZXJyLmhlYWRlcnMgJiYgKGVyci5oZWFkZXJzLmRhdGUgfHwgZXJyLmhlYWRlcnMuRGF0ZSkgfHwgZXJyLmVycm9yICYmIGVyci5lcnJvci5TZXJ2ZXJUaW1lO1xuXG4gIHRyeSB7XG4gICAgdmFyIGVycm9yQ29kZSA9IGVyci5lcnJvci5Db2RlO1xuICAgIHZhciBlcnJvck1lc3NhZ2UgPSBlcnIuZXJyb3IuTWVzc2FnZTtcblxuICAgIGlmIChlcnJvckNvZGUgPT09ICdSZXF1ZXN0VGltZVRvb1NrZXdlZCcgfHwgZXJyb3JDb2RlID09PSAnQWNjZXNzRGVuaWVkJyAmJiBlcnJvck1lc3NhZ2UgPT09ICdSZXF1ZXN0IGhhcyBleHBpcmVkJykge1xuICAgICAgaXNUaW1lRXJyb3IgPSB0cnVlO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge31cblxuICBpZiAoZXJyKSB7XG4gICAgaWYgKGlzVGltZUVycm9yICYmIHNlcnZlckRhdGUpIHtcbiAgICAgIHZhciBzZXJ2ZXJUaW1lID0gRGF0ZS5wYXJzZShzZXJ2ZXJEYXRlKTtcblxuICAgICAgaWYgKHRoaXMub3B0aW9ucy5Db3JyZWN0Q2xvY2tTa2V3ICYmIE1hdGguYWJzKHV0aWwuZ2V0U2tld1RpbWUodGhpcy5vcHRpb25zLlN5c3RlbUNsb2NrT2Zmc2V0KSAtIHNlcnZlclRpbWUpID49IDMwMDAwKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiBMb2NhbCB0aW1lIGlzIHRvbyBza2V3ZWQuJyk7XG4gICAgICAgIHRoaXMub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldCA9IHNlcnZlclRpbWUgLSBEYXRlLm5vdygpO1xuICAgICAgICBhbGxvd1JldHJ5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKE1hdGguZmxvb3IoZXJyLnN0YXR1c0NvZGUgLyAxMDApID09PSA1KSB7XG4gICAgICBhbGxvd1JldHJ5ID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYWxsb3dSZXRyeTtcbn0gLy8g6I635Y+W562+5ZCN5bm25Y+R6LW36K+35rGCXG5cblxuZnVuY3Rpb24gc3VibWl0UmVxdWVzdChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpczsgLy8g5aSE55CGIGhlYWRlcnNcblxuICAhcGFyYW1zLmhlYWRlcnMgJiYgKHBhcmFtcy5oZWFkZXJzID0ge30pOyAvLyDlpITnkIYgcXVlcnlcblxuICAhcGFyYW1zLnFzICYmIChwYXJhbXMucXMgPSB7fSk7XG4gIHBhcmFtcy5WZXJzaW9uSWQgJiYgKHBhcmFtcy5xcy52ZXJzaW9uSWQgPSBwYXJhbXMuVmVyc2lvbklkKTtcbiAgcGFyYW1zLnFzID0gdXRpbC5jbGVhcktleShwYXJhbXMucXMpOyAvLyDmuIXnkIYgdW5kZWZpbmVkIOWSjCBudWxsIOWtl+autVxuXG4gIHBhcmFtcy5oZWFkZXJzICYmIChwYXJhbXMuaGVhZGVycyA9IHV0aWwuY2xlYXJLZXkocGFyYW1zLmhlYWRlcnMpKTtcbiAgcGFyYW1zLnFzICYmIChwYXJhbXMucXMgPSB1dGlsLmNsZWFyS2V5KHBhcmFtcy5xcykpO1xuICB2YXIgUXVlcnkgPSB1dGlsLmNsb25lKHBhcmFtcy5xcyk7XG4gIHBhcmFtcy5hY3Rpb24gJiYgKFF1ZXJ5W3BhcmFtcy5hY3Rpb25dID0gJycpO1xuICB2YXIgcGFyYW1zVXJsID0gcGFyYW1zLnVybCB8fCBwYXJhbXMuVXJsO1xuICB2YXIgU2lnbkhvc3QgPSBwYXJhbXMuU2lnbkhvc3QgfHwgZ2V0U2lnbkhvc3QuY2FsbCh0aGlzLCB7XG4gICAgQnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICBVcmw6IHBhcmFtc1VybFxuICB9KTtcbiAgdmFyIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlcjtcblxuICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQodHJ5VGltZXMpIHtcbiAgICB2YXIgb2xkQ2xvY2tPZmZzZXQgPSBzZWxmLm9wdGlvbnMuU3lzdGVtQ2xvY2tPZmZzZXQ7XG4gICAgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICBzaWduU3RhcnRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgIHJldHJ5VGltZXM6IHRyeVRpbWVzIC0gMVxuICAgIH0pO1xuICAgIGdldEF1dGhvcml6YXRpb25Bc3luYy5jYWxsKHNlbGYsIHtcbiAgICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCB8fCAnJyxcbiAgICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbiB8fCAnJyxcbiAgICAgIE1ldGhvZDogcGFyYW1zLm1ldGhvZCxcbiAgICAgIEtleTogcGFyYW1zLktleSxcbiAgICAgIFF1ZXJ5OiBRdWVyeSxcbiAgICAgIEhlYWRlcnM6IHBhcmFtcy5oZWFkZXJzLFxuICAgICAgU2lnbkhvc3Q6IFNpZ25Ib3N0LFxuICAgICAgQWN0aW9uOiBwYXJhbXMuQWN0aW9uLFxuICAgICAgUmVzb3VyY2VLZXk6IHBhcmFtcy5SZXNvdXJjZUtleSxcbiAgICAgIFNjb3BlOiBwYXJhbXMuU2NvcGUsXG4gICAgICBGb3JjZVNpZ25Ib3N0OiBzZWxmLm9wdGlvbnMuRm9yY2VTaWduSG9zdFxuICAgIH0sIGZ1bmN0aW9uIChlcnIsIEF1dGhEYXRhKSB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdHJhY2tlciAmJiB0cmFja2VyLnNldFBhcmFtcyh7XG4gICAgICAgIHNpZ25FbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgICAgaHR0cFN0YXJ0VGltZTogbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgICAgIH0pO1xuICAgICAgcGFyYW1zLkF1dGhEYXRhID0gQXV0aERhdGE7XG5cbiAgICAgIF9zdWJtaXRSZXF1ZXN0LmNhbGwoc2VsZiwgcGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICAgIHRyYWNrZXIgJiYgdHJhY2tlci5zZXRQYXJhbXMoe1xuICAgICAgICAgIGh0dHBFbmRUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXJyICYmIHRyeVRpbWVzIDwgMiAmJiAob2xkQ2xvY2tPZmZzZXQgIT09IHNlbGYub3B0aW9ucy5TeXN0ZW1DbG9ja09mZnNldCB8fCBhbGxvd1JldHJ5LmNhbGwoc2VsZiwgZXJyKSkpIHtcbiAgICAgICAgICBpZiAocGFyYW1zLmhlYWRlcnMpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBwYXJhbXMuaGVhZGVycy5BdXRob3JpemF0aW9uO1xuICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy5oZWFkZXJzWyd0b2tlbiddO1xuICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy5oZWFkZXJzWydjbGllbnRJUCddO1xuICAgICAgICAgICAgZGVsZXRlIHBhcmFtcy5oZWFkZXJzWydjbGllbnRVQSddO1xuICAgICAgICAgICAgcGFyYW1zLmhlYWRlcnNbJ3gtY29zLXNlY3VyaXR5LXRva2VuJ10gJiYgZGVsZXRlIHBhcmFtcy5oZWFkZXJzWyd4LWNvcy1zZWN1cml0eS10b2tlbiddO1xuICAgICAgICAgICAgcGFyYW1zLmhlYWRlcnNbJ3gtY2ktc2VjdXJpdHktdG9rZW4nXSAmJiBkZWxldGUgcGFyYW1zLmhlYWRlcnNbJ3gtY2ktc2VjdXJpdHktdG9rZW4nXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBuZXh0KHRyeVRpbWVzICsgMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgbmV4dCgxKTtcbn0gLy8g5Y+R6LW36K+35rGCXG5cblxuZnVuY3Rpb24gX3N1Ym1pdFJlcXVlc3QocGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHZhciBUYXNrSWQgPSBwYXJhbXMuVGFza0lkO1xuICBpZiAoVGFza0lkICYmICFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgdmFyIGJ1Y2tldCA9IHBhcmFtcy5CdWNrZXQ7XG4gIHZhciByZWdpb24gPSBwYXJhbXMuUmVnaW9uO1xuICB2YXIgb2JqZWN0ID0gcGFyYW1zLktleTtcbiAgdmFyIG1ldGhvZCA9IHBhcmFtcy5tZXRob2QgfHwgJ0dFVCc7XG4gIHZhciB1cmwgPSBwYXJhbXMuVXJsIHx8IHBhcmFtcy51cmw7XG4gIHZhciBib2R5ID0gcGFyYW1zLmJvZHk7XG4gIHZhciByYXdCb2R5ID0gcGFyYW1zLnJhd0JvZHk7IC8vIHVybFxuXG4gIGlmIChzZWxmLm9wdGlvbnMuVXNlQWNjZWxlcmF0ZSkge1xuICAgIHJlZ2lvbiA9ICdhY2NlbGVyYXRlJztcbiAgfVxuXG4gIHVybCA9IHVybCB8fCBnZXRVcmwoe1xuICAgIEZvcmNlUGF0aFN0eWxlOiBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUsXG4gICAgcHJvdG9jb2w6IHNlbGYub3B0aW9ucy5Qcm90b2NvbCxcbiAgICBkb21haW46IHNlbGYub3B0aW9ucy5Eb21haW4sXG4gICAgYnVja2V0OiBidWNrZXQsXG4gICAgcmVnaW9uOiByZWdpb24sXG4gICAgb2JqZWN0OiBvYmplY3RcbiAgfSk7XG5cbiAgaWYgKHBhcmFtcy5hY3Rpb24pIHtcbiAgICAvLyDlt7Lnn6Xpl67popjvvIzmn5DkupvniYjmnKznmoRxceS8muWvuXVybOiHquWKqOaLvOaOpe+8iOavlOWmgi91cGxvYWTooqvmi7zmjqXmiJAvdXBsb2FkPShudWxsKe+8ieWvvOiHtOetvuWQjemUmeivr++8jOi/memHjOWBmuS4i+WFvOWuueOAglxuICAgIHVybCA9IHVybCArICc/JyArICh1dGlsLmlzSU9TX1FRID8gXCJcIi5jb25jYXQocGFyYW1zLmFjdGlvbiwgXCI9XCIpIDogcGFyYW1zLmFjdGlvbik7XG4gIH1cblxuICBpZiAocGFyYW1zLnFzU3RyKSB7XG4gICAgaWYgKHVybC5pbmRleE9mKCc/JykgPiAtMSkge1xuICAgICAgdXJsID0gdXJsICsgJyYnICsgcGFyYW1zLnFzU3RyO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmwgPSB1cmwgKyAnPycgKyBwYXJhbXMucXNTdHI7XG4gICAgfVxuICB9XG5cbiAgdmFyIG9wdCA9IHtcbiAgICBtZXRob2Q6IG1ldGhvZCxcbiAgICB1cmw6IHVybCxcbiAgICBoZWFkZXJzOiBwYXJhbXMuaGVhZGVycyxcbiAgICBxczogcGFyYW1zLnFzLFxuICAgIGJvZHk6IGJvZHlcbiAgfTsgLy8g5YW85a65Y2nmjqXlj6NcblxuICB2YXIgdG9rZW4gPSAneC1jb3Mtc2VjdXJpdHktdG9rZW4nO1xuXG4gIGlmICh1dGlsLmlzQ0lIb3N0KHVybCkpIHtcbiAgICB0b2tlbiA9ICd4LWNpLXNlY3VyaXR5LXRva2VuJztcbiAgfSAvLyDojrflj5bnrb7lkI1cblxuXG4gIG9wdC5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBwYXJhbXMuQXV0aERhdGEuQXV0aG9yaXphdGlvbjtcbiAgcGFyYW1zLkF1dGhEYXRhLlRva2VuICYmIChvcHQuaGVhZGVyc1sndG9rZW4nXSA9IHBhcmFtcy5BdXRoRGF0YS5Ub2tlbik7XG4gIHBhcmFtcy5BdXRoRGF0YS5DbGllbnRJUCAmJiAob3B0LmhlYWRlcnNbJ2NsaWVudElQJ10gPSBwYXJhbXMuQXV0aERhdGEuQ2xpZW50SVApO1xuICBwYXJhbXMuQXV0aERhdGEuQ2xpZW50VUEgJiYgKG9wdC5oZWFkZXJzWydjbGllbnRVQSddID0gcGFyYW1zLkF1dGhEYXRhLkNsaWVudFVBKTtcbiAgcGFyYW1zLkF1dGhEYXRhLlNlY3VyaXR5VG9rZW4gJiYgKG9wdC5oZWFkZXJzW3Rva2VuXSA9IHBhcmFtcy5BdXRoRGF0YS5TZWN1cml0eVRva2VuKTsgLy8g5riF55CGIHVuZGVmaW5lZCDlkowgbnVsbCDlrZfmrrVcblxuICBvcHQuaGVhZGVycyAmJiAob3B0LmhlYWRlcnMgPSB1dGlsLmNsZWFyS2V5KG9wdC5oZWFkZXJzKSk7XG4gIG9wdCA9IHV0aWwuY2xlYXJLZXkob3B0KTsgLy8gcHJvZ3Jlc3NcblxuICBpZiAocGFyYW1zLm9uUHJvZ3Jlc3MgJiYgdHlwZW9mIHBhcmFtcy5vblByb2dyZXNzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdmFyIGNvbnRlbnRMZW5ndGggPSBib2R5ICYmIChib2R5LnNpemUgfHwgYm9keS5sZW5ndGgpIHx8IDA7XG5cbiAgICBvcHQub25Qcm9ncmVzcyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoVGFza0lkICYmICFzZWxmLl9pc1J1bm5pbmdUYXNrKFRhc2tJZCkpIHJldHVybjtcbiAgICAgIHZhciBsb2FkZWQgPSBlID8gZS5sb2FkZWQgOiAwO1xuICAgICAgcGFyYW1zLm9uUHJvZ3Jlc3Moe1xuICAgICAgICBsb2FkZWQ6IGxvYWRlZCxcbiAgICAgICAgdG90YWw6IGNvbnRlbnRMZW5ndGhcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBpZiAocGFyYW1zLm9uRG93bmxvYWRQcm9ncmVzcykge1xuICAgIG9wdC5vbkRvd25sb2FkUHJvZ3Jlc3MgPSBwYXJhbXMub25Eb3dubG9hZFByb2dyZXNzO1xuICB9XG5cbiAgaWYgKHBhcmFtcy5EYXRhVHlwZSkge1xuICAgIG9wdC5kYXRhVHlwZSA9IHBhcmFtcy5EYXRhVHlwZTtcbiAgfVxuXG4gIGlmICh0aGlzLm9wdGlvbnMuVGltZW91dCkge1xuICAgIG9wdC50aW1lb3V0ID0gdGhpcy5vcHRpb25zLlRpbWVvdXQ7XG4gIH1cblxuICBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUgJiYgKG9wdC5wYXRoU3R5bGUgPSBzZWxmLm9wdGlvbnMuRm9yY2VQYXRoU3R5bGUpO1xuICBzZWxmLmVtaXQoJ2JlZm9yZS1zZW5kJywgb3B0KTtcbiAgdmFyIHVzZUFjY2VsZXJhdGUgPSBvcHQudXJsLmluY2x1ZGVzKCdhY2NlbGVyYXRlLicpO1xuICB2YXIgcXVlcnlTdHJpbmcgPSBvcHQucXMgPyBPYmplY3Qua2V5cyhvcHQucXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuIFwiXCIuY29uY2F0KGtleSwgXCI9XCIpLmNvbmNhdChvcHQucXNba2V5XSk7XG4gIH0pLmpvaW4oJyYnKSA6ICcnO1xuICB2YXIgZnVsbFVybCA9IHF1ZXJ5U3RyaW5nID8gb3B0LnVybCArICc/JyArIHF1ZXJ5U3RyaW5nIDogb3B0LnVybDtcbiAgcGFyYW1zLnRyYWNrZXIgJiYgcGFyYW1zLnRyYWNrZXIuc2V0UGFyYW1zKHtcbiAgICByZXFVcmw6IGZ1bGxVcmwsXG4gICAgYWNjZWxlcmF0ZTogdXNlQWNjZWxlcmF0ZSA/ICdZJyA6ICdOJ1xuICB9KTsgLy8g5YiG5Z2X5LiK5Lyg5pe257uZ54i257qndHJhY2tlcuiuvue9rnVybOS/oeaBr1xuXG4gIHBhcmFtcy50cmFja2VyICYmIHBhcmFtcy50cmFja2VyLnBhcmVudCAmJiBwYXJhbXMudHJhY2tlci5wYXJlbnQuc2V0UGFyYW1zKHtcbiAgICByZXFVcmw6IGZ1bGxVcmwsXG4gICAgYWNjZWxlcmF0ZTogdXNlQWNjZWxlcmF0ZSA/ICdZJyA6ICdOJ1xuICB9KTtcbiAgdmFyIHNlbmRlciA9IChzZWxmLm9wdGlvbnMuUmVxdWVzdCB8fCBSRVFVRVNUKShvcHQsIGZ1bmN0aW9uIChyKSB7XG4gICAgaWYgKHIuZXJyb3IgPT09ICdhYm9ydCcpIHJldHVybjtcbiAgICB2YXIgcmVjZWl2ZSA9IHtcbiAgICAgIG9wdGlvbnM6IG9wdCxcbiAgICAgIGVycm9yOiBlcnIsXG4gICAgICBzdGF0dXNDb2RlOiByZXNwb25zZSAmJiByZXNwb25zZS5zdGF0dXNDb2RlIHx8IDAsXG4gICAgICBoZWFkZXJzOiByZXNwb25zZSAmJiByZXNwb25zZS5oZWFkZXJzIHx8IHt9LFxuICAgICAgYm9keTogYm9keVxuICAgIH07XG4gICAgc2VsZi5lbWl0KCdhZnRlci1yZWNlaXZlJywgcmVjZWl2ZSk7XG4gICAgZXJyID0gcmVjZWl2ZS5lcnJvcjtcbiAgICBib2R5ID0gcmVjZWl2ZS5ib2R5O1xuICAgIHJlc3BvbnNlID0ge1xuICAgICAgc3RhdHVzQ29kZTogcmVjZWl2ZS5zdGF0dXNDb2RlLFxuICAgICAgaGVhZGVyczogcmVjZWl2ZS5oZWFkZXJzXG4gICAgfTsgLy8g5oqb5Ye65LqL5Lu277yM5YWB6K645L+u5pS56L+U5Zue5YC855qEIGVycm9y44CBc3RhdHVzQ29kZeOAgXN0YXR1c01lc3NhZ2XjgIFib2R5XG5cbiAgICBzZWxmLmVtaXQoJ2FmdGVyLXJlY2VpdmUnLCByKTtcbiAgICB2YXIgcmVzcG9uc2UgPSB7XG4gICAgICBzdGF0dXNDb2RlOiByLnN0YXR1c0NvZGUsXG4gICAgICBzdGF0dXNNZXNzYWdlOiByLnN0YXR1c01lc3NhZ2UsXG4gICAgICBoZWFkZXJzOiByLmhlYWRlcnNcbiAgICB9O1xuICAgIHZhciBlcnIgPSByLmVycm9yO1xuICAgIHZhciBib2R5ID0gci5ib2R5OyAvLyDov5Tlm57lhoXlrrnmt7vliqAg54q25oCB56CBIOWSjCBoZWFkZXJzXG5cbiAgICB2YXIgaGFzUmV0dXJuZWQ7XG5cbiAgICB2YXIgY2IgPSBmdW5jdGlvbiBjYihlcnIsIGRhdGEpIHtcbiAgICAgIFRhc2tJZCAmJiBzZWxmLm9mZignaW5uZXIta2lsbC10YXNrJywga2lsbFRhc2spO1xuICAgICAgaWYgKGhhc1JldHVybmVkKSByZXR1cm47XG4gICAgICBoYXNSZXR1cm5lZCA9IHRydWU7XG4gICAgICB2YXIgYXR0cnMgPSB7fTtcbiAgICAgIHJlc3BvbnNlICYmIHJlc3BvbnNlLnN0YXR1c0NvZGUgJiYgKGF0dHJzLnN0YXR1c0NvZGUgPSByZXNwb25zZS5zdGF0dXNDb2RlKTtcbiAgICAgIHJlc3BvbnNlICYmIHJlc3BvbnNlLmhlYWRlcnMgJiYgKGF0dHJzLmhlYWRlcnMgPSByZXNwb25zZS5oZWFkZXJzKTtcblxuICAgICAgaWYgKGVycikge1xuICAgICAgICBlcnIgPSB1dGlsLmV4dGVuZChlcnIgfHwge30sIGF0dHJzKTtcbiAgICAgICAgY2FsbGJhY2soZXJyLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGEgPSB1dGlsLmV4dGVuZChkYXRhIHx8IHt9LCBhdHRycyk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIGRhdGEpO1xuICAgICAgfVxuXG4gICAgICBzZW5kZXIgPSBudWxsO1xuICAgIH07IC8vIOivt+axgumUmeivr++8jOWPkeeUn+e9kee7nOmUmeivr1xuXG5cbiAgICBpZiAoZXJyKSByZXR1cm4gY2IodXRpbC5lcnJvcihlcnIpKTsgLy8g6K+35rGC6L+U5Zue56CB5LiN5Li6IDIwMFxuXG4gICAgdmFyIHN0YXR1c0NvZGUgPSByZXNwb25zZS5zdGF0dXNDb2RlO1xuICAgIHZhciBzdGF0dXNTdWNjZXNzID0gTWF0aC5mbG9vcihzdGF0dXNDb2RlIC8gMTAwKSA9PT0gMjsgLy8gMjAwIDIwMiAyMDQgMjA2XG4gICAgLy8g5LiN5a+5IGJvZHkg6L+b6KGM6L2s5o2i77yMYm9keSDnm7TmjqXmjILovb3ov5Tlm55cblxuICAgIGlmIChyYXdCb2R5ICYmIHN0YXR1c1N1Y2Nlc3MpIHJldHVybiBjYihudWxsLCB7XG4gICAgICBib2R5OiBib2R5XG4gICAgfSk7IC8vIOino+aekCB4bWwgYm9keVxuXG4gICAgdmFyIGpzb247XG5cbiAgICB0cnkge1xuICAgICAganNvbiA9IGJvZHkgJiYgYm9keS5pbmRleE9mKCc8JykgPiAtMSAmJiBib2R5LmluZGV4T2YoJz4nKSA+IC0xICYmIHV0aWwueG1sMmpzb24oYm9keSkgfHwge307XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAganNvbiA9IHt9O1xuICAgIH0gLy8g5aSE55CG6L+U5Zue5YC8XG5cblxuICAgIHZhciB4bWxFcnJvciA9IGpzb24gJiYganNvbi5FcnJvcjtcblxuICAgIGlmIChzdGF0dXNTdWNjZXNzKSB7XG4gICAgICAvLyDmraPnoa7ov5Tlm57vvIznirbmgIHnoIEgMnh4IOaXtu+8jGJvZHkg5LiN5Lya5pyJIEVycm9yXG4gICAgICBjYihudWxsLCBqc29uKTtcbiAgICB9IGVsc2UgaWYgKHhtbEVycm9yKSB7XG4gICAgICAvLyDmraPluLjov5Tlm57kuoYgeG1sIGJvZHnvvIzkuJTmnIkgRXJyb3Ig6IqC54K5XG4gICAgICBjYih1dGlsLmVycm9yKG5ldyBFcnJvcih4bWxFcnJvci5NZXNzYWdlKSwge1xuICAgICAgICBjb2RlOiB4bWxFcnJvci5Db2RlLFxuICAgICAgICBlcnJvcjogeG1sRXJyb3JcbiAgICAgIH0pKTtcbiAgICB9IGVsc2UgaWYgKHN0YXR1c0NvZGUpIHtcbiAgICAgIC8vIOaciemUmeivr+eahOeKtuaAgeeggVxuICAgICAgY2IodXRpbC5lcnJvcihuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzTWVzc2FnZSksIHtcbiAgICAgICAgY29kZTogJycgKyBzdGF0dXNDb2RlXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXNDb2RlKSB7XG4gICAgICAvLyDml6DnirbmgIHnoIHvvIzmiJbogIXojrflj5bkuI3liLDnirbmgIHnoIFcbiAgICAgIGNiKHV0aWwuZXJyb3IobmV3IEVycm9yKCdzdGF0dXNDb2RlIGVycm9yJykpKTtcbiAgICB9XG4gIH0pOyAvLyBraWxsIHRhc2tcblxuICB2YXIga2lsbFRhc2sgPSBmdW5jdGlvbiBraWxsVGFzayhkYXRhKSB7XG4gICAgaWYgKGRhdGEuVGFza0lkID09PSBUYXNrSWQpIHtcbiAgICAgIHNlbmRlciAmJiBzZW5kZXIuYWJvcnQgJiYgc2VuZGVyLmFib3J0KCk7XG4gICAgICBzZWxmLm9mZignaW5uZXIta2lsbC10YXNrJywga2lsbFRhc2spO1xuICAgIH1cbiAgfTtcblxuICBUYXNrSWQgJiYgc2VsZi5vbignaW5uZXIta2lsbC10YXNrJywga2lsbFRhc2spO1xufVxuXG52YXIgQVBJX01BUCA9IHtcbiAgLy8gQnVja2V0IOebuOWFs+aWueazlVxuICBnZXRTZXJ2aWNlOiBnZXRTZXJ2aWNlLFxuICAvLyBCdWNrZXRcbiAgcHV0QnVja2V0OiBwdXRCdWNrZXQsXG4gIGhlYWRCdWNrZXQ6IGhlYWRCdWNrZXQsXG4gIC8vIEJ1Y2tldFxuICBnZXRCdWNrZXQ6IGdldEJ1Y2tldCxcbiAgZGVsZXRlQnVja2V0OiBkZWxldGVCdWNrZXQsXG4gIHB1dEJ1Y2tldEFjbDogcHV0QnVja2V0QWNsLFxuICAvLyBCdWNrZXRBQ0xcbiAgZ2V0QnVja2V0QWNsOiBnZXRCdWNrZXRBY2wsXG4gIHB1dEJ1Y2tldENvcnM6IHB1dEJ1Y2tldENvcnMsXG4gIC8vIEJ1Y2tldENvcnNcbiAgZ2V0QnVja2V0Q29yczogZ2V0QnVja2V0Q29ycyxcbiAgZGVsZXRlQnVja2V0Q29yczogZGVsZXRlQnVja2V0Q29ycyxcbiAgZ2V0QnVja2V0TG9jYXRpb246IGdldEJ1Y2tldExvY2F0aW9uLFxuICAvLyBCdWNrZXRMb2NhdGlvblxuICBnZXRCdWNrZXRQb2xpY3k6IGdldEJ1Y2tldFBvbGljeSxcbiAgLy8gQnVja2V0UG9saWN5XG4gIHB1dEJ1Y2tldFBvbGljeTogcHV0QnVja2V0UG9saWN5LFxuICBkZWxldGVCdWNrZXRQb2xpY3k6IGRlbGV0ZUJ1Y2tldFBvbGljeSxcbiAgcHV0QnVja2V0VGFnZ2luZzogcHV0QnVja2V0VGFnZ2luZyxcbiAgLy8gQnVja2V0VGFnZ2luZ1xuICBnZXRCdWNrZXRUYWdnaW5nOiBnZXRCdWNrZXRUYWdnaW5nLFxuICBkZWxldGVCdWNrZXRUYWdnaW5nOiBkZWxldGVCdWNrZXRUYWdnaW5nLFxuICBwdXRCdWNrZXRMaWZlY3ljbGU6IHB1dEJ1Y2tldExpZmVjeWNsZSxcbiAgLy8gQnVja2V0TGlmZWN5Y2xlXG4gIGdldEJ1Y2tldExpZmVjeWNsZTogZ2V0QnVja2V0TGlmZWN5Y2xlLFxuICBkZWxldGVCdWNrZXRMaWZlY3ljbGU6IGRlbGV0ZUJ1Y2tldExpZmVjeWNsZSxcbiAgcHV0QnVja2V0VmVyc2lvbmluZzogcHV0QnVja2V0VmVyc2lvbmluZyxcbiAgLy8gQnVja2V0VmVyc2lvbmluZ1xuICBnZXRCdWNrZXRWZXJzaW9uaW5nOiBnZXRCdWNrZXRWZXJzaW9uaW5nLFxuICBwdXRCdWNrZXRSZXBsaWNhdGlvbjogcHV0QnVja2V0UmVwbGljYXRpb24sXG4gIC8vIEJ1Y2tldFJlcGxpY2F0aW9uXG4gIGdldEJ1Y2tldFJlcGxpY2F0aW9uOiBnZXRCdWNrZXRSZXBsaWNhdGlvbixcbiAgZGVsZXRlQnVja2V0UmVwbGljYXRpb246IGRlbGV0ZUJ1Y2tldFJlcGxpY2F0aW9uLFxuICBwdXRCdWNrZXRXZWJzaXRlOiBwdXRCdWNrZXRXZWJzaXRlLFxuICAvLyBCdWNrZXRXZWJzaXRlXG4gIGdldEJ1Y2tldFdlYnNpdGU6IGdldEJ1Y2tldFdlYnNpdGUsXG4gIGRlbGV0ZUJ1Y2tldFdlYnNpdGU6IGRlbGV0ZUJ1Y2tldFdlYnNpdGUsXG4gIHB1dEJ1Y2tldFJlZmVyZXI6IHB1dEJ1Y2tldFJlZmVyZXIsXG4gIC8vIEJ1Y2tldFJlZmVyZXJcbiAgZ2V0QnVja2V0UmVmZXJlcjogZ2V0QnVja2V0UmVmZXJlcixcbiAgcHV0QnVja2V0RG9tYWluOiBwdXRCdWNrZXREb21haW4sXG4gIC8vIEJ1Y2tldERvbWFpblxuICBnZXRCdWNrZXREb21haW46IGdldEJ1Y2tldERvbWFpbixcbiAgZGVsZXRlQnVja2V0RG9tYWluOiBkZWxldGVCdWNrZXREb21haW4sXG4gIHB1dEJ1Y2tldE9yaWdpbjogcHV0QnVja2V0T3JpZ2luLFxuICAvLyBCdWNrZXRPcmlnaW5cbiAgZ2V0QnVja2V0T3JpZ2luOiBnZXRCdWNrZXRPcmlnaW4sXG4gIGRlbGV0ZUJ1Y2tldE9yaWdpbjogZGVsZXRlQnVja2V0T3JpZ2luLFxuICBwdXRCdWNrZXRMb2dnaW5nOiBwdXRCdWNrZXRMb2dnaW5nLFxuICAvLyBCdWNrZXRMb2dnaW5nXG4gIGdldEJ1Y2tldExvZ2dpbmc6IGdldEJ1Y2tldExvZ2dpbmcsXG4gIHB1dEJ1Y2tldEludmVudG9yeTogcHV0QnVja2V0SW52ZW50b3J5LFxuICAvLyBCdWNrZXRJbnZlbnRvcnlcbiAgZ2V0QnVja2V0SW52ZW50b3J5OiBnZXRCdWNrZXRJbnZlbnRvcnksXG4gIGxpc3RCdWNrZXRJbnZlbnRvcnk6IGxpc3RCdWNrZXRJbnZlbnRvcnksXG4gIGRlbGV0ZUJ1Y2tldEludmVudG9yeTogZGVsZXRlQnVja2V0SW52ZW50b3J5LFxuICBwdXRCdWNrZXRBY2NlbGVyYXRlOiBwdXRCdWNrZXRBY2NlbGVyYXRlLFxuICBnZXRCdWNrZXRBY2NlbGVyYXRlOiBnZXRCdWNrZXRBY2NlbGVyYXRlLFxuICBwdXRCdWNrZXRFbmNyeXB0aW9uOiBwdXRCdWNrZXRFbmNyeXB0aW9uLFxuICBnZXRCdWNrZXRFbmNyeXB0aW9uOiBnZXRCdWNrZXRFbmNyeXB0aW9uLFxuICBkZWxldGVCdWNrZXRFbmNyeXB0aW9uOiBkZWxldGVCdWNrZXRFbmNyeXB0aW9uLFxuICAvLyBPYmplY3Qg55u45YWz5pa55rOVXG4gIGdldE9iamVjdDogZ2V0T2JqZWN0LFxuICBoZWFkT2JqZWN0OiBoZWFkT2JqZWN0LFxuICBsaXN0T2JqZWN0VmVyc2lvbnM6IGxpc3RPYmplY3RWZXJzaW9ucyxcbiAgcHV0T2JqZWN0OiBwdXRPYmplY3QsXG4gIGRlbGV0ZU9iamVjdDogZGVsZXRlT2JqZWN0LFxuICBnZXRPYmplY3RBY2w6IGdldE9iamVjdEFjbCxcbiAgcHV0T2JqZWN0QWNsOiBwdXRPYmplY3RBY2wsXG4gIG9wdGlvbnNPYmplY3Q6IG9wdGlvbnNPYmplY3QsXG4gIHB1dE9iamVjdENvcHk6IHB1dE9iamVjdENvcHksXG4gIGRlbGV0ZU11bHRpcGxlT2JqZWN0OiBkZWxldGVNdWx0aXBsZU9iamVjdCxcbiAgcmVzdG9yZU9iamVjdDogcmVzdG9yZU9iamVjdCxcbiAgcHV0T2JqZWN0VGFnZ2luZzogcHV0T2JqZWN0VGFnZ2luZyxcbiAgZ2V0T2JqZWN0VGFnZ2luZzogZ2V0T2JqZWN0VGFnZ2luZyxcbiAgZGVsZXRlT2JqZWN0VGFnZ2luZzogZGVsZXRlT2JqZWN0VGFnZ2luZyxcbiAgc2VsZWN0T2JqZWN0Q29udGVudDogc2VsZWN0T2JqZWN0Q29udGVudCxcbiAgYXBwZW5kT2JqZWN0OiBhcHBlbmRPYmplY3QsXG4gIC8vIOWIhuWdl+S4iuS8oOebuOWFs+aWueazlVxuICB1cGxvYWRQYXJ0Q29weTogdXBsb2FkUGFydENvcHksXG4gIG11bHRpcGFydEluaXQ6IG11bHRpcGFydEluaXQsXG4gIG11bHRpcGFydFVwbG9hZDogbXVsdGlwYXJ0VXBsb2FkLFxuICBtdWx0aXBhcnRDb21wbGV0ZTogbXVsdGlwYXJ0Q29tcGxldGUsXG4gIG11bHRpcGFydExpc3Q6IG11bHRpcGFydExpc3QsXG4gIG11bHRpcGFydExpc3RQYXJ0OiBtdWx0aXBhcnRMaXN0UGFydCxcbiAgbXVsdGlwYXJ0QWJvcnQ6IG11bHRpcGFydEFib3J0LFxuICAvLyDlt6Xlhbfmlrnms5VcbiAgcmVxdWVzdDogcmVxdWVzdCxcbiAgZ2V0T2JqZWN0VXJsOiBnZXRPYmplY3RVcmwsXG4gIGdldEF1dGg6IGdldEF1dGhcbn07XG5cbmZ1bmN0aW9uIHdhcm5PbGRBcGkoYXBpTmFtZSwgZm4sIHByb3RvKSB7XG4gIHV0aWwuZWFjaChbJ0NvcnMnLCAnQWNsJ10sIGZ1bmN0aW9uIChzdWZmaXgpIHtcbiAgICBpZiAoYXBpTmFtZS5zbGljZSgtc3VmZml4Lmxlbmd0aCkgPT09IHN1ZmZpeCkge1xuICAgICAgdmFyIG9sZE5hbWUgPSBhcGlOYW1lLnNsaWNlKDAsIC1zdWZmaXgubGVuZ3RoKSArIHN1ZmZpeC50b1VwcGVyQ2FzZSgpO1xuICAgICAgdmFyIGFwaUZuID0gdXRpbC5hcGlXcmFwcGVyKGFwaU5hbWUsIGZuKTtcbiAgICAgIHZhciB3YXJuZWQgPSBmYWxzZTtcblxuICAgICAgcHJvdG9bb2xkTmFtZV0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICF3YXJuZWQgJiYgY29uc29sZS53YXJuKCd3YXJuaW5nOiBjb3MuJyArIG9sZE5hbWUgKyAnIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFBsZWFzZSBVc2UgY29zLicgKyBhcGlOYW1lICsgJyBpbnN0ZWFkLicpO1xuICAgICAgICB3YXJuZWQgPSB0cnVlO1xuICAgICAgICBhcGlGbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9XG4gIH0pO1xufVxuXG5tb2R1bGUuZXhwb3J0cy5pbml0ID0gZnVuY3Rpb24gKENPUywgdGFzaykge1xuICB0YXNrLnRyYW5zZmVyVG9UYXNrTWV0aG9kKEFQSV9NQVAsICdwdXRPYmplY3QnKTtcbiAgdXRpbC5lYWNoKEFQSV9NQVAsIGZ1bmN0aW9uIChmbiwgYXBpTmFtZSkge1xuICAgIENPUy5wcm90b3R5cGVbYXBpTmFtZV0gPSB1dGlsLmFwaVdyYXBwZXIoYXBpTmFtZSwgZm4pO1xuICAgIHdhcm5PbGRBcGkoYXBpTmFtZSwgZm4sIENPUy5wcm90b3R5cGUpO1xuICB9KTtcbn07XG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vc3JjL2Nvcy5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9zcmMvY29zLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcblxuXG52YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbCAqLyBcIi4vc3JjL3V0aWwuanNcIik7XG5cbnZhciBldmVudCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vZXZlbnQgKi8gXCIuL3NyYy9ldmVudC5qc1wiKTtcblxudmFyIHRhc2sgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3Rhc2sgKi8gXCIuL3NyYy90YXNrLmpzXCIpO1xuXG52YXIgYmFzZSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vYmFzZSAqLyBcIi4vc3JjL2Jhc2UuanNcIik7XG5cbnZhciBhZHZhbmNlID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi9hZHZhbmNlICovIFwiLi9zcmMvYWR2YW5jZS5qc1wiKTtcblxudmFyIHBrZyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL3BhY2thZ2UuanNvbiAqLyBcIi4vcGFja2FnZS5qc29uXCIpO1xuXG52YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG4gIEFwcElkOiAnJyxcbiAgLy8gQXBwSWQg5bey5bqf5byD77yM6K+35ou85o6l5YiwIEJ1Y2tldCDlkI7kvKDlhaXvvIzkvovlpoLvvJp0ZXN0LTEyNTAwMDAwMDBcbiAgU2VjcmV0SWQ6ICcnLFxuICBTZWNyZXRLZXk6ICcnLFxuICBTZWN1cml0eVRva2VuOiAnJyxcbiAgLy8g5L2/55So5Li05pe25a+G6ZKl6ZyA6KaB5rOo5oSP6Ieq6KGM5Yi35pawIFRva2VuXG4gIENodW5rUmV0cnlUaW1lczogMixcbiAgRmlsZVBhcmFsbGVsTGltaXQ6IDMsXG4gIENodW5rUGFyYWxsZWxMaW1pdDogMyxcbiAgQ2h1bmtTaXplOiAxMDI0ICogMTAyNCxcbiAgU2xpY2VTaXplOiAxMDI0ICogMTAyNCxcbiAgQ29weUNodW5rUGFyYWxsZWxMaW1pdDogMjAsXG4gIENvcHlDaHVua1NpemU6IDEwMjQgKiAxMDI0ICogMTAsXG4gIENvcHlTbGljZVNpemU6IDEwMjQgKiAxMDI0ICogMTAsXG4gIE1heFBhcnROdW1iZXI6IDEwMDAwLFxuICBQcm9ncmVzc0ludGVydmFsOiAxMDAwLFxuICBEb21haW46ICcnLFxuICBTZXJ2aWNlRG9tYWluOiAnJyxcbiAgUHJvdG9jb2w6ICcnLFxuICBDb21wYXRpYmlsaXR5TW9kZTogZmFsc2UsXG4gIEZvcmNlUGF0aFN0eWxlOiBmYWxzZSxcbiAgVXNlUmF3S2V5OiBmYWxzZSxcbiAgVGltZW91dDogMCxcbiAgLy8g5Y2V5L2N5q+r56eS77yMMCDku6PooajkuI3orr7nva7otoXml7bml7bpl7RcbiAgQ29ycmVjdENsb2NrU2tldzogdHJ1ZSxcbiAgU3lzdGVtQ2xvY2tPZmZzZXQ6IDAsXG4gIC8vIOWNleS9jeavq+enku+8jG1zXG4gIFVwbG9hZENoZWNrQ29udGVudE1kNTogZmFsc2UsXG4gIFVwbG9hZFF1ZXVlU2l6ZTogMTAwMDAsXG4gIFVwbG9hZEFkZE1ldGFNZDU6IGZhbHNlLFxuICBVcGxvYWRJZENhY2hlTGltaXQ6IDUwLFxuICBVc2VBY2NlbGVyYXRlOiBmYWxzZSxcbiAgRm9yY2VTaWduSG9zdDogdHJ1ZSxcbiAgLy8g6buY6K6k5bCGaG9zdOWKoOWFpeetvuWQjeiuoeeul++8jOWFs+mXreWQjuWPr+iDveWvvOiHtOi2iuadg+mjjumZqe+8jOW7uuiuruS/neaMgeS4unRydWVcbiAgRW5hYmxlVHJhY2tlcjogZmFsc2UsXG4gIC8vIOm7mOiupOWFs+mXreS4iuaKpVxuICBEZWVwVHJhY2tlcjogZmFsc2UsXG4gIC8vIOS4iuaKpeaXtuaYr+WQpuWvueavj+S4quWIhuWdl+S4iuS8oOWBmuWNleeLrOS4iuaKpVxuICBUcmFja2VyRGVsYXk6IDUwMDAsXG4gIC8vIOWRqOacn+aAp+S4iuaKpe+8jOWNleS9jeavq+enkuOAgjDku6Pooajlrp7ml7bkuIrmiqVcbiAgQ3VzdG9tSWQ6ICcnIC8vIOiHquWumuS5ieS4iuaKpWlkXG5cbn07IC8vIOWvueWkluaatOmcsueahOexu1xuXG52YXIgQ09TID0gZnVuY3Rpb24gQ09TKG9wdGlvbnMpIHtcbiAgdGhpcy5vcHRpb25zID0gdXRpbC5leHRlbmQodXRpbC5jbG9uZShkZWZhdWx0T3B0aW9ucyksIG9wdGlvbnMgfHwge30pO1xuICB0aGlzLm9wdGlvbnMuRmlsZVBhcmFsbGVsTGltaXQgPSBNYXRoLm1heCgxLCB0aGlzLm9wdGlvbnMuRmlsZVBhcmFsbGVsTGltaXQpO1xuICB0aGlzLm9wdGlvbnMuQ2h1bmtQYXJhbGxlbExpbWl0ID0gTWF0aC5tYXgoMSwgdGhpcy5vcHRpb25zLkNodW5rUGFyYWxsZWxMaW1pdCk7XG4gIHRoaXMub3B0aW9ucy5DaHVua1JldHJ5VGltZXMgPSBNYXRoLm1heCgwLCB0aGlzLm9wdGlvbnMuQ2h1bmtSZXRyeVRpbWVzKTtcbiAgdGhpcy5vcHRpb25zLkNodW5rU2l6ZSA9IE1hdGgubWF4KDEwMjQgKiAxMDI0LCB0aGlzLm9wdGlvbnMuQ2h1bmtTaXplKTtcbiAgdGhpcy5vcHRpb25zLkNvcHlDaHVua1BhcmFsbGVsTGltaXQgPSBNYXRoLm1heCgxLCB0aGlzLm9wdGlvbnMuQ29weUNodW5rUGFyYWxsZWxMaW1pdCk7XG4gIHRoaXMub3B0aW9ucy5Db3B5Q2h1bmtTaXplID0gTWF0aC5tYXgoMTAyNCAqIDEwMjQsIHRoaXMub3B0aW9ucy5Db3B5Q2h1bmtTaXplKTtcbiAgdGhpcy5vcHRpb25zLkNvcHlTbGljZVNpemUgPSBNYXRoLm1heCgwLCB0aGlzLm9wdGlvbnMuQ29weVNsaWNlU2l6ZSk7XG4gIHRoaXMub3B0aW9ucy5NYXhQYXJ0TnVtYmVyID0gTWF0aC5tYXgoMTAyNCwgTWF0aC5taW4oMTAwMDAsIHRoaXMub3B0aW9ucy5NYXhQYXJ0TnVtYmVyKSk7XG4gIHRoaXMub3B0aW9ucy5UaW1lb3V0ID0gTWF0aC5tYXgoMCwgdGhpcy5vcHRpb25zLlRpbWVvdXQpO1xuXG4gIGlmICh0aGlzLm9wdGlvbnMuQXBwSWQpIHtcbiAgICBjb25zb2xlLndhcm4oJ3dhcm5pbmc6IEFwcElkIGhhcyBiZWVuIGRlcHJlY2F0ZWQsIFBsZWFzZSBwdXQgaXQgYXQgdGhlIGVuZCBvZiBwYXJhbWV0ZXIgQnVja2V0KEUuZzogXCJ0ZXN0LTEyNTAwMDAwMDBcIikuJyk7XG4gIH1cblxuICBpZiAodGhpcy5vcHRpb25zLlNlY3JldElkICYmIHRoaXMub3B0aW9ucy5TZWNyZXRJZC5pbmRleE9mKCcgJykgPiAtMSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiBTZWNyZXRJZOagvOW8j+mUmeivr++8jOivt+ajgOafpScpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiBTZWNyZXRJZCBmb3JtYXQgaXMgaW5jb3JyZWN0LiBQbGVhc2UgY2hlY2snKTtcbiAgfVxuXG4gIGlmICh0aGlzLm9wdGlvbnMuU2VjcmV0S2V5ICYmIHRoaXMub3B0aW9ucy5TZWNyZXRLZXkuaW5kZXhPZignICcpID4gLTEpIHtcbiAgICBjb25zb2xlLmVycm9yKCdlcnJvcjogU2VjcmV0S2V55qC85byP6ZSZ6K+v77yM6K+35qOA5p+lJyk7XG4gICAgY29uc29sZS5lcnJvcignZXJyb3I6IFNlY3JldEtleSBmb3JtYXQgaXMgaW5jb3JyZWN0LiBQbGVhc2UgY2hlY2snKTtcbiAgfVxuXG4gIGlmICh1dGlsLmlzTm9kZSgpKSB7XG4gICAgY29uc29sZS53YXJuKCd3YXJuaW5nOiBjb3MtanMtc2RrLXY1IOS4jeaUr+aMgSBub2RlanMg546v5aKD5L2/55So77yM6K+35pS555SoIGNvcy1ub2RlanMtc2RrLXY177yM5Y+C6ICD5paH5qGj77yaIGh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvODYyOScpO1xuICAgIGNvbnNvbGUud2Fybignd2FybmluZzogY29zLWpzLXNkay12NSBkb2VzIG5vdCBzdXBwb3J0IG5vZGVqcyBlbnZpcm9ubWVudC4gUGxlYXNlIHVzZSBjb3Mtbm9kZWpzLXNkay12NSBpbnN0ZWFkLiBTZWU6IGh0dHBzOi8vY2xvdWQudGVuY2VudC5jb20vZG9jdW1lbnQvcHJvZHVjdC80MzYvODYyOScpO1xuICB9XG5cbiAgZXZlbnQuaW5pdCh0aGlzKTtcbiAgdGFzay5pbml0KHRoaXMpO1xufTtcblxuYmFzZS5pbml0KENPUywgdGFzayk7XG5hZHZhbmNlLmluaXQoQ09TLCB0YXNrKTtcbkNPUy51dGlsID0ge1xuICBtZDU6IHV0aWwubWQ1LFxuICB4bWwyanNvbjogdXRpbC54bWwyanNvbixcbiAganNvbjJ4bWw6IHV0aWwuanNvbjJ4bWxcbn07XG5DT1MuZ2V0QXV0aG9yaXphdGlvbiA9IHV0aWwuZ2V0QXV0aDtcbkNPUy52ZXJzaW9uID0gcGtnLnZlcnNpb247XG5tb2R1bGUuZXhwb3J0cyA9IENPUztcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvZXZlbnQuanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKiohKlxcXG4gICEqKiogLi9zcmMvZXZlbnQuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxudmFyIGluaXRFdmVudCA9IGZ1bmN0aW9uIGluaXRFdmVudChjb3MpIHtcbiAgdmFyIGxpc3RlbmVycyA9IHt9O1xuXG4gIHZhciBnZXRMaXN0ID0gZnVuY3Rpb24gZ2V0TGlzdChhY3Rpb24pIHtcbiAgICAhbGlzdGVuZXJzW2FjdGlvbl0gJiYgKGxpc3RlbmVyc1thY3Rpb25dID0gW10pO1xuICAgIHJldHVybiBsaXN0ZW5lcnNbYWN0aW9uXTtcbiAgfTtcblxuICBjb3Mub24gPSBmdW5jdGlvbiAoYWN0aW9uLCBjYWxsYmFjaykge1xuICAgIGlmIChhY3Rpb24gPT09ICd0YXNrLWxpc3QtdXBkYXRlJykge1xuICAgICAgY29uc29sZS53YXJuKCd3YXJuaW5nOiBFdmVudCBcIicgKyBhY3Rpb24gKyAnXCIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBcImxpc3QtdXBkYXRlXCIgaW5zdGVhZC4nKTtcbiAgICB9XG5cbiAgICBnZXRMaXN0KGFjdGlvbikucHVzaChjYWxsYmFjayk7XG4gIH07XG5cbiAgY29zLm9mZiA9IGZ1bmN0aW9uIChhY3Rpb24sIGNhbGxiYWNrKSB7XG4gICAgdmFyIGxpc3QgPSBnZXRMaXN0KGFjdGlvbik7XG5cbiAgICBmb3IgKHZhciBpID0gbGlzdC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgY2FsbGJhY2sgPT09IGxpc3RbaV0gJiYgbGlzdC5zcGxpY2UoaSwgMSk7XG4gICAgfVxuICB9O1xuXG4gIGNvcy5lbWl0ID0gZnVuY3Rpb24gKGFjdGlvbiwgZGF0YSkge1xuICAgIHZhciBsaXN0ID0gZ2V0TGlzdChhY3Rpb24pLm1hcChmdW5jdGlvbiAoY2IpIHtcbiAgICAgIHJldHVybiBjYjtcbiAgICB9KTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgbGlzdFtpXShkYXRhKTtcbiAgICB9XG4gIH07XG59O1xuXG52YXIgRXZlbnRQcm94eSA9IGZ1bmN0aW9uIEV2ZW50UHJveHkoKSB7XG4gIGluaXRFdmVudCh0aGlzKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzLmluaXQgPSBpbml0RXZlbnQ7XG5tb2R1bGUuZXhwb3J0cy5FdmVudFByb3h5ID0gRXZlbnRQcm94eTtcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvc2Vzc2lvbi5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vc3JjL3Nlc3Npb24uanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbCAqLyBcIi4vc3JjL3V0aWwuanNcIik7IC8vIOaMieeFp+aWh+S7tueJueW+geWAvO+8jOe8k+WtmCBVcGxvYWRJZFxuXG5cbnZhciBjYWNoZUtleSA9ICdjb3Nfc2RrX3VwbG9hZF9jYWNoZSc7XG52YXIgZXhwaXJlcyA9IDMwICogMjQgKiAzNjAwO1xudmFyIGNhY2hlO1xudmFyIHRpbWVyO1xuXG52YXIgZ2V0Q2FjaGUgPSBmdW5jdGlvbiBnZXRDYWNoZSgpIHtcbiAgdHJ5IHtcbiAgICB2YXIgdmFsID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShjYWNoZUtleSkpO1xuICB9IGNhdGNoIChlKSB7fVxuXG4gIGlmICghdmFsKSB2YWwgPSBbXTtcbiAgY2FjaGUgPSB2YWw7XG59O1xuXG52YXIgc2V0Q2FjaGUgPSBmdW5jdGlvbiBzZXRDYWNoZSgpIHtcbiAgdHJ5IHtcbiAgICBpZiAoY2FjaGUubGVuZ3RoKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShjYWNoZUtleSwgSlNPTi5zdHJpbmdpZnkoY2FjaGUpKTtlbHNlIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGNhY2hlS2V5KTtcbiAgfSBjYXRjaCAoZSkge31cbn07XG5cbnZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgaWYgKGNhY2hlKSByZXR1cm47XG4gIGdldENhY2hlLmNhbGwodGhpcyk7IC8vIOa4heeQhuWkquiAgeaXp+eahOaVsOaNrlxuXG4gIHZhciBjaGFuZ2VkID0gZmFsc2U7XG4gIHZhciBub3cgPSBNYXRoLnJvdW5kKERhdGUubm93KCkgLyAxMDAwKTtcblxuICBmb3IgKHZhciBpID0gY2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICB2YXIgbXRpbWUgPSBjYWNoZVtpXVsyXTtcblxuICAgIGlmICghbXRpbWUgfHwgbXRpbWUgKyBleHBpcmVzIDwgbm93KSB7XG4gICAgICBjYWNoZS5zcGxpY2UoaSwgMSk7XG4gICAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBjaGFuZ2VkICYmIHNldENhY2hlKCk7XG59OyAvLyDmiornvJPlrZjlrZjliLDmnKzlnLBcblxuXG52YXIgc2F2ZSA9IGZ1bmN0aW9uIHNhdmUoKSB7XG4gIGlmICh0aW1lcikgcmV0dXJuO1xuICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgIHNldENhY2hlKCk7XG4gICAgdGltZXIgPSBudWxsO1xuICB9LCA0MDApO1xufTtcblxudmFyIG1vZCA9IHtcbiAgdXNpbmc6IHt9LFxuICAvLyDmoIforrAgVXBsb2FkSWQg5q2j5Zyo5L2/55SoXG4gIHNldFVzaW5nOiBmdW5jdGlvbiBzZXRVc2luZyh1dWlkKSB7XG4gICAgbW9kLnVzaW5nW3V1aWRdID0gdHJ1ZTtcbiAgfSxcbiAgLy8g5qCH6K6wIFVwbG9hZElkIOW3sue7j+ayoeWcqOS9v+eUqFxuICByZW1vdmVVc2luZzogZnVuY3Rpb24gcmVtb3ZlVXNpbmcodXVpZCkge1xuICAgIGRlbGV0ZSBtb2QudXNpbmdbdXVpZF07XG4gIH0sXG4gIC8vIOeUqOS4iuS8oOWPguaVsOeUn+aIkOWTiOW4jOWAvFxuICBnZXRGaWxlSWQ6IGZ1bmN0aW9uIGdldEZpbGVJZChmaWxlLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5KSB7XG4gICAgaWYgKGZpbGUubmFtZSAmJiBmaWxlLnNpemUgJiYgZmlsZS5sYXN0TW9kaWZpZWREYXRlICYmIENodW5rU2l6ZSkge1xuICAgICAgcmV0dXJuIHV0aWwubWQ1KFtmaWxlLm5hbWUsIGZpbGUuc2l6ZSwgZmlsZS5sYXN0TW9kaWZpZWREYXRlLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5XS5qb2luKCc6OicpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuICAvLyDnlKjkuIrkvKDlj4LmlbDnlJ/miJDlk4jluIzlgLxcbiAgZ2V0Q29weUZpbGVJZDogZnVuY3Rpb24gZ2V0Q29weUZpbGVJZChjb3B5U291cmNlLCBzb3VyY2VIZWFkZXJzLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5KSB7XG4gICAgdmFyIHNpemUgPSBzb3VyY2VIZWFkZXJzWydjb250ZW50LWxlbmd0aCddO1xuICAgIHZhciBldGFnID0gc291cmNlSGVhZGVycy5ldGFnIHx8ICcnO1xuICAgIHZhciBsYXN0TW9kaWZpZWQgPSBzb3VyY2VIZWFkZXJzWydsYXN0LW1vZGlmaWVkJ107XG5cbiAgICBpZiAoY29weVNvdXJjZSAmJiBDaHVua1NpemUpIHtcbiAgICAgIHJldHVybiB1dGlsLm1kNShbY29weVNvdXJjZSwgc2l6ZSwgZXRhZywgbGFzdE1vZGlmaWVkLCBDaHVua1NpemUsIEJ1Y2tldCwgS2V5XS5qb2luKCc6OicpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9LFxuICAvLyDojrflj5bmlofku7blr7nlupTnmoQgVXBsb2FkSWQg5YiX6KGoXG4gIGdldFVwbG9hZElkTGlzdDogZnVuY3Rpb24gZ2V0VXBsb2FkSWRMaXN0KHV1aWQpIHtcbiAgICBpZiAoIXV1aWQpIHJldHVybiBudWxsO1xuICAgIGluaXQuY2FsbCh0aGlzKTtcbiAgICB2YXIgbGlzdCA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYWNoZS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNhY2hlW2ldWzBdID09PSB1dWlkKSBsaXN0LnB1c2goY2FjaGVbaV1bMV0pO1xuICAgIH1cblxuICAgIHJldHVybiBsaXN0Lmxlbmd0aCA/IGxpc3QgOiBudWxsO1xuICB9LFxuICAvLyDnvJPlrZggVXBsb2FkSWRcbiAgc2F2ZVVwbG9hZElkOiBmdW5jdGlvbiBzYXZlVXBsb2FkSWQodXVpZCwgVXBsb2FkSWQsIGxpbWl0KSB7XG4gICAgaW5pdC5jYWxsKHRoaXMpO1xuICAgIGlmICghdXVpZCkgcmV0dXJuOyAvLyDmuIXnkIbmsqHnlKjnmoQgVXBsb2FkSWTvvIxqcyDmlofku7bmsqHmnIkgRmlsZVBhdGgg77yM5Y+q5riF55CG55u45ZCM6K6w5b2VXG5cbiAgICBmb3IgKHZhciBpID0gY2FjaGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIHZhciBpdGVtID0gY2FjaGVbaV07XG5cbiAgICAgIGlmIChpdGVtWzBdID09PSB1dWlkICYmIGl0ZW1bMV0gPT09IFVwbG9hZElkKSB7XG4gICAgICAgIGNhY2hlLnNwbGljZShpLCAxKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjYWNoZS51bnNoaWZ0KFt1dWlkLCBVcGxvYWRJZCwgTWF0aC5yb3VuZChEYXRlLm5vdygpIC8gMTAwMCldKTtcbiAgICBpZiAoY2FjaGUubGVuZ3RoID4gbGltaXQpIGNhY2hlLnNwbGljZShsaW1pdCk7XG4gICAgc2F2ZSgpO1xuICB9LFxuICAvLyBVcGxvYWRJZCDlt7LnlKjlrozvvIznp7vpmaTmjolcbiAgcmVtb3ZlVXBsb2FkSWQ6IGZ1bmN0aW9uIHJlbW92ZVVwbG9hZElkKFVwbG9hZElkKSB7XG4gICAgaW5pdC5jYWxsKHRoaXMpO1xuICAgIGRlbGV0ZSBtb2QudXNpbmdbVXBsb2FkSWRdO1xuXG4gICAgZm9yICh2YXIgaSA9IGNhY2hlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBpZiAoY2FjaGVbaV1bMV0gPT09IFVwbG9hZElkKSBjYWNoZS5zcGxpY2UoaSwgMSk7XG4gICAgfVxuXG4gICAgc2F2ZSgpO1xuICB9XG59O1xubW9kdWxlLmV4cG9ydHMgPSBtb2Q7XG5cbi8qKiovIH0pLFxuXG4vKioqLyBcIi4vc3JjL3Rhc2suanNcIjpcbi8qISoqKioqKioqKioqKioqKioqKioqKiEqXFxcbiAgISoqKiAuL3NyYy90YXNrLmpzICoqKiFcbiAgXFwqKioqKioqKioqKioqKioqKioqKiovXG4vKiEgbm8gc3RhdGljIGV4cG9ydHMgZm91bmQgKi9cbi8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHtcblxudmFyIHNlc3Npb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3Nlc3Npb24gKi8gXCIuL3NyYy9zZXNzaW9uLmpzXCIpO1xuXG52YXIgdXRpbCA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vdXRpbCAqLyBcIi4vc3JjL3V0aWwuanNcIik7XG5cbnZhciBvcmlnaW5BcGlNYXAgPSB7fTtcblxudmFyIHRyYW5zZmVyVG9UYXNrTWV0aG9kID0gZnVuY3Rpb24gdHJhbnNmZXJUb1Rhc2tNZXRob2QoYXBpTWFwLCBhcGlOYW1lKSB7XG4gIG9yaWdpbkFwaU1hcFthcGlOYW1lXSA9IGFwaU1hcFthcGlOYW1lXTtcblxuICBhcGlNYXBbYXBpTmFtZV0gPSBmdW5jdGlvbiAocGFyYW1zLCBjYWxsYmFjaykge1xuICAgIGlmIChwYXJhbXMuU2tpcFRhc2spIHtcbiAgICAgIG9yaWdpbkFwaU1hcFthcGlOYW1lXS5jYWxsKHRoaXMsIHBhcmFtcywgY2FsbGJhY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9hZGRUYXNrKGFwaU5hbWUsIHBhcmFtcywgY2FsbGJhY2spO1xuICAgIH1cbiAgfTtcbn07XG5cbnZhciBpbml0VGFzayA9IGZ1bmN0aW9uIGluaXRUYXNrKGNvcykge1xuICB2YXIgcXVldWUgPSBbXTtcbiAgdmFyIHRhc2tzID0ge307XG4gIHZhciB1cGxvYWRpbmdGaWxlQ291bnQgPSAwO1xuICB2YXIgbmV4dFVwbG9hZEluZGV4ID0gMDsgLy8g5o6l5Y+j6L+U5Zue566A55Wl55qE5Lu75Yqh5L+h5oGvXG5cbiAgdmFyIGZvcm1hdFRhc2sgPSBmdW5jdGlvbiBmb3JtYXRUYXNrKHRhc2spIHtcbiAgICB2YXIgdCA9IHtcbiAgICAgIGlkOiB0YXNrLmlkLFxuICAgICAgQnVja2V0OiB0YXNrLkJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogdGFzay5SZWdpb24sXG4gICAgICBLZXk6IHRhc2suS2V5LFxuICAgICAgRmlsZVBhdGg6IHRhc2suRmlsZVBhdGgsXG4gICAgICBzdGF0ZTogdGFzay5zdGF0ZSxcbiAgICAgIGxvYWRlZDogdGFzay5sb2FkZWQsXG4gICAgICBzaXplOiB0YXNrLnNpemUsXG4gICAgICBzcGVlZDogdGFzay5zcGVlZCxcbiAgICAgIHBlcmNlbnQ6IHRhc2sucGVyY2VudCxcbiAgICAgIGhhc2hQZXJjZW50OiB0YXNrLmhhc2hQZXJjZW50LFxuICAgICAgZXJyb3I6IHRhc2suZXJyb3JcbiAgICB9O1xuICAgIGlmICh0YXNrLkZpbGVQYXRoKSB0LkZpbGVQYXRoID0gdGFzay5GaWxlUGF0aDtcbiAgICBpZiAodGFzay5fY3VzdG9tKSB0Ll9jdXN0b20gPSB0YXNrLl9jdXN0b207IC8vIOaOp+WItuWPsOS9v+eUqFxuXG4gICAgcmV0dXJuIHQ7XG4gIH07XG5cbiAgdmFyIGVtaXRMaXN0VXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0aW1lcjtcblxuICAgIHZhciBlbWl0ID0gZnVuY3Rpb24gZW1pdCgpIHtcbiAgICAgIHRpbWVyID0gMDtcbiAgICAgIGNvcy5lbWl0KCd0YXNrLWxpc3QtdXBkYXRlJywge1xuICAgICAgICBsaXN0OiB1dGlsLm1hcChxdWV1ZSwgZm9ybWF0VGFzaylcbiAgICAgIH0pO1xuICAgICAgY29zLmVtaXQoJ2xpc3QtdXBkYXRlJywge1xuICAgICAgICBsaXN0OiB1dGlsLm1hcChxdWV1ZSwgZm9ybWF0VGFzaylcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCF0aW1lcikgdGltZXIgPSBzZXRUaW1lb3V0KGVtaXQpO1xuICAgIH07XG4gIH0oKTtcblxuICB2YXIgY2xlYXJRdWV1ZSA9IGZ1bmN0aW9uIGNsZWFyUXVldWUoKSB7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA8PSBjb3Mub3B0aW9ucy5VcGxvYWRRdWV1ZVNpemUpIHJldHVybjtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV4dFVwbG9hZEluZGV4ICYmIC8vIOWwj+S6juW9k+WJjeaTjeS9nOeahCBpbmRleCDmiY3muIXnkIZcbiAgICBpIDwgcXVldWUubGVuZ3RoICYmIC8vIOWkp+S6jumYn+WIl+aJjea4heeQhlxuICAgIHF1ZXVlLmxlbmd0aCA+IGNvcy5vcHRpb25zLlVwbG9hZFF1ZXVlU2l6ZSAvLyDlpoLmnpzov5jlpKrlpJrvvIzmiY3nu6fnu63muIXnkIZcbiAgICA7KSB7XG4gICAgICB2YXIgaXNBY3RpdmUgPSBxdWV1ZVtpXS5zdGF0ZSA9PT0gJ3dhaXRpbmcnIHx8IHF1ZXVlW2ldLnN0YXRlID09PSAnY2hlY2tpbmcnIHx8IHF1ZXVlW2ldLnN0YXRlID09PSAndXBsb2FkaW5nJztcblxuICAgICAgaWYgKCFxdWV1ZVtpXSB8fCAhaXNBY3RpdmUpIHtcbiAgICAgICAgdGFza3NbcXVldWVbaV0uaWRdICYmIGRlbGV0ZSB0YXNrc1txdWV1ZVtpXS5pZF07XG4gICAgICAgIHF1ZXVlLnNwbGljZShpLCAxKTtcbiAgICAgICAgbmV4dFVwbG9hZEluZGV4LS07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpKys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZW1pdExpc3RVcGRhdGUoKTtcbiAgfTtcblxuICB2YXIgc3RhcnROZXh0VGFzayA9IGZ1bmN0aW9uIHN0YXJ0TmV4dFRhc2soKSB7XG4gICAgLy8g5qOA5p+l5piv5ZCm5YWB6K645aKe5Yqg5omn6KGM6L+b56iLXG4gICAgaWYgKHVwbG9hZGluZ0ZpbGVDb3VudCA+PSBjb3Mub3B0aW9ucy5GaWxlUGFyYWxsZWxMaW1pdCkgcmV0dXJuOyAvLyDot7Pov4fkuI3lj6/miafooYznmoTku7vliqFcblxuICAgIHdoaWxlIChxdWV1ZVtuZXh0VXBsb2FkSW5kZXhdICYmIHF1ZXVlW25leHRVcGxvYWRJbmRleF0uc3RhdGUgIT09ICd3YWl0aW5nJykge1xuICAgICAgbmV4dFVwbG9hZEluZGV4Kys7XG4gICAgfSAvLyDmo4Dmn6XmmK/lkKblt7LpgY3ljobnu5PmnZ9cblxuXG4gICAgaWYgKG5leHRVcGxvYWRJbmRleCA+PSBxdWV1ZS5sZW5ndGgpIHJldHVybjsgLy8g5LiK5Lyg6K+l6YGN5Y6G5Yiw55qE5Lu75YqhXG5cbiAgICB2YXIgdGFzayA9IHF1ZXVlW25leHRVcGxvYWRJbmRleF07XG4gICAgbmV4dFVwbG9hZEluZGV4Kys7XG4gICAgdXBsb2FkaW5nRmlsZUNvdW50Kys7XG4gICAgdGFzay5zdGF0ZSA9ICdjaGVja2luZyc7XG4gICAgdGFzay5wYXJhbXMub25UYXNrU3RhcnQgJiYgdGFzay5wYXJhbXMub25UYXNrU3RhcnQoZm9ybWF0VGFzayh0YXNrKSk7XG4gICAgIXRhc2sucGFyYW1zLlVwbG9hZERhdGEgJiYgKHRhc2sucGFyYW1zLlVwbG9hZERhdGEgPSB7fSk7XG4gICAgdmFyIGFwaVBhcmFtcyA9IHV0aWwuZm9ybWF0UGFyYW1zKHRhc2suYXBpLCB0YXNrLnBhcmFtcyk7XG4gICAgb3JpZ2luQXBpTWFwW3Rhc2suYXBpXS5jYWxsKGNvcywgYXBpUGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4gICAgICBpZiAoIWNvcy5faXNSdW5uaW5nVGFzayh0YXNrLmlkKSkgcmV0dXJuO1xuXG4gICAgICBpZiAodGFzay5zdGF0ZSA9PT0gJ2NoZWNraW5nJyB8fCB0YXNrLnN0YXRlID09PSAndXBsb2FkaW5nJykge1xuICAgICAgICB0YXNrLnN0YXRlID0gZXJyID8gJ2Vycm9yJyA6ICdzdWNjZXNzJztcbiAgICAgICAgZXJyICYmICh0YXNrLmVycm9yID0gZXJyKTtcbiAgICAgICAgdXBsb2FkaW5nRmlsZUNvdW50LS07XG4gICAgICAgIGVtaXRMaXN0VXBkYXRlKCk7XG4gICAgICAgIHN0YXJ0TmV4dFRhc2soKTtcbiAgICAgICAgdGFzay5jYWxsYmFjayAmJiB0YXNrLmNhbGxiYWNrKGVyciwgZGF0YSk7XG5cbiAgICAgICAgaWYgKHRhc2suc3RhdGUgPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgIGlmICh0YXNrLnBhcmFtcykge1xuICAgICAgICAgICAgZGVsZXRlIHRhc2sucGFyYW1zLlVwbG9hZERhdGE7XG4gICAgICAgICAgICBkZWxldGUgdGFzay5wYXJhbXMuQm9keTtcbiAgICAgICAgICAgIGRlbGV0ZSB0YXNrLnBhcmFtcztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBkZWxldGUgdGFzay5jYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjbGVhclF1ZXVlKCk7XG4gICAgfSk7XG4gICAgZW1pdExpc3RVcGRhdGUoKTsgLy8g5byC5q2l5omn6KGM5LiL5LiA5Liq5Lu75YqhXG5cbiAgICBzZXRUaW1lb3V0KHN0YXJ0TmV4dFRhc2spO1xuICB9O1xuXG4gIHZhciBraWxsVGFzayA9IGZ1bmN0aW9uIGtpbGxUYXNrKGlkLCBzd2l0Y2hUb1N0YXRlKSB7XG4gICAgdmFyIHRhc2sgPSB0YXNrc1tpZF07XG4gICAgaWYgKCF0YXNrKSByZXR1cm47XG4gICAgdmFyIHdhaXRpbmcgPSB0YXNrICYmIHRhc2suc3RhdGUgPT09ICd3YWl0aW5nJztcbiAgICB2YXIgcnVubmluZyA9IHRhc2sgJiYgKHRhc2suc3RhdGUgPT09ICdjaGVja2luZycgfHwgdGFzay5zdGF0ZSA9PT0gJ3VwbG9hZGluZycpO1xuXG4gICAgaWYgKHN3aXRjaFRvU3RhdGUgPT09ICdjYW5jZWxlZCcgJiYgdGFzay5zdGF0ZSAhPT0gJ2NhbmNlbGVkJyB8fCBzd2l0Y2hUb1N0YXRlID09PSAncGF1c2VkJyAmJiB3YWl0aW5nIHx8IHN3aXRjaFRvU3RhdGUgPT09ICdwYXVzZWQnICYmIHJ1bm5pbmcpIHtcbiAgICAgIGlmIChzd2l0Y2hUb1N0YXRlID09PSAncGF1c2VkJyAmJiB0YXNrLnBhcmFtcy5Cb2R5ICYmIHR5cGVvZiB0YXNrLnBhcmFtcy5Cb2R5LnBpcGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignc3RyZWFtIG5vdCBzdXBwb3J0IHBhdXNlJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGFzay5zdGF0ZSA9IHN3aXRjaFRvU3RhdGU7XG4gICAgICBjb3MuZW1pdCgnaW5uZXIta2lsbC10YXNrJywge1xuICAgICAgICBUYXNrSWQ6IGlkLFxuICAgICAgICB0b1N0YXRlOiBzd2l0Y2hUb1N0YXRlXG4gICAgICB9KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIFVwbG9hZElkID0gdGFzayAmJiB0YXNrLnBhcmFtcyAmJiB0YXNrLnBhcmFtcy5VcGxvYWREYXRhLlVwbG9hZElkO1xuICAgICAgfSBjYXRjaCAoZSkge31cblxuICAgICAgaWYgKHN3aXRjaFRvU3RhdGUgPT09ICdjYW5jZWxlZCcgJiYgVXBsb2FkSWQpIHNlc3Npb24ucmVtb3ZlVXNpbmcoVXBsb2FkSWQpO1xuICAgICAgZW1pdExpc3RVcGRhdGUoKTtcblxuICAgICAgaWYgKHJ1bm5pbmcpIHtcbiAgICAgICAgdXBsb2FkaW5nRmlsZUNvdW50LS07XG4gICAgICAgIHN0YXJ0TmV4dFRhc2soKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN3aXRjaFRvU3RhdGUgPT09ICdjYW5jZWxlZCcpIHtcbiAgICAgICAgaWYgKHRhc2sucGFyYW1zKSB7XG4gICAgICAgICAgZGVsZXRlIHRhc2sucGFyYW1zLlVwbG9hZERhdGE7XG4gICAgICAgICAgZGVsZXRlIHRhc2sucGFyYW1zLkJvZHk7XG4gICAgICAgICAgZGVsZXRlIHRhc2sucGFyYW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgZGVsZXRlIHRhc2suY2FsbGJhY2s7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJRdWV1ZSgpO1xuICB9O1xuXG4gIGNvcy5fYWRkVGFza3MgPSBmdW5jdGlvbiAodGFza0xpc3QpIHtcbiAgICB1dGlsLmVhY2godGFza0xpc3QsIGZ1bmN0aW9uICh0YXNrKSB7XG4gICAgICBjb3MuX2FkZFRhc2sodGFzay5hcGksIHRhc2sucGFyYW1zLCB0YXNrLmNhbGxiYWNrLCB0cnVlKTtcbiAgICB9KTtcbiAgICBlbWl0TGlzdFVwZGF0ZSgpO1xuICB9O1xuXG4gIHZhciBpc1Rhc2tSZWFkeVdhcm5pbmcgPSB0cnVlO1xuXG4gIGNvcy5fYWRkVGFzayA9IGZ1bmN0aW9uIChhcGksIHBhcmFtcywgY2FsbGJhY2ssIGlnbm9yZUFkZEV2ZW50KSB7XG4gICAgLy8g5aSN5Yi25Y+C5pWw5a+56LGhXG4gICAgcGFyYW1zID0gdXRpbC5mb3JtYXRQYXJhbXMoYXBpLCBwYXJhbXMpOyAvLyDnlJ/miJAgaWRcblxuICAgIHZhciBpZCA9IHV0aWwudXVpZCgpO1xuICAgIHBhcmFtcy5UYXNrSWQgPSBpZDtcbiAgICBwYXJhbXMub25UYXNrUmVhZHkgJiYgcGFyYW1zLm9uVGFza1JlYWR5KGlkKTtcblxuICAgIGlmIChwYXJhbXMuVGFza1JlYWR5KSB7XG4gICAgICBwYXJhbXMuVGFza1JlYWR5KGlkKTtcbiAgICAgIGlzVGFza1JlYWR5V2FybmluZyAmJiBjb25zb2xlLndhcm4oJ3dhcm5pbmc6IFBhcmFtIFwiVGFza1JlYWR5XCIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBcIm9uVGFza1JlYWR5XCIgaW5zdGVhZC4nKTtcbiAgICAgIGlzVGFza1JlYWR5V2FybmluZyA9IGZhbHNlO1xuICAgIH1cblxuICAgIHZhciB0YXNrID0ge1xuICAgICAgLy8gZW52XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgIGFwaTogYXBpLFxuICAgICAgaW5kZXg6IHF1ZXVlLmxlbmd0aCxcbiAgICAgIC8vIHRhc2tcbiAgICAgIGlkOiBpZCxcbiAgICAgIEJ1Y2tldDogcGFyYW1zLkJ1Y2tldCxcbiAgICAgIFJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgIEtleTogcGFyYW1zLktleSxcbiAgICAgIEZpbGVQYXRoOiBwYXJhbXMuRmlsZVBhdGggfHwgJycsXG4gICAgICBzdGF0ZTogJ3dhaXRpbmcnLFxuICAgICAgbG9hZGVkOiAwLFxuICAgICAgc2l6ZTogMCxcbiAgICAgIHNwZWVkOiAwLFxuICAgICAgcGVyY2VudDogMCxcbiAgICAgIGhhc2hQZXJjZW50OiAwLFxuICAgICAgZXJyb3I6IG51bGwsXG4gICAgICBfY3VzdG9tOiBwYXJhbXMuX2N1c3RvbVxuICAgIH07XG4gICAgdmFyIG9uSGFzaFByb2dyZXNzID0gcGFyYW1zLm9uSGFzaFByb2dyZXNzO1xuXG4gICAgcGFyYW1zLm9uSGFzaFByb2dyZXNzID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIGlmICghY29zLl9pc1J1bm5pbmdUYXNrKHRhc2suaWQpKSByZXR1cm47XG4gICAgICB0YXNrLmhhc2hQZXJjZW50ID0gaW5mby5wZXJjZW50O1xuICAgICAgb25IYXNoUHJvZ3Jlc3MgJiYgb25IYXNoUHJvZ3Jlc3MoaW5mbyk7XG4gICAgICBlbWl0TGlzdFVwZGF0ZSgpO1xuICAgIH07XG5cbiAgICB2YXIgb25Qcm9ncmVzcyA9IHBhcmFtcy5vblByb2dyZXNzO1xuXG4gICAgcGFyYW1zLm9uUHJvZ3Jlc3MgPSBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgaWYgKCFjb3MuX2lzUnVubmluZ1Rhc2sodGFzay5pZCkpIHJldHVybjtcbiAgICAgIHRhc2suc3RhdGUgPT09ICdjaGVja2luZycgJiYgKHRhc2suc3RhdGUgPSAndXBsb2FkaW5nJyk7XG4gICAgICB0YXNrLmxvYWRlZCA9IGluZm8ubG9hZGVkO1xuICAgICAgdGFzay5zcGVlZCA9IGluZm8uc3BlZWQ7XG4gICAgICB0YXNrLnBlcmNlbnQgPSBpbmZvLnBlcmNlbnQ7XG4gICAgICBvblByb2dyZXNzICYmIG9uUHJvZ3Jlc3MoaW5mbyk7XG4gICAgICBlbWl0TGlzdFVwZGF0ZSgpO1xuICAgIH07IC8vIOW8guatpeiOt+WPliBmaWxlc2l6ZVxuXG5cbiAgICB1dGlsLmdldEZpbGVTaXplKGFwaSwgcGFyYW1zLCBmdW5jdGlvbiAoZXJyLCBzaXplKSB7XG4gICAgICAvLyDlvIDlp4vlpITnkIbkuIrkvKBcbiAgICAgIGlmIChlcnIpIHJldHVybiBjYWxsYmFjayh1dGlsLmVycm9yKGVycikpOyAvLyDlpoLmnpzojrflj5blpKflsI/lh7rplJnvvIzkuI3liqDlhaXpmJ/liJdcbiAgICAgIC8vIOiOt+WPluWujOaWh+S7tuWkp+Wwj+WGjeaKiuS7u+WKoeWKoOWFpemYn+WIl1xuXG4gICAgICB0YXNrc1tpZF0gPSB0YXNrO1xuICAgICAgcXVldWUucHVzaCh0YXNrKTtcbiAgICAgIHRhc2suc2l6ZSA9IHNpemU7XG4gICAgICAhaWdub3JlQWRkRXZlbnQgJiYgZW1pdExpc3RVcGRhdGUoKTtcbiAgICAgIHN0YXJ0TmV4dFRhc2soKTtcbiAgICAgIGNsZWFyUXVldWUoKTtcbiAgICB9KTtcbiAgICByZXR1cm4gaWQ7XG4gIH07XG5cbiAgY29zLl9pc1J1bm5pbmdUYXNrID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgdmFyIHRhc2sgPSB0YXNrc1tpZF07XG4gICAgcmV0dXJuICEhKHRhc2sgJiYgKHRhc2suc3RhdGUgPT09ICdjaGVja2luZycgfHwgdGFzay5zdGF0ZSA9PT0gJ3VwbG9hZGluZycpKTtcbiAgfTtcblxuICBjb3MuZ2V0VGFza0xpc3QgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHV0aWwubWFwKHF1ZXVlLCBmb3JtYXRUYXNrKTtcbiAgfTtcblxuICBjb3MuY2FuY2VsVGFzayA9IGZ1bmN0aW9uIChpZCkge1xuICAgIGtpbGxUYXNrKGlkLCAnY2FuY2VsZWQnKTtcbiAgfTtcblxuICBjb3MucGF1c2VUYXNrID0gZnVuY3Rpb24gKGlkKSB7XG4gICAga2lsbFRhc2soaWQsICdwYXVzZWQnKTtcbiAgfTtcblxuICBjb3MucmVzdGFydFRhc2sgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICB2YXIgdGFzayA9IHRhc2tzW2lkXTtcblxuICAgIGlmICh0YXNrICYmICh0YXNrLnN0YXRlID09PSAncGF1c2VkJyB8fCB0YXNrLnN0YXRlID09PSAnZXJyb3InKSkge1xuICAgICAgdGFzay5zdGF0ZSA9ICd3YWl0aW5nJztcbiAgICAgIGVtaXRMaXN0VXBkYXRlKCk7XG4gICAgICBuZXh0VXBsb2FkSW5kZXggPSBNYXRoLm1pbihuZXh0VXBsb2FkSW5kZXgsIHRhc2suaW5kZXgpO1xuICAgICAgc3RhcnROZXh0VGFzaygpO1xuICAgIH1cbiAgfTtcblxuICBjb3MuaXNVcGxvYWRSdW5uaW5nID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB1cGxvYWRpbmdGaWxlQ291bnQgfHwgbmV4dFVwbG9hZEluZGV4IDwgcXVldWUubGVuZ3RoO1xuICB9O1xufTtcblxubW9kdWxlLmV4cG9ydHMudHJhbnNmZXJUb1Rhc2tNZXRob2QgPSB0cmFuc2ZlclRvVGFza01ldGhvZDtcbm1vZHVsZS5leHBvcnRzLmluaXQgPSBpbml0VGFzaztcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvdHJhY2tlci5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vc3JjL3RyYWNrZXIuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG52YXIgX2NsYXNzQ2FsbENoZWNrID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jbGFzc0NhbGxDaGVjayAqLyBcIi4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvY2xhc3NDYWxsQ2hlY2suanNcIik7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAYmFiZWwvcnVudGltZS9oZWxwZXJzL2NyZWF0ZUNsYXNzICovIFwiLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcy5qc1wiKTtcblxudmFyIF90eXBlb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISBAYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZiAqLyBcIi4vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzXCIpO1xuXG52YXIgcGtnID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgLi4vcGFja2FnZS5qc29uICovIFwiLi9wYWNrYWdlLmpzb25cIik7XG5cbnZhciBiZWFjb24gPSBudWxsO1xuXG52YXIgZ2V0QmVhY29uID0gZnVuY3Rpb24gZ2V0QmVhY29uKGRlbGF5KSB7XG4gIGlmICghYmVhY29uKSB7XG4gICAgLy8g5LiN5pS+5Zyo6aG25bGC5piv6YG/5YWN6aaW5qyh5byV5YWl5bCx6KKr5Yqg6L2977yM5LuO6ICM6YG/5YWN5Zyo5p+Q5Lqb546v5aKD5q+U5aaCd2Vid29ya2Vy6YeM5Yqg6L2954Gv5aGUc2Rr5YaFd2luZG9355u45YWz5a+56LGh5oql6ZSZXG4gICAgdmFyIEJlYWNvbkFjdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL2xpYi9iZWFjb24ubWluICovIFwiLi9saWIvYmVhY29uLm1pbi5qc1wiKTtcblxuICAgIGJlYWNvbiA9IG5ldyBCZWFjb25BY3Rpb24oe1xuICAgICAgYXBwa2V5OiBcIjBBTkQwVkVWQjI0VUJHRFVcIixcbiAgICAgIHZlcnNpb25Db2RlOiBwa2cudmVyc2lvbixcbiAgICAgIGNoYW5uZWxJRDogJ2pzX3NkaycsXG4gICAgICAvL+a4oOmBkyzpgInloatcbiAgICAgIG9wZW5pZDogJ29wZW5pZCcsXG4gICAgICAvLyDnlKjmiLdpZCwg6YCJ5aGrXG4gICAgICB1bmlvbmlkOiAndW5pZCcsXG4gICAgICAvL+eUqOaIt3VuaW9uaWQgLCDnsbvkvLxpZGZ2LOmAieWhq1xuICAgICAgc3RyaWN0TW9kZTogZmFsc2UsXG4gICAgICAvL+S4peiLm+aooeW8j+W8gOWFsywg5omT5byA5Lil6Iub5qih5byP5Lya5Li75Yqo5oqb5Ye65byC5bi4LCDkuIrnur/or7fliqHlv4XlhbPpl60hISFcbiAgICAgIGRlbGF5OiBkZWxheSxcbiAgICAgIC8vIOaZrumAmuS6i+S7tuW7tui/n+S4iuaKpeaXtumXtCjljZXkvY3mr6vnp5IpLCDpu5jorqQxMDAwKDHnp5IpLOmAieWhq1xuICAgICAgc2Vzc2lvbkR1cmF0aW9uOiA2MCAqIDEwMDAgLy8gc2Vzc2lvbuWPmOabtOeahOaXtumXtOmXtOmalCwg5LiA5Liq55So5oi35oyB57utMzDliIbpkp8o6buY6K6k5YC8KeayoeacieS7u+S9leS4iuaKpeWImeeul+WPpuS4gOasoSBzZXNzaW9uLOavj+WPmOabtOS4gOasoXNlc3Npb27kuIrmiqXkuIDmrKHlkK/liqjkuovku7YocnFkX2FwcGxhdW5jaGVkKSzkvb/nlKjmr6vnp5IobXMpLOacgOWwj+WAvDMw56eSLOmAieWhq1xuXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gYmVhY29uO1xufTtcblxudmFyIHV0aWxzID0ge1xuICAvLyDnlJ/miJB1aWQg5q+P5Liq6ZO+6Lev5a+55bqU5ZSv5LiA5LiA5p2hdWlkXG4gIGdldFVpZDogZnVuY3Rpb24gZ2V0VWlkKCkge1xuICAgIHZhciBTNCA9IGZ1bmN0aW9uIFM0KCkge1xuICAgICAgcmV0dXJuICgoMSArIE1hdGgucmFuZG9tKCkpICogMHgxMDAwMCB8IDApLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTNCgpICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFM0KCkgKyBTNCgpO1xuICB9LFxuICAvLyDojrflj5bnvZHnu5znsbvlnotcbiAgZ2V0TmV0VHlwZTogZnVuY3Rpb24gZ2V0TmV0VHlwZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHZhciBjb25uZWN0aW9uID0gbmF2aWdhdG9yLmNvbm5lY3Rpb24gfHwgbmF2aWdhdG9yLm1vekNvbm5lY3Rpb24gfHwgbmF2aWdhdG9yLndlYmtpdENvbm5lY3Rpb247XG4gICAgICByZXR1cm4gKGNvbm5lY3Rpb24gPT09IG51bGwgfHwgY29ubmVjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29ubmVjdGlvbi50eXBlKSB8fCAoY29ubmVjdGlvbiA9PT0gbnVsbCB8fCBjb25uZWN0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25uZWN0aW9uLmVmZmVjdGl2ZVR5cGUpIHx8ICd1bmtub3duJztcbiAgICB9XG5cbiAgICByZXR1cm4gJ3Vua25vd24nO1xuICB9LFxuICAvLyDojrflj5ZwY+err+aTjeS9nOezu+e7n+exu+Wei1xuICBnZXRPc1R5cGU6IGZ1bmN0aW9uIGdldE9zVHlwZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiAndW5rbm93biBvcyc7XG4gICAgfVxuXG4gICAgdmFyIGFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBpc01hYyA9IC9tYWNpbnRvc2h8bWFjIG9zIHgvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuXG4gICAgaWYgKGFnZW50LmluZGV4T2YoXCJ3aW4zMlwiKSA+PSAwIHx8IGFnZW50LmluZGV4T2YoXCJ3b3czMlwiKSA+PSAwKSB7XG4gICAgICByZXR1cm4gJ3dpbjMyJztcbiAgICB9XG5cbiAgICBpZiAoYWdlbnQuaW5kZXhPZihcIndpbjY0XCIpID49IDAgfHwgYWdlbnQuaW5kZXhPZihcIndvdzY0XCIpID49IDApIHtcbiAgICAgIHJldHVybiAnd2luNjQnO1xuICAgIH1cblxuICAgIGlmIChpc01hYykge1xuICAgICAgcmV0dXJuICdtYWMnO1xuICAgIH1cblxuICAgIHJldHVybiAndW5rbm93biBvcyc7XG4gIH0sXG4gIGlzTW9iaWxlOiBmdW5jdGlvbiBpc01vYmlsZSgpIHtcbiAgICB2YXIgZXhwID0gLyhwaG9uZXxwYWR8cG9kfGlQaG9uZXxpUG9kfGlvc3xpUGFkfEFuZHJvaWR8TW9iaWxlfEJsYWNrQmVycnl8SUVNb2JpbGV8TVFRQnJvd3NlcnxKVUN8RmVubmVjfHdPU0Jyb3dzZXJ8QnJvd3Nlck5HfFdlYk9TfFN5bWJpYW58V2luZG93cyBQaG9uZSkvaTtcblxuICAgIGlmICgodHlwZW9mIG5hdmlnYXRvciA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG5hdmlnYXRvcikpID09PSAnb2JqZWN0JyAmJiBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKGV4cCkpIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyDnp7vliqjnq69cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIFBD56uvXG4gIH0sXG4gIGlzQW5kcm9pZDogZnVuY3Rpb24gaXNBbmRyb2lkKCkge1xuICAgIHZhciBleHAgPSAvKEFuZHJvaWR8QWRyfExpbnV4KS9pO1xuXG4gICAgaWYgKCh0eXBlb2YgbmF2aWdhdG9yID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YobmF2aWdhdG9yKSkgPT09ICdvYmplY3QnICYmIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goZXhwKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBpc0lPUzogZnVuY3Rpb24gaXNJT1MoKSB7XG4gICAgdmFyIGV4cCA9IC8oaVBob25lfGlQb2R8aVBhZHxpT1MpL2k7XG5cbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSA9PT0gJ29iamVjdCcgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaChleHApKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlzT3RoZXJNb2JpbGU6IGZ1bmN0aW9uIGlzT3RoZXJNb2JpbGUoKSB7XG4gICAgcmV0dXJuIGlzTW9iaWxlICYmICFpc0FuZHJvaWQgJiYgIWlzSU9TO1xuICB9LFxuICAvLyDojrflj5bmtY/op4jlmajnsbvlnotcbiAgZ2V0RGV2aWNlTmFtZTogZnVuY3Rpb24gZ2V0RGV2aWNlTmFtZSgpIHtcbiAgICBpZiAoKHR5cGVvZiBuYXZpZ2F0b3IgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZihuYXZpZ2F0b3IpKSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiAndW5rbm93biBkZXZpY2UnO1xuICAgIH1cblxuICAgIHZhciBleHBsb3JlciA9IG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsgLy8g6IW+6K6v5Lya6K6u5YaF572u5rWP6KeI5ZmoXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5jbHVkZXMoJ2FwcC90ZW5jZW50X3dlbWVldCcpKSB7XG4gICAgICByZXR1cm4gJ3RlbmNlbnRfd2VtZWV0JztcbiAgICB9IC8vIOmBqOa4uOa1j+iniOWZqFxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZignbWF4dGhvbicpID49IDApIHtcbiAgICAgIHZhciBtYXRjaCA9IGV4cGxvcmVyLm1hdGNoKC9tYXh0aG9uXFwvKFtcXGQuXSspLyk7XG4gICAgICB2YXIgdmVyID0gbWF0Y2ggJiYgbWF0Y2hbMV0gfHwgJyc7XG4gICAgICByZXR1cm4gXCJcXHU1MEIyXFx1NkUzOFxcdTZENEZcXHU4OUM4XFx1NTY2OCBcIi5jb25jYXQodmVyKS50cmltKCk7XG4gICAgfSAvLyBRUea1j+iniOWZqFxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZigncXFicm93c2VyJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaCA9IGV4cGxvcmVyLm1hdGNoKC9xcWJyb3dzZXJcXC8oW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXIgPSBfbWF0Y2ggJiYgX21hdGNoWzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJRUVxcdTZENEZcXHU4OUM4XFx1NTY2OCBcIi5jb25jYXQoX3ZlcikudHJpbSgpO1xuICAgIH0gLy8g5pCc54uX5rWP6KeI5ZmoXG5cblxuICAgIGlmIChleHBsb3Jlci5pbmRleE9mKCdzZSAyLngnKSA+PSAwKSB7XG4gICAgICByZXR1cm4gJ+aQnOeLl+a1j+iniOWZqCc7XG4gICAgfSAvLyDlvq7kv6HmtY/op4jlmahcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ3d4d29yaycpID49IDApIHtcbiAgICAgIHJldHVybiAn5b6u5L+h5YaF572u5rWP6KeI5ZmoJztcbiAgICB9IC8vIGllXG5cblxuICAgIGlmIChleHBsb3Jlci5pbmRleE9mKCdtc2llJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDIgPSBleHBsb3Jlci5tYXRjaCgvbXNpZSAoW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXIyID0gX21hdGNoMiAmJiBfbWF0Y2gyWzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJJRSBcIi5jb25jYXQoX3ZlcjIpLnRyaW0oKTtcbiAgICB9IC8vIGZpcmVmb3hcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ2ZpcmVmb3gnKSA+PSAwKSB7XG4gICAgICB2YXIgX21hdGNoMyA9IGV4cGxvcmVyLm1hdGNoKC9maXJlZm94XFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyMyA9IF9tYXRjaDMgJiYgX21hdGNoM1sxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiRmlyZWZveCBcIi5jb25jYXQoX3ZlcjMpLnRyaW0oKTtcbiAgICB9IC8vIENocm9tZVxuXG5cbiAgICBpZiAoZXhwbG9yZXIuaW5kZXhPZignY2hyb21lJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDQgPSBleHBsb3Jlci5tYXRjaCgvY2hyb21lXFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNCA9IF9tYXRjaDQgJiYgX21hdGNoNFsxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiQ2hyb21lIFwiLmNvbmNhdChfdmVyNCkudHJpbSgpO1xuICAgIH0gLy8gT3BlcmFcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ29wZXJhJykgPj0gMCkge1xuICAgICAgdmFyIF9tYXRjaDUgPSBleHBsb3Jlci5tYXRjaCgvb3BlcmEuKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNSA9IF9tYXRjaDUgJiYgX21hdGNoNVsxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiT3BlcmEgXCIuY29uY2F0KF92ZXI1KS50cmltKCk7XG4gICAgfSAvLyBTYWZhcmlcblxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ3NhZmFyaScpID49IDApIHtcbiAgICAgIHZhciBfbWF0Y2g2ID0gZXhwbG9yZXIubWF0Y2goL3ZlcnNpb25cXC8oW1xcZC5dKykvKTtcblxuICAgICAgdmFyIF92ZXI2ID0gX21hdGNoNiAmJiBfbWF0Y2g2WzFdIHx8ICcnO1xuXG4gICAgICByZXR1cm4gXCJTYWZhcmkgXCIuY29uY2F0KF92ZXI2KS50cmltKCk7XG4gICAgfVxuXG4gICAgaWYgKGV4cGxvcmVyLmluZGV4T2YoJ2VkZ2UnKSA+PSAwKSB7XG4gICAgICB2YXIgX21hdGNoNyA9IGV4cGxvcmVyLm1hdGNoKC9lZGdlXFwvKFtcXGQuXSspLyk7XG5cbiAgICAgIHZhciBfdmVyNyA9IF9tYXRjaDcgJiYgX21hdGNoN1sxXSB8fCAnJztcblxuICAgICAgcmV0dXJuIFwiZWRnZSBcIi5jb25jYXQoX3ZlcjcpLnRyaW0oKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXhwbG9yZXIuc3Vic3RyKDAsIDIwMCk7XG4gIH1cbn07XG52YXIgY29uc3RhbnQgPSB7XG4gIGlzTW9iaWxlOiB1dGlscy5pc01vYmlsZSgpLFxuICBpc0Jyb3dzZXI6ICF1dGlscy5pc01vYmlsZSgpLFxuICBtb2JpbGVPc1R5cGU6IHV0aWxzLmlzQW5kcm9pZCgpID8gJ2FuZHJvaWQnIDogdXRpbHMuaXNJT1MgPyAnaW9zJyA6ICdvdGhlcl9tb2JpbGUnLFxuICBwY09zVHlwZTogdXRpbHMuZ2V0T3NUeXBlKClcbn07IC8vIOiuvuWkh+S/oeaBr++8jOWPquWPluS4gOasoeWAvFxuXG52YXIgZGV2aWNlSW5mbyA9IHtcbiAgLy8g4oaT5LiK5oql6aG5XG4gIGRldmljZVR5cGU6IGNvbnN0YW50LmlzTW9iaWxlID8gJ21vYmlsZScgOiBjb25zdGFudC5pc0Jyb3dzZXIgPyAnYnJvd3NlcicgOiAndW5rbm93bicsXG4gIGRldmljZVBsYXRmb3JtOiBjb25zdGFudC5pc01vYmlsZSA/IGNvbnN0YW50Lm1vYmlsZU9zVHlwZSA6IGNvbnN0YW50LnBjT3NUeXBlLFxuICBkZXZpY2VOYW1lOiB1dGlscy5nZXREZXZpY2VOYW1lKCkgLy/mtY/op4jlmajlkI3np7BcblxufTsgLy8g5YiG5Z2X5LiK5Lyg5Y6f5a2Q5pa55rOVXG5cbnZhciBzbGljZVVwbG9hZE1ldGhvZHMgPSBbJ211bHRpcGFydEluaXQnLCAnbXVsdGlwYXJ0VXBsb2FkJywgJ211bHRpcGFydENvbXBsZXRlJywgJ211bHRpcGFydExpc3QnLCAnbXVsdGlwYXJ0TGlzdFBhcnQnLCAnbXVsdGlwYXJ0QWJvcnQnXTtcbnZhciB1cGxvYWRBcGkgPSBbJ3B1dE9iamVjdCcsICdwb3N0T2JqZWN0JywgJ2FwcGVuZE9iamVjdCcsICdzbGljZVVwbG9hZEZpbGUnLCAndXBsb2FkRmlsZScsICd1cGxvYWRGaWxlcyddLmNvbmNhdChzbGljZVVwbG9hZE1ldGhvZHMpO1xudmFyIGRvd25sb2FkQXBpID0gWydnZXRPYmplY3QnXTtcblxuZnVuY3Rpb24gZ2V0RXZlbnRDb2RlKGFwaU5hbWUpIHtcbiAgaWYgKHVwbG9hZEFwaS5pbmNsdWRlcyhhcGlOYW1lKSkge1xuICAgIHJldHVybiAnY29zX3VwbG9hZCc7XG4gIH1cblxuICBpZiAoZG93bmxvYWRBcGkuaW5jbHVkZXMoYXBpTmFtZSkpIHtcbiAgICByZXR1cm4gJ2Nvc19kb3dubG9hZCc7XG4gIH1cblxuICByZXR1cm4gJ2Jhc2Vfc2VydmljZSc7XG59IC8vIOS4iuaKpeWPguaVsOmpvOWzsOaUueS4i+WIkue6v1xuXG5cbmZ1bmN0aW9uIGNhbWVsMnVuZGVybGluZShrZXkpIHtcbiAgcmV0dXJuIGtleS5yZXBsYWNlKC8oW0EtWl0pL2csIFwiXyQxXCIpLnRvTG93ZXJDYXNlKCk7XG59XG5cbmZ1bmN0aW9uIGZvcm1hdFBhcmFtcyhwYXJhbXMpIHtcbiAgdmFyIGZvcm1hdHRlZFBhcmFtcyA9IHt9O1xuICB2YXIgYWxsUmVwb3J0ZXJLZXlzID0gWyd0cmFjZVBsYXRmb3JtJywgJ2Nvc3Nka1ZlcnNpb24nLCAncmVnaW9uJywgJ25ldHdvcmtUeXBlJywgJ2hvc3QnLCAnYWNjZWxlcmF0ZScsICdyZXF1ZXN0UGF0aCcsICdzaXplJywgJ2h0dHBNZDUnLCAnaHR0cFNpZ24nLCAnaHR0cEZ1bGwnLCAnbmFtZScsICdyZXN1bHQnLCAndG9va1RpbWUnLCAnZXJyb3JOb2RlJywgJ2Vycm9yQ29kZScsICdlcnJvck1lc3NhZ2UnLCAnZXJyb3JSZXF1ZXN0SWQnLCAnZXJyb3JTdGF0dXNDb2RlJywgJ2Vycm9yU2VydmljZU5hbWUnLCAnZXJyb3JUeXBlJywgJ3RyYWNlSWQnLCAnYnVja2V0JywgJ2FwcGlkJywgJ3BhcnROdW1iZXInLCAncmV0cnlUaW1lcycsICdyZXFVcmwnLCAnY3VzdG9tSWQnLCAnZnVsbEVycm9yJywgJ2RldmljZVR5cGUnLCAnZGV2aWNlUGxhdGZvcm0nLCAnZGV2aWNlTmFtZSddO1xuICB2YXIgc3VjY2Vzc0tleXMgPSBbJ3RyYWNlUGxhdGZvcm0nLCAnY29zc2RrVmVyc2lvbicsICdyZWdpb24nLCAnYnVja2V0JywgJ2FwcGlkJywgJ25ldHdvcmtUeXBlJywgJ2hvc3QnLCAnYWNjZWxlcmF0ZScsICdyZXF1ZXN0UGF0aCcsICdwYXJ0TnVtYmVyJywgJ3NpemUnLCAnbmFtZScsICdyZXN1bHQnLCAndG9va1RpbWUnLCAnZXJyb3JSZXF1ZXN0SWQnLCAncmV0cnlUaW1lcycsICdyZXFVcmwnLCAnY3VzdG9tSWQnLCAnZGV2aWNlVHlwZScsICdkZXZpY2VQbGF0Zm9ybScsICdkZXZpY2VOYW1lJ107IC8vIOmcgOimgeS4iuaKpeeahOWPguaVsOWtl+autVxuXG4gIHZhciByZXBvcnRlcktleXMgPSBwYXJhbXMucmVzdWx0ID09PSAnU3VjY2VzcycgPyBzdWNjZXNzS2V5cyA6IGFsbFJlcG9ydGVyS2V5cztcblxuICBmb3IgKHZhciBrZXkgaW4gcGFyYW1zKSB7XG4gICAgaWYgKCFyZXBvcnRlcktleXMuaW5jbHVkZXMoa2V5KSkgY29udGludWU7XG4gICAgdmFyIGZvcm1hdHRlZEtleSA9IGNhbWVsMnVuZGVybGluZShrZXkpO1xuICAgIGZvcm1hdHRlZFBhcmFtc1tmb3JtYXR0ZWRLZXldID0gcGFyYW1zW2tleV07XG4gIH1cblxuICByZXR1cm4gZm9ybWF0dGVkUGFyYW1zO1xufSAvLyDpk77ot6/ov73ouKrlmahcblxuXG52YXIgVHJhY2tlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGZ1bmN0aW9uIFRyYWNrZXIob3B0KSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFRyYWNrZXIpO1xuXG4gICAgdmFyIHBhcmVudCA9IG9wdC5wYXJlbnQsXG4gICAgICAgIHRyYWNlSWQgPSBvcHQudHJhY2VJZCxcbiAgICAgICAgYnVja2V0ID0gb3B0LmJ1Y2tldCxcbiAgICAgICAgcmVnaW9uID0gb3B0LnJlZ2lvbixcbiAgICAgICAgYXBpTmFtZSA9IG9wdC5hcGlOYW1lLFxuICAgICAgICBmaWxlS2V5ID0gb3B0LmZpbGVLZXksXG4gICAgICAgIGZpbGVTaXplID0gb3B0LmZpbGVTaXplLFxuICAgICAgICBhY2NlbGVyYXRlID0gb3B0LmFjY2VsZXJhdGUsXG4gICAgICAgIGN1c3RvbUlkID0gb3B0LmN1c3RvbUlkLFxuICAgICAgICBkZWxheSA9IG9wdC5kZWxheSxcbiAgICAgICAgZGVlcFRyYWNrZXIgPSBvcHQuZGVlcFRyYWNrZXI7XG4gICAgdmFyIGFwcGlkID0gYnVja2V0ICYmIGJ1Y2tldC5zdWJzdHIoYnVja2V0Lmxhc3RJbmRleE9mKCctJykgKyAxKSB8fCAnJztcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmRlZXBUcmFja2VyID0gZGVlcFRyYWNrZXI7XG4gICAgdGhpcy5kZWxheSA9IGRlbGF5OyAvLyDkuIrmiqXnlKjliLDnmoTlrZfmrrVcblxuICAgIHRoaXMucGFyYW1zID0ge1xuICAgICAgLy8g6YCa55So5a2X5q61XG4gICAgICBjb3NzZGtWZXJzaW9uOiBwa2cudmVyc2lvbixcbiAgICAgIHJlZ2lvbjogcmVnaW9uLFxuICAgICAgbmV0d29ya1R5cGU6ICcnLFxuICAgICAgaG9zdDogJycsXG4gICAgICBhY2NlbGVyYXRlOiBhY2NlbGVyYXRlID8gJ1knIDogJ04nLFxuICAgICAgcmVxdWVzdFBhdGg6IGZpbGVLZXkgfHwgJycsXG4gICAgICBzaXplOiBmaWxlU2l6ZSB8fCAtMSxcbiAgICAgIGh0dHBNZDU6IDAsXG4gICAgICAvLyBNRDXogJfml7ZcbiAgICAgIGh0dHBTaWduOiAwLFxuICAgICAgLy8g6K6h566X562+5ZCN6ICX5pe2XG4gICAgICBodHRwRnVsbDogMCxcbiAgICAgIC8vIGh0dHDor7fmsYLogJfml7ZcbiAgICAgIG5hbWU6IGFwaU5hbWUgfHwgJycsXG4gICAgICByZXN1bHQ6ICcnLFxuICAgICAgLy8gc2RrIGFwaeiwg+eUqOe7k+aenFN1Y2Nlc3PjgIFGYWlsXG4gICAgICB0b29rVGltZTogMCxcbiAgICAgIC8vIOaAu+iAl+aXtlxuICAgICAgZXJyb3JOb2RlOiAnJyxcbiAgICAgIGVycm9yQ29kZTogJycsXG4gICAgICBlcnJvck1lc3NhZ2U6ICcnLFxuICAgICAgZXJyb3JSZXF1ZXN0SWQ6ICcnLFxuICAgICAgZXJyb3JTdGF0dXNDb2RlOiAwLFxuICAgICAgZXJyb3JTZXJ2aWNlTmFtZTogJycsXG4gICAgICAvLyBqc+ihpeWFheWtl+autVxuICAgICAgdHJhY2VQbGF0Zm9ybTogJ2Nvcy1qcy1zZGstdjUnLFxuICAgICAgLy8g5LiK5oql5bmz5Y+wPWpzXG4gICAgICB0cmFjZUlkOiB0cmFjZUlkIHx8IHV0aWxzLmdldFVpZCgpLFxuICAgICAgLy8g5q+P5p2h5LiK5oql5ZSv5LiA5qCH6K+GXG4gICAgICBidWNrZXQ6IGJ1Y2tldCxcbiAgICAgIGFwcGlkOiBhcHBpZCxcbiAgICAgIHBhcnROdW1iZXI6IDAsXG4gICAgICAvLyDliIblnZfkuIrkvKDnvJblj7dcbiAgICAgIHJldHJ5VGltZXM6IDAsXG4gICAgICAvLyBzZGvlhoXpg6jlj5HotbfnmoTor7fmsYLph43or5VcbiAgICAgIHJlcVVybDogJycsXG4gICAgICAvLyDor7fmsYJ1cmxcbiAgICAgIGN1c3RvbUlkOiBjdXN0b21JZCB8fCAnJyxcbiAgICAgIC8vIOS4muWKoWlkXG4gICAgICBkZXZpY2VUeXBlOiBkZXZpY2VJbmZvLmRldmljZVR5cGUsXG4gICAgICAvLyDorr7lpIfnsbvlnosg56e75Yqo56uv5rWP6KeI5Zmo44CBd2Vi5rWP6KeI5ZmoXG4gICAgICBkZXZpY2VQbGF0Zm9ybTogZGV2aWNlSW5mby5kZXZpY2VQbGF0Zm9ybSxcbiAgICAgIGRldmljZU5hbWU6IGRldmljZUluZm8uZGV2aWNlTmFtZSxcbiAgICAgIG1kNVN0YXJ0VGltZTogMCxcbiAgICAgIC8vIG1kNeiuoeeul+W8gOWni+aXtumXtFxuICAgICAgbWQ1RW5kVGltZTogMCxcbiAgICAgIC8vIG1kNeiuoeeul+e7k+adn+aXtumXtFxuICAgICAgc2lnblN0YXJ0VGltZTogMCxcbiAgICAgIC8vIOiuoeeul+etvuWQjeW8gOWni+aXtumXtFxuICAgICAgc2lnbkVuZFRpbWU6IDAsXG4gICAgICAvLyDorqHnrpfnrb7lkI3nu5PmnZ/ml7bpl7RcbiAgICAgIGh0dHBTdGFydFRpbWU6IDAsXG4gICAgICAvLyDlj5HotbfnvZHnu5zor7fmsYLlvIDlp4vml7bpl7RcbiAgICAgIGh0dHBFbmRUaW1lOiAwLFxuICAgICAgLy8g572R6Lev6K+35rGC57uT5p2f5pe26Ze0XG4gICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgICAgLy8gc2RrIGFwaeiwg+eUqOi1t+Wni+aXtumXtO+8jOS4jeaYr+e6r+e9kee7nOiAl+aXtlxuICAgICAgZW5kVGltZTogMCAvLyAgc2RrIGFwaeiwg+eUqOe7k+adn+aXtumXtO+8jOS4jeaYr+e6r+e9kee7nOiAl+aXtlxuXG4gICAgfTtcbiAgICB0aGlzLmJlYWNvbiA9IGdldEJlYWNvbihkZWxheSk7XG4gIH0gLy8g5qC85byP5YyWc2Rr5Zue6LCDXG5cblxuICBfY3JlYXRlQ2xhc3MoVHJhY2tlciwgW3tcbiAgICBrZXk6IFwiZm9ybWF0UmVzdWx0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFJlc3VsdChlcnIsIGRhdGEpIHtcbiAgICAgIHZhciBfZXJyJGVycm9yLCBfZXJyJGVycm9yMiwgX2VyciRlcnJvcjMsIF9lcnIkZXJyb3I0LCBfZXJyJGVycm9yNSwgX2VyciRlcnJvcjY7XG5cbiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIHZhciB0b29rVGltZSA9IG5vdyAtIHRoaXMucGFyYW1zLnN0YXJ0VGltZTtcbiAgICAgIHZhciBuZXR3b3JrVHlwZSA9IHV0aWxzLmdldE5ldFR5cGUoKTtcbiAgICAgIHZhciBlcnJvckNvZGUgPSBlcnIgPyAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLmNvZGUpIHx8IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2VyciRlcnJvciA9IGVyci5lcnJvcikgPT09IG51bGwgfHwgX2VyciRlcnJvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VyciRlcnJvci5jb2RlKSB8fCAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnIkZXJyb3IyID0gZXJyLmVycm9yKSA9PT0gbnVsbCB8fCBfZXJyJGVycm9yMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VyciRlcnJvcjIuQ29kZSkgOiAnJztcbiAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBlcnIgPyAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLm1lc3NhZ2UpIHx8IChlcnIgPT09IG51bGwgfHwgZXJyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2VyciRlcnJvcjMgPSBlcnIuZXJyb3IpID09PSBudWxsIHx8IF9lcnIkZXJyb3IzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyJGVycm9yMy5tZXNzYWdlKSB8fCAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnIkZXJyb3I0ID0gZXJyLmVycm9yKSA9PT0gbnVsbCB8fCBfZXJyJGVycm9yNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VyciRlcnJvcjQuTWVzc2FnZSkgOiAnJztcbiAgICAgIHZhciBlcnJvclNlcnZpY2VOYW1lID0gZXJyID8gKGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVyci5yZXNvdXJjZSkgfHwgKGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZXJyJGVycm9yNSA9IGVyci5lcnJvcikgPT09IG51bGwgfHwgX2VyciRlcnJvcjUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnIkZXJyb3I1LnJlc291cmNlKSB8fCAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnIkZXJyb3I2ID0gZXJyLmVycm9yKSA9PT0gbnVsbCB8fCBfZXJyJGVycm9yNiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2VyciRlcnJvcjYuUmVzb3VyY2UpIDogJyc7XG4gICAgICB2YXIgZXJyb3JTdGF0dXNDb2RlID0gZXJyID8gZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLnN0YXR1c0NvZGUgOiBkYXRhLnN0YXR1c0NvZGU7XG4gICAgICB2YXIgcmVxdWVzdElkID0gZXJyID8gKGVyciA9PT0gbnVsbCB8fCBlcnIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVyci5oZWFkZXJzKSAmJiAoZXJyID09PSBudWxsIHx8IGVyciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZXJyLmhlYWRlcnNbJ3gtY29zLXJlcXVlc3QtaWQnXSkgOiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkYXRhLmhlYWRlcnMpICYmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRhdGEuaGVhZGVyc1sneC1jb3MtcmVxdWVzdC1pZCddKTtcbiAgICAgIHZhciBlcnJvclR5cGUgPSBlcnIgPyByZXF1ZXN0SWQgPyAnU2VydmVyJyA6ICdDbGllbnQnIDogJyc7XG4gICAgICBPYmplY3QuYXNzaWduKHRoaXMucGFyYW1zLCB7XG4gICAgICAgIHRvb2tUaW1lOiB0b29rVGltZSxcbiAgICAgICAgbmV0d29ya1R5cGU6IG5ldHdvcmtUeXBlLFxuICAgICAgICBodHRwTWQ1OiB0aGlzLnBhcmFtcy5tZDVFbmRUaW1lIC0gdGhpcy5wYXJhbXMubWQ1U3RhcnRUaW1lLFxuICAgICAgICBodHRwU2lnbjogdGhpcy5wYXJhbXMuc2lnbkVuZFRpbWUgLSB0aGlzLnBhcmFtcy5zaWduU3RhcnRUaW1lLFxuICAgICAgICBodHRwRnVsbDogdGhpcy5wYXJhbXMuaHR0cEVuZFRpbWUgLSB0aGlzLnBhcmFtcy5odHRwU3RhcnRUaW1lLFxuICAgICAgICByZXN1bHQ6IGVyciA/ICdGYWlsJyA6ICdTdWNjZXNzJyxcbiAgICAgICAgZXJyb3JUeXBlOiBlcnJvclR5cGUsXG4gICAgICAgIGVycm9yQ29kZTogZXJyb3JDb2RlLFxuICAgICAgICBlcnJvclN0YXR1c0NvZGU6IGVycm9yU3RhdHVzQ29kZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgIGVycm9yU2VydmljZU5hbWU6IGVycm9yU2VydmljZU5hbWUsXG4gICAgICAgIGVycm9yUmVxdWVzdElkOiByZXF1ZXN0SWRcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXJyICYmICghZXJyb3JDb2RlIHx8ICFlcnJvck1lc3NhZ2UpKSB7XG4gICAgICAgIC8vIOaaguWtmOWFqOmHj2VycuS4gOauteaXtumXtCDop4Llr5/mmK/lkKbmiYDmnIllcnLmoLzlvI/pg73lj6/ooqvop6PmnpBcbiAgICAgICAgdGhpcy5wYXJhbXMuZnVsbEVycm9yID0gZXJyID8gSlNPTi5zdHJpbmdpZnkoZXJyKSA6ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5wYXJhbXMubmFtZSA9PT0gJ2dldE9iamVjdCcpIHtcbiAgICAgICAgdGhpcy5wYXJhbXMuc2l6ZSA9IGRhdGEgPyBkYXRhLmhlYWRlcnMgJiYgZGF0YS5oZWFkZXJzWydjb250ZW50LWxlbmd0aCddIDogLTE7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnBhcmFtcy5yZXFVcmwpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgZXhlY1JlcyA9IC9eaHR0cChzKT86XFwvXFwvKC4qPylcXC8vLmV4ZWModGhpcy5wYXJhbXMucmVxVXJsKTtcbiAgICAgICAgICB0aGlzLnBhcmFtcy5ob3N0ID0gZXhlY1Jlc1syXTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHRoaXMucGFyYW1zLmhvc3QgPSB0aGlzLnBhcmFtcy5yZXFVcmw7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5zZW5kRXZlbnRzKCk7XG4gICAgfSAvLyDorr7nva7lvZPliY3pk77ot6/nmoTlj4LmlbBcblxuICB9LCB7XG4gICAga2V5OiBcInNldFBhcmFtc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQYXJhbXMocGFyYW1zKSB7XG4gICAgICBPYmplY3QuYXNzaWduKHRoaXMucGFyYW1zLCBwYXJhbXMpO1xuICAgIH0gLy8g5L2/55So54Gv5aGU5bu25pe25LiK5oqlXG5cbiAgfSwge1xuICAgIGtleTogXCJzZW5kRXZlbnRzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRFdmVudHMoKSB7XG4gICAgICAvLyBEZWVwVHJhY2tlcuaooeW8j+S4i+aJjeS8muS4iuaKpeWIhuWdl+S4iuS8oOWGhemDqOe7huiKglxuICAgICAgaWYgKHNsaWNlVXBsb2FkTWV0aG9kcy5pbmNsdWRlcyh0aGlzLnBhcmFtcy5uYW1lKSAmJiAhdGhpcy5kZWVwVHJhY2tlcikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBldmVudENvZGUgPSBnZXRFdmVudENvZGUodGhpcy5wYXJhbXMubmFtZSk7XG4gICAgICB2YXIgZm9ybWF0dGVkUGFyYW1zID0gZm9ybWF0UGFyYW1zKHRoaXMucGFyYW1zKTsgLy8g5YWc5bqV5aSE55CGXG5cbiAgICAgIGlmICghdGhpcy5iZWFjb24pIHtcbiAgICAgICAgdGhpcy5iZWFjb24gPSBnZXRCZWFjb24odGhpcy5kZWxheSB8fCA1MDAwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuZGVsYXkgPT09IDApIHtcbiAgICAgICAgLy8g5a6e5pe25LiK5oqlXG4gICAgICAgIHRoaXMuYmVhY29uICYmIHRoaXMuYmVhY29uLm9uRGlyZWN0VXNlckFjdGlvbihldmVudENvZGUsIGZvcm1hdHRlZFBhcmFtcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyDlkajmnJ/mgKfkuIrmiqVcbiAgICAgICAgdGhpcy5iZWFjb24gJiYgdGhpcy5iZWFjb24ub25Vc2VyQWN0aW9uKGV2ZW50Q29kZSwgZm9ybWF0dGVkUGFyYW1zKTtcbiAgICAgIH1cbiAgICB9IC8vIOeUn+aIkOWtkOWunuS+i++8jOS4jueItuaJgOWxnuS4gOS4qumTvui3r++8jOWPr+eUqOS6juWIhuWdl+S4iuS8oOWGhemDqOa1geeoi+S4iuaKpeWNleS4quWIhuWdl+aTjeS9nFxuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2VuZXJhdGVTdWJUcmFja2VyXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlU3ViVHJhY2tlcihzdWJQYXJhbXMpIHtcbiAgICAgIE9iamVjdC5hc3NpZ24oc3ViUGFyYW1zLCB7XG4gICAgICAgIHBhcmVudDogdGhpcyxcbiAgICAgICAgZGVlcFRyYWNrZXI6IHRoaXMuZGVlcFRyYWNrZXIsXG4gICAgICAgIHRyYWNlSWQ6IHRoaXMucGFyYW1zLnRyYWNlSWQsXG4gICAgICAgIGJ1Y2tldDogdGhpcy5wYXJhbXMuYnVja2V0LFxuICAgICAgICByZWdpb246IHRoaXMucGFyYW1zLnJlZ2lvbixcbiAgICAgICAgZmlsZUtleTogdGhpcy5wYXJhbXMucmVxdWVzdFBhdGgsXG4gICAgICAgIGN1c3RvbUlkOiB0aGlzLnBhcmFtcy5jdXN0b21JZCxcbiAgICAgICAgZGVsYXk6IHRoaXMuZGVsYXlcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5ldyBUcmFja2VyKHN1YlBhcmFtcyk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFRyYWNrZXI7XG59KCk7XG5cbm1vZHVsZS5leHBvcnRzID0gVHJhY2tlcjtcblxuLyoqKi8gfSksXG5cbi8qKiovIFwiLi9zcmMvdXRpbC5qc1wiOlxuLyohKioqKioqKioqKioqKioqKioqKioqISpcXFxuICAhKioqIC4vc3JjL3V0aWwuanMgKioqIVxuICBcXCoqKioqKioqKioqKioqKioqKioqKi9cbi8qISBubyBzdGF0aWMgZXhwb3J0cyBmb3VuZCAqL1xuLyoqKi8gKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cInVzZSBzdHJpY3RcIjtcbi8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihwcm9jZXNzKSB7XG5cbnZhciBfdHlwZW9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygvKiEgQGJhYmVsL3J1bnRpbWUvaGVscGVycy90eXBlb2YgKi8gXCIuL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL3R5cGVvZi5qc1wiKTtcblxudmFyIG1kNSA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL2xpYi9tZDUgKi8gXCIuL2xpYi9tZDUuanNcIik7XG5cbnZhciBDcnlwdG9KUyA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL2xpYi9jcnlwdG8gKi8gXCIuL2xpYi9jcnlwdG8uanNcIik7XG5cbnZhciB4bWwyanNvbiA9IF9fd2VicGFja19yZXF1aXJlX18oLyohIC4uL2xpYi94bWwyanNvbiAqLyBcIi4vbGliL3htbDJqc29uLmpzXCIpO1xuXG52YXIganNvbjJ4bWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuLi9saWIvanNvbjJ4bWwgKi8gXCIuL2xpYi9qc29uMnhtbC5qc1wiKTtcblxudmFyIFRyYWNrZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKC8qISAuL3RyYWNrZXIgKi8gXCIuL3NyYy90cmFja2VyLmpzXCIpO1xuXG5mdW5jdGlvbiBjYW1TYWZlVXJsRW5jb2RlKHN0cikge1xuICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikucmVwbGFjZSgvIS9nLCAnJTIxJykucmVwbGFjZSgvJy9nLCAnJTI3JykucmVwbGFjZSgvXFwoL2csICclMjgnKS5yZXBsYWNlKC9cXCkvZywgJyUyOScpLnJlcGxhY2UoL1xcKi9nLCAnJTJBJyk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdEtleXMob2JqLCBmb3JLZXkpIHtcbiAgdmFyIGxpc3QgPSBbXTtcblxuICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XG4gICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBsaXN0LnB1c2goZm9yS2V5ID8gY2FtU2FmZVVybEVuY29kZShrZXkpLnRvTG93ZXJDYXNlKCkgOiBrZXkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsaXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBhID0gYS50b0xvd2VyQ2FzZSgpO1xuICAgIGIgPSBiLnRvTG93ZXJDYXNlKCk7XG4gICAgcmV0dXJuIGEgPT09IGIgPyAwIDogYSA+IGIgPyAxIDogLTE7XG4gIH0pO1xufVxuXG47XG4vKipcbiAqIG9iaui9rOS4unN0cmluZ1xuICogQHBhcmFtICB7T2JqZWN0fSAgb2JqICAgICAgICAgICAgICAgIOmcgOimgei9rOeahOWvueixoe+8jOW/hemhu1xuICogQHBhcmFtICB7Qm9vbGVhbn0gbG93ZXJDYXNlS2V5ICAgICAgIGtleeaYr+WQpui9rOS4uuWwj+WGme+8jOm7mOiupGZhbHNl77yM6Z2e5b+F6aG7XG4gKiBAcmV0dXJuIHtTdHJpbmd9ICBkYXRhICAgICAgICAgICAgICAg6L+U5Zue5a2X56ym5LiyXG4gKi9cblxudmFyIG9iajJzdHIgPSBmdW5jdGlvbiBvYmoyc3RyKG9iaiwgbG93ZXJDYXNlS2V5KSB7XG4gIHZhciBpLCBrZXksIHZhbDtcbiAgdmFyIGxpc3QgPSBbXTtcbiAgdmFyIGtleUxpc3QgPSBnZXRPYmplY3RLZXlzKG9iaik7XG5cbiAgZm9yIChpID0gMDsgaSA8IGtleUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICBrZXkgPSBrZXlMaXN0W2ldO1xuICAgIHZhbCA9IG9ialtrZXldID09PSB1bmRlZmluZWQgfHwgb2JqW2tleV0gPT09IG51bGwgPyAnJyA6ICcnICsgb2JqW2tleV07XG4gICAga2V5ID0gbG93ZXJDYXNlS2V5ID8gY2FtU2FmZVVybEVuY29kZShrZXkpLnRvTG93ZXJDYXNlKCkgOiBjYW1TYWZlVXJsRW5jb2RlKGtleSk7XG4gICAgdmFsID0gY2FtU2FmZVVybEVuY29kZSh2YWwpIHx8ICcnO1xuICAgIGxpc3QucHVzaChrZXkgKyAnPScgKyB2YWwpO1xuICB9XG5cbiAgcmV0dXJuIGxpc3Quam9pbignJicpO1xufTsgLy8g5Y+v5Lul562+5YWl562+5ZCN55qEaGVhZGVyc1xuXG5cbnZhciBzaWduSGVhZGVycyA9IFsnY29udGVudC1kaXNwb3NpdGlvbicsICdjb250ZW50LWVuY29kaW5nJywgJ2NvbnRlbnQtbGVuZ3RoJywgJ2NvbnRlbnQtbWQ1JywgJ2V4cGVjdCcsICdob3N0JywgJ2lmLW1hdGNoJywgJ2lmLW1vZGlmaWVkLXNpbmNlJywgJ2lmLW5vbmUtbWF0Y2gnLCAnaWYtdW5tb2RpZmllZC1zaW5jZScsICdvcmlnaW4nLCAncmFuZ2UnLCAncmVzcG9uc2UtY2FjaGUtY29udHJvbCcsICdyZXNwb25zZS1jb250ZW50LWRpc3Bvc2l0aW9uJywgJ3Jlc3BvbnNlLWNvbnRlbnQtZW5jb2RpbmcnLCAncmVzcG9uc2UtY29udGVudC1sYW5ndWFnZScsICdyZXNwb25zZS1jb250ZW50LXR5cGUnLCAncmVzcG9uc2UtZXhwaXJlcycsICd0cmFuc2Zlci1lbmNvZGluZycsICd2ZXJzaW9uaWQnXTtcblxudmFyIGdldFNpZ25IZWFkZXJPYmogPSBmdW5jdGlvbiBnZXRTaWduSGVhZGVyT2JqKGhlYWRlcnMpIHtcbiAgdmFyIHNpZ25IZWFkZXJPYmogPSB7fTtcblxuICBmb3IgKHZhciBpIGluIGhlYWRlcnMpIHtcbiAgICB2YXIga2V5ID0gaS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKGtleS5pbmRleE9mKCd4LWNvcy0nKSA+IC0xIHx8IHNpZ25IZWFkZXJzLmluZGV4T2Yoa2V5KSA+IC0xKSB7XG4gICAgICBzaWduSGVhZGVyT2JqW2ldID0gaGVhZGVyc1tpXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc2lnbkhlYWRlck9iajtcbn07IC8v5rWL6K+V55So55qEa2V55ZCO6Z2i5Y+v5Lul5Y675o6JXG5cblxudmFyIGdldEF1dGggPSBmdW5jdGlvbiBnZXRBdXRoKG9wdCkge1xuICBvcHQgPSBvcHQgfHwge307XG4gIHZhciBTZWNyZXRJZCA9IG9wdC5TZWNyZXRJZDtcbiAgdmFyIFNlY3JldEtleSA9IG9wdC5TZWNyZXRLZXk7XG4gIHZhciBLZXlUaW1lID0gb3B0LktleVRpbWU7XG4gIHZhciBtZXRob2QgPSAob3B0Lm1ldGhvZCB8fCBvcHQuTWV0aG9kIHx8ICdnZXQnKS50b0xvd2VyQ2FzZSgpO1xuICB2YXIgcXVlcnlQYXJhbXMgPSBjbG9uZShvcHQuUXVlcnkgfHwgb3B0LnBhcmFtcyB8fCB7fSk7XG4gIHZhciBoZWFkZXJzID0gZ2V0U2lnbkhlYWRlck9iaihjbG9uZShvcHQuSGVhZGVycyB8fCBvcHQuaGVhZGVycyB8fCB7fSkpO1xuICB2YXIgS2V5ID0gb3B0LktleSB8fCAnJztcbiAgdmFyIHBhdGhuYW1lO1xuXG4gIGlmIChvcHQuVXNlUmF3S2V5KSB7XG4gICAgcGF0aG5hbWUgPSBvcHQuUGF0aG5hbWUgfHwgb3B0LnBhdGhuYW1lIHx8ICcvJyArIEtleTtcbiAgfSBlbHNlIHtcbiAgICBwYXRobmFtZSA9IG9wdC5QYXRobmFtZSB8fCBvcHQucGF0aG5hbWUgfHwgS2V5O1xuICAgIHBhdGhuYW1lLmluZGV4T2YoJy8nKSAhPT0gMCAmJiAocGF0aG5hbWUgPSAnLycgKyBwYXRobmFtZSk7XG4gIH0gLy8gRm9yY2VTaWduSG9zdOaYjuehruS8oOWFpWZhbHNl5omN5LiN5Yqg5YWlaG9zdOetvuWQjVxuXG5cbiAgdmFyIGZvcmNlU2lnbkhvc3QgPSBvcHQuRm9yY2VTaWduSG9zdCA9PT0gZmFsc2UgPyBmYWxzZSA6IHRydWU7IC8vIOWmguaenOacieS8oOWFpeWtmOWCqOahtuS4lOmcgOimgeW8uuWItuetvuWQje+8jOmCo+S5iOetvuWQjem7mOiupOWKoCBIb3N0IOWPguS4juiuoeeul++8jOmBv+WFjei3qOahtuiuv+mXrlxuXG4gIGlmICghaGVhZGVycy5Ib3N0ICYmICFoZWFkZXJzLmhvc3QgJiYgb3B0LkJ1Y2tldCAmJiBvcHQuUmVnaW9uICYmIGZvcmNlU2lnbkhvc3QpIGhlYWRlcnMuSG9zdCA9IG9wdC5CdWNrZXQgKyAnLmNvcy4nICsgb3B0LlJlZ2lvbiArICcubXlxY2xvdWQuY29tJztcbiAgaWYgKCFTZWNyZXRJZCkgdGhyb3cgbmV3IEVycm9yKCdtaXNzaW5nIHBhcmFtIFNlY3JldElkJyk7XG4gIGlmICghU2VjcmV0S2V5KSB0aHJvdyBuZXcgRXJyb3IoJ21pc3NpbmcgcGFyYW0gU2VjcmV0S2V5Jyk7IC8vIOetvuWQjeacieaViOi1t+atouaXtumXtFxuXG4gIHZhciBub3cgPSBNYXRoLnJvdW5kKGdldFNrZXdUaW1lKG9wdC5TeXN0ZW1DbG9ja09mZnNldCkgLyAxMDAwKSAtIDE7XG4gIHZhciBleHAgPSBub3c7XG4gIHZhciBFeHBpcmVzID0gb3B0LkV4cGlyZXMgfHwgb3B0LmV4cGlyZXM7XG5cbiAgaWYgKEV4cGlyZXMgPT09IHVuZGVmaW5lZCkge1xuICAgIGV4cCArPSA5MDA7IC8vIOetvuWQjei/h+acn+aXtumXtOS4uuW9k+WJjSArIDkwMHNcbiAgfSBlbHNlIHtcbiAgICBleHAgKz0gRXhwaXJlcyAqIDEgfHwgMDtcbiAgfSAvLyDopoHnlKjliLDnmoQgQXV0aG9yaXphdGlvbiDlj4LmlbDliJfooahcblxuXG4gIHZhciBxU2lnbkFsZ29yaXRobSA9ICdzaGExJztcbiAgdmFyIHFBayA9IFNlY3JldElkO1xuICB2YXIgcVNpZ25UaW1lID0gS2V5VGltZSB8fCBub3cgKyAnOycgKyBleHA7XG4gIHZhciBxS2V5VGltZSA9IEtleVRpbWUgfHwgbm93ICsgJzsnICsgZXhwO1xuICB2YXIgcUhlYWRlckxpc3QgPSBnZXRPYmplY3RLZXlzKGhlYWRlcnMsIHRydWUpLmpvaW4oJzsnKS50b0xvd2VyQ2FzZSgpO1xuICB2YXIgcVVybFBhcmFtTGlzdCA9IGdldE9iamVjdEtleXMocXVlcnlQYXJhbXMsIHRydWUpLmpvaW4oJzsnKS50b0xvd2VyQ2FzZSgpOyAvLyDnrb7lkI3nrpfms5Xor7TmmI7mlofmoaPvvJpodHRwczovL3d3dy5xY2xvdWQuY29tL2RvY3VtZW50L3Byb2R1Y3QvNDM2Lzc3NzhcbiAgLy8g5q2l6aqk5LiA77ya6K6h566XIFNpZ25LZXlcblxuICB2YXIgc2lnbktleSA9IENyeXB0b0pTLkhtYWNTSEExKHFLZXlUaW1lLCBTZWNyZXRLZXkpLnRvU3RyaW5nKCk7IC8vIOatpemqpOS6jO+8muaehOaIkCBGb3JtYXRTdHJpbmdcblxuICB2YXIgZm9ybWF0U3RyaW5nID0gW21ldGhvZCwgcGF0aG5hbWUsIHV0aWwub2JqMnN0cihxdWVyeVBhcmFtcywgdHJ1ZSksIHV0aWwub2JqMnN0cihoZWFkZXJzLCB0cnVlKSwgJyddLmpvaW4oJ1xcbicpOyAvLyDmraXpqqTkuInvvJrorqHnrpcgU3RyaW5nVG9TaWduXG5cbiAgdmFyIHN0cmluZ1RvU2lnbiA9IFsnc2hhMScsIHFTaWduVGltZSwgQ3J5cHRvSlMuU0hBMShmb3JtYXRTdHJpbmcpLnRvU3RyaW5nKCksICcnXS5qb2luKCdcXG4nKTsgLy8g5q2l6aqk5Zub77ya6K6h566XIFNpZ25hdHVyZVxuXG4gIHZhciBxU2lnbmF0dXJlID0gQ3J5cHRvSlMuSG1hY1NIQTEoc3RyaW5nVG9TaWduLCBzaWduS2V5KS50b1N0cmluZygpOyAvLyDmraXpqqTkupTvvJrmnoTpgKAgQXV0aG9yaXphdGlvblxuXG4gIHZhciBhdXRob3JpemF0aW9uID0gWydxLXNpZ24tYWxnb3JpdGhtPScgKyBxU2lnbkFsZ29yaXRobSwgJ3EtYWs9JyArIHFBaywgJ3Etc2lnbi10aW1lPScgKyBxU2lnblRpbWUsICdxLWtleS10aW1lPScgKyBxS2V5VGltZSwgJ3EtaGVhZGVyLWxpc3Q9JyArIHFIZWFkZXJMaXN0LCAncS11cmwtcGFyYW0tbGlzdD0nICsgcVVybFBhcmFtTGlzdCwgJ3Etc2lnbmF0dXJlPScgKyBxU2lnbmF0dXJlXS5qb2luKCcmJyk7XG4gIHJldHVybiBhdXRob3JpemF0aW9uO1xufTtcblxudmFyIHJlYWRJbnRCRSA9IGZ1bmN0aW9uIHJlYWRJbnRCRShjaHVuaywgc2l6ZSwgb2Zmc2V0KSB7XG4gIHZhciBieXRlcyA9IHNpemUgLyA4O1xuICB2YXIgYnVmID0gY2h1bmsuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBieXRlcyk7XG4gIG5ldyBVaW50OEFycmF5KGJ1ZikucmV2ZXJzZSgpO1xuICByZXR1cm4gbmV3IHtcbiAgICA4OiBVaW50OEFycmF5LFxuICAgIDE2OiBVaW50MTZBcnJheSxcbiAgICAzMjogVWludDMyQXJyYXlcbiAgfVtzaXplXShidWYpWzBdO1xufTtcblxudmFyIGJ1ZjJzdHIgPSBmdW5jdGlvbiBidWYyc3RyKGNodW5rLCBzdGFydCwgZW5kLCBpc1V0ZjgpIHtcbiAgdmFyIGJ1ZiA9IGNodW5rLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICB2YXIgc3RyID0gJyc7XG4gIG5ldyBVaW50OEFycmF5KGJ1ZikuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUpIHtcbiAgICBzdHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSk7XG4gIH0pO1xuICBpZiAoaXNVdGY4KSBzdHIgPSBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKHN0cikpO1xuICByZXR1cm4gc3RyO1xufTtcblxudmFyIHBhcnNlU2VsZWN0UGF5bG9hZCA9IGZ1bmN0aW9uIHBhcnNlU2VsZWN0UGF5bG9hZChjaHVuaykge1xuICB2YXIgaGVhZGVyID0ge307XG4gIHZhciBib2R5ID0gYnVmMnN0cihjaHVuayk7XG4gIHZhciByZXN1bHQgPSB7XG4gICAgcmVjb3JkczogW11cbiAgfTtcblxuICB3aGlsZSAoY2h1bmsuYnl0ZUxlbmd0aCkge1xuICAgIHZhciB0b3RhbExlbmd0aCA9IHJlYWRJbnRCRShjaHVuaywgMzIsIDApO1xuICAgIHZhciBoZWFkZXJMZW5ndGggPSByZWFkSW50QkUoY2h1bmssIDMyLCA0KTtcbiAgICB2YXIgcGF5bG9hZFJlc3RMZW5ndGggPSB0b3RhbExlbmd0aCAtIGhlYWRlckxlbmd0aCAtIDE2O1xuICAgIHZhciBvZmZzZXQgPSAwO1xuICAgIHZhciBjb250ZW50O1xuICAgIGNodW5rID0gY2h1bmsuc2xpY2UoMTIpOyAvLyDojrflj5YgTWVzc2FnZSDnmoQgaGVhZGVyIOS/oeaBr1xuXG4gICAgd2hpbGUgKG9mZnNldCA8IGhlYWRlckxlbmd0aCkge1xuICAgICAgdmFyIGhlYWRlck5hbWVMZW5ndGggPSByZWFkSW50QkUoY2h1bmssIDgsIG9mZnNldCk7XG4gICAgICB2YXIgaGVhZGVyTmFtZSA9IGJ1ZjJzdHIoY2h1bmssIG9mZnNldCArIDEsIG9mZnNldCArIDEgKyBoZWFkZXJOYW1lTGVuZ3RoKTtcbiAgICAgIHZhciBoZWFkZXJWYWx1ZUxlbmd0aCA9IHJlYWRJbnRCRShjaHVuaywgMTYsIG9mZnNldCArIGhlYWRlck5hbWVMZW5ndGggKyAyKTtcbiAgICAgIHZhciBoZWFkZXJWYWx1ZSA9IGJ1ZjJzdHIoY2h1bmssIG9mZnNldCArIGhlYWRlck5hbWVMZW5ndGggKyA0LCBvZmZzZXQgKyBoZWFkZXJOYW1lTGVuZ3RoICsgNCArIGhlYWRlclZhbHVlTGVuZ3RoKTtcbiAgICAgIGhlYWRlcltoZWFkZXJOYW1lXSA9IGhlYWRlclZhbHVlO1xuICAgICAgb2Zmc2V0ICs9IGhlYWRlck5hbWVMZW5ndGggKyA0ICsgaGVhZGVyVmFsdWVMZW5ndGg7XG4gICAgfVxuXG4gICAgaWYgKGhlYWRlclsnOmV2ZW50LXR5cGUnXSA9PT0gJ1JlY29yZHMnKSB7XG4gICAgICBjb250ZW50ID0gYnVmMnN0cihjaHVuaywgb2Zmc2V0LCBvZmZzZXQgKyBwYXlsb2FkUmVzdExlbmd0aCwgdHJ1ZSk7XG4gICAgICByZXN1bHQucmVjb3Jkcy5wdXNoKGNvbnRlbnQpO1xuICAgIH0gZWxzZSBpZiAoaGVhZGVyWyc6ZXZlbnQtdHlwZSddID09PSAnU3RhdHMnKSB7XG4gICAgICBjb250ZW50ID0gYnVmMnN0cihjaHVuaywgb2Zmc2V0LCBvZmZzZXQgKyBwYXlsb2FkUmVzdExlbmd0aCwgdHJ1ZSk7XG4gICAgICByZXN1bHQuc3RhdHMgPSB1dGlsLnhtbDJqc29uKGNvbnRlbnQpLlN0YXRzO1xuICAgIH0gZWxzZSBpZiAoaGVhZGVyWyc6ZXZlbnQtdHlwZSddID09PSAnZXJyb3InKSB7XG4gICAgICB2YXIgZXJyQ29kZSA9IGhlYWRlclsnOmVycm9yLWNvZGUnXTtcbiAgICAgIHZhciBlcnJNZXNzYWdlID0gaGVhZGVyWyc6ZXJyb3ItbWVzc2FnZSddO1xuICAgICAgdmFyIGVyciA9IG5ldyBFcnJvcihlcnJNZXNzYWdlKTtcbiAgICAgIGVyci5tZXNzYWdlID0gZXJyTWVzc2FnZTtcbiAgICAgIGVyci5uYW1lID0gZXJyLmNvZGUgPSBlcnJDb2RlO1xuICAgICAgcmVzdWx0LmVycm9yID0gZXJyO1xuICAgIH0gZWxzZSBpZiAoWydQcm9ncmVzcycsICdDb250aW51YXRpb24nLCAnRW5kJ10uaW5jbHVkZXMoaGVhZGVyWyc6ZXZlbnQtdHlwZSddKSkgey8vIGRvIG5vdGhpbmdcbiAgICB9XG5cbiAgICBjaHVuayA9IGNodW5rLnNsaWNlKG9mZnNldCArIHBheWxvYWRSZXN0TGVuZ3RoICsgNCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBheWxvYWQ6IHJlc3VsdC5yZWNvcmRzLmpvaW4oJycpLFxuICAgIGJvZHk6IGJvZHlcbiAgfTtcbn07XG5cbnZhciBnZXRTb3VyY2VQYXJhbXMgPSBmdW5jdGlvbiBnZXRTb3VyY2VQYXJhbXMoc291cmNlKSB7XG4gIHZhciBwYXJzZXIgPSB0aGlzLm9wdGlvbnMuQ29weVNvdXJjZVBhcnNlcjtcbiAgaWYgKHBhcnNlcikgcmV0dXJuIHBhcnNlcihzb3VyY2UpO1xuICB2YXIgbSA9IHNvdXJjZS5tYXRjaCgvXihbXi5dKy1cXGQrKVxcLmNvcyh2NnwtY2RjfC1pbnRlcm5hbCk/XFwuKFteLl0rKVxcLigobXlxY2xvdWRcXC5jb20pfCh0ZW5jZW50Y29zXFwuY24pKVxcLyguKykkLyk7XG4gIGlmICghbSkgcmV0dXJuIG51bGw7XG4gIHJldHVybiB7XG4gICAgQnVja2V0OiBtWzFdLFxuICAgIFJlZ2lvbjogbVszXSxcbiAgICBLZXk6IG1bN11cbiAgfTtcbn07XG5cbnZhciBub29wID0gZnVuY3Rpb24gbm9vcCgpIHt9OyAvLyDmuIXpmaTlr7nosaHph4zlgLzkuLrnmoQgdW5kZWZpbmVkIOaIliBudWxsIOeahOWxnuaAp1xuXG5cbnZhciBjbGVhcktleSA9IGZ1bmN0aW9uIGNsZWFyS2V5KG9iaikge1xuICB2YXIgcmV0T2JqID0ge307XG5cbiAgZm9yICh2YXIga2V5IGluIG9iaikge1xuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSAmJiBvYmpba2V5XSAhPT0gdW5kZWZpbmVkICYmIG9ialtrZXldICE9PSBudWxsKSB7XG4gICAgICByZXRPYmpba2V5XSA9IG9ialtrZXldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXRPYmo7XG59O1xuXG52YXIgcmVhZEFzQmluYXJ5U3RyaW5nID0gZnVuY3Rpb24gcmVhZEFzQmluYXJ5U3RyaW5nKGJsb2IsIGNhbGxiYWNrKSB7XG4gIHZhciByZWFkRnVuO1xuICB2YXIgZnIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gIGlmIChGaWxlUmVhZGVyLnByb3RvdHlwZS5yZWFkQXNCaW5hcnlTdHJpbmcpIHtcbiAgICByZWFkRnVuID0gRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQmluYXJ5U3RyaW5nO1xuXG4gICAgZnIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGJhY2sodGhpcy5yZXN1bHQpO1xuICAgIH07XG4gIH0gZWxzZSBpZiAoRmlsZVJlYWRlci5wcm90b3R5cGUucmVhZEFzQXJyYXlCdWZmZXIpIHtcbiAgICAvLyDlnKggaWUxMSDmt7vliqAgcmVhZEFzQmluYXJ5U3RyaW5nIOWFvOWuuVxuICAgIHJlYWRGdW4gPSBmdW5jdGlvbiByZWFkRnVuKGZpbGVEYXRhKSB7XG4gICAgICB2YXIgYmluYXJ5ID0gXCJcIjtcbiAgICAgIHZhciBwdCA9IHRoaXM7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBieXRlcyA9IG5ldyBVaW50OEFycmF5KHJlYWRlci5yZXN1bHQpO1xuICAgICAgICB2YXIgbGVuZ3RoID0gYnl0ZXMuYnl0ZUxlbmd0aDtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FsbGJhY2soYmluYXJ5KTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlRGF0YSk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKCdGaWxlUmVhZGVyIG5vdCBzdXBwb3J0IHJlYWRBc0JpbmFyeVN0cmluZycpO1xuICB9XG5cbiAgcmVhZEZ1bi5jYWxsKGZyLCBibG9iKTtcbn07XG5cbnZhciBmaWxlU2xpY2VOZWVkQ29weSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbXBhcmVWZXJzaW9uID0gZnVuY3Rpb24gY29tcGFyZVZlcnNpb24oYSwgYikge1xuICAgIGEgPSBhLnNwbGl0KCcuJyk7XG4gICAgYiA9IGIuc3BsaXQoJy4nKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYi5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGFbaV0gIT09IGJbaV0pIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KGFbaV0pID4gcGFyc2VJbnQoYltpXSkgPyAxIDogLTE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIDA7XG4gIH07XG5cbiAgdmFyIGNoZWNrID0gZnVuY3Rpb24gY2hlY2sodWEpIHtcbiAgICBpZiAoIXVhKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIENocm9tZVZlcnNpb24gPSAodWEubWF0Y2goL0Nocm9tZVxcLyhbLlxcZF0rKS8pIHx8IFtdKVsxXTtcbiAgICB2YXIgUUJDb3JlVmVyc2lvbiA9ICh1YS5tYXRjaCgvUUJDb3JlXFwvKFsuXFxkXSspLykgfHwgW10pWzFdO1xuICAgIHZhciBRUUJyb3dzZXJWZXJzaW9uID0gKHVhLm1hdGNoKC9RUUJyb3dzZXJcXC8oWy5cXGRdKykvKSB8fCBbXSlbMV07XG4gICAgdmFyIG5lZWQgPSBDaHJvbWVWZXJzaW9uICYmIGNvbXBhcmVWZXJzaW9uKENocm9tZVZlcnNpb24sICc1My4wLjI3ODUuMTE2JykgPCAwICYmIFFCQ29yZVZlcnNpb24gJiYgY29tcGFyZVZlcnNpb24oUUJDb3JlVmVyc2lvbiwgJzMuNTMuOTkxLjQwMCcpIDwgMCAmJiBRUUJyb3dzZXJWZXJzaW9uICYmIGNvbXBhcmVWZXJzaW9uKFFRQnJvd3NlclZlcnNpb24sICc5LjAuMjUyNC40MDAnKSA8PSAwIHx8IGZhbHNlO1xuICAgIHJldHVybiBuZWVkO1xuICB9O1xuXG4gIHJldHVybiBjaGVjayh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBuYXZpZ2F0b3IudXNlckFnZW50KTtcbn0oKTsgLy8g6I635Y+W5paH5Lu25YiG54mHXG5cblxudmFyIGZpbGVTbGljZSA9IGZ1bmN0aW9uIGZpbGVTbGljZShmaWxlLCBzdGFydCwgZW5kLCBpc1VzZVRvVXBsb2FkLCBjYWxsYmFjaykge1xuICB2YXIgYmxvYjtcblxuICBpZiAoZmlsZS5zbGljZSkge1xuICAgIGJsb2IgPSBmaWxlLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICB9IGVsc2UgaWYgKGZpbGUubW96U2xpY2UpIHtcbiAgICBibG9iID0gZmlsZS5tb3pTbGljZShzdGFydCwgZW5kKTtcbiAgfSBlbHNlIGlmIChmaWxlLndlYmtpdFNsaWNlKSB7XG4gICAgYmxvYiA9IGZpbGUud2Via2l0U2xpY2Uoc3RhcnQsIGVuZCk7XG4gIH1cblxuICBpZiAoaXNVc2VUb1VwbG9hZCAmJiBmaWxlU2xpY2VOZWVkQ29weSkge1xuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBibG9iID0gbnVsbDtcbiAgICAgIGNhbGxiYWNrKG5ldyBCbG9iKFtyZWFkZXIucmVzdWx0XSkpO1xuICAgIH07XG5cbiAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYik7XG4gIH0gZWxzZSB7XG4gICAgY2FsbGJhY2soYmxvYik7XG4gIH1cbn07IC8vIOiOt+WPluaWh+S7tuWGheWuueeahCBNRDVcblxuXG52YXIgZ2V0Qm9keU1kNSA9IGZ1bmN0aW9uIGdldEJvZHlNZDUoVXBsb2FkQ2hlY2tDb250ZW50TWQ1LCBCb2R5LCBjYWxsYmFjaywgb25Qcm9ncmVzcykge1xuICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IG5vb3A7XG5cbiAgaWYgKFVwbG9hZENoZWNrQ29udGVudE1kNSkge1xuICAgIGlmICh0eXBlb2YgQm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGNhbGxiYWNrKHV0aWwubWQ1KEJvZHksIHRydWUpKTtcbiAgICB9IGVsc2UgaWYgKEJsb2IgJiYgQm9keSBpbnN0YW5jZW9mIEJsb2IpIHtcbiAgICAgIHV0aWwuZ2V0RmlsZU1kNShCb2R5LCBmdW5jdGlvbiAoZXJyLCBtZDUpIHtcbiAgICAgICAgY2FsbGJhY2sobWQ1KTtcbiAgICAgIH0sIG9uUHJvZ3Jlc3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjYWxsYmFjaygpO1xuICB9XG59OyAvLyDojrflj5bmlofku7YgbWQ1IOWAvFxuXG5cbnZhciBtZDVDaHVua1NpemUgPSAxMDI0ICogMTAyNDtcblxudmFyIGdldEZpbGVNZDUgPSBmdW5jdGlvbiBnZXRGaWxlTWQ1KGJsb2IsIGNhbGxiYWNrLCBvblByb2dyZXNzKSB7XG4gIHZhciBzaXplID0gYmxvYi5zaXplO1xuICB2YXIgbG9hZGVkID0gMDtcbiAgdmFyIG1kNWN0eCA9IG1kNS5nZXRDdHgoKTtcblxuICB2YXIgbmV4dCA9IGZ1bmN0aW9uIG5leHQoc3RhcnQpIHtcbiAgICBpZiAoc3RhcnQgPj0gc2l6ZSkge1xuICAgICAgdmFyIGhhc2ggPSBtZDVjdHguZGlnZXN0KCdoZXgnKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIGhhc2gpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBlbmQgPSBNYXRoLm1pbihzaXplLCBzdGFydCArIG1kNUNodW5rU2l6ZSk7XG4gICAgdXRpbC5maWxlU2xpY2UoYmxvYiwgc3RhcnQsIGVuZCwgZmFsc2UsIGZ1bmN0aW9uIChjaHVuaykge1xuICAgICAgcmVhZEFzQmluYXJ5U3RyaW5nKGNodW5rLCBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICBjaHVuayA9IG51bGw7XG4gICAgICAgIG1kNWN0eCA9IG1kNWN0eC51cGRhdGUoY29udGVudCwgdHJ1ZSk7XG4gICAgICAgIGxvYWRlZCArPSBjb250ZW50Lmxlbmd0aDtcbiAgICAgICAgY29udGVudCA9IG51bGw7XG4gICAgICAgIGlmIChvblByb2dyZXNzKSBvblByb2dyZXNzKHtcbiAgICAgICAgICBsb2FkZWQ6IGxvYWRlZCxcbiAgICAgICAgICB0b3RhbDogc2l6ZSxcbiAgICAgICAgICBwZXJjZW50OiBNYXRoLnJvdW5kKGxvYWRlZCAvIHNpemUgKiAxMDAwMCkgLyAxMDAwMFxuICAgICAgICB9KTtcbiAgICAgICAgbmV4dChzdGFydCArIG1kNUNodW5rU2l6ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBuZXh0KDApO1xufTtcblxuZnVuY3Rpb24gY2xvbmUob2JqKSB7XG4gIHJldHVybiBtYXAob2JqLCBmdW5jdGlvbiAodikge1xuICAgIHJldHVybiBfdHlwZW9mKHYpID09PSAnb2JqZWN0JyAmJiB2ICE9PSBudWxsID8gY2xvbmUodikgOiB2O1xuICB9KTtcbn1cblxuZnVuY3Rpb24gYXR0cihvYmosIG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xuICByZXR1cm4gb2JqICYmIG5hbWUgaW4gb2JqID8gb2JqW25hbWVdIDogZGVmYXVsdFZhbHVlO1xufVxuXG5mdW5jdGlvbiBleHRlbmQodGFyZ2V0LCBzb3VyY2UpIHtcbiAgZWFjaChzb3VyY2UsIGZ1bmN0aW9uICh2YWwsIGtleSkge1xuICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gIH0pO1xuICByZXR1cm4gdGFyZ2V0O1xufVxuXG5mdW5jdGlvbiBpc0FycmF5KGFycikge1xuICByZXR1cm4gYXJyIGluc3RhbmNlb2YgQXJyYXk7XG59XG5cbmZ1bmN0aW9uIGlzSW5BcnJheShhcnIsIGl0ZW0pIHtcbiAgdmFyIGZsYWcgPSBmYWxzZTtcblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgIGlmIChpdGVtID09PSBhcnJbaV0pIHtcbiAgICAgIGZsYWcgPSB0cnVlO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZsYWc7XG59XG5cbmZ1bmN0aW9uIG1ha2VBcnJheShhcnIpIHtcbiAgcmV0dXJuIGlzQXJyYXkoYXJyKSA/IGFyciA6IFthcnJdO1xufVxuXG5mdW5jdGlvbiBlYWNoKG9iaiwgZm4pIHtcbiAgZm9yICh2YXIgaSBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICBmbihvYmpbaV0sIGkpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBtYXAob2JqLCBmbikge1xuICB2YXIgbyA9IGlzQXJyYXkob2JqKSA/IFtdIDoge307XG5cbiAgZm9yICh2YXIgaSBpbiBvYmopIHtcbiAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGkpKSB7XG4gICAgICBvW2ldID0gZm4ob2JqW2ldLCBpKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gbztcbn1cblxuZnVuY3Rpb24gZmlsdGVyKG9iaiwgZm4pIHtcbiAgdmFyIGlhQXJyID0gaXNBcnJheShvYmopO1xuICB2YXIgbyA9IGlhQXJyID8gW10gOiB7fTtcblxuICBmb3IgKHZhciBpIGluIG9iaikge1xuICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoaSkpIHtcbiAgICAgIGlmIChmbihvYmpbaV0sIGkpKSB7XG4gICAgICAgIGlmIChpYUFycikge1xuICAgICAgICAgIG8ucHVzaChvYmpbaV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9baV0gPSBvYmpbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbztcbn1cblxudmFyIGJpbmFyeUJhc2U2NCA9IGZ1bmN0aW9uIGJpbmFyeUJhc2U2NChzdHIpIHtcbiAgdmFyIGksXG4gICAgICBsZW4sXG4gICAgICBjaGFyLFxuICAgICAgcmVzID0gJyc7XG5cbiAgZm9yIChpID0gMCwgbGVuID0gc3RyLmxlbmd0aCAvIDI7IGkgPCBsZW47IGkrKykge1xuICAgIGNoYXIgPSBwYXJzZUludChzdHJbaSAqIDJdICsgc3RyW2kgKiAyICsgMV0sIDE2KTtcbiAgICByZXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyKTtcbiAgfVxuXG4gIHJldHVybiBidG9hKHJlcyk7XG59O1xuXG52YXIgdXVpZCA9IGZ1bmN0aW9uIHV1aWQoKSB7XG4gIHZhciBTNCA9IGZ1bmN0aW9uIFM0KCkge1xuICAgIHJldHVybiAoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDAgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xuICB9O1xuXG4gIHJldHVybiBTNCgpICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFwiLVwiICsgUzQoKSArIFM0KCkgKyBTNCgpO1xufTtcblxudmFyIGhhc01pc3NpbmdQYXJhbXMgPSBmdW5jdGlvbiBoYXNNaXNzaW5nUGFyYW1zKGFwaU5hbWUsIHBhcmFtcykge1xuICB2YXIgQnVja2V0ID0gcGFyYW1zLkJ1Y2tldDtcbiAgdmFyIFJlZ2lvbiA9IHBhcmFtcy5SZWdpb247XG4gIHZhciBLZXkgPSBwYXJhbXMuS2V5O1xuICB2YXIgRG9tYWluID0gdGhpcy5vcHRpb25zLkRvbWFpbjtcbiAgdmFyIGNoZWNrQnVja2V0ID0gIURvbWFpbiB8fCB0eXBlb2YgRG9tYWluID09PSAnc3RyaW5nJyAmJiBEb21haW4uaW5kZXhPZigne0J1Y2tldH0nKSA+IC0xO1xuICB2YXIgY2hlY2tSZWdpb24gPSAhRG9tYWluIHx8IHR5cGVvZiBEb21haW4gPT09ICdzdHJpbmcnICYmIERvbWFpbi5pbmRleE9mKCd7UmVnaW9ufScpID4gLTE7XG5cbiAgaWYgKGFwaU5hbWUuaW5kZXhPZignQnVja2V0JykgPiAtMSB8fCBhcGlOYW1lID09PSAnZGVsZXRlTXVsdGlwbGVPYmplY3QnIHx8IGFwaU5hbWUgPT09ICdtdWx0aXBhcnRMaXN0JyB8fCBhcGlOYW1lID09PSAnbGlzdE9iamVjdFZlcnNpb25zJykge1xuICAgIGlmIChjaGVja0J1Y2tldCAmJiAhQnVja2V0KSByZXR1cm4gJ0J1Y2tldCc7XG4gICAgaWYgKGNoZWNrUmVnaW9uICYmICFSZWdpb24pIHJldHVybiAnUmVnaW9uJztcbiAgfSBlbHNlIGlmIChhcGlOYW1lLmluZGV4T2YoJ09iamVjdCcpID4gLTEgfHwgYXBpTmFtZS5pbmRleE9mKCdtdWx0aXBhcnQnKSA+IC0xIHx8IGFwaU5hbWUgPT09ICdzbGljZVVwbG9hZEZpbGUnIHx8IGFwaU5hbWUgPT09ICdhYm9ydFVwbG9hZFRhc2snKSB7XG4gICAgaWYgKGNoZWNrQnVja2V0ICYmICFCdWNrZXQpIHJldHVybiAnQnVja2V0JztcbiAgICBpZiAoY2hlY2tSZWdpb24gJiYgIVJlZ2lvbikgcmV0dXJuICdSZWdpb24nO1xuICAgIGlmICghS2V5KSByZXR1cm4gJ0tleSc7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59O1xuXG52YXIgZm9ybWF0UGFyYW1zID0gZnVuY3Rpb24gZm9ybWF0UGFyYW1zKGFwaU5hbWUsIHBhcmFtcykge1xuICAvLyDlpI3liLblj4LmlbDlr7nosaFcbiAgcGFyYW1zID0gZXh0ZW5kKHt9LCBwYXJhbXMpOyAvLyDnu5/kuIDlpITnkIYgSGVhZGVyc1xuXG4gIGlmIChhcGlOYW1lICE9PSAnZ2V0QXV0aCcgJiYgYXBpTmFtZSAhPT0gJ2dldFY0QXV0aCcgJiYgYXBpTmFtZSAhPT0gJ2dldE9iamVjdFVybCcpIHtcbiAgICB2YXIgSGVhZGVycyA9IHBhcmFtcy5IZWFkZXJzIHx8IHt9O1xuXG4gICAgaWYgKHBhcmFtcyAmJiBfdHlwZW9mKHBhcmFtcykgPT09ICdvYmplY3QnKSB7XG4gICAgICAoZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gcGFyYW1zKSB7XG4gICAgICAgICAgaWYgKHBhcmFtcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGtleS5pbmRleE9mKCd4LWNvcy0nKSA+IC0xKSB7XG4gICAgICAgICAgICBIZWFkZXJzW2tleV0gPSBwYXJhbXNba2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pKCk7XG5cbiAgICAgIHZhciBoZWFkZXJNYXAgPSB7XG4gICAgICAgIC8vIHBhcmFtcyBoZWFkZXJzXG4gICAgICAgICd4LWNvcy1tZmEnOiAnTUZBJyxcbiAgICAgICAgJ0NvbnRlbnQtTUQ1JzogJ0NvbnRlbnRNRDUnLFxuICAgICAgICAnQ29udGVudC1MZW5ndGgnOiAnQ29udGVudExlbmd0aCcsXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnQ29udGVudFR5cGUnLFxuICAgICAgICAnRXhwZWN0JzogJ0V4cGVjdCcsXG4gICAgICAgICdFeHBpcmVzJzogJ0V4cGlyZXMnLFxuICAgICAgICAnQ2FjaGUtQ29udHJvbCc6ICdDYWNoZUNvbnRyb2wnLFxuICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbic6ICdDb250ZW50RGlzcG9zaXRpb24nLFxuICAgICAgICAnQ29udGVudC1FbmNvZGluZyc6ICdDb250ZW50RW5jb2RpbmcnLFxuICAgICAgICAnUmFuZ2UnOiAnUmFuZ2UnLFxuICAgICAgICAnSWYtTW9kaWZpZWQtU2luY2UnOiAnSWZNb2RpZmllZFNpbmNlJyxcbiAgICAgICAgJ0lmLVVubW9kaWZpZWQtU2luY2UnOiAnSWZVbm1vZGlmaWVkU2luY2UnLFxuICAgICAgICAnSWYtTWF0Y2gnOiAnSWZNYXRjaCcsXG4gICAgICAgICdJZi1Ob25lLU1hdGNoJzogJ0lmTm9uZU1hdGNoJyxcbiAgICAgICAgJ3gtY29zLWNvcHktc291cmNlJzogJ0NvcHlTb3VyY2UnLFxuICAgICAgICAneC1jb3MtY29weS1zb3VyY2UtUmFuZ2UnOiAnQ29weVNvdXJjZVJhbmdlJyxcbiAgICAgICAgJ3gtY29zLW1ldGFkYXRhLWRpcmVjdGl2ZSc6ICdNZXRhZGF0YURpcmVjdGl2ZScsXG4gICAgICAgICd4LWNvcy1jb3B5LXNvdXJjZS1JZi1Nb2RpZmllZC1TaW5jZSc6ICdDb3B5U291cmNlSWZNb2RpZmllZFNpbmNlJyxcbiAgICAgICAgJ3gtY29zLWNvcHktc291cmNlLUlmLVVubW9kaWZpZWQtU2luY2UnOiAnQ29weVNvdXJjZUlmVW5tb2RpZmllZFNpbmNlJyxcbiAgICAgICAgJ3gtY29zLWNvcHktc291cmNlLUlmLU1hdGNoJzogJ0NvcHlTb3VyY2VJZk1hdGNoJyxcbiAgICAgICAgJ3gtY29zLWNvcHktc291cmNlLUlmLU5vbmUtTWF0Y2gnOiAnQ29weVNvdXJjZUlmTm9uZU1hdGNoJyxcbiAgICAgICAgJ3gtY29zLWFjbCc6ICdBQ0wnLFxuICAgICAgICAneC1jb3MtZ3JhbnQtcmVhZCc6ICdHcmFudFJlYWQnLFxuICAgICAgICAneC1jb3MtZ3JhbnQtd3JpdGUnOiAnR3JhbnRXcml0ZScsXG4gICAgICAgICd4LWNvcy1ncmFudC1mdWxsLWNvbnRyb2wnOiAnR3JhbnRGdWxsQ29udHJvbCcsXG4gICAgICAgICd4LWNvcy1ncmFudC1yZWFkLWFjcCc6ICdHcmFudFJlYWRBY3AnLFxuICAgICAgICAneC1jb3MtZ3JhbnQtd3JpdGUtYWNwJzogJ0dyYW50V3JpdGVBY3AnLFxuICAgICAgICAneC1jb3Mtc3RvcmFnZS1jbGFzcyc6ICdTdG9yYWdlQ2xhc3MnLFxuICAgICAgICAneC1jb3MtdHJhZmZpYy1saW1pdCc6ICdUcmFmZmljTGltaXQnLFxuICAgICAgICAneC1jb3MtbWltZS1saW1pdCc6ICdNaW1lTGltaXQnLFxuICAgICAgICAvLyBTU0UtQ1xuICAgICAgICAneC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbi1jdXN0b21lci1hbGdvcml0aG0nOiAnU1NFQ3VzdG9tZXJBbGdvcml0aG0nLFxuICAgICAgICAneC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbi1jdXN0b21lci1rZXknOiAnU1NFQ3VzdG9tZXJLZXknLFxuICAgICAgICAneC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbi1jdXN0b21lci1rZXktTUQ1JzogJ1NTRUN1c3RvbWVyS2V5TUQ1JyxcbiAgICAgICAgLy8gU1NFLUNPU+OAgVNTRS1LTVNcbiAgICAgICAgJ3gtY29zLXNlcnZlci1zaWRlLWVuY3J5cHRpb24nOiAnU2VydmVyU2lkZUVuY3J5cHRpb24nLFxuICAgICAgICAneC1jb3Mtc2VydmVyLXNpZGUtZW5jcnlwdGlvbi1jb3Mta21zLWtleS1pZCc6ICdTU0VLTVNLZXlJZCcsXG4gICAgICAgICd4LWNvcy1zZXJ2ZXItc2lkZS1lbmNyeXB0aW9uLWNvbnRleHQnOiAnU1NFQ29udGV4dCdcbiAgICAgIH07XG4gICAgICB1dGlsLmVhY2goaGVhZGVyTWFwLCBmdW5jdGlvbiAocGFyYW1LZXksIGhlYWRlcktleSkge1xuICAgICAgICBpZiAocGFyYW1zW3BhcmFtS2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgSGVhZGVyc1toZWFkZXJLZXldID0gcGFyYW1zW3BhcmFtS2V5XTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBwYXJhbXMuSGVhZGVycyA9IGNsZWFyS2V5KEhlYWRlcnMpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYXJhbXM7XG59O1xuXG52YXIgYXBpV3JhcHBlciA9IGZ1bmN0aW9uIGFwaVdyYXBwZXIoYXBpTmFtZSwgYXBpRm4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChwYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzOyAvLyDlpITnkIblj4LmlbBcblxuICAgIGlmICh0eXBlb2YgcGFyYW1zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYWxsYmFjayA9IHBhcmFtcztcbiAgICAgIHBhcmFtcyA9IHt9O1xuICAgIH0gLy8g5pW055CG5Y+C5pWw5qC85byPXG5cblxuICAgIHBhcmFtcyA9IGZvcm1hdFBhcmFtcyhhcGlOYW1lLCBwYXJhbXMpOyAvLyB0cmFja2Vy5Lyg6YCSXG5cbiAgICB2YXIgdHJhY2tlcjtcblxuICAgIGlmIChzZWxmLm9wdGlvbnMuRW5hYmxlVHJhY2tlcikge1xuICAgICAgaWYgKHBhcmFtcy5jYWxsZWRCeVNkayA9PT0gJ3NsaWNlVXBsb2FkRmlsZScpIHtcbiAgICAgICAgLy8g5YiG5Z2X5LiK5Lyg5YaF6YOo5pa55rOV5L2/55Soc2xpY2VVcGxvYWRGaWxl55qE5a2Q6ZO+6LevXG4gICAgICAgIHRyYWNrZXIgPSBwYXJhbXMudHJhY2tlciAmJiBwYXJhbXMudHJhY2tlci5nZW5lcmF0ZVN1YlRyYWNrZXIoe1xuICAgICAgICAgIGFwaU5hbWU6IGFwaU5hbWVcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKFsndXBsb2FkRmlsZScsICd1cGxvYWRGaWxlcyddLmluY2x1ZGVzKGFwaU5hbWUpKSB7XG4gICAgICAgIC8vIHVwbG9hZEZpbGXjgIF1cGxvYWRGaWxlc+aWueazleWcqOWGhemDqOWkhOeQhu+8jOatpOWkhOS4jeWkhOeQhlxuICAgICAgICB0cmFja2VyID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBmaWxlU2l6ZSA9IC0xO1xuXG4gICAgICAgIGlmIChwYXJhbXMuQm9keSkge1xuICAgICAgICAgIGZpbGVTaXplID0gdHlwZW9mIHBhcmFtcy5Cb2R5ID09PSAnc3RyaW5nJyA/IHBhcmFtcy5Cb2R5Lmxlbmd0aCA6IHBhcmFtcy5Cb2R5LnNpemUgfHwgcGFyYW1zLkJvZHkuYnl0ZUxlbmd0aCB8fCAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyYWNrZXIgPSBuZXcgVHJhY2tlcih7XG4gICAgICAgICAgYnVja2V0OiBwYXJhbXMuQnVja2V0LFxuICAgICAgICAgIHJlZ2lvbjogcGFyYW1zLlJlZ2lvbixcbiAgICAgICAgICBhcGlOYW1lOiBhcGlOYW1lLFxuICAgICAgICAgIGZpbGVLZXk6IHBhcmFtcy5LZXksXG4gICAgICAgICAgZmlsZVNpemU6IGZpbGVTaXplLFxuICAgICAgICAgIGRlZXBUcmFja2VyOiBzZWxmLm9wdGlvbnMuRGVlcFRyYWNrZXIsXG4gICAgICAgICAgY3VzdG9tSWQ6IHNlbGYub3B0aW9ucy5DdXN0b21JZCxcbiAgICAgICAgICBkZWxheTogc2VsZi5vcHRpb25zLlRyYWNrZXJEZWxheVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwYXJhbXMudHJhY2tlciA9IHRyYWNrZXI7IC8vIOS7o+eQhuWbnuiwg+WHveaVsFxuXG4gICAgdmFyIGZvcm1hdFJlc3VsdCA9IGZ1bmN0aW9uIGZvcm1hdFJlc3VsdChyZXN1bHQpIHtcbiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmhlYWRlcnMpIHtcbiAgICAgICAgcmVzdWx0LmhlYWRlcnNbJ3gtY29zLXJlcXVlc3QtaWQnXSAmJiAocmVzdWx0LlJlcXVlc3RJZCA9IHJlc3VsdC5oZWFkZXJzWyd4LWNvcy1yZXF1ZXN0LWlkJ10pO1xuICAgICAgICByZXN1bHQuaGVhZGVyc1sneC1jaS1yZXF1ZXN0LWlkJ10gJiYgKHJlc3VsdC5SZXF1ZXN0SWQgPSByZXN1bHQuaGVhZGVyc1sneC1jaS1yZXF1ZXN0LWlkJ10pO1xuICAgICAgICByZXN1bHQuaGVhZGVyc1sneC1jb3MtdmVyc2lvbi1pZCddICYmIChyZXN1bHQuVmVyc2lvbklkID0gcmVzdWx0LmhlYWRlcnNbJ3gtY29zLXZlcnNpb24taWQnXSk7XG4gICAgICAgIHJlc3VsdC5oZWFkZXJzWyd4LWNvcy1kZWxldGUtbWFya2VyJ10gJiYgKHJlc3VsdC5EZWxldGVNYXJrZXIgPSByZXN1bHQuaGVhZGVyc1sneC1jb3MtZGVsZXRlLW1hcmtlciddKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuXG4gICAgdmFyIF9jYWxsYmFjayA9IGZ1bmN0aW9uIF9jYWxsYmFjayhlcnIsIGRhdGEpIHtcbiAgICAgIC8vIOagvOW8j+WMluS4iuaKpeWPguaVsOW5tuS4iuaKpVxuICAgICAgdHJhY2tlciAmJiB0cmFja2VyLmZvcm1hdFJlc3VsdChlcnIsIGRhdGEpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZm9ybWF0UmVzdWx0KGVyciksIGZvcm1hdFJlc3VsdChkYXRhKSk7XG4gICAgfTtcblxuICAgIHZhciBjaGVja1BhcmFtcyA9IGZ1bmN0aW9uIGNoZWNrUGFyYW1zKCkge1xuICAgICAgaWYgKGFwaU5hbWUgIT09ICdnZXRTZXJ2aWNlJyAmJiBhcGlOYW1lICE9PSAnYWJvcnRVcGxvYWRUYXNrJykge1xuICAgICAgICAvLyDliKTmlq3lj4LmlbDmmK/lkKblrozmlbRcbiAgICAgICAgdmFyIG1pc3NpbmdSZXN1bHQgPSBoYXNNaXNzaW5nUGFyYW1zLmNhbGwoc2VsZiwgYXBpTmFtZSwgcGFyYW1zKTtcblxuICAgICAgICBpZiAobWlzc2luZ1Jlc3VsdCkge1xuICAgICAgICAgIHJldHVybiAnbWlzc2luZyBwYXJhbSAnICsgbWlzc2luZ1Jlc3VsdDtcbiAgICAgICAgfSAvLyDliKTmlq0gcmVnaW9uIOagvOW8j1xuXG5cbiAgICAgICAgaWYgKHBhcmFtcy5SZWdpb24pIHtcbiAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLkNvbXBhdGliaWxpdHlNb2RlKSB7XG4gICAgICAgICAgICBpZiAoIS9eKFthLXpcXGQtLl0rKSQvLnRlc3QocGFyYW1zLlJlZ2lvbikpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdSZWdpb24gZm9ybWF0IGVycm9yLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwYXJhbXMuUmVnaW9uLmluZGV4T2YoJ2Nvcy4nKSA+IC0xKSB7XG4gICAgICAgICAgICAgIHJldHVybiAncGFyYW0gUmVnaW9uIHNob3VsZCBub3QgYmUgc3RhcnQgd2l0aCBcImNvcy5cIic7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCEvXihbYS16XFxkLV0rKSQvLnRlc3QocGFyYW1zLlJlZ2lvbikpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdSZWdpb24gZm9ybWF0IGVycm9yLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSAvLyDliKTmlq0gcmVnaW9uIOagvOW8j1xuXG5cbiAgICAgICAgICBpZiAoIXNlbGYub3B0aW9ucy5Db21wYXRpYmlsaXR5TW9kZSAmJiBwYXJhbXMuUmVnaW9uLmluZGV4T2YoJy0nKSA9PT0gLTEgJiYgcGFyYW1zLlJlZ2lvbiAhPT0gJ3lmYicgJiYgcGFyYW1zLlJlZ2lvbiAhPT0gJ2RlZmF1bHQnICYmIHBhcmFtcy5SZWdpb24gIT09ICdhY2NlbGVyYXRlJykge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCd3YXJuaW5nOiBwYXJhbSBSZWdpb24gZm9ybWF0IGVycm9yLCBmaW5kIGhlbHAgaGVyZTogaHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNi82MjI0Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIOWFvOWuueS4jeW4piBBcHBJZCDnmoQgQnVja2V0XG5cblxuICAgICAgICBpZiAocGFyYW1zLkJ1Y2tldCkge1xuICAgICAgICAgIGlmICghL14oW2EtelxcZC1dKyktKFxcZCspJC8udGVzdChwYXJhbXMuQnVja2V0KSkge1xuICAgICAgICAgICAgaWYgKHBhcmFtcy5BcHBJZCkge1xuICAgICAgICAgICAgICBwYXJhbXMuQnVja2V0ID0gcGFyYW1zLkJ1Y2tldCArICctJyArIHBhcmFtcy5BcHBJZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VsZi5vcHRpb25zLkFwcElkKSB7XG4gICAgICAgICAgICAgIHBhcmFtcy5CdWNrZXQgPSBwYXJhbXMuQnVja2V0ICsgJy0nICsgc2VsZi5vcHRpb25zLkFwcElkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdCdWNrZXQgc2hvdWxkIGZvcm1hdCBhcyBcInRlc3QtMTI1MDAwMDAwMFwiLic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHBhcmFtcy5BcHBJZCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCd3YXJuaW5nOiBBcHBJZCBoYXMgYmVlbiBkZXByZWNhdGVkLCBQbGVhc2UgcHV0IGl0IGF0IHRoZSBlbmQgb2YgcGFyYW1ldGVyIEJ1Y2tldChFLmcgQnVja2V0OlwidGVzdC0xMjUwMDAwMDAwXCIgKS4nKTtcbiAgICAgICAgICAgIGRlbGV0ZSBwYXJhbXMuQXBwSWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIOWmguaenCBLZXkg5pivIC8g5byA5aS077yM5by65Yi25Y675o6J56ys5LiA5LiqIC9cblxuXG4gICAgICAgIGlmICghc2VsZi5vcHRpb25zLlVzZVJhd0tleSAmJiBwYXJhbXMuS2V5ICYmIHBhcmFtcy5LZXkuc3Vic3RyKDAsIDEpID09PSAnLycpIHtcbiAgICAgICAgICBwYXJhbXMuS2V5ID0gcGFyYW1zLktleS5zdWJzdHIoMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGVyck1zZyA9IGNoZWNrUGFyYW1zKCk7XG4gICAgdmFyIGlzU3luYyA9IFsnZ2V0QXV0aCcsICdnZXRPYmplY3RVcmwnXS5pbmNsdWRlcyhhcGlOYW1lKTtcblxuICAgIGlmICh0eXBlb2YgUHJvbWlzZSA9PT0gJ2Z1bmN0aW9uJyAmJiAhaXNTeW5jICYmICFjYWxsYmFjaykge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayhlcnIsIGRhdGEpIHtcbiAgICAgICAgICBlcnIgPyByZWplY3QoZXJyKSA6IHJlc29sdmUoZGF0YSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKGVyck1zZykgcmV0dXJuIF9jYWxsYmFjayh1dGlsLmVycm9yKG5ldyBFcnJvcihlcnJNc2cpKSk7XG4gICAgICAgIGFwaUZuLmNhbGwoc2VsZiwgcGFyYW1zLCBfY2FsbGJhY2spO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChlcnJNc2cpIHJldHVybiBfY2FsbGJhY2sodXRpbC5lcnJvcihuZXcgRXJyb3IoZXJyTXNnKSkpO1xuICAgICAgdmFyIHJlcyA9IGFwaUZuLmNhbGwoc2VsZiwgcGFyYW1zLCBfY2FsbGJhY2spO1xuICAgICAgaWYgKGlzU3luYykgcmV0dXJuIHJlcztcbiAgICB9XG4gIH07XG59O1xuXG52YXIgdGhyb3R0bGVPblByb2dyZXNzID0gZnVuY3Rpb24gdGhyb3R0bGVPblByb2dyZXNzKHRvdGFsLCBvblByb2dyZXNzKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIHNpemUwID0gMDtcbiAgdmFyIHNpemUxID0gMDtcbiAgdmFyIHRpbWUwID0gRGF0ZS5ub3coKTtcbiAgdmFyIHRpbWUxO1xuICB2YXIgdGltZXI7XG5cbiAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgIHRpbWVyID0gMDtcblxuICAgIGlmIChvblByb2dyZXNzICYmIHR5cGVvZiBvblByb2dyZXNzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aW1lMSA9IERhdGUubm93KCk7XG4gICAgICB2YXIgc3BlZWQgPSBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChzaXplMSAtIHNpemUwKSAvICgodGltZTEgLSB0aW1lMCkgLyAxMDAwKSAqIDEwMCkgLyAxMDApIHx8IDA7XG4gICAgICB2YXIgcGVyY2VudDtcblxuICAgICAgaWYgKHNpemUxID09PSAwICYmIHRvdGFsID09PSAwKSB7XG4gICAgICAgIHBlcmNlbnQgPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGVyY2VudCA9IE1hdGguZmxvb3Ioc2l6ZTEgLyB0b3RhbCAqIDEwMCkgLyAxMDAgfHwgMDtcbiAgICAgIH1cblxuICAgICAgdGltZTAgPSB0aW1lMTtcbiAgICAgIHNpemUwID0gc2l6ZTE7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIG9uUHJvZ3Jlc3Moe1xuICAgICAgICAgIGxvYWRlZDogc2l6ZTEsXG4gICAgICAgICAgdG90YWw6IHRvdGFsLFxuICAgICAgICAgIHNwZWVkOiBzcGVlZCxcbiAgICAgICAgICBwZXJjZW50OiBwZXJjZW50XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZSkge31cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZnVuY3Rpb24gKGluZm8sIGltbWVkaWF0ZWx5KSB7XG4gICAgaWYgKGluZm8pIHtcbiAgICAgIHNpemUxID0gaW5mby5sb2FkZWQ7XG4gICAgICB0b3RhbCA9IGluZm8udG90YWw7XG4gICAgfVxuXG4gICAgaWYgKGltbWVkaWF0ZWx5KSB7XG4gICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdXBkYXRlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aW1lcikgcmV0dXJuO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KHVwZGF0ZSwgc2VsZi5vcHRpb25zLlByb2dyZXNzSW50ZXJ2YWwpO1xuICAgIH1cbiAgfTtcbn07XG5cbnZhciBnZXRGaWxlU2l6ZSA9IGZ1bmN0aW9uIGdldEZpbGVTaXplKGFwaSwgcGFyYW1zLCBjYWxsYmFjaykge1xuICB2YXIgc2l6ZTtcblxuICBpZiAodHlwZW9mIHBhcmFtcy5Cb2R5ID09PSAnc3RyaW5nJykge1xuICAgIHBhcmFtcy5Cb2R5ID0gbmV3IEJsb2IoW3BhcmFtcy5Cb2R5XSwge1xuICAgICAgdHlwZTogJ3RleHQvcGxhaW4nXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAocGFyYW1zLkJvZHkgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xuICAgIHBhcmFtcy5Cb2R5ID0gbmV3IEJsb2IoW3BhcmFtcy5Cb2R5XSk7XG4gIH1cblxuICBpZiAocGFyYW1zLkJvZHkgJiYgKHBhcmFtcy5Cb2R5IGluc3RhbmNlb2YgQmxvYiB8fCBwYXJhbXMuQm9keS50b1N0cmluZygpID09PSAnW29iamVjdCBGaWxlXScgfHwgcGFyYW1zLkJvZHkudG9TdHJpbmcoKSA9PT0gJ1tvYmplY3QgQmxvYl0nKSkge1xuICAgIHNpemUgPSBwYXJhbXMuQm9keS5zaXplO1xuICB9IGVsc2Uge1xuICAgIGNhbGxiYWNrKHV0aWwuZXJyb3IobmV3IEVycm9yKCdwYXJhbXMgYm9keSBmb3JtYXQgZXJyb3IsIE9ubHkgYWxsb3cgRmlsZXxCbG9ifFN0cmluZy4nKSkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHBhcmFtcy5Db250ZW50TGVuZ3RoID0gc2l6ZTtcbiAgY2FsbGJhY2sobnVsbCwgc2l6ZSk7XG59OyAvLyDojrflj5bosIPmraPnmoTml7bpl7TmiLNcblxuXG52YXIgZ2V0U2tld1RpbWUgPSBmdW5jdGlvbiBnZXRTa2V3VGltZShvZmZzZXQpIHtcbiAgcmV0dXJuIERhdGUubm93KCkgKyAob2Zmc2V0IHx8IDApO1xufTtcblxudmFyIGVycm9yID0gZnVuY3Rpb24gZXJyb3IoZXJyLCBvcHQpIHtcbiAgdmFyIHNvdXJjZUVyciA9IGVycjtcbiAgZXJyLm1lc3NhZ2UgPSBlcnIubWVzc2FnZSB8fCBudWxsO1xuXG4gIGlmICh0eXBlb2Ygb3B0ID09PSAnc3RyaW5nJykge1xuICAgIGVyci5lcnJvciA9IG9wdDtcbiAgICBlcnIubWVzc2FnZSA9IG9wdDtcbiAgfSBlbHNlIGlmIChfdHlwZW9mKG9wdCkgPT09ICdvYmplY3QnICYmIG9wdCAhPT0gbnVsbCkge1xuICAgIGV4dGVuZChlcnIsIG9wdCk7XG4gICAgaWYgKG9wdC5jb2RlIHx8IG9wdC5uYW1lKSBlcnIuY29kZSA9IG9wdC5jb2RlIHx8IG9wdC5uYW1lO1xuICAgIGlmIChvcHQubWVzc2FnZSkgZXJyLm1lc3NhZ2UgPSBvcHQubWVzc2FnZTtcbiAgICBpZiAob3B0LnN0YWNrKSBlcnIuc3RhY2sgPSBvcHQuc3RhY2s7XG4gIH1cblxuICBpZiAodHlwZW9mIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlcnIsICduYW1lJywge1xuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlcnIsICdtZXNzYWdlJywge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICB9XG5cbiAgZXJyLm5hbWUgPSBvcHQgJiYgb3B0Lm5hbWUgfHwgZXJyLm5hbWUgfHwgZXJyLmNvZGUgfHwgJ0Vycm9yJztcbiAgaWYgKCFlcnIuY29kZSkgZXJyLmNvZGUgPSBlcnIubmFtZTtcbiAgaWYgKCFlcnIuZXJyb3IpIGVyci5lcnJvciA9IGNsb25lKHNvdXJjZUVycik7IC8vIOWFvOWuueiAgeeahOmUmeivr+agvOW8j1xuXG4gIHJldHVybiBlcnI7XG59O1xuXG52YXIgaXNXZWJXb3JrZXIgPSBmdW5jdGlvbiBpc1dlYldvcmtlcigpIHtcbiAgLy8g5pyJ6ZmQ5Yik5patIHdvcmtlciDnjq/looPnmoQgY29uc3RydWN0b3IgbmFtZSDlhbbmrKHnlKggd29ya2VyIOeLrOacieeahCBGaWxlUmVhZGVyU3luYyDlhZzlupUg6K+m57uG5Y+C6ICDIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL3poLUNOL2RvY3MvV2ViL0FQSS9XZWJfV29ya2Vyc19BUEkvVXNpbmdfd2ViX3dvcmtlcnNcbiAgcmV0dXJuICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKGdsb2JhbFRoaXMpKSA9PT0gJ29iamVjdCcgJiYgKGdsb2JhbFRoaXMuY29uc3RydWN0b3IubmFtZSA9PT0gJ0RlZGljYXRlZFdvcmtlckdsb2JhbFNjb3BlJyB8fCBnbG9iYWxUaGlzLkZpbGVSZWFkZXJTeW5jKTtcbn07XG5cbnZhciBpc05vZGUgPSBmdW5jdGlvbiBpc05vZGUoKSB7XG4gIC8vIOW+l+WFnOW6lSB3ZWIgd29ya2VyIOeOr+Wig+S4rSB3ZWJwYWNrIOeUqOS6hiBwcm9jZXNzIOaPkuS7tuS5i+exu+eahOaDheWGtVxuICByZXR1cm4gKHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZih3aW5kb3cpKSAhPT0gJ29iamVjdCcgJiYgKHR5cGVvZiBwcm9jZXNzID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YocHJvY2VzcykpID09PSAnb2JqZWN0JyAmJiBcImZ1bmN0aW9uXCIgPT09ICdmdW5jdGlvbicgJiYgIWlzV2ViV29ya2VyKCk7XG59O1xuXG52YXIgaXNDSUhvc3QgPSBmdW5jdGlvbiBpc0NJSG9zdCh1cmwpIHtcbiAgcmV0dXJuIC9eaHR0cHM/OlxcL1xcLyhbXi9dK1xcLik/Y2lcXC5bXi9dKy8udGVzdCh1cmwpO1xufTsgLy/liKTmlq3mmK/lkKbmmK9pb3NcblxuXG52YXIgaXNJT1MgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICgodHlwZW9mIG5hdmlnYXRvciA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG5hdmlnYXRvcikpICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhciB1ID0gbmF2aWdhdG9yLnVzZXJBZ2VudDtcbiAgdmFyIGlzSU9TID0gISF1Lm1hdGNoKC9cXChpW147XSs7KCBVOyk/IENQVS4rTWFjIE9TIFgvKTsgLy9pb3Pnu4jnq69cblxuICByZXR1cm4gaXNJT1M7XG59KCk7IC8vIOWIpOaWreaYr3Fx5YaF572u5rWP6KeI5ZmoXG5cblxudmFyIGlzUVEgPSBmdW5jdGlvbiAoKSB7XG4gIGlmICgodHlwZW9mIG5hdmlnYXRvciA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG5hdmlnYXRvcikpICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiAvXFxzUVEvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xufSgpO1xuXG52YXIgdXRpbCA9IHtcbiAgbm9vcDogbm9vcCxcbiAgZm9ybWF0UGFyYW1zOiBmb3JtYXRQYXJhbXMsXG4gIGFwaVdyYXBwZXI6IGFwaVdyYXBwZXIsXG4gIHhtbDJqc29uOiB4bWwyanNvbixcbiAganNvbjJ4bWw6IGpzb24yeG1sLFxuICBtZDU6IG1kNSxcbiAgY2xlYXJLZXk6IGNsZWFyS2V5LFxuICBmaWxlU2xpY2U6IGZpbGVTbGljZSxcbiAgZ2V0Qm9keU1kNTogZ2V0Qm9keU1kNSxcbiAgZ2V0RmlsZU1kNTogZ2V0RmlsZU1kNSxcbiAgYmluYXJ5QmFzZTY0OiBiaW5hcnlCYXNlNjQsXG4gIGV4dGVuZDogZXh0ZW5kLFxuICBpc0FycmF5OiBpc0FycmF5LFxuICBpc0luQXJyYXk6IGlzSW5BcnJheSxcbiAgbWFrZUFycmF5OiBtYWtlQXJyYXksXG4gIGVhY2g6IGVhY2gsXG4gIG1hcDogbWFwLFxuICBmaWx0ZXI6IGZpbHRlcixcbiAgY2xvbmU6IGNsb25lLFxuICBhdHRyOiBhdHRyLFxuICB1dWlkOiB1dWlkLFxuICBjYW1TYWZlVXJsRW5jb2RlOiBjYW1TYWZlVXJsRW5jb2RlLFxuICB0aHJvdHRsZU9uUHJvZ3Jlc3M6IHRocm90dGxlT25Qcm9ncmVzcyxcbiAgZ2V0RmlsZVNpemU6IGdldEZpbGVTaXplLFxuICBnZXRTa2V3VGltZTogZ2V0U2tld1RpbWUsXG4gIGVycm9yOiBlcnJvcixcbiAgb2JqMnN0cjogb2JqMnN0cixcbiAgZ2V0QXV0aDogZ2V0QXV0aCxcbiAgcGFyc2VTZWxlY3RQYXlsb2FkOiBwYXJzZVNlbGVjdFBheWxvYWQsXG4gIGdldFNvdXJjZVBhcmFtczogZ2V0U291cmNlUGFyYW1zLFxuICBpc0Jyb3dzZXI6IHRydWUsXG4gIGlzTm9kZTogaXNOb2RlLFxuICBpc0NJSG9zdDogaXNDSUhvc3QsXG4gIGlzSU9TX1FROiBpc0lPUyAmJiBpc1FRXG59O1xubW9kdWxlLmV4cG9ydHMgPSB1dGlsO1xuLyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKHRoaXMsIF9fd2VicGFja19yZXF1aXJlX18oLyohIC4vLi4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyAqLyBcIi4vbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qc1wiKSkpXG5cbi8qKiovIH0pXG5cbi8qKioqKiovIH0pO1xufSk7Il0sInNvdXJjZVJvb3QiOiIifQ==